import{a9 as se,F as oe,r as g,j as ne,B as re,aa as ie,q as m,G as w,H as i,v as s,I as e,ad as y,J as h,s as f,ab as C,ac as k,x as n,aO as de,af as T,ae as S,ag as L,y as R,aj as A,K as x,ah as K,ai as W}from"./index.9a35c593.js";import{Q as ue}from"./QHeader.a42b297c.js";import{Q as me}from"./QSpinnerPuff.63c3b3e5.js";import{Q as X}from"./QBadge.7863268c.js";import{Q as ce,a as O}from"./QTabs.f2c953d4.js";import{a as ge,Q as B}from"./QTabPanel.3046a235.js";import{Q as Y}from"./QMarkupTable.b4086e71.js";import{Q as Z}from"./QSelect.8858cdb5.js";import{Q as _e}from"./QPage.b11f49d7.js";import{Q as ve,a as fe}from"./QLayout.356bc385.js";import{C as $}from"./ClosePopup.9fe58d5a.js";import{u as pe}from"./use-quasar.1dd06edd.js";import{s as ee}from"./supabase.f526ede5.js";import{n as be}from"./navigationUtils.2c4b9dee.js";import{a as D}from"./api.2af71db3.js";import{C as ye}from"./ClubNavigationMenu.49bb71fc.js";import{g as he}from"./tournamentUtils.cfdf57cc.js";import{_ as ke}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.7b658e35.js";import"./use-render-cache.770e5fe8.js";import"./selection.35df2a5b.js";import"./QChip.b0962c0b.js";import"./QItem.ddb840f4.js";import"./QItemLabel.9694ed54.js";import"./QMenu.d88a69b5.js";import"./position-engine.08590986.js";import"./format.de7e9769.js";import"./QFooter.4bd3b6d2.js";const xe={name:"ManageTournament",components:{ClubNavigationMenu:ye},setup(){const q=se(),t=oe(),p=pe(),a=g(null),E=g([]),P=g([]),F=g(!1),l=g("matches"),c=g(!1),d=g(!1),N=g(!1),v=g(null),M=g(!1),U=g(!1),_=g({set1_team1:null,set1_team2:null,set2_team1:null,set2_team2:null,set3_team1:null,set3_team2:null,winner:null}),Q=g({match_date:null,match_time:null,court_id:null}),j=g([]),te=ne(()=>v.value?[{label:v.value.team1,value:v.value.team1_players[0]},{label:v.value.team2,value:v.value.team2_players[0]}]:[]);re(async()=>{await ae(),await I(),await z(),await le()});const ae=async()=>{F.value=!0;try{const o=q.params.tournamentId,{data:r,error:u}=await ee.from("tournaments").select("*").eq("id",o).single();if(u)throw u;a.value=r}catch(o){console.error("Error loading tournament:",o),p.notify({type:"negative",message:"Error al cargar el torneo"})}finally{F.value=!1}},I=async()=>{try{const o=q.params.tournamentId,r=await D.get(`/tournaments/${o}/matches`);E.value=r.data.matches}catch(o){console.error("Error loading matches:",o),p.notify({type:"negative",message:"Error al cargar los partidos"})}},z=async()=>{try{const o=q.params.tournamentId,r=await D.get(`/tournaments/${o}/standings`);P.value=r.data.standings,c.value=r.data.is_retas||!1}catch(o){console.error("Error loading standings:",o),p.notify({type:"negative",message:"Error al cargar las posiciones"})}},le=async()=>{var o;try{if((o=a.value)!=null&&o.courts_used){const{data:r,error:u}=await ee.from("courts").select("id, name").in("id",a.value.courts_used);!u&&r&&(j.value=r.map(V=>({label:V.name,value:V.id})))}}catch(r){console.error("Error loading courts:",r)}};return{tournament:a,matches:E,standings:P,loading:F,activeTab:l,isRetasTournament:c,resultDialogVisible:d,rescheduleDialogVisible:N,selectedMatch:v,resultForm:_,rescheduleForm:Q,courtOptions:j,winnerOptions:te,savingResult:M,savingReschedule:U,getSystemName:o=>he(o),formatScore:o=>{if(!o)return"Sin resultado";try{const r=typeof o=="string"?JSON.parse(o):o;let u=[];return r.set1&&u.push(`${r.set1.team1}-${r.set1.team2}`),r.set2&&u.push(`${r.set2.team1}-${r.set2.team2}`),r.set3&&u.push(`${r.set3.team1}-${r.set3.team2}`),u.join(", ")}catch{return"Error en formato"}},openResultDialog:o=>{var r,u,V,G,J,H;if(v.value=o,o.score)try{const b=typeof o.score=="string"?JSON.parse(o.score):o.score;_.value={set1_team1:((r=b.set1)==null?void 0:r.team1)||null,set1_team2:((u=b.set1)==null?void 0:u.team2)||null,set2_team1:((V=b.set2)==null?void 0:V.team1)||null,set2_team2:((G=b.set2)==null?void 0:G.team2)||null,set3_team1:((J=b.set3)==null?void 0:J.team1)||null,set3_team2:((H=b.set3)==null?void 0:H.team2)||null,winner:o.winner}}catch(b){console.error("Error parsing score:",b)}else _.value={set1_team1:null,set1_team2:null,set2_team1:null,set2_team2:null,set3_team1:null,set3_team2:null,winner:null};d.value=!0},openRescheduleDialog:o=>{v.value=o,Q.value={match_date:o.match_date,match_time:o.match_time,court_id:o.court_id},N.value=!0},saveResult:async()=>{var o,r;if(!!v.value){if(!_.value.winner){p.notify({type:"negative",message:"Debes seleccionar un ganador"});return}M.value=!0;try{const u={set1:{team1:_.value.set1_team1,team2:_.value.set1_team2},set2:{team1:_.value.set2_team1,team2:_.value.set2_team2}};_.value.set3_team1!==null&&_.value.set3_team2!==null&&(u.set3={team1:_.value.set3_team1,team2:_.value.set3_team2});const V=await D.put(`/tournaments/${a.value.id}/matches/${v.value.id}/result`,{score:u,winner:_.value.winner});p.notify({type:"positive",message:"Resultado guardado exitosamente"}),d.value=!1,await I(),await z()}catch(u){console.error("Error saving result:",u),p.notify({type:"negative",message:((r=(o=u.response)==null?void 0:o.data)==null?void 0:r.detail)||"Error al guardar el resultado"})}finally{M.value=!1}}},saveReschedule:async()=>{var o,r;if(!!v.value){U.value=!0;try{const u=await D.put(`/tournaments/${a.value.id}/matches/${v.value.id}/reschedule`,{match_date:Q.value.match_date,match_time:Q.value.match_time+":00",court_id:Q.value.court_id});p.notify({type:"positive",message:"Partido reagendado exitosamente"}),N.value=!1,await I()}catch(u){console.error("Error rescheduling match:",u),p.notify({type:"negative",message:((r=(o=u.response)==null?void 0:o.data)==null?void 0:r.detail)||"Error al reagendar el partido"})}finally{U.value=!1}}},goBack:()=>{t.back()},goToDashboard:()=>{be(t,userStore)}}}},Ve={class:"header-content"},we={class:"greeting"},Ce={class:"header-icons"},Re={key:0,class:"text-center q-mt-md"},Fe={key:1},Qe={class:"q-mt-none"},qe={class:"row q-gutter-md"},Te={class:"col"},Se={class:"col"},De={class:"matches-list"},Ee={class:"match-header row items-center justify-between"},Pe={class:"col"},Ne={class:"q-my-none"},Me={class:"text-caption q-mb-none"},Ue={class:"col-auto"},Ie={key:0,class:"q-mt-md"},Oe={class:"q-mt-md row q-gutter-sm"},Be={key:0,class:"text-center q-pa-xl"},je={class:"text-left"},ze={class:"text-left"},Ge={class:"text-center"},Je={class:"text-center"},He={class:"text-center"},Le={class:"text-center"},Ae={class:"text-left"},Ke={class:"text-left"},We={class:"text-center"},Xe={class:"text-center"},Ye={class:"text-center"},Ze={class:"text-center"},$e={key:2,class:"text-center q-pa-xl"},et={class:"bracket-view q-mt-md"},tt={class:"bracket-match-content"},at={class:"bracket-team"},lt={class:"bracket-team"},st={class:"bracket-details text-caption"},ot={class:"q-gutter-md"},nt={class:"q-gutter-md"};function rt(q,t,p,a,E,P){const F=ie("ClubNavigationMenu");return m(),w(ve,{view:"hHh lpR fFf",class:"body text-white"},{default:i(()=>[s(ue,{elevated:"",class:"bg-primary text-white"},{default:i(()=>[e("div",Ve,[e("div",we,[e("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...l)=>a.goToDashboard&&a.goToDashboard(...l))}),t[15]||(t[15]=y(" Administrar Torneo "))]),e("div",Ce,[s(h,{flat:"",round:"",icon:"arrow_back",onClick:a.goBack},null,8,["onClick"])])])]),_:1}),s(fe,null,{default:i(()=>[s(_e,{class:"q-pa-md"},{default:i(()=>[a.loading?(m(),f("div",Re,[s(me,{color:"primary",size:"3em"}),t[16]||(t[16]=e("p",null,"Cargando informaci\xF3n del torneo...",-1))])):a.tournament?(m(),f("div",Fe,[s(C,{class:"q-mb-md transparent-card"},{default:i(()=>[s(k,null,{default:i(()=>[e("h4",Qe,n(a.tournament.name),1),e("div",qe,[e("div",Te,[e("p",null,[t[17]||(t[17]=e("strong",null,"Sistema:",-1)),y(" "+n(a.getSystemName(a.tournament.system)),1)]),e("p",null,[t[18]||(t[18]=e("strong",null,"Categor\xEDa:",-1)),y(" "+n(a.tournament.category),1)]),e("p",null,[t[19]||(t[19]=e("strong",null,"G\xE9nero:",-1)),y(" "+n(a.tournament.gender),1)])]),e("div",Se,[e("p",null,[t[20]||(t[20]=e("strong",null,"Fecha Inicio:",-1)),y(" "+n(a.tournament.start_date),1)]),e("p",null,[t[21]||(t[21]=e("strong",null,"Fecha Fin:",-1)),y(" "+n(a.tournament.end_date),1)]),e("p",null,[t[23]||(t[23]=e("strong",null,"Estado:",-1)),s(X,{color:"green"},{default:i(()=>t[22]||(t[22]=[y("Cerrado")])),_:1})])])])]),_:1})]),_:1}),s(ce,{modelValue:a.activeTab,"onUpdate:modelValue":t[1]||(t[1]=l=>a.activeTab=l),dense:"",class:"text-white","active-color":"primary","indicator-color":"primary",align:"justify"},{default:i(()=>[s(O,{name:"matches",label:"Partidos",icon:"sports_tennis"}),s(O,{name:"standings",label:"Posiciones",icon:"emoji_events"}),s(O,{name:"bracket",label:"Cuadro",icon:"grid_on"})]),_:1},8,["modelValue"]),s(de),s(ge,{modelValue:a.activeTab,"onUpdate:modelValue":t[2]||(t[2]=l=>a.activeTab=l),animated:"",class:"transparent-bg"},{default:i(()=>[s(B,{name:"matches"},{default:i(()=>[e("div",De,[(m(!0),f(T,null,S(a.matches,l=>(m(),w(C,{key:l.id,class:"q-mb-md transparent-card"},{default:i(()=>[s(k,null,{default:i(()=>[e("div",Ee,[e("div",Pe,[e("h6",Ne,n(l.team1)+" vs "+n(l.team2),1),e("p",Me,n(l.match_date)+" - "+n(l.match_time.substring(0,5))+" | Cancha: "+n(l.court_name),1)]),e("div",Ue,[s(X,{color:l.has_result?"green":"orange",label:l.has_result?"Finalizado":"Pendiente"},null,8,["color","label"])])]),l.has_result?(m(),f("div",Ie,[e("p",null,[t[24]||(t[24]=e("strong",null,"Resultado:",-1)),y(" "+n(a.formatScore(l.score)),1)])])):R("",!0),e("div",Oe,[l.has_result?R("",!0):(m(),w(h,{key:0,label:"Registrar Resultado",color:"green",size:"sm",icon:"edit_note",onClick:c=>a.openResultDialog(l)},null,8,["onClick"])),l.has_result?(m(),w(h,{key:1,label:"Editar Resultado",color:"primary",size:"sm",icon:"edit",onClick:c=>a.openResultDialog(l)},null,8,["onClick"])):R("",!0),s(h,{label:"Reagendar",color:"orange",size:"sm",icon:"schedule",onClick:c=>a.openRescheduleDialog(l)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),a.matches.length===0?(m(),f("div",Be,[s(L,{name:"info",size:"3em",color:"grey"}),t[25]||(t[25]=e("p",null,"No hay partidos programados",-1))])):R("",!0)])]),_:1}),s(B,{name:"standings"},{default:i(()=>[s(C,{class:"transparent-card"},{default:i(()=>[s(k,null,{default:i(()=>[t[29]||(t[29]=e("h6",{class:"q-mt-none"},"Tabla de Posiciones",-1)),a.isRetasTournament?(m(),w(Y,{key:0,flat:"",bordered:"",class:"standings-table"},{default:i(()=>[t[26]||(t[26]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Pos"),e("th",{class:"text-left"},"Jugador"),e("th",{class:"text-center"},"PJ"),e("th",{class:"text-center"},"PG"),e("th",{class:"text-center"},"PP"),e("th",{class:"text-center"},"% Victorias")])],-1)),e("tbody",null,[(m(!0),f(T,null,S(a.standings,(l,c)=>(m(),f("tr",{key:l.team_id},[e("td",je,n(c+1),1),e("td",ze,n(l.team_name),1),e("td",Ge,n(l.matches_played),1),e("td",Je,n(l.wins),1),e("td",He,n(l.losses),1),e("td",Le,[e("strong",null,n(l.win_percentage)+"%",1)])]))),128))])]),_:1})):(m(),w(Y,{key:1,flat:"",bordered:"",class:"standings-table"},{default:i(()=>[t[27]||(t[27]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Pos"),e("th",{class:"text-left"},"Equipo"),e("th",{class:"text-center"},"PJ"),e("th",{class:"text-center"},"PG"),e("th",{class:"text-center"},"PP"),e("th",{class:"text-center"},"Total Pts")])],-1)),e("tbody",null,[(m(!0),f(T,null,S(a.standings,(l,c)=>(m(),f("tr",{key:l.team_id},[e("td",Ae,n(c+1),1),e("td",Ke,n(l.team_name),1),e("td",We,n(l.matches_played),1),e("td",Xe,n(l.wins),1),e("td",Ye,n(l.losses),1),e("td",Ze,[e("strong",null,n(l.total_points),1)])]))),128))])]),_:1})),a.standings.length===0?(m(),f("div",$e,[s(L,{name:"info",size:"3em",color:"grey"}),t[28]||(t[28]=e("p",null,"No hay resultados registrados a\xFAn",-1))])):R("",!0)]),_:1})]),_:1})]),_:1}),s(B,{name:"bracket"},{default:i(()=>[s(C,{class:"transparent-card"},{default:i(()=>[s(k,null,{default:i(()=>[t[31]||(t[31]=e("h6",{class:"q-mt-none"},"Cuadro del Torneo",-1)),t[32]||(t[32]=e("p",{class:"text-caption"},"Vista del cuadro completo del torneo",-1)),e("div",et,[(m(!0),f(T,null,S(a.matches,l=>(m(),f("div",{key:l.id,class:"bracket-match q-mb-sm"},[e("div",tt,[e("div",at,n(l.team1),1),t[30]||(t[30]=e("div",{class:"bracket-vs"},"vs",-1)),e("div",lt,n(l.team2),1)]),e("div",st,n(l.match_date)+" - "+n(l.match_time.substring(0,5)),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):R("",!0),s(A,{modelValue:a.resultDialogVisible,"onUpdate:modelValue":t[10]||(t[10]=l=>a.resultDialogVisible=l)},{default:i(()=>[s(C,{class:"bg-dark text-white",style:{"min-width":"350px"}},{default:i(()=>[s(k,null,{default:i(()=>t[33]||(t[33]=[e("div",{class:"text-h6"},"Registrar Resultado",-1)])),_:1}),s(k,null,{default:i(()=>{var l,c;return[e("p",null,[e("strong",null,n((l=a.selectedMatch)==null?void 0:l.team1)+" vs "+n((c=a.selectedMatch)==null?void 0:c.team2),1)]),e("div",ot,[s(x,{modelValue:a.resultForm.set1_team1,"onUpdate:modelValue":t[3]||(t[3]=d=>a.resultForm.set1_team1=d),type:"number",label:"Set 1 - Equipo 1",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),s(x,{modelValue:a.resultForm.set1_team2,"onUpdate:modelValue":t[4]||(t[4]=d=>a.resultForm.set1_team2=d),type:"number",label:"Set 1 - Equipo 2",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),s(x,{modelValue:a.resultForm.set2_team1,"onUpdate:modelValue":t[5]||(t[5]=d=>a.resultForm.set2_team1=d),type:"number",label:"Set 2 - Equipo 1",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),s(x,{modelValue:a.resultForm.set2_team2,"onUpdate:modelValue":t[6]||(t[6]=d=>a.resultForm.set2_team2=d),type:"number",label:"Set 2 - Equipo 2",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),s(x,{modelValue:a.resultForm.set3_team1,"onUpdate:modelValue":t[7]||(t[7]=d=>a.resultForm.set3_team1=d),type:"number",label:"Set 3 - Equipo 1 (Opcional)",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),s(x,{modelValue:a.resultForm.set3_team2,"onUpdate:modelValue":t[8]||(t[8]=d=>a.resultForm.set3_team2=d),type:"number",label:"Set 3 - Equipo 2 (Opcional)",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),s(Z,{modelValue:a.resultForm.winner,"onUpdate:modelValue":t[9]||(t[9]=d=>a.resultForm.winner=d),options:a.winnerOptions,label:"Ganador",outlined:"",dark:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]}),_:1}),s(K,{align:"right"},{default:i(()=>[W(s(h,{flat:"",label:"Cancelar",color:"red"},null,512),[[$]]),s(h,{flat:"",label:"Guardar",color:"green",onClick:a.saveResult,loading:a.savingResult},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(A,{modelValue:a.rescheduleDialogVisible,"onUpdate:modelValue":t[14]||(t[14]=l=>a.rescheduleDialogVisible=l)},{default:i(()=>[s(C,{class:"bg-dark text-white",style:{"min-width":"350px"}},{default:i(()=>[s(k,null,{default:i(()=>t[34]||(t[34]=[e("div",{class:"text-h6"},"Reagendar Partido",-1)])),_:1}),s(k,null,{default:i(()=>{var l,c;return[e("p",null,[e("strong",null,n((l=a.selectedMatch)==null?void 0:l.team1)+" vs "+n((c=a.selectedMatch)==null?void 0:c.team2),1)]),e("div",nt,[s(x,{modelValue:a.rescheduleForm.match_date,"onUpdate:modelValue":t[11]||(t[11]=d=>a.rescheduleForm.match_date=d),type:"date",label:"Nueva Fecha",outlined:"",dark:""},null,8,["modelValue"]),s(x,{modelValue:a.rescheduleForm.match_time,"onUpdate:modelValue":t[12]||(t[12]=d=>a.rescheduleForm.match_time=d),type:"time",label:"Nueva Hora",outlined:"",dark:""},null,8,["modelValue"]),s(Z,{modelValue:a.rescheduleForm.court_id,"onUpdate:modelValue":t[13]||(t[13]=d=>a.rescheduleForm.court_id=d),options:a.courtOptions,label:"Nueva Cancha",outlined:"",dark:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]}),_:1}),s(K,{align:"right"},{default:i(()=>[W(s(h,{flat:"",label:"Cancelar",color:"red"},null,512),[[$]]),s(h,{flat:"",label:"Guardar",color:"green",onClick:a.saveReschedule,loading:a.savingReschedule},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(F)]),_:1})}var Ht=ke(xe,[["render",rt],["__scopeId","data-v-619c6539"]]);export{Ht as default};
