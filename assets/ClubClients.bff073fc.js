import{a8 as C,q as f,G as g,H as r,v as s,I as c,ab as _,J as h,s as Q,ac as x,ad as S,bC as E,x as w,aU as F}from"./index.9347e1d0.js";import{Q as B}from"./QHeader.509e0022.js";import{Q as I,a as m}from"./QItem.7ca4858b.js";import{Q as y}from"./QItemLabel.6efeb509.js";import{Q as N}from"./QList.8b4f65d9.js";import{Q as $,a as j}from"./QLayout.4ae72c5e.js";import{s as p}from"./supabase.78a98346.js";import{a as v}from"./api.2af71db3.js";import{u as q}from"./userStore.0bae46e2.js";import{C as L}from"./ClubNavigationMenu.e559cec3.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.725dbfbf.js";import"./QTabs.7871b722.js";import"./rtl.276c3f1b.js";import"./QFooter.3e78255a.js";const V={components:{ClubNavigationMenu:L},data(){return{clients:[],userStore:q()}},methods:{goBack(){this.$router.back()},async toggleFollow(a){const t=this.userStore.userId;if(t)try{a.is_following?await v.delete("community/unfollow",{data:{follower_id:t,followed_id:a.player_id}}):await v.post("community/follow",{follower_id:t,followed_id:a.player_id}),a.is_following=!a.is_following}catch(l){console.error("Error toggling follow:",l)}},async fetchClients(){if(this.userStore.userId){const t=this.userStore.clubId;try{const{data:l,error:n}=await p.from("matches").select("team1_players, team2_players").eq("club_id",t);if(n)throw n;const i={};l.forEach(e=>{e.team1_players.forEach(o=>{i[o]=(i[o]||0)+1}),e.team2_players.forEach(o=>{i[o]=(i[o]||0)+1})});const{data:u,error:d}=await p.from("players").select("user_id, first_name, last_name, photo_url").in("user_id",Object.keys(i));if(d)throw d;this.clients=await Promise.all(Object.keys(i).map(async e=>{const o=u.find(k=>k.user_id===e),b=await this.checkIfFollowing(e);return{player_id:e,player_name:o?`${o.first_name} ${o.last_name}`:"Unknown",photo_url:o?o.photo_url:null,visits:i[e],is_following:b}})),this.clients.sort((e,o)=>o.visits-e.visits)}catch(l){console.error("Error fetching clients:",l)}}},async checkIfFollowing(a){const t=this.userStore.userId;if(t)try{const{data:l,error:n}=await p.from("follows").select("id").eq("follower_id",t).eq("followed_id",a).single();if(n&&n.code!=="PGRST116")throw n;return!!l}catch(l){return console.error("Error checking follow status:",l),!1}return!1}},mounted(){this.fetchClients()}},H={class:"header-content"},P={class:"header-icons"},U=["src"];function D(a,t,l,n,i,u){const d=C("ClubNavigationMenu");return f(),g($,{view:"hHh lpR fFf",class:"body"},{default:r(()=>[s(B,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[c("div",H,[t[0]||(t[0]=c("div",{class:"greeting"},[c("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),_(" Mejores clientes ")],-1)),c("div",P,[s(h,{flat:"",round:"",icon:"close",onClick:u.goBack},null,8,["onClick"])])])]),_:1}),s(j,null,{default:r(()=>[t[1]||(t[1]=c("div",{class:"q-mt-xl"},null,-1)),s(N,{class:"court-list"},{default:r(()=>[(f(!0),Q(S,null,x(i.clients,e=>(f(),g(I,{key:e.player_id,clickable:"",onClick:o=>a.editClient(e),class:"text-black court-item"},{default:r(()=>[s(m,{avatar:""},{default:r(()=>[s(E,null,{default:r(()=>[c("img",{src:e.photo_url||"https://via.placeholder.com/150",alt:"Foto del jugador"},null,8,U)]),_:2},1024)]),_:2},1024),s(m,null,{default:r(()=>[s(y,null,{default:r(()=>[_(w(e.player_name),1)]),_:2},1024),s(y,{caption:"",class:"text-black"},{default:r(()=>[_(w(e.visits)+" Visitas a tu club ",1)]),_:2},1024)]),_:2},1024),s(m,{side:""},{default:r(()=>[s(h,{color:e.is_following?"negative":"positive",icon:e.is_following?"o_remove_circle":"o_add_circle",label:e.is_following?"Dejar de seguir":"Seguir",onClick:F(o=>u.toggleFollow(e),["stop"])},null,8,["color","icon","label","onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),s(d)]),_:1})}var se=M(V,[["render",D],["__scopeId","data-v-19afd2fe"]]);export{se as default};
