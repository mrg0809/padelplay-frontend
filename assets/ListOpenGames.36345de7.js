import{Q as se}from"./QHeader.325e6f8a.js";import{F as le,r as p,w as re,B as ne,q as r,G as c,H as s,v as l,I as a,bI as U,ag as S,ad as g,s as u,ae as ie,af as de,ab as ue,ac as z,x as n,bG as C,y as ce,J as q,aW as I}from"./index.cabb238b.js";import{Q as M,a as P}from"./QItem.54c8e8ba.js";import{Q as $}from"./QSelect.74aa0205.js";import{Q as pe}from"./QList.e00fe6ed.js";import{Q as me}from"./QSpinnerDots.d4a31a47.js";import{Q as _e}from"./QPage.699d16e0.js";import{Q as ye,a as ve}from"./QLayout.6d8de49a.js";import{s as A}from"./supabase.48b89bac.js";import{f as fe}from"./commun.a511d4d1.js";import{u as he}from"./useDashboardNavigation.7cf658d3.js";import{u as be}from"./summaryStore.78a4c122.js";import{u as ge}from"./use-quasar.8c5b79cf.js";import{P as we}from"./PlayerNavigationMenu.015757c8.js";import{N as ke}from"./NotificationBell.ba64f71a.js";import{B as De}from"./BannerPromoScrolling.aee34302.js";import{D as xe}from"./DesktopNavigation.ba3059ed.js";import"./QChip.412b033a.js";import"./QItemLabel.8ddeeb8d.js";import"./QMenu.0e9924f1.js";import"./position-engine.1c1c51fc.js";import"./selection.843cdb12.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./userStore.b62a8549.js";import"./pinia.490ff4c4.js";import"./QTabs.a62af68f.js";import"./QFooter.55965c1d.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QBadge.3619d9a5.js";import"./api.2af71db3.js";import"./admin.c99b9bfe.js";import"./QTooltip.35c9b747.js";const Se={class:"header-content"},Ce={class:"greeting"},Ne={class:"header-icons"},Qe={class:"row q-col-gutter-md q-mb-lg"},Te={class:"col-12 col-sm-4"},Oe={class:"col-12 col-sm-4"},qe={class:"col-12 col-sm-4"},Ie={class:"games-list"},Me={class:"court-container"},Pe={class:"court"},$e={class:"player team1-player1"},je={key:0},Fe=["src"],Ve={key:1},Le={class:"text-caption"},Ee={class:"player team1-player2"},He={key:0},Be=["src"],Ge={key:1},Je={class:"text-caption"},Ue={class:"player team2-player1"},ze={key:0},Ae=["src"],Xe={key:1},Re={class:"text-caption"},We={class:"player team2-player2"},Ke={key:0},Ye=["src"],Ze={key:1},et={class:"text-caption"},tt={class:"club-info"},ot=["src"],at={class:"club-name"},st={class:"price-duration"},lt={class:"total-price"},rt={class:"duration"},nt={key:1,class:"text-center"},it={key:2,class:"text-center text-white"},Gt={__name:"ListOpenGames",setup(dt){const X=le(),{goToDashboard:j}=he(),R=be(),F=ge(),k=p([]),D=p([]),W=p(["Hoy","Ma\xF1ana","Esta Semana","Pr\xF3ximos 7 d\xEDas"]),K=p(["femenil","varonil","mixto"]),v=p(null),w=p(null),f=p(null),h=p([]),N=p(!1),V=o=>new Date(o).toLocaleDateString("es-MX",{day:"numeric",month:"long",year:"numeric"}),Y=(o,t)=>{const[e,i]=o.split(":").map(Number),[_,m]=t.split(":").map(Number);let y=_*60+m-(e*60+i);return y<0&&(y+=24*60),y},Z=async()=>{try{const o=await fe();k.value=o.map(t=>typeof t=="string"?t:t.value||t.label||t),D.value=k.value}catch{}},ee=(o,t)=>{if(o===""){t(()=>{D.value=k.value});return}t(()=>{const e=o.toLowerCase();D.value=k.value.filter(i=>i.toLowerCase().indexOf(e)>-1)})},L=async()=>{N.value=!0,h.value=[];try{let o=A.from("matches").select(`
                id, match_date, match_time, category, gender, is_open, team1_players, team2_players,
                club:clubs!inner ( id, name, city, logo_url ),
                reservation:reservations ( total_price, start_time, end_time )
            `).eq("is_open",!0);const t=w.value,e=new Date;e.setHours(0,0,0,0);const i=new Date(e);i.setDate(e.getDate()+1);const _=new Date(e);_.setDate(e.getDate()+2);const m=new Date(e);m.setDate(e.getDate()+(7-e.getDay())),m.setHours(23,59,59,999);const y=new Date(e);y.setDate(e.getDate()+7),y.setHours(23,59,59,999);const x=e.toISOString().split("T")[0],E=i.toISOString().split("T")[0],te=_.toISOString().split("T")[0],oe=m.toISOString().split("T")[0],ae=y.toISOString().split("T")[0];t==="Hoy"?o=o.gte("match_date",x).lt("match_date",E):t==="Ma\xF1ana"?o=o.gte("match_date",E).lt("match_date",te):t==="Esta Semana"?o=o.gte("match_date",x).lte("match_date",oe):t==="Pr\xF3ximos 7 d\xEDas"?o=o.gte("match_date",x).lte("match_date",ae):o=o.gte("match_date",x),v.value&&(o=o.eq("club.city",v.value)),f.value&&(o=o.eq("gender",f.value));const{data:T,error:H}=await o.order("match_date").order("match_time");if(H)throw H;if(!T){h.value=[];return}const B=T.flatMap(d=>[...d.team1_players||[],...d.team2_players||[]]).filter(d=>d!=null);let O={};if(B.length>0){const{data:d,error:b}=await A.from("players").select("user_id, first_name, photo_url, category").in("user_id",[...new Set(B)]);if(b)throw b;O=(d||[]).reduce((G,J)=>(G[J.user_id]=J,G),{})}h.value=T.map(d=>({...d,club:d.club||{name:"N/A",city:"N/A",id:null},reservation:d.reservation||{total_price:0,start_time:"00:00",end_time:"00:00"},team1_players:(d.team1_players||[null,null]).map(b=>O[b]||null),team2_players:(d.team2_players||[null,null]).map(b=>O[b]||null)}))}catch(o){console.error("Error fetching matches:",o),h.value=[],F.notify({type:"negative",message:"Error al buscar juegos."})}finally{N.value=!1}},Q=(o,t,e)=>{var m;if(console.log(`Intentando unirse a juego ${o.id}, equipo ${t}, slot ${e}`),!o||!o.reservation||o.reservation.total_price===void 0||o.reservation.total_price===null||!((m=o.club)!=null&&m.id)){console.error("Datos incompletos del juego para proceder al pago:",o),F.notify({type:"negative",message:"Informaci\xF3n del juego incompleta para unirse."});return}const i=(o.reservation.total_price||0)/4;i<=0&&console.warn("El precio por jugador es cero o inv\xE1lido.");const _={summaryTitle:"Confirmar Uni\xF3n a Juego",itemDetails:[{label:"Club",value:o.club.name||"No especificado"},{label:"Fecha",value:V(o.match_date)},{label:"Hora",value:`${new Date(o.match_date+"T"+o.match_time).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})} hrs.`},{label:"Categor\xEDa",value:o.category||"N/A"},{label:"Precio (Tu parte)",value:`$${i.toFixed(2)}`}],baseData:{clubId:o.club.id,price:i,participants:1,type:"open_match_join",id:o.id},allowPaymentSplit:!1,showPublicToggle:!1,commissionRate:4,extraData:{matchId:o.id,teamToJoin:t,slotIndex:e,matchCategory:o.category,matchGender:o.gender,matchDate:o.match_date,matchTime:o.match_time,clubName:o.club.name}};R.setSummaryDetails(_),console.log("Datos para unirse a juego guardados en Pinia:",_),X.push({name:"OrderSummary"})};return re([v,w,f],L,{deep:!0}),ne(()=>{Z(),L()}),(o,t)=>(r(),c(ye,{view:"hHh lpR fFf",class:"text-white"},{default:s(()=>[l(se,{elevated:"",class:"text-white"},{default:s(()=>[a("div",Se,[a("div",Ce,[a("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...e)=>U(j)&&U(j)(...e))})]),a("div",Ne,[l(ke)])]),l(De)]),_:1}),l(ve,{class:"home"},{default:s(()=>[l(_e,{class:"q-pa-md"},{default:s(()=>[a("div",Qe,[a("div",Te,[l($,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e),options:D.value,label:"Ciudad",outlined:"",dense:"","options-dense":"",clearable:"","hide-selected":"","input-debounce":"300",onFilter:ee,onClear:t[2]||(t[2]=e=>v.value=null),dark:"",color:"white","label-color":"white","popup-content-class":"text-white"},{prepend:s(()=>[l(S,{name:"location_on",color:"white"})]),"no-option":s(()=>[l(M,null,{default:s(()=>[l(P,{class:"text-white"},{default:s(()=>t[7]||(t[7]=[g("No hay ciudades")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),a("div",Oe,[l($,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e),options:W.value,label:"Fecha",outlined:"",dense:"","options-dense":"",clearable:"",dark:"",color:"white","label-color":"white","popup-content-class":"text-white",onClear:t[4]||(t[4]=e=>w.value=null)},{prepend:s(()=>[l(S,{name:"calendar_month",color:"white"})]),"no-option":s(()=>[l(M,null,{default:s(()=>[l(P,{class:"text-white"},{default:s(()=>t[8]||(t[8]=[g("No hay opciones")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),a("div",qe,[l($,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=e=>f.value=e),options:K.value,label:"G\xE9nero",outlined:"",dense:"","options-dense":"",clearable:"",dark:"",color:"white","label-color":"white","popup-content-class":"text-white",onClear:t[6]||(t[6]=e=>f.value=null)},{prepend:s(()=>[l(S,{name:"wc",color:"white"})]),"no-option":s(()=>[l(M,null,{default:s(()=>[l(P,{class:"text-grey-8"},{default:s(()=>t[9]||(t[9]=[g("No hay opciones")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])])]),a("div",Ie,[h.value.length>0?(r(),c(pe,{key:0,class:"q-mt-md"},{default:s(()=>[(r(!0),u(de,null,ie(h.value,e=>(r(),c(ue,{key:e.id,clickable:"",class:"match-card"},{default:s(()=>[l(z,{class:"q-mt-md"},{default:s(()=>[a("strong",null,n(V(e.match_date))+" | "+n(new Date(e.match_date+"T"+e.match_time).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})),1),t[14]||(t[14]=a("br",null,null,-1)),t[15]||(t[15]=g(" Categor\xEDa")),l(S,{name:"o_sports_tennis"}),g(" "+n(e.category)+" ",1),a("div",Me,[a("div",Pe,[a("div",$e,[e.team1_players[0]?(r(),u("div",je,[e.team1_players[0].photo_url?(r(),c(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team1_players[0].photo_url,alt:"Foto del jugador"},null,8,Fe)]),_:2},1024)):(r(),u("span",Ve,n(e.team1_players[0].first_name||"Jugador 1 Equipo 1"),1)),a("div",Le,n(e.team1_players[0].category),1)])):ce("",!0)]),a("div",Ee,[e.team1_players[1]?(r(),u("div",He,[e.team1_players[1].photo_url?(r(),c(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team1_players[1].photo_url,alt:"Foto del jugador"},null,8,Be)]),_:2},1024)):(r(),u("span",Ge,n(e.team1_players[1].first_name||"Jugador 1 Equipo 1"),1)),a("div",Je,n(e.team1_players[1].category),1)])):(r(),c(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:I(i=>Q(e,1,1),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),a("div",Ue,[e.team2_players[0]?(r(),u("div",ze,[e.team2_players[0].photo_url?(r(),c(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team2_players[0].photo_url,alt:"Foto del jugador"},null,8,Ae)]),_:2},1024)):(r(),u("span",Xe,n(e.team2_players[0].first_name||"Jugador 1 Equipo 2"),1)),a("div",Re,n(e.team2_players[0].category),1)])):(r(),c(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:I(i=>Q(e,2,0),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),a("div",We,[e.team2_players[1]?(r(),u("div",Ke,[e.team2_players[1].photo_url?(r(),c(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team2_players[1].photo_url,alt:"Foto del jugador"},null,8,Ye)]),_:2},1024)):(r(),u("span",Ze,n(e.team2_players[1].first_name||"Jugador 2 Equipo 2"),1)),a("div",et,n(e.team2_players[1].category),1)])):(r(),c(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:I(i=>Q(e,2,1),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),t[10]||(t[10]=a("div",{class:"line1"},null,-1)),t[11]||(t[11]=a("div",{class:"net"},null,-1)),t[12]||(t[12]=a("div",{class:"line2"},null,-1)),t[13]||(t[13]=a("div",{class:"horizontal-line"},null,-1))])])]),_:2},1024),l(z,{class:"club-info-section"},{default:s(()=>[a("div",tt,[a("img",{src:e.club.logo_url||"/logo.jpeg",alt:"Club Logo",class:"club-logo"},null,8,ot),a("span",at,n(e.club.name),1)]),t[17]||(t[17]=a("div",{class:"vertical-divider"},null,-1)),a("div",st,[a("span",lt,"$"+n(e.reservation.total_price/4)+" MXN",1),t[16]||(t[16]=a("br",null,null,-1)),a("span",rt,n(Y(e.reservation.start_time,e.reservation.end_time))+" minutos",1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})):N.value?(r(),u("div",nt,[t[18]||(t[18]=g("Buscando...")),t[19]||(t[19]=a("br",null,null,-1)),l(me,{color:"black",size:"xl"})])):(r(),u("div",it,t[20]||(t[20]=[a("p",null,"No se encontraron juegos.",-1)])))])]),_:1})]),_:1}),l(we),l(xe)]),_:1}))}};export{Gt as default};
