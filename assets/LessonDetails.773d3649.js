import{Q as E}from"./QHeader.3518b267.js";import{Q as A}from"./QSpinnerCube.f9943632.js";import{a7 as F,F as R,r as b,B as $,j as H,q as r,G as x,H as c,v as l,I as s,bG as h,a9 as T,aa as V,s as n,x as i,aM as z,ae as u,ab as o,y as d,ad as U,ac as j,J as D,bC as M}from"./index.a05546fd.js";import{Q as G}from"./QPage.f01afbe1.js";import{Q as Y,a as J}from"./QLayout.46a61ef3.js";import{u as O}from"./use-quasar.c5364419.js";import{u as K}from"./summaryStore.45b2cdc4.js";import{u as W}from"./useDashboardNavigation.a1f678a3.js";import{u as X}from"./userStore.2b3b6ba3.js";import{g as Z,a as ee}from"./lessons.6312fb61.js";import{N as ae}from"./NotificationBell.7faf38c2.js";import{B as se}from"./BannerPromoScrolling.769d50f5.js";import{P as le}from"./PlayerNavigationMenu.25e2275d.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.eaa32ff8.js";import"./supabase.9337c7d0.js";import"./QBadge.50532ba9.js";import"./api.2af71db3.js";import"./admin.c99b9bfe.js";import"./QTabs.b249ec85.js";import"./rtl.276c3f1b.js";import"./QFooter.216d5ed8.js";const oe={class:"header-content"},re={class:"greeting"},ne={class:"header-icons"},ie={key:0,class:"q-pa-xl text-center"},ue={key:1,class:"q-pa-md q-gutter-sm"},ce={key:0},de={key:1,class:"q-mt-md"},me={class:"q-gutter-xs row items-center"},pe=["src","alt"],ve={key:1},ge={key:2},fe={class:"q-mt-lg text-center"},ye={key:1,class:"text-negative text-caption q-mt-xs"},_e={key:2,class:"text-positive text-caption q-mt-xs"},be={key:2,class:"q-pa-md text-center text-negative"},xe={__name:"LessonDetails",setup(he){const y=F(),I=R(),{goToDashboard:k}=W(),P=K(),p=O(),_=X(),q=y.params.lessonId,Q=y.query.clubId,S=y.query.clubName||"Club no especificado",a=b(null),v=b(!0),g=b([]),w=async()=>{if(v.value=!0,a.value=null,g.value=[],!q){console.error("ID de la lecci\xF3n no encontrado en los par\xE1metros de la ruta."),p.notify({type:"negative",message:"No se pudo identificar la clase."}),v.value=!1;return}try{const t=await Z(q);if(a.value=t[0],!a.value||typeof a.value!="object")throw new Error("Respuesta inv\xE1lida del API al cargar detalles de clase.");if(a.value.players&&a.value.players.length>0)try{const e=await ee(a.value.players);g.value=e}catch(e){console.error("Error al cargar datos de los jugadores:",e)}}catch(t){console.error("Error al cargar detalles de la lecci\xF3n:",t),a.value=null,p.notify({type:"negative",message:"Error al cargar la informaci\xF3n de la clase."})}finally{v.value=!1}},L=()=>{if(!a.value){console.error("Detalles de la lecci\xF3n no est\xE1n cargados para ir al resumen."),p.notify({type:"negative",message:"No se pueden obtener los detalles de la clase."});return}if(a.value.available_slots<=0){p.notify({type:"warning",message:"Ya no hay cupos disponibles para esta clase."});return}const t=a.value,e={summaryTitle:"Resumen de Inscripci\xF3n",itemDetails:[{label:"Club",value:S},{label:"Clase",value:t.name||"No especificado"},{label:"Fecha",value:t.lesson_date||"No especificada"},{label:"Hora",value:`${t.lesson_time||"--:--"} hrs.`},{label:"Duraci\xF3n",value:`${t.duration||60} minutos`}],baseData:{clubId:Q,price:t.price||0,participants:1,type:"public_lesson",id:t.id},allowPaymentSplit:!1,showPublicToggle:!1,commissionRate:4,extraData:{coachName:t.coach_name,lessonDescription:t.description}};P.setSummaryDetails(e),console.log("Datos del resumen de CLASE P\xDABLICA guardados en Pinia:",e),I.push({name:"OrderSummary"})};$(()=>{w()});const N=H(()=>!a.value||!a.value.players||!_.userId?!1:a.value.players.includes(_.userId)),B=t=>{if(!t)return"??";const e=t.split("-");return e.length>0?e[0].substring(0,2).toUpperCase():userId.substring(0,2).toUpperCase()};return(t,e)=>(r(),x(Y,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:c(()=>[l(E,{elevated:"",class:"text-white"},{default:c(()=>[s("div",oe,[s("div",re,[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...f)=>h(k)&&h(k)(...f))})]),s("div",ne,[l(ae)])]),l(se)]),_:1}),l(J,{class:"home"},{default:c(()=>[l(G,{class:"q-pa-md"},{default:c(()=>[l(T,null,{default:c(()=>[l(V,null,{default:c(()=>{var f,C;return[v.value?(r(),n("div",ie,[l(A,{color:"primary",size:"xl"}),e[2]||(e[2]=s("p",{class:"q-mt-md"},"Cargando detalles de la clase...",-1))])):a.value?(r(),n("div",ue,[s("h3",null,i(a.value.name||"Clase sin Nombre"),1),l(z,{dark:"",spaced:"md"}),a.value.description?(r(),n("p",ce,[s("strong",null,[l(u,{name:"mdi-information-outline",class:"q-mr-xs"}),e[3]||(e[3]=o("Descripci\xF3n:"))]),o(" "+i(a.value.description),1)])):d("",!0),s("p",null,[s("strong",null,[l(u,{name:"mdi-calendar",class:"q-mr-xs"}),e[4]||(e[4]=o("Fecha:"))]),o(" "+i(a.value.lesson_date||"No especificada"),1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-clock-outline",class:"q-mr-xs"}),e[5]||(e[5]=o("Hora:"))]),o(" "+i(a.value.lesson_time||"No especificada")+" hrs. ",1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-timer-sand",class:"q-mr-xs"}),e[6]||(e[6]=o("Duraci\xF3n:"))]),o(" "+i(a.value.duration||"60")+" minutos ",1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-account-supervisor-circle-outline",class:"q-mr-xs"}),e[7]||(e[7]=o("Coach:"))]),o(" "+i(a.value.coaches.name||"No asignado"),1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-cash",class:"q-mr-xs"}),e[8]||(e[8]=o("Precio Inscripci\xF3n:"))]),o(" $"+i(((f=a.value.price)==null?void 0:f.toFixed(2))||"N/A"),1)]),g.value.length>0?(r(),n("div",de,[s("p",null,[s("strong",null,[l(u,{name:"mdi-account-check",class:"q-mr-xs"}),e[9]||(e[9]=o("Participantes:"))])]),s("div",me,[(r(!0),n(U,null,j(g.value,m=>(r(),x(M,{key:m.user_id,size:"48px",color:"white","text-color":"black",class:"overlapping"},{default:c(()=>[m.photo_url?(r(),n("img",{key:0,src:m.photo_url,alt:m.user_id},null,8,pe)):(r(),n("span",ve,i(B(h(_).fullName)),1))]),_:2},1024))),128))])])):d("",!0),a.value.max_participants!=null?(r(),n("p",ge,[s("strong",null,[l(u,{name:"mdi-account-group-outline",class:"q-mr-xs"}),e[10]||(e[10]=o("Cupo:"))]),o(" "+i((C=a.value.available_slots)!=null?C:"N/A")+" / "+i(a.value.max_participants)+" disponibles ",1)])):d("",!0),s("div",fe,[N.value?d("",!0):(r(),x(D,{key:0,color:"green",label:"Inscribirme","icon-right":"mdi-pencil-plus-outline",onClick:L,class:"full-width",size:"lg",push:"",disable:!a.value||a.value.available_slots<=0,title:!a.value||a.value.available_slots<=0?"No hay cupos disponibles o la clase no se carg\xF3":"Inscribirse a esta clase"},null,8,["disable","title"])),!a.value||a.value.available_slots<=0?(r(),n("div",ye,i(a.value?"No hay cupos disponibles":"Error al cargar la clase"),1)):d("",!0),N.value?(r(),n("div",_e," Ya est\xE1s inscrito en esta clase. ")):d("",!0)])])):(r(),n("div",be,[l(u,{name:"mdi-alert-circle-outline",size:"lg"}),e[11]||(e[11]=s("p",{class:"q-mt-md"},"No se pudieron cargar los detalles de la clase.",-1)),l(D,{flat:"",label:"Volver",onClick:e[1]||(e[1]=m=>t.$router.go(-1))})]))]}),_:1})]),_:1})]),_:1}),l(le)]),_:1})]),_:1}))}};var je=te(xe,[["__scopeId","data-v-7e48244e"]]);export{je as default};
