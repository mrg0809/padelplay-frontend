import{s as t}from"./supabase.66aa98e2.js";const k=async(s,n=null,c=null,d=null)=>{console.log("DEBUG: getClubPaymentOrdersWithFilters called with:",{club_id:s,startDate:n,endDate:c,eventType:d});const g=t.from("payment_orders").select("*").limit(10),{data:v,error:b}=await g;console.log("DEBUG: Sample payment_orders data:",{debugData:v,debugError:b});const E=t.from("payment_orders").select("*").eq("recipient_id",s).limit(5),{data:u,error:P}=await E;console.log("DEBUG: Payment orders with recipient_id matching club_id:",{recipientDebugData:u,recipientDebugError:P});try{let i=t.from("payment_orders").select(`
        id, order_date, total_amount, payment_method, payment_status, 
        transaction_id, event_type, event_id, club_commission, player_commission, 
        is_full_payment, recipient_id, user_id
      `).in("event_type",["reservation","court"]).in("payment_status",["approved","succeeded"]);n&&c?i=i.gte("order_date",n).lte("order_date",c):n&&(i=i.gte("order_date",n));const{data:o,error:w}=await i.order("order_date",{ascending:!1});if(w)return console.log("ERROR in reservation payments query:",w),[];if(console.log("DEBUG: All reservation payments before filtering:",o),!o||o.length===0)return console.log("DEBUG: No reservation payments found"),[];const y=o.map(r=>r.event_id).filter(Boolean),p=o.map(r=>r.id);let A=new Set,f=[];if(y.length>0){const{data:r,error:_}=await t.from("reservations").select(`
          id, court_id, reservation_date, start_time, end_time, payment_order_id,
          courts(id, name, club_id)
        `).in("id",y);!_&&r&&(f=r.filter(e=>e.courts&&e.courts.club_id===s),A=new Set(f.map(e=>e.id)))}const{data:B,error:O}=await t.from("reservations").select(`
        id, court_id, reservation_date, start_time, end_time, payment_order_id,
        courts(id, name, club_id)
      `).in("payment_order_id",p);let m=new Set;if(!O&&B){const r=B.filter(e=>e.courts&&e.courts.club_id===s);r.forEach(e=>{e.payment_order_id&&m.add(e.payment_order_id)});const _=new Set(f.map(e=>e.id));r.forEach(e=>{_.has(e.id)||(f.push(e),_.add(e.id))})}const h=o.filter(r=>A.has(r.event_id)||m.has(r.id));if(console.log("DEBUG: Filtered club payments:",h),h.length>0){const r=[...new Set(h.map(a=>a.user_id).filter(Boolean))];if(r.length>0){const{data:a,error:R}=await t.from("players").select("user_id, first_name, last_name, email, phone, photo_url").in("user_id",r);if(!R&&a){const q={};a.forEach(l=>{q[l.user_id]={id:l.user_id,full_name:`${l.first_name||""} ${l.last_name||""}`.trim(),email:l.email,phone:l.phone,photo_url:l.photo_url}}),h.forEach(l=>{l.user_id&&q[l.user_id]&&(l.profiles=q[l.user_id])})}else R&&console.log("ERROR fetching player data:",R)}const _={},e={};f.forEach(a=>{_[a.id]=a,a.payment_order_id&&(e[a.payment_order_id]=a)}),h.forEach(a=>{const R=a.event_id&&_[a.event_id]||e[a.id];R&&(a.reservations=R)})}if(console.log("DEBUG: Final club payments with profile and reservation data:",h),d&&d!=="reservation"){let r=t.from("payment_orders").select(`
          id, order_date, total_amount, payment_method, payment_status, 
          transaction_id, event_type, event_id, club_commission, player_commission, 
          is_full_payment, recipient_id, user_id
        `).eq("recipient_id",s).eq("event_type",d);n&&c?r=r.gte("order_date",n).lte("order_date",c):n&&(r=r.gte("order_date",n));const{data:_,error:e}=await r.order("order_date",{ascending:!1});return e?(console.log("ERROR in non-reservation query:",e),h):_||[]}return h}catch(i){return console.error("ERROR in getClubPaymentOrdersWithFilters:",i),[]}},C=async()=>{console.log("=== DEBUG: Payment Orders Analysis ===");const{data:s,error:n}=await t.from("payment_orders").select("*").limit(10);console.log("Sample payment_orders:",{samplePayments:s,sampleError:n});const{data:c,error:d}=await t.from("payment_orders").select("recipient_id").not("recipient_id","is",null);console.log("Unique recipient_ids in payment_orders:",{recipientIds:c,recipientError:d});const{data:g,error:v}=await t.from("payment_orders").select("event_type").not("event_type","is",null);console.log("Event types in payment_orders:",{eventTypes:g,eventError:v});const{data:b,error:E}=await t.from("payment_orders").select("payment_status").not("payment_status","is",null);console.log("Payment statuses in payment_orders:",{statuses:b,statusError:E});const{data:u,error:P}=await t.from("payment_orders").select("user_id").not("user_id","is",null).limit(5);let i=null;if(u&&u.length>0){const o=[...new Set(u.map(p=>p.user_id))],{data:w,error:y}=await t.from("players").select("user_id, first_name, last_name, email").in("user_id",o);i={playersLookup:w,playersLookupError:y}}return console.log("Payment orders with player data:",{userPlayers:u,playersData:i}),{samplePayments:s,recipientIds:c,eventTypes:g,statuses:b,userPlayers:i}},G=async s=>{console.log("=== DEBUG: Club Payment Approaches for clubId:",s,"===");const{data:n,error:c}=await t.from("payment_orders").select("*").eq("recipient_id",s).limit(5);console.log("Approach 1 - recipient_id filter:",{approach1:n,error1:c});try{const{data:o,error:w}=await t.from("payment_orders").select("*").eq("event_type","reservation").limit(10);if(console.log("Approach 2a - reservation payments:",{reservationPayments:o,reservationError:w}),o&&o.length>0){const y=o.map(p=>p.event_id).filter(Boolean);if(console.log("Approach 2b - event_ids to lookup:",y),y.length>0){const{data:p,error:A}=await t.from("reservations").select(`
            id, court_id,
            courts(id, club_id)
          `).in("id",y);console.log("Approach 2c - reservations found:",{reservations:p,reservationsError:A});const f=p?p.filter(m=>m.courts&&m.courts.club_id===s):[];console.log("Approach 2d - club reservations:",f);const B=new Set(f.map(m=>m.id)),O=o.filter(m=>B.has(m.event_id));console.log("Approach 2e - final filtered payments:",O)}}}catch(o){console.log("Approach 2 - error in step-by-step approach:",o)}const{data:d,error:g}=await t.from("payment_orders").select("*").limit(5);console.log("Approach 3 - any payments exist:",{anyPayments:d,anyError:g});const{data:v,error:b}=await t.from("clubs").select("*").eq("id",s);console.log("Approach 4 - club validity check:",{clubCheck:v,clubError:b});const{data:E,error:u}=await t.from("courts").select("*").eq("club_id",s).limit(3);console.log("Approach 5 - courts for this club:",{courtsCheck:E,courtsError:u});const{data:P,error:i}=await t.from("reservations").select(`
      *,
      courts!inner(club_id)
    `).eq("courts.club_id",s).limit(3);return console.log("Approach 6 - reservations for this club:",{reservationsCheck:P,reservationsError:i}),{approach1:n,anyPayments:d,clubCheck:v,courtsCheck:E,reservationsCheck:P}};export{C as a,G as d,k as g};
