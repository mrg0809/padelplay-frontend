import{a9 as E,F as I,r as D,B as z,q as o,G as y,H as n,v as a,I as e,ad as Q,J as P,s as d,ag as k,x as c,ab as _,ac as u,af as p,ae as h,y as V,K as g,aS as B}from"./index.d2ffaf32.js";import{Q as O}from"./QHeader.6dc27614.js";import{Q as j}from"./QSpinnerPuff.ddae957e.js";import{Q as S}from"./QChip.b5a03079.js";import{Q as w}from"./QSelect.763eff18.js";import{Q as R}from"./QBanner.9b07c2b1.js";import{Q as G}from"./QPage.e7459944.js";import{Q as M,a as L}from"./QLayout.20569da5.js";import{s as F}from"./supabase.c42fb837.js";import{n as A}from"./navigationUtils.2c4b9dee.js";import{a as H}from"./api.2af71db3.js";import{u as J}from"./use-quasar.e5b85707.js";import{g as K,f as W}from"./tournamentUtils.e8e65a8c.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import"./QItem.3d58836d.js";import"./QItemLabel.54cdb47b.js";import"./QMenu.07894f12.js";import"./position-engine.b5237c54.js";import"./selection.d58affd5.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const Y={name:"PreviewTournament",setup(){const U=E(),i=I(),N=J(),t=D(null),x=D(!1),C=D(!1),r=D(null),s=D([]);z(async()=>{await l(),await m()});const l=async()=>{var b,q;x.value=!0,r.value=null;try{const v=U.params.tournamentId;if(!v)throw new Error("ID del torneo no encontrado");let f="";U.query.config&&(f=`?config=${encodeURIComponent(U.query.config)}`);const T=await H.get(`/tournaments/${v}/preview${f}`);t.value=T.data,console.log("Tournament preview loaded:",t.value)}catch(v){console.error("Error loading tournament preview:",v),r.value=((q=(b=v.response)==null?void 0:b.data)==null?void 0:q.detail)||v.message||"Error al cargar el preview del torneo"}finally{x.value=!1}},m=async()=>{var b,q;try{if((b=t.value)!=null&&b.tournament_id){const v=await F.from("tournaments").select("courts_used, club_id").eq("id",t.value.tournament_id).single();if((q=v.data)!=null&&q.courts_used){const f=await F.from("courts").select("id, name").in("id",v.data.courts_used);f.data&&(s.value=f.data.map(T=>({label:T.name,value:T.id})))}}}catch(v){console.error("Error loading courts:",v)}};return{tournamentData:t,loading:x,saving:C,error:r,courtOptions:s,getSystemName:b=>K(b),getTeamName:b=>W(b),saveMatches:async()=>{var b,q,v;C.value=!0;try{if(!((b=t.value)!=null&&b.matches))throw new Error("No hay partidos para guardar");const f=await H.post(`/tournaments/${t.value.tournament_id}/save-matches`,t.value.matches);N.notify({type:"positive",message:`${f.data.matches_saved} partidos guardados exitosamente. Torneo cerrado.`,timeout:3e3}),setTimeout(()=>{i.push("/club/torneos")},1500)}catch(f){console.error("Error saving matches:",f),N.notify({type:"negative",message:((v=(q=f.response)==null?void 0:q.data)==null?void 0:v.detail)||"Error al guardar los partidos",timeout:3e3})}finally{C.value=!1}},cancelPreview:()=>{i.back()},goBack:()=>{i.back()},goToDashboard:()=>{A(i,userStore)}}}},Z={class:"header-content"},$={class:"greeting"},ee={class:"header-icons"},ae={key:0,class:"text-center q-mt-md"},te={key:1,class:"text-center q-mt-md"},se={class:"text-negative"},oe={key:2},le={class:"row items-center q-gutter-md"},ne={class:"col"},re={class:"q-my-none"},de={class:"q-mb-none text-subtitle2"},ce={class:"col-auto"},ie={key:0,class:"tournament-structure"},me={key:0,class:"groups-container"},ue={class:"q-my-none"},_e={class:"teams-list"},pe={key:0,class:"group-matches"},he={class:"match-details"},ve={class:"match-teams"},be={class:"team-name"},ge={class:"team-name"},fe={class:"match-schedule q-mt-sm"},ye={class:"schedule-inputs row q-gutter-sm"},Ve={key:1,class:"tournament-structure"},qe={class:"bracket-container"},ke={class:"q-my-none"},we={class:"round-matches"},De={class:"match-details"},Ue={class:"match-teams"},xe={class:"match-schedule q-mt-sm"},Ce={class:"schedule-inputs row q-gutter-sm"},Te={key:2,class:"tournament-structure"},Qe={key:0,class:"groups-container q-mb-xl"},Pe={class:"q-my-none"},Ne={class:"teams-list"},Se={key:0,class:"group-matches"},Be={class:"match-details"},Fe={class:"match-teams"},He={class:"team-name"},Ee={class:"team-name"},Ie={class:"match-schedule q-mt-sm"},ze={class:"schedule-inputs row q-gutter-sm"},Oe={key:1,class:"playoffs-container"},je={class:"q-my-none"},Re={class:"round-matches"},Ge={class:"match-details"},Me={class:"match-teams"},Le={class:"team-name tbd-team"},Ae={class:"team-name tbd-team"},Je={class:"match-schedule q-mt-sm"},Ke={class:"schedule-inputs row q-gutter-sm"},We={key:3,class:"tournament-structure"},Xe={class:"q-mb-none"},Ye={class:"liga-matches"},Ze={class:"match-details"},$e={class:"match-teams"},ea={class:"team-name"},aa={class:"team-name"},ta={class:"match-schedule q-mt-sm"},sa={class:"schedule-inputs row q-gutter-sm"},oa={key:4,class:"tournament-structure"},la={class:"q-mb-none"},na={class:"q-mb-none"},ra={key:0,class:"q-mb-none"},da={class:"retas-rounds"},ca={class:"q-my-none"},ia={class:"retas-matches"},ma={class:"match-details"},ua={class:"match-teams-retas"},_a={class:"team-players"},pa={class:"players"},ha={class:"team-players"},va={class:"players"},ba={class:"match-schedule q-mt-sm"},ga={class:"schedule-inputs row q-gutter-sm"},fa={class:"actions-section q-mt-xl"},ya={class:"row q-gutter-md justify-center"};function Va(U,i,N,t,x,C){return o(),y(M,{view:"hHh lpR fFf",class:"body text-white"},{default:n(()=>[a(O,{elevated:"",class:"bg-primary text-white"},{default:n(()=>[e("div",Z,[e("div",$,[e("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:i[0]||(i[0]=(...r)=>t.goToDashboard&&t.goToDashboard(...r))}),i[1]||(i[1]=Q(" Cuadro Propuesto del Torneo "))]),e("div",ee,[a(P,{flat:"",round:"",icon:"arrow_back",onClick:t.goBack},null,8,["onClick"])])])]),_:1}),a(L,null,{default:n(()=>[a(G,{class:"q-pa-md"},{default:n(()=>[t.loading?(o(),d("div",ae,[a(j,{color:"primary",size:"3em"}),i[2]||(i[2]=e("p",null,"Generando cuadro del torneo...",-1))])):t.error?(o(),d("div",te,[a(k,{name:"warning",color:"negative",size:"3em"}),e("p",se,c(t.error),1),a(P,{label:"Volver",color:"primary",onClick:t.goBack},null,8,["onClick"])])):t.tournamentData?(o(),d("div",oe,[a(_,{class:"q-mb-md tournament-info-card"},{default:n(()=>[a(u,null,{default:n(()=>{var r,s;return[e("div",le,[e("div",ne,[e("h4",re,c(((r=t.tournamentData.tournament)==null?void 0:r.name)||"Torneo"),1),e("p",de," Sistema: "+c(t.getSystemName(t.tournamentData.system))+" | Total de Partidos: "+c(((s=t.tournamentData.matches)==null?void 0:s.length)||0),1)]),e("div",ce,[a(S,{color:t.tournamentData.system==="eliminacion directa"?"red":t.tournamentData.system==="round-robin"?"blue":t.tournamentData.system==="combinado"?"purple":t.tournamentData.system==="retas"?"orange":"green","text-color":"white",label:t.getSystemName(t.tournamentData.system),icon:"emoji_events"},null,8,["color","label"])])])]}),_:1})]),_:1}),t.tournamentData.system==="round-robin"?(o(),d("div",ie,[t.tournamentData.structure.groups?(o(),d("div",me,[(o(!0),d(p,null,h(t.tournamentData.structure.groups,r=>(o(),d("div",{key:r.name,class:"group-section q-mb-lg"},[a(_,{class:"group-card"},{default:n(()=>[a(u,{class:"bg-blue-8 text-white"},{default:n(()=>[e("h6",ue,c(r.name),1),e("div",_e,[(o(!0),d(p,null,h(r.teams,s=>(o(),y(S,{key:s.id,color:"white","text-color":"blue-8",size:"sm",class:"q-ma-xs"},{default:n(()=>[Q(c(t.getTeamName(s)),1)]),_:2},1024))),128))])]),_:2},1024),a(u,{class:"matches-section"},{default:n(()=>[i[3]||(i[3]=e("h6",{class:"q-mt-none q-mb-md"},"Partidos del Grupo",-1)),t.tournamentData.structure.group_matches[r.name]?(o(),d("div",pe,[(o(!0),d(p,null,h(t.tournamentData.structure.group_matches[r.name],s=>(o(),y(_,{key:s.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",he,[e("div",ve,[e("span",be,c(s.team1.name),1),a(k,{name:"sports",class:"vs-icon"}),e("span",ge,c(s.team2.name),1)]),e("div",fe,[e("div",ye,[a(g,{modelValue:s.match_date,"onUpdate:modelValue":l=>s.match_date=l,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(g,{modelValue:s.match_time,"onUpdate:modelValue":l=>s.match_time=l,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:s.court_id,"onUpdate:modelValue":l=>s.court_id=l,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])):V("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):V("",!0)])):t.tournamentData.system==="eliminacion directa"?(o(),d("div",Ve,[e("div",qe,[(o(!0),d(p,null,h(t.tournamentData.structure.bracket,(r,s)=>(o(),d("div",{key:s,class:"bracket-round"},[a(_,{class:"round-card q-mb-lg"},{default:n(()=>[a(u,{class:"bg-red-8 text-white"},{default:n(()=>[e("h6",ke,c(s),1)]),_:2},1024),a(u,null,{default:n(()=>[e("div",we,[(o(!0),d(p,null,h(r,l=>(o(),y(_,{key:l.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",De,[e("div",Ue,[e("span",{class:B(["team-name",{"tbd-team":!l.team1.player1}])},c(l.team1.name),3),a(k,{name:"sports",class:"vs-icon"}),e("span",{class:B(["team-name",{"tbd-team":!l.team2.player1}])},c(l.team2.name),3)]),e("div",xe,[e("div",Ce,[a(g,{modelValue:l.match_date,"onUpdate:modelValue":m=>l.match_date=m,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(g,{modelValue:l.match_time,"onUpdate:modelValue":m=>l.match_time=m,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:l.court_id,"onUpdate:modelValue":m=>l.court_id=m,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])])):t.tournamentData.system==="combinado"?(o(),d("div",Te,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(u,{class:"bg-purple-8 text-white"},{default:n(()=>i[4]||(i[4]=[e("h5",{class:"q-my-none"},"Fase de Grupos",-1)])),_:1})]),_:1}),t.tournamentData.structure.groups?(o(),d("div",Qe,[(o(!0),d(p,null,h(t.tournamentData.structure.groups,r=>(o(),d("div",{key:r.name,class:"group-section q-mb-lg"},[a(_,{class:"group-card"},{default:n(()=>[a(u,{class:"bg-blue-6 text-white"},{default:n(()=>[e("h6",Pe,c(r.name),1),e("div",Ne,[(o(!0),d(p,null,h(r.teams,s=>(o(),y(S,{key:s.id,color:"white","text-color":"blue-8",size:"sm",class:"q-ma-xs"},{default:n(()=>[Q(c(t.getTeamName(s)),1)]),_:2},1024))),128))])]),_:2},1024),a(u,{class:"matches-section"},{default:n(()=>[t.tournamentData.structure.group_matches[r.name]?(o(),d("div",Se,[(o(!0),d(p,null,h(t.tournamentData.structure.group_matches[r.name],s=>(o(),y(_,{key:s.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",Be,[e("div",Fe,[e("span",He,c(s.team1.name),1),a(k,{name:"sports",class:"vs-icon"}),e("span",Ee,c(s.team2.name),1)]),e("div",Ie,[e("div",ze,[a(g,{modelValue:s.match_date,"onUpdate:modelValue":l=>s.match_date=l,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(g,{modelValue:s.match_time,"onUpdate:modelValue":l=>s.match_time=l,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:s.court_id,"onUpdate:modelValue":l=>s.court_id=l,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])):V("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):V("",!0),a(_,{class:"q-mb-lg"},{default:n(()=>[a(u,{class:"bg-purple-8 text-white"},{default:n(()=>i[5]||(i[5]=[e("h5",{class:"q-my-none"},"Fase de Playoffs",-1)])),_:1})]),_:1}),t.tournamentData.structure.playoffs?(o(),d("div",Oe,[(o(!0),d(p,null,h(t.tournamentData.structure.playoffs,(r,s)=>(o(),d("div",{key:s,class:"bracket-round"},[a(_,{class:"round-card q-mb-lg"},{default:n(()=>[a(u,{class:"bg-red-6 text-white"},{default:n(()=>[e("h6",je,c(s),1)]),_:2},1024),a(u,null,{default:n(()=>[e("div",Re,[(o(!0),d(p,null,h(r,l=>(o(),y(_,{key:l.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",Ge,[e("div",Me,[e("span",Le,c(l.team1.name),1),a(k,{name:"sports",class:"vs-icon"}),e("span",Ae,c(l.team2.name),1)]),e("div",Je,[e("div",Ke,[a(g,{modelValue:l.match_date,"onUpdate:modelValue":m=>l.match_date=m,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(g,{modelValue:l.match_time,"onUpdate:modelValue":m=>l.match_time=m,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:l.court_id,"onUpdate:modelValue":m=>l.court_id=m,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])):V("",!0)])):t.tournamentData.system==="liga"?(o(),d("div",We,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(u,{class:"bg-green-8 text-white"},{default:n(()=>[i[6]||(i[6]=e("h5",{class:"q-my-none"},"Liga - Todos contra Todos",-1)),e("p",Xe,c(t.tournamentData.structure.total_matches)+" partidos programados",1)]),_:1})]),_:1}),e("div",Ye,[(o(!0),d(p,null,h(t.tournamentData.matches,r=>(o(),y(_,{key:r.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",Ze,[e("div",$e,[e("span",ea,c(r.team1.name),1),a(k,{name:"sports",class:"vs-icon"}),e("span",aa,c(r.team2.name),1)]),e("div",ta,[e("div",sa,[a(g,{modelValue:r.match_date,"onUpdate:modelValue":s=>r.match_date=s,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(g,{modelValue:r.match_time,"onUpdate:modelValue":s=>r.match_time=s,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:r.court_id,"onUpdate:modelValue":s=>r.court_id=s,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])])):t.tournamentData.system==="retas"?(o(),d("div",oa,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(u,{class:"bg-black text-white"},{default:n(()=>[i[7]||(i[7]=e("h5",{class:"q-my-none"},"Retas - Rotaci\xF3n de Parejas",-1)),e("p",la,c(t.tournamentData.structure.num_rounds)+" rondas con "+c(t.tournamentData.structure.total_players)+" jugadores",1),e("p",na,"Total de partidos: "+c(t.tournamentData.structure.total_matches),1),t.tournamentData.structure.estimated_duration_minutes?(o(),d("p",ra," Duraci\xF3n estimada: "+c(Math.floor(t.tournamentData.structure.estimated_duration_minutes/60))+"h "+c(t.tournamentData.structure.estimated_duration_minutes%60)+"min ",1)):V("",!0),t.tournamentData.structure.time_limited?(o(),y(R,{key:1,class:"bg-orange text-white q-mt-sm",rounded:"",dense:""},{avatar:n(()=>[a(k,{name:"warning",color:"white"})]),default:n(()=>[Q(" "+c(t.tournamentData.structure.warning),1)]),_:1})):V("",!0)]),_:1})]),_:1}),e("div",da,[(o(!0),d(p,null,h(t.tournamentData.structure.rounds,(r,s)=>(o(),d("div",{key:s,class:"round-section q-mb-lg"},[a(_,{flat:"",bordered:"",class:"round-card"},{default:n(()=>[a(u,{class:"bg-black text-white round-header"},{default:n(()=>[e("h6",ca,c(s),1)]),_:2},1024),a(u,{class:"q-pa-none"},{default:n(()=>[e("div",ia,[(o(!0),d(p,null,h(r,l=>(o(),y(_,{key:l.id,class:"match-card q-mb-sm q-ma-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",ma,[e("div",ua,[e("div",_a,[i[8]||(i[8]=e("div",{class:"team-label"},"Pareja 1:",-1)),e("div",pa,[(o(!0),d(p,null,h(l.team1.players,m=>(o(),d("span",{key:m.id,class:"player-name"},c(m.name),1))),128))])]),a(k,{name:"sports",class:"vs-icon"}),e("div",ha,[i[9]||(i[9]=e("div",{class:"team-label"},"Pareja 2:",-1)),e("div",va,[(o(!0),d(p,null,h(l.team2.players,m=>(o(),d("span",{key:m.id,class:"player-name"},c(m.name),1))),128))])])]),e("div",ba,[e("div",ga,[a(g,{modelValue:l.date,"onUpdate:modelValue":m=>l.date=m,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(g,{modelValue:l.time,"onUpdate:modelValue":m=>l.time=m,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:l.court_id,"onUpdate:modelValue":m=>l.court_id=m,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])])):V("",!0),e("div",fa,[e("div",ya,[a(P,{label:"Guardar Cuadro",color:"green",size:"lg",icon:"save",onClick:t.saveMatches,loading:t.saving,class:"save-btn"},null,8,["onClick","loading"]),a(P,{label:"Cancelar",color:"red",size:"lg",icon:"cancel",onClick:t.cancelPreview,outline:"",class:"cancel-btn"},null,8,["onClick"])]),i[10]||(i[10]=e("p",{class:"text-center q-mt-sm text-caption"}," Al guardar el cuadro, se cerrar\xE1n las inscripciones y se bloquear\xE1n las canchas para los horarios programados ",-1))])])):V("",!0)]),_:1})]),_:1})]),_:1})}var Wa=X(Y,[["render",Va],["__scopeId","data-v-cc511a74"]]);export{Wa as default};
