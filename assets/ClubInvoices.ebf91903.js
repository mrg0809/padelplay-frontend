import{F as U,r as i,j as g,B as O,q as _,G as $,H as l,v as a,I as s,bI as I,ad as u,J as w,K as Q,s as f,x as r,ab as y,ac as h,ag as R}from"./index.0dae1473.js";import{Q as M}from"./QHeader.daa47c6c.js";import{Q as G}from"./QSelect.d037d2d9.js";import{Q as H}from"./QSpinnerPuff.d5f53e4e.js";import{Q as c}from"./QTd.d4f21951.js";import{Q as j}from"./QChip.1bf307a2.js";import{Q as z}from"./QTable.446e9fc1.js";import{Q as J}from"./QPage.93249297.js";import{Q as Y,a as K}from"./QLayout.c8e0bf98.js";import{u as W}from"./use-quasar.5ccf209f.js";import{u as X}from"./userStore.3198d202.js";import{u as Z}from"./useDashboardNavigation.ffff980f.js";import{C as ee}from"./ClubNavigationMenu.e7dcf348.js";import{d as te,g as oe}from"./paymentsDebug.23574f13.js";import{_ as ae}from"./plugin-vue_export-helper.21dcd24c.js";import"./QItem.73fbae79.js";import"./QItemLabel.abb776d6.js";import"./QMenu.b120de54.js";import"./position-engine.0d8bf4bb.js";import"./selection.94b8945c.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QList.228e108c.js";import"./QMarkupTable.078eda46.js";import"./use-fullscreen.e5cc93b1.js";import"./pinia.8dcdf680.js";import"./QTabs.dbece195.js";import"./QFooter.aca25710.js";import"./supabase.25da9554.js";const le={class:"header-content"},se={class:"greeting"},re={class:"header-icons"},ne={class:"row q-gutter-md q-mb-md"},ie={class:"col-12 col-md-3"},ue={class:"col-12 col-md-3"},de={class:"col-12 col-md-3"},ce={class:"col-12 col-md-3 flex items-end"},me={key:0,class:"text-center q-my-lg"},pe={key:1},ve={class:"row q-gutter-md q-mt-lg"},_e={class:"col-12 col-md-3"},be={class:"text-h4"},ge={class:"col-12 col-md-3"},fe={class:"text-h4"},ye={class:"col-12 col-md-3"},he={class:"text-h4"},xe={key:2,class:"text-center q-my-lg"},Ne={__name:"ClubInvoices",setup(Ce){const k=U(),{goToDashboard:x}=Z(),N=W(),d=X(),n=i([]),m=i(!1),p=i(""),v=i(""),b=i(""),S=i([{label:"Reservas",value:"reservation"},{label:"Lecciones",value:"lesson"},{label:"Torneos",value:"tournament"},{label:"Productos",value:"product"}]),T=i([{name:"order_date",label:"Fecha",field:"order_date",align:"left",sortable:!0},{name:"customer",label:"Cliente",field:o=>{var e;return((e=o.profiles)==null?void 0:e.full_name)||"N/A"},align:"left"},{name:"event_type",label:"Tipo",field:"event_type",align:"center"},{name:"payment_method",label:"M\xE9todo de Pago",field:"payment_method",align:"center"},{name:"total_amount",label:"Monto Total",field:"total_amount",align:"right",sortable:!0},{name:"club_commission",label:"Comisi\xF3n Club",field:"club_commission",align:"right"},{name:"player_commission",label:"Comisi\xF3n Jugador",field:"player_commission",align:"right"},{name:"net_amount",label:"Monto Neto",field:"net_amount",align:"right"}]),F=g(()=>n.value.reduce((o,e)=>o+Number(e.total_amount||0),0)),D=g(()=>n.value.reduce((o,e)=>o+Number(e.club_commission||0)+Number(e.player_commission||0),0)),E=g(()=>n.value.reduce((o,e)=>{const t=Number(e.total_amount||0),A=Number(e.club_commission||0)+Number(e.player_commission||0);return o+(t-A)},0)),V=()=>{k.back()},B=o=>new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),q=o=>{const e=Number(o.total_amount||0),t=Number(o.club_commission||0)+Number(o.player_commission||0);return(e-t).toFixed(2)},L=o=>({reservation:"Reserva",lesson:"Lecci\xF3n",tournament:"Torneo",product:"Producto"})[o]||o,P=o=>({reservation:"blue",lesson:"green",tournament:"orange",product:"purple"})[o]||"grey",C=async()=>{if(console.log("DEBUG ClubInvoices: userStore data:",{userId:d.userId,clubId:d.clubId,userType:d.userType}),!d.clubId){N.notify({type:"negative",message:"No se encontr\xF3 informaci\xF3n del club"});return}m.value=!0;try{n.value.length===0&&(console.log("=== RUNNING CLUB INVOICES DEBUG ANALYSIS ==="),await te(d.clubId),console.log("=== CLUB INVOICES DEBUG ANALYSIS COMPLETE ==="));const o=await oe(d.clubId,p.value||null,v.value||null,b.value||null);n.value=o}catch(o){console.error("Error fetching payment orders:",o),N.notify({type:"negative",message:"Error al cargar las facturas"})}finally{m.value=!1}};return O(()=>{const o=new Date,e=new Date(o);e.setDate(o.getDate()-30),p.value=e.toISOString().split("T")[0],v.value=o.toISOString().split("T")[0],C()}),(o,e)=>(_(),$(Y,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[a(M,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[s("div",le,[s("div",se,[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...t)=>I(x)&&I(x)(...t))}),e[4]||(e[4]=u(" Facturas "))]),s("div",re,[a(w,{flat:"",round:"",icon:"arrow_back",onClick:V})])])]),_:1}),a(K,null,{default:l(()=>[a(J,{class:"q-pa-md"},{default:l(()=>[s("div",ne,[s("div",ie,[a(Q,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),type:"date",label:"Fecha Inicio",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),s("div",ue,[a(Q,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),type:"date",label:"Fecha Fin",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),s("div",de,[a(G,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=t=>b.value=t),options:S.value,label:"Tipo de Reserva",outlined:"",dense:"",dark:"",color:"white",clearable:""},null,8,["modelValue","options"])]),s("div",ce,[a(w,{onClick:C,color:"primary",label:"Filtrar",loading:m.value,dense:""},null,8,["loading"])])]),m.value?(_(),f("div",me,[a(H,{color:"primary",size:"3em"}),e[5]||(e[5]=s("p",{class:"q-mt-md"},"Cargando facturas...",-1))])):n.value.length>0?(_(),f("div",pe,[a(z,{columns:T.value,rows:n.value,"row-key":"id",dense:"",class:"bg-black text-white","rows-per-page-options":[10,25,50],"rows-per-page-label":"Filas por p\xE1gina:","no-data-label":"No hay facturas disponibles"},{"body-cell-order_date":l(t=>[a(c,{props:t},{default:l(()=>[u(r(B(t.value)),1)]),_:2},1032,["props"])]),"body-cell-total_amount":l(t=>[a(c,{props:t},{default:l(()=>[u(" $"+r(Number(t.value).toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-club_commission":l(t=>[a(c,{props:t},{default:l(()=>[u(" $"+r(Number(t.value||0).toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-player_commission":l(t=>[a(c,{props:t},{default:l(()=>[u(" $"+r(Number(t.value||0).toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-net_amount":l(t=>[a(c,{props:t,class:"text-green"},{default:l(()=>[u(" $"+r(q(t.row)),1)]),_:2},1032,["props"])]),"body-cell-event_type":l(t=>[a(c,{props:t},{default:l(()=>[a(j,{color:P(t.value),"text-color":"white",dense:""},{default:l(()=>[u(r(L(t.value)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),_:1},8,["columns","rows"]),s("div",ve,[s("div",_e,[a(y,{class:"bg-primary text-white"},{default:l(()=>[a(h,null,{default:l(()=>[e[6]||(e[6]=s("div",{class:"text-h6"},"Total Facturado",-1)),s("div",be,"$"+r(F.value.toFixed(2)),1)]),_:1})]),_:1})]),s("div",ge,[a(y,{class:"bg-orange text-white"},{default:l(()=>[a(h,null,{default:l(()=>[e[7]||(e[7]=s("div",{class:"text-h6"},"Comisi\xF3n Plataforma",-1)),s("div",fe,"$"+r(D.value.toFixed(2)),1)]),_:1})]),_:1})]),s("div",ye,[a(y,{class:"bg-green text-white"},{default:l(()=>[a(h,null,{default:l(()=>[e[8]||(e[8]=s("div",{class:"text-h6"},"Total Recibido",-1)),s("div",he,"$"+r(E.value.toFixed(2)),1)]),_:1})]),_:1})])])])):(_(),f("div",xe,[a(R,{name:"receipt",size:"4em",color:"black"}),e[9]||(e[9]=s("p",{class:"text-h6 q-mt-md"},"No hay facturas para mostrar",-1)),e[10]||(e[10]=s("p",{class:"text-black"},"Ajusta los filtros para ver m\xE1s resultados",-1))]))]),_:1})]),_:1}),a(ee)]),_:1}))}};var Ze=ae(Ne,[["__scopeId","data-v-297d59d8"]]);export{Ze as default};
