import{Q as le}from"./QHeader.325e6f8a.js";import{F as ne,r as p,B as ce,q as i,G as q,H as o,v as s,I as r,bI as B,J as v,s as l,ab as V,ac as E,ad as _,K as j,y as $,ag as w,af as G,ae as L,bG as R,x as c}from"./index.cabb238b.js";import{Q as de}from"./QSpinnerDots.d4a31a47.js";import{Q as ue}from"./QTooltip.35c9b747.js";import{Q as M,a as y}from"./QItem.54c8e8ba.js";import{Q as f}from"./QItemLabel.8ddeeb8d.js";import{Q as A}from"./QChip.412b033a.js";import{Q as U}from"./QList.e00fe6ed.js";import{Q as me}from"./QPage.699d16e0.js";import{Q as pe,a as _e}from"./QLayout.6d8de49a.js";import{u as ve}from"./userStore.b62a8549.js";import{s as S}from"./supabase.48b89bac.js";import{d as ye}from"./dateUtils.417f5f8f.js";import{u as fe}from"./useDashboardNavigation.7cf658d3.js";import{P as ge}from"./PlayerNavigationMenu.015757c8.js";import{P as he}from"./PlayerTopMenu.ee6587be.js";import{N as be}from"./NotificationBell.ba64f71a.js";import{B as xe}from"./BannerPromoScrolling.aee34302.js";import{_ as we}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.1c1c51fc.js";import"./selection.843cdb12.js";import"./pinia.490ff4c4.js";import"./QTabs.a62af68f.js";import"./rtl.276c3f1b.js";import"./QFooter.55965c1d.js";import"./QBtnDropdown.ef49fdda.js";import"./QBtnGroup.9335b69a.js";import"./QMenu.0e9924f1.js";import"./QBadge.3619d9a5.js";import"./api.2af71db3.js";import"./admin.c99b9bfe.js";const ke={class:"header-content"},Ce={class:"greeting"},Qe={class:"header-icons"},De={class:"player-container"},Pe={class:"row items-center q-mb-md history-header"},qe={key:0,class:"text-center q-pa-xl"},$e={key:1,class:"history-content"},Se={class:"history-tabs q-mb-md"},He={class:"history-layout"},Ie={key:0,class:"history-section"},Ne={class:"section-header"},Fe={key:0,class:"date-filter-section q-mb-md"},Te={class:"row q-gutter-sm"},ze={class:"col"},Be={class:"col"},Ve={class:"row q-gutter-sm q-mt-sm"},Ee={key:1,class:"empty-state"},je={key:2,class:"payment-list"},Ge={class:"text-right"},Le={class:"text-weight-bold amount"},Re={key:1,class:"history-section"},Me={key:0,class:"empty-state"},Ae={key:1,class:"games-list"},Ue={class:"text-right"},Je={class:"q-mt-xs text-caption text-grey"},Oe={__name:"PlayerHistory",setup(Ke){const g=ne(),k=ve().userId,{goToDashboard:H}=fe(),h=p(!0),n=p("payments"),Q=p([]),D=p([]),b=p(""),x=p(""),C=p(!0),I=()=>{const e=new Date,t=new Date;t.setDate(e.getDate()-15),x.value=e.toISOString().split("T")[0],b.value=t.toISOString().split("T")[0]},N=async()=>{try{let e=S.from("payment_orders").select("*").eq("user_id",k);b.value&&(e=e.gte("order_date",b.value)),x.value&&(e=e.lte("order_date",x.value));const{data:t,error:a}=await e.order("order_date",{ascending:!1});if(a){console.error("Error loading payment history:",a);return}Q.value=t||[]}catch(e){console.error("Error loading payment history:",e)}},F=async()=>{h.value=!0,await N(),h.value=!1},J=async()=>{I(),await F()},O=async()=>{try{const{data:e,error:t}=await S.from("reservations").select(`
        *,
        courts(id, name, club_id, clubs(name)),
        matches(id, gender, category, team1_players, team2_players)
      `).eq("player_id",k).order("reservation_date",{ascending:!1}).limit(50);if(t){console.error("Error loading games history:",t);return}const{data:a,error:d}=await S.from("matches").select(`
        id, gender, category, team1_players, team2_players,
        reservations(id, reservation_date, start_time, end_time, status, courts(id, name, clubs(name)))
      `).or(`team1_players.cs.{${k}},team2_players.cs.{${k}}`).order("created_at",{ascending:!1}).limit(50);d&&console.error("Error loading match reservations:",d);const u=[...e||[]];a&&a.forEach(m=>{m.reservations&&!u.some(P=>P.id===m.reservations.id)&&u.push({id:m.reservations.id,...m.reservations,matches:m})}),u.sort((m,P)=>new Date(P.reservation_date)-new Date(m.reservation_date)),D.value=u}catch(e){console.error("Error loading games history:",e)}},T=e=>{switch(e){case"succeeded":case"approved":return"positive";case"pending":return"warning";case"failed":case"rejected":return"negative";default:return"grey"}},K=e=>{switch(e){case"succeeded":case"approved":return"Exitoso";case"pending":return"Pendiente";case"failed":case"rejected":return"Fallido";default:return e}},X=e=>{switch(e){case"court":case"reservation":return"sports_tennis";case"tournament":return"emoji_events";case"lesson":return"school";case"open_match_join":return"group_add";default:return"payment"}},W=e=>{switch(e.event_type){case"court":case"reservation":return"Reserva de cancha";case"tournament":return"Inscripci\xF3n a torneo";case"lesson":return"Clase de p\xE1del";case"open_match_join":return"Uni\xF3n a partido abierto";default:return e.event_type||"Pago"}},Y=e=>{switch(e){case"completed":return"positive";case"active":case"confirmed":return"primary";case"cancelled":return"negative";default:return"grey"}},Z=e=>{switch(e){case"completed":return"Completado";case"active":case"confirmed":return"Confirmado";case"cancelled":return"Cancelado";default:return e||"Programado"}},ee=e=>{if(e.matches){const t=e.matches;let a="Partido";return t.gender&&(a+=` ${t.gender}`),t.category&&(a+=` - ${t.category}`),a}return"Reserva de cancha"},te=e=>{var t,a;if(e.courts){const d=e.courts.name||"Cancha sin nombre",u=((t=e.courts.clubs)==null?void 0:t.name)||((a=e.courts.club)==null?void 0:a.name);return u?`${d} - ${u}`:d}return"Cancha sin nombre"},z=e=>e?ye(e):"",se=e=>e?e.substring(0,5):"",ae=e=>e?Number(e).toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",oe=()=>{g.go(-1)},re=e=>{var t;(t=e.matches)!=null&&t.id?g.push(`/player/match/${e.matches.id}`):e.id&&console.log("Reservation details:",e)},ie=e=>{switch(e.event_type){case"court":case"reservation":case"open_match_join":e.event_id&&g.push(`/player/match/${e.event_id}`);break;case"tournament":e.event_id&&g.push(`/player/tournaments/${e.event_id}`);break;case"lesson":case"private-lesson":case"public-lesson":e.event_id&&g.push(`/player/classes/${e.event_id}`);break;default:console.log("Payment details:",e)}};return ce(async()=>{h.value=!0,I(),await Promise.all([N(),O()]),h.value=!1}),(e,t)=>(i(),q(pe,{view:"hHh lpR fFf",class:"text-white"},{default:o(()=>[s(le,{elevated:"",class:"text-white"},{default:o(()=>[r("div",ke,[r("div",Ce,[r("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...a)=>B(H)&&B(H)(...a))})]),r("div",Qe,[s(be),s(he)])]),s(xe)]),_:1}),s(_e,null,{default:o(()=>[s(me,{class:"q-pa-md"},{default:o(()=>[r("div",De,[r("div",Pe,[s(v,{flat:"",round:"",dense:"",icon:"arrow_back",class:"text-white",onClick:oe}),t[6]||(t[6]=r("h5",{class:"text-white q-ma-none q-ml-md"},"Historial",-1))]),h.value?(i(),l("div",qe,[s(de,{size:"50px",color:"white"}),t[7]||(t[7]=r("div",{class:"q-mt-md text-white"},"Cargando historial...",-1))])):(i(),l("div",$e,[r("div",Se,[s(v,{color:n.value==="payments"?"primary":"grey",outline:n.value!=="payments",label:"Pagos",onClick:t[1]||(t[1]=a=>n.value="payments"),class:"tab-btn"},null,8,["color","outline"]),s(v,{color:n.value==="games"?"primary":"grey",outline:n.value!=="games",label:"Juegos",onClick:t[2]||(t[2]=a=>n.value="games"),class:"tab-btn"},null,8,["color","outline"])]),r("div",He,[n.value==="payments"?(i(),l("div",Ie,[s(V,{flat:"",bordered:"",class:"text-white history-card"},{default:o(()=>[s(E,null,{default:o(()=>[r("div",Ne,[t[9]||(t[9]=r("div",{class:"text-h6"},"\u{1F4CB} Historial de Pagos",-1)),s(v,{flat:"",round:"",dense:"",icon:C.value?"expand_less":"tune",onClick:t[3]||(t[3]=a=>C.value=!C.value),color:"primary",class:"q-ml-sm"},{default:o(()=>[s(ue,null,{default:o(()=>t[8]||(t[8]=[_("Filtrar por fechas")])),_:1})]),_:1},8,["icon"])]),C.value?(i(),l("div",Fe,[r("div",Te,[r("div",ze,[s(j,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=a=>b.value=a),type:"date",label:"Desde",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),r("div",Be,[s(j,{modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=a=>x.value=a),type:"date",label:"Hasta",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])])]),r("div",Ve,[s(v,{label:"Aplicar",color:"primary",onClick:F,size:"sm"}),s(v,{label:"\xDAltimos 15 d\xEDas",color:"secondary",outline:"",onClick:J,size:"sm"})])])):$("",!0),Q.value.length===0?(i(),l("div",Ee,[s(w,{name:"payment",size:"50px",color:"grey"}),t[10]||(t[10]=r("div",{class:"q-mt-md text-grey"},"No tienes pagos registrados",-1))])):(i(),l("div",je,[s(U,{separator:"",class:"text-white"},{default:o(()=>[(i(!0),l(G,null,L(Q.value,a=>(i(),q(M,{key:a.id,class:"payment-item",clickable:"",onClick:d=>ie(a)},{default:o(()=>[s(y,{avatar:""},{default:o(()=>[s(R,{color:T(a.payment_status),"text-color":"white",size:"40px"},{default:o(()=>[s(w,{name:X(a.event_type)},null,8,["name"])]),_:2},1032,["color"])]),_:2},1024),s(y,{class:"payment-details"},{default:o(()=>[s(f,{class:"text-weight-bold payment-title"},{default:o(()=>[_(c(W(a)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey payment-date"},{default:o(()=>[_(c(z(a.order_date)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey payment-method"},{default:o(()=>[_(c(a.payment_method),1)]),_:2},1024)]),_:2},1024),s(y,{side:"",class:"payment-amount"},{default:o(()=>[r("div",Ge,[r("div",Le," $"+c(ae(a.total_amount)),1),s(A,{color:T(a.payment_status),"text-color":"white",size:"sm",label:K(a.payment_status)},null,8,["color","label"])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]))]),_:1})]),_:1})])):$("",!0),n.value==="games"?(i(),l("div",Re,[s(V,{flat:"",bordered:"",class:"text-white history-card"},{default:o(()=>[s(E,null,{default:o(()=>[t[12]||(t[12]=r("div",{class:"section-header"},[r("div",{class:"text-h6"},"\u{1F3D3} Historial de Juegos")],-1)),D.value.length===0?(i(),l("div",Me,[s(w,{name:"sports_tennis",size:"50px",color:"grey"}),t[11]||(t[11]=r("div",{class:"q-mt-md text-grey"},"No tienes juegos registrados",-1))])):(i(),l("div",Ae,[s(U,{separator:"",class:"text-white"},{default:o(()=>[(i(!0),l(G,null,L(D.value,a=>(i(),q(M,{key:a.id,class:"game-item",clickable:"",onClick:d=>re(a)},{default:o(()=>[s(y,{avatar:""},{default:o(()=>[s(R,{color:"primary","text-color":"white",size:"40px"},{default:o(()=>[s(w,{name:"sports_tennis"})]),_:1})]),_:1}),s(y,{class:"game-details"},{default:o(()=>[s(f,{class:"text-weight-bold game-title"},{default:o(()=>[_(c(te(a)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey game-date"},{default:o(()=>[_(c(z(a.reservation_date))+" - "+c(se(a.start_time)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey game-type"},{default:o(()=>[_(c(ee(a)),1)]),_:2},1024)]),_:2},1024),s(y,{side:"",class:"game-status"},{default:o(()=>[r("div",Ue,[s(A,{color:Y(a.status),"text-color":"white",size:"sm",label:Z(a.status)},null,8,["color","label"]),r("div",Je,[s(w,{name:"chevron_right"})])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]))]),_:1})]),_:1})])):$("",!0)])]))])]),_:1})]),_:1}),s(ge)]),_:1}))}};var qt=we(Oe,[["__scopeId","data-v-84ce4836"]]);export{qt as default};
