import{F as U,r as u,B as F,a8 as j,q as d,G as _,H as o,v as a,I as r,ab as C,J as s,s as x,ae as H,ad as R,ac as J,ag as k,ah as V,a9 as Q,aa as D,af as w,x as y}from"./index.815d5b0f.js";import{Q as A}from"./QHeader.3caf1f46.js";import{Q as G}from"./QPage.daab8af4.js";import{Q as E,a as h}from"./QItem.80f66e57.js";import{Q as O}from"./QList.ce6bf49d.js";import{Q as K}from"./QMenu.519aff97.js";import{Q as W,a as X}from"./QLayout.91ba208b.js";import{C as T}from"./ClosePopup.385dc8c6.js";import{s as I}from"./supabase.0c3a4b59.js";import{u as Y}from"./use-quasar.56f650c2.js";import"./api.92f95132.js";import{C as Z}from"./ClubNavigationMenu.d5c69742.js";import{_ as $}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.557d1480.js";import"./selection.a88ce13a.js";import"./QTabs.e5b1bd5c.js";import"./rtl.276c3f1b.js";import"./QFooter.ba1f9f5c.js";const ee={name:"ListTournaments",components:{ClubNavigationMenu:Z},setup(){const c=U(),e=Y(),m=u([]),n=u(null),v=u(!1),g=u(!1),f=u(null),t=u(null),b=async()=>{try{if(!n.value){console.error("Club ID no encontrado.");return}const{data:l,error:p}=await I.rpc("get_tournaments_by_club",{club_id:n.value});if(p){console.error("Error fetching tournaments:",p.message);return}m.value=l.map(i=>({id:i.id,name:i.name,start_date:i.start_date,min_pairs:i.min_pairs,registered_teams:i.registered_teams||0}))}catch(l){console.error("Unexpected error fetching tournaments:",l.message)}},q=l=>{c.push({name:"EditTournament",params:{tournamentId:l}})},B=l=>{f.value=l,v.value=!0},N=async()=>{try{const{error:l}=await I.from("tournaments").delete().eq("id",f.value);if(l)throw l;m.value=m.value.filter(p=>p.id!==f.value),v.value=!1,e.notify({type:"positive",message:"Torneo eliminado exitosamente."})}catch(l){console.error("Error al eliminar el torneo:",l.message),e.notify({type:"negative",message:"Error al eliminar torneo."})}},L=l=>{t.value=l,g.value=!0},M=async()=>{try{if(console.log("Cerrando torneo:",t.value.id),t.value.registered_teams<t.value.min_pairs){e.notify({type:"negative",message:"El torneo no tiene suficientes parejas inscritas para cerrarlo."}),g.value=!1;return}c.push({name:"PreviewTournament",params:{tournamentId:t.value.id}}),g.value=!1}catch(l){console.error("Error navigating to preview:",l),e.notify({type:"negative",message:"Error al navegar a la vista previa del torneo."})}},P=l=>{c.push("/club/creartorneos")},z=()=>{c.back()};return F(()=>{const l=localStorage.getItem("token");if(l){const i=l.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),S=JSON.parse(atob(i));n.value=S.club_id||null}b()}),{tournaments:m,goBack:z,editTournament:q,openDeleteDialog:B,openCloseDialog:L,deleteDialogVisible:v,closeDialogVisible:g,deleteTournament:N,closeTournament:M,openCreateTournament:P}}},ae={class:"header-content"},oe={class:"header-icons"},le={key:0,class:"text-center q-mt-md"},te={key:1,class:"tournaments-list"},re={class:"actions"};function ne(c,e,m,n,v,g){const f=j("ClubNavigationMenu");return d(),_(W,{view:"hHh lpR fFf",class:"body text-white"},{default:o(()=>[a(A,{elevated:"",class:"bg-primary text-white"},{default:o(()=>[r("div",ae,[e[2]||(e[2]=r("div",{class:"greeting"},[r("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),C(" Mis Torneos ")],-1)),r("div",oe,[a(s,{flat:"",round:"",icon:"arrow_back",onClick:n.goBack},null,8,["onClick"])])])]),_:1}),a(X,null,{default:o(()=>[a(G,{class:"q-pa-md"},{default:o(()=>[n.tournaments.length===0?(d(),x("div",le,[a(H,{name:"event_busy",size:"64px"}),e[3]||(e[3]=r("p",null,"No has creado torneos todav\xEDa.",-1))])):(d(),x("div",te,[(d(!0),x(R,null,J(n.tournaments,t=>(d(),_(Q,{key:t.id,class:"q-mb-md transparent-card"},{default:o(()=>[a(D,null,{default:o(()=>[r("h4",null,y(t.name),1),r("p",null,[e[4]||(e[4]=r("strong",null,"Fecha:",-1)),C(" "+y(t.start_date)+" ",1),e[5]||(e[5]=r("br",null,null,-1)),e[6]||(e[6]=r("strong",null,"M\xEDnimo de Parejas:",-1)),C(" "+y(t.min_pairs)+" ",1),e[7]||(e[7]=r("br",null,null,-1)),e[8]||(e[8]=r("strong",null,"Parejas Inscritas:",-1)),C(" "+y(t.registered_teams),1)]),r("div",re,[a(s,{icon:"edit",label:"Editar",color:"primary",size:"sm",onClick:b=>n.editTournament(t.id)},null,8,["onClick"]),a(s,{icon:"delete",label:"Eliminar",color:"negative",size:"sm",disable:t.registered_teams>0,onClick:b=>n.openDeleteDialog(t.id)},null,8,["disable","onClick"]),a(s,{icon:"block",label:"Cerrar Torneo",color:"orange",size:"sm",onClick:b=>n.openCloseDialog(t)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]))]),_:1}),a(s,{glossy:"",round:"",size:"lg",color:"black",icon:"add",class:"fixed-bottom-right q-mb-xl"},{default:o(()=>[a(K,{anchor:"top end",self:"bottom end"},{default:o(()=>[a(O,{style:{"min-width":"150px"}},{default:o(()=>[k((d(),_(E,{clickable:"",onClick:n.openCreateTournament},{default:o(()=>[a(h,null,{default:o(()=>e[9]||(e[9]=[r("strong",null,"Retas",-1)])),_:1})]),_:1},8,["onClick"])),[[T]]),k((d(),_(E,{clickable:"",onClick:n.openCreateTournament},{default:o(()=>[a(h,null,{default:o(()=>e[10]||(e[10]=[r("strong",null,"Torneo",-1)])),_:1})]),_:1},8,["onClick"])),[[T]])]),_:1})]),_:1})]),_:1}),a(V,{modelValue:n.deleteDialogVisible,"onUpdate:modelValue":e[0]||(e[0]=t=>n.deleteDialogVisible=t)},{default:o(()=>[a(Q,{class:"bg-black text-white"},{default:o(()=>[a(D,null,{default:o(()=>e[11]||(e[11]=[r("div",{class:"text-h6"},"Confirmar eliminaci\xF3n",-1),r("div",null,"\xBFEst\xE1s seguro de que deseas eliminar este torneo?",-1)])),_:1}),a(w,{align:"right"},{default:o(()=>[k(a(s,{flat:"",label:"Cancelar",color:"primary"},null,512),[[T]]),a(s,{flat:"",label:"Eliminar",color:"negative",onClick:n.deleteTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:n.closeDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=t=>n.closeDialogVisible=t)},{default:o(()=>[a(Q,{class:"bg-black text-white"},{default:o(()=>[a(D,null,{default:o(()=>e[12]||(e[12]=[r("div",{class:"text-h6"},"Confirmar cierre",-1),r("div",null," \xBFEst\xE1s seguro de que deseas cerrar este torneo? Esto generar\xE1 el fixture autom\xE1ticamente. ",-1)])),_:1}),a(w,{align:"right"},{default:o(()=>[k(a(s,{flat:"",label:"Cancelar",color:"red"},null,512),[[T]]),a(s,{flat:"",label:"Cerrar Torneo",color:"green",onClick:n.closeTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(f)]),_:1})}var De=$(ee,[["render",ne],["__scopeId","data-v-692acad7"]]);export{De as default};
