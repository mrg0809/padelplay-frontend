import{Q as Pe}from"./QHeader.435fe33d.js";import{r as m,F as Se,bI as he,B as xe,aa as Ne,q as i,G as U,H as b,v as t,I as l,bH as ue,K as x,s as p,ae as le,af as I,ab as Te,ac as qe,y as S,ad as k,x as _,J as ae,ah as Qe,aj as De,aS as Ee,ag as W,bE as Be}from"./index.3f1076a3.js";import{Q as de}from"./QTooltip.eeb15206.js";import{Q as Ue}from"./QPage.76b9f650.js";import{Q as Ie,a as $e}from"./QLayout.fe9d4509.js";import{Q as X}from"./QSelect.5a18ef61.js";import{Q as oe}from"./QChip.7993a070.js";import{Q as He,a as ce}from"./QItem.b93d6a07.js";import{Q as Me}from"./QItemLabel.87a3fa18.js";import{Q as Re}from"./QList.9c423d93.js";import{u as ze}from"./use-quasar.0801e5c5.js";import{c as Fe,a as Le}from"./lessons.e59aa609.js";import{u as Oe}from"./useDashboardNavigation.47583d78.js";import{a as me}from"./api.2af71db3.js";import{s as se}from"./supabase.1a50364d.js";import{f as Ae}from"./reservations.6a94deee.js";import{f as je}from"./lessons.82b34671.js";import{f as Ge}from"./clubs.21e99cea.js";import{g as Je}from"./hourUtils.24f4f451.js";import{s as Ke}from"./commun.fc6bc6e6.js";import{u as We}from"./userStore.83e3996f.js";import{B as Xe}from"./BannerPromoScrolling.500b6c87.js";import{C as Ye}from"./ClubNavigationMenu.b111cae3.js";import{C as Ze}from"./ClubTopMenu.0ea6a94c.js";import{N as el}from"./NotificationBell.10a15500.js";import{_ as ll}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.56b90783.js";import"./selection.499e7988.js";import"./QMenu.902d7e0c.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./pinia.79532550.js";import"./admin.c99b9bfe.js";import"./QTabs.a46b14bb.js";import"./QFooter.1bfeb9e5.js";import"./QBtnDropdown.e6013b36.js";import"./QBadge.7d912cff.js";const al=async V=>{try{return(await me.post("/blocks/block-court",V)).data}catch(c){throw console.error("Error al crear bloqueo:",c),c}},ol=async V=>{try{return(await me.delete(`/blocks/delete-block/${V}`)).data}catch(c){throw console.error("Error al eliminar bloqueo:",c),c}},tl=async(V,c)=>{try{const{data:g,error:R}=await se.from("court_blocks").select("*").eq("club_id",c).lte("start_date",V).gte("end_date",V);if(R)throw R;return g}catch(g){throw console.error("Error fetching court blocks:",g),g}},sl=async V=>{const{data:c,error:g}=await se.from("courts").select("id, name").eq("club_id",V);if(g)throw new Error(g.message);return c},rl=async V=>{const{data:c,error:g}=await se.from("courts").select("id, name, price_per_hour, price_per_hour_and_half, price_per_two_hour").eq("id",V);if(g)throw new Error(g.message);return c};const nl={class:"header-content"},il={class:"greeting"},ul={class:"header-icons"},dl={class:"date-selector"},cl={class:"reservation-calendar responsive-table"},ml={class:"reservation-table"},pl=["onClick"],vl={key:0},fl={key:1},bl={key:0},gl={key:0},yl={key:1},_l={key:2},kl={key:1},Vl={key:0},wl={key:1},Cl={key:0},Pl={key:1},Sl={key:2},hl={class:"q-mt-md"},xl={__name:"ViewSchedule",setup(V){const c=m(new Date().toISOString().split("T")[0]),g=m([]),R=m([]);m([]);const v=m({}),re=Se(),{goToDashboard:ne}=Oe(),E=ze(),N=We().clubId,$=m(!1),Y=m(!1),n=m(null);m({playerName:"",isPaid:!1,eventType:"Reserva"});const z=m(null),F=m([]),T=m(null),y=m(null),w=m(""),L=m(""),te=m([{label:"60 min",value:60},{label:"90 min",value:90},{label:"120 min",value:120}]),C=m(null),pe=m([{label:"Reserva",value:"reservation"},{label:"Clase",value:"lesson"},{label:"Bloqueo",value:"block"}]),O=m(""),A=m(""),j=m(null),Z=m(""),ee=m(""),G=m(""),ve=async(o,e)=>{if(!o)return e(()=>F.value=[]);try{const d=await Ke(o);F.value=d.map(s=>({...s,full_name:`${s.first_name} ${s.last_name}`})),e(()=>F.value=F.value)}catch(d){console.error("Error buscando jugadores:",d)}},ie=()=>{z.value=null,y.value=null,w.value="",O.value="",A.value="",j.value=null,Z.value="",ee.value="",G.value=""},fe=()=>{n.value.type==="reservation"&&n.value.matchId?re.push(`/player/match/${n.value.matchId}?from=club`):n.value.type==="lesson"&&re.push(`/club/clases/${n.value.id}`)},be=()=>{E.dialog({title:"Confirmar",message:"\xBFEst\xE1s seguro de que quieres eliminar este bloqueo?",cancel:!0,persistent:!0}).onOk(async()=>{try{await ol(n.value.id),E.notify({type:"positive",message:"Bloqueo eliminado exitosamente"}),$.value=!1,J()}catch(o){console.error("Error al eliminar bloqueo:",o),E.notify({type:"negative",message:"Error al eliminar el bloqueo"})}})},ge=async()=>{if(console.log("selectedDuration.value:",y.value),console.log("selectedCourtId.value:",T.value),!y.value||!T.value){w.value="No disponible";return}try{const o=await rl(T.value);if(console.log("courtPrices:",o),!o||o.length===0){w.value="No disponible";return}const e=o[0];let d="No disponible";y.value.value===60?(d=e.price_per_hour,console.log("Duraci\xF3n 60, precio:",d)):y.value.value===90?(d=e.price_per_hour_and_half,console.log("Duraci\xF3n 90, precio:",d)):y.value.value===120&&(d=e.price_per_two_hour,console.log("Duraci\xF3n 120, precio:",d)),d==null?(w.value="No disponible",console.log("Precio es null o undefined")):(w.value=d.toString(),console.log("Precio asignado:",w.value))}catch(o){console.error("Error obteniendo precios:",o),w.value="No disponible"}},ye=(o,e)=>{var d;(d=v.value[o])!=null&&d[e]?(n.value=v.value[o][e],Y.value=!1):(T.value=o,L.value=e,Y.value=!0,C.value=null,ie()),$.value=!0},_e=async()=>{if(!C.value||!T.value||!L.value||!y.value){console.error("Faltan datos b\xE1sicos para crear el evento.");return}const o=L.value,e=y.value.value,[d,s]=o.split(":").map(Number);let u=s+e,h=d+Math.floor(u/60);u=u%60;const a=String(h).padStart(2,"0")+":"+String(u).padStart(2,"0");try{if(C.value.value==="reservation"){if(!z.value||!w.value){console.error("Faltan datos para crear la reserva.");return}const r={club_id:N,court_id:T.value,reservation_date:c.value,start_time:o,end_time:a,total_price:w.value,player_id:z.value.user_id};await Fe(r),E.notify({type:"positive",message:"Reserva creada exitosamente"})}else if(C.value.value==="lesson"){if(!O.value||!A.value){console.error("Faltan datos para crear la lecci\xF3n.");return}const r={club_id:N,court_id:T.value,lesson_date:c.value,lesson_time:o+":00",duration:e,coach:A.value,lesson_type:"public",name:O.value,description:ee.value,price:parseFloat(Z.value)||0,max_participants:j.value?parseInt(j.value):null};await Le(r),E.notify({type:"positive",message:"Lecci\xF3n creada exitosamente"})}else if(C.value.value==="block"){if(!G.value){console.error("Falta la raz\xF3n del bloqueo.");return}const r={court_id:T.value,club_id:N,start_date:c.value,end_date:c.value,start_time:o+":00",end_time:a+":00",reason:G.value};await al(r),E.notify({type:"positive",message:"Bloqueo creado exitosamente"})}console.log("Evento creado exitosamente"),$.value=!1,J()}catch(r){console.error("Error al crear el evento:",r),E.notify({type:"negative",message:"Error al crear el evento"})}},ke=(o,e)=>{var d;if((d=v.value[o])!=null&&d[e]){if(v.value[o][e].type==="block")return"blocked";if(v.value[o][e].type==="reservation")return"occupied";if(v.value[o][e].type==="lesson")return"lesson"}return"available"},J=async()=>{try{const o=await Ae(c.value,N),e=await tl(c.value,N),d=await je(c.value,N),s=o.reduce((a,r)=>{var B,H;const P=r.court_id,K=r.start_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"reservation",playerName:r.profiles.full_name,courtName:r.courts.name,isPaid:r.is_paid,id:r.id,matchId:(H=(B=r.matches)==null?void 0:B[0])==null?void 0:H.id};const[Q,D]=f.split(":").map(Number);let M=D+30,Ce=Q+Math.floor(M/60);if(M=M%60,f=`${String(Ce).padStart(2,"0")}:${String(M).padStart(2,"0")}`,f>q)break}return a},{}),u=d.reduce((a,r)=>{var B;const P=r.court_id,K=r.lesson_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"lesson",lessonName:r.name,coachName:((B=r.coaches)==null?void 0:B.name)||r.coach,lessonType:r.lesson_type,maxParticipants:r.max_participants,currentParticipants:r.players?r.players.length:0,id:r.id,price:r.price};const[H,Q]=f.split(":").map(Number);let D=Q+30,M=H+Math.floor(D/60);if(D=D%60,f=`${String(M).padStart(2,"0")}:${String(D).padStart(2,"0")}`,f>q)break}return a},{}),h=e.reduce((a,r)=>{const P=r.court_id,K=r.start_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"block",isBlock:!0,reason:r.reason,id:r.id};const[B,H]=f.split(":").map(Number);let Q=H+30,D=B+Math.floor(Q/60);if(Q=Q%60,f=`${String(D).padStart(2,"0")}:${String(Q).padStart(2,"0")}`,f>q)break}return a},{});v.value={},v.value=Object.assign({},s,u,h)}catch(o){console.error("Unexpected error:",o.message)}},Ve=async()=>{try{const o=await Ge(N),e=o.reduce((s,u)=>u.opening_time<s?u.opening_time:s,o[0].opening_time),d=o.reduce((s,u)=>u.closing_time>s?u.closing_time:s,o[0].closing_time);R.value=Je(e,d)}catch(o){console.error("Unexpected error:",o.message)}},we=async()=>{try{const o=await sl(N);g.value=o}catch(o){console.error("Unexpected error:",o.message)}};return he(()=>{J()}),xe(()=>{we(),Ve(),J()}),(o,e)=>{const d=Ne("q-textarea");return i(),U(Ie,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:b(()=>[t(Pe,{elevated:"",class:"text-white"},{default:b(()=>[l("div",nl,[l("div",il,[l("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...s)=>ue(ne)&&ue(ne)(...s))})]),l("div",ul,[t(el),t(Ze)])]),t(Xe)]),_:1}),t($e,null,{default:b(()=>[t(Ue,{class:"q-pa-md schedule-desktop"},{default:b(()=>[l("div",dl,[t(x,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),type:"date",label:"Selecciona una fecha",outlined:"",dense:"",color:"white","bg-color":"grey",onChange:J},null,8,["modelValue"])]),e[19]||(e[19]=l("div",{class:"color-legend q-mb-md"},[l("div",{class:"legend-title text-h6 text-center q-mb-sm"},"Leyenda"),l("div",{class:"legend-items"},[l("div",{class:"legend-item"},[l("div",{class:"legend-color available"}),l("span",null,"Disponible")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color occupied"}),l("span",null,"Reserva")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color lesson"}),l("span",null,"Clase")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color blocked"}),l("span",null,"Bloqueo")])])],-1)),l("div",cl,[l("table",ml,[l("thead",null,[l("tr",null,[e[18]||(e[18]=l("th",null,"Hora",-1)),(i(!0),p(I,null,le(g.value,s=>(i(),p("th",{key:s.id},_(s.name),1))),128))])]),l("tbody",null,[(i(!0),p(I,null,le(R.value,s=>(i(),p("tr",{key:s},[l("td",null,_(s),1),(i(!0),p(I,null,le(g.value,u=>{var h;return i(),p("td",{key:u.id,class:Ee(ke(u.id,s)),onClick:a=>ye(u.id,s)},[(h=v.value[u.id])!=null&&h[s]?(i(),p("div",vl,[v.value[u.id][s].type==="reservation"?(i(),p(I,{key:0},[l("strong",null,_(v.value[u.id][s].playerName),1),v.value[u.id][s].isPaid?(i(),U(W,{key:0,name:"o_paid",color:"green",size:"sm",class:"q-ml-sm"})):(i(),U(W,{key:1,name:"money_off",color:"red",size:"sm",class:"q-ml-sm"}))],64)):v.value[u.id][s].type==="lesson"?(i(),p(I,{key:1},[l("strong",null,_(v.value[u.id][s].lessonName),1),t(W,{name:"school",color:"blue",size:"sm",class:"q-ml-sm"}),t(de,null,{default:b(()=>[k("Instructor: "+_(v.value[u.id][s].coachName),1)]),_:2},1024)],64)):v.value[u.id][s].type==="block"?(i(),p(I,{key:2},[t(de,null,{default:b(()=>[k(_(v.value[u.id][s].reason),1)]),_:2},1024),t(W,{name:"block",color:"red",size:"xs"})],64)):S("",!0)])):(i(),p("div",fl,[t(W,{name:"add",color:"black",size:"xs"})]))],10,pl)}),128))]))),128))])])])]),_:1})]),_:1}),t(De,{modelValue:$.value,"onUpdate:modelValue":e[17]||(e[17]=s=>$.value=s)},{default:b(()=>[t(Te,{class:"bg-black"},{default:b(()=>[t(qe,null,{default:b(()=>{var s,u,h;return[Y.value?(i(),p("div",bl,[e[20]||(e[20]=l("h6",null,"Crear Evento",-1)),t(X,{modelValue:C.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>C.value=a),ie],options:pe.value,label:"Tipo de evento"},null,8,["modelValue","options"]),((s=C.value)==null?void 0:s.value)==="reservation"?(i(),p("div",gl,[t(X,{modelValue:z.value,"onUpdate:modelValue":e[3]||(e[3]=a=>z.value=a),"use-input":"","fill-input":"","input-debounce":"300",label:"Buscar jugador",options:F.value,"option-label":"full_name","option-value":"user_id",onFilter:ve},null,8,["modelValue","options"]),t(X,{modelValue:y.value,"onUpdate:modelValue":[e[4]||(e[4]=a=>y.value=a),ge],options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"]),t(x,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=a=>w.value=a),label:"Precio",disable:""},null,8,["modelValue"])])):S("",!0),((u=C.value)==null?void 0:u.value)==="lesson"?(i(),p("div",yl,[t(x,{modelValue:O.value,"onUpdate:modelValue":e[6]||(e[6]=a=>O.value=a),label:"Nombre de la clase"},null,8,["modelValue"]),t(x,{modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=a=>A.value=a),label:"Instructor"},null,8,["modelValue"]),t(X,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"]),t(x,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=a=>j.value=a),type:"number",label:"M\xE1ximo participantes"},null,8,["modelValue"]),t(x,{modelValue:Z.value,"onUpdate:modelValue":e[10]||(e[10]=a=>Z.value=a),type:"number",label:"Precio por persona"},null,8,["modelValue"]),t(d,{modelValue:ee.value,"onUpdate:modelValue":e[11]||(e[11]=a=>ee.value=a),label:"Descripci\xF3n (opcional)"},null,8,["modelValue"])])):S("",!0),((h=C.value)==null?void 0:h.value)==="block"?(i(),p("div",_l,[t(x,{modelValue:G.value,"onUpdate:modelValue":e[12]||(e[12]=a=>G.value=a),label:"Raz\xF3n del bloqueo"},null,8,["modelValue"]),t(X,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=a=>y.value=a),options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"])])):S("",!0),t(x,{modelValue:c.value,"onUpdate:modelValue":e[14]||(e[14]=a=>c.value=a),label:"Fecha",disable:""},null,8,["modelValue"]),t(x,{modelValue:L.value,"onUpdate:modelValue":e[15]||(e[15]=a=>L.value=a),label:"Hora de inicio",disable:""},null,8,["modelValue"])])):(i(),p("div",kl,[e[34]||(e[34]=l("h6",null,"Detalles del Evento",-1)),n.value.type==="reservation"?(i(),p("div",Vl,[e[24]||(e[24]=l("p",null,[l("strong",null,"Tipo:"),k(" Reserva")],-1)),l("p",null,[e[21]||(e[21]=l("strong",null,"Jugador:",-1)),k(" "+_(n.value.playerName),1)]),l("p",null,[e[22]||(e[22]=l("strong",null,"Cancha:",-1)),k(" "+_(n.value.courtName),1)]),l("p",null,[e[23]||(e[23]=l("strong",null,"Estado de pago:",-1)),t(oe,{color:n.value.isPaid?"green":"red","text-color":"white",icon:n.value.isPaid?"check_circle":"pending",label:n.value.isPaid?"Pagado":"Pendiente"},null,8,["color","icon","label"])])])):n.value.type==="lesson"?(i(),p("div",wl,[e[31]||(e[31]=l("p",null,[l("strong",null,"Tipo:"),k(" Clase")],-1)),l("p",null,[e[25]||(e[25]=l("strong",null,"Nombre:",-1)),k(" "+_(n.value.lessonName),1)]),l("p",null,[e[26]||(e[26]=l("strong",null,"Instructor:",-1)),k(" "+_(n.value.coachName),1)]),l("p",null,[e[27]||(e[27]=l("strong",null,"Tipo de clase:",-1)),t(oe,{color:n.value.lessonType==="private"?"purple":"blue","text-color":"white",label:n.value.lessonType==="private"?"Privada":"Grupal"},null,8,["color","label"])]),l("p",null,[e[28]||(e[28]=l("strong",null,"Participantes:",-1)),t(oe,{color:"blue","text-color":"white",label:`${n.value.currentParticipants}/${n.value.maxParticipants||"\u221E"}`},null,8,["label"])]),n.value.price?(i(),p("p",Cl,[e[29]||(e[29]=l("strong",null,"Precio:",-1)),k(" $"+_(n.value.price),1)])):S("",!0),n.value.lessonType==="public"&&n.value.currentParticipants>0?(i(),p("div",Pl,[e[30]||(e[30]=l("p",null,[l("strong",null,"Participantes inscritos:")],-1)),t(Re,{dense:""},{default:b(()=>[(i(!0),p(I,null,le(n.value.currentParticipants,a=>(i(),U(He,{key:a,dense:""},{default:b(()=>[t(ce,{avatar:""},{default:b(()=>[t(Be,{size:"sm",color:"blue","text-color":"white"},{default:b(()=>[k(_(a),1)]),_:2},1024)]),_:2},1024),t(ce,null,{default:b(()=>[t(Me,{caption:""},{default:b(()=>[k("Participante "+_(a),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):S("",!0)])):n.value.type==="block"?(i(),p("div",Sl,[e[33]||(e[33]=l("p",null,[l("strong",null,"Tipo:"),k(" Bloqueo")],-1)),l("p",null,[e[32]||(e[32]=l("strong",null,"Raz\xF3n:",-1)),k(" "+_(n.value.reason),1)]),t(oe,{color:"red","text-color":"white",icon:"block",label:"Cancha bloqueada"})])):S("",!0),l("div",hl,[n.value.type!=="block"?(i(),U(ae,{key:0,flat:"",color:"primary",label:"Ver m\xE1s detalles",onClick:fe})):S("",!0),n.value.type==="block"?(i(),U(ae,{key:1,flat:"",color:"negative",label:"Eliminar bloqueo",onClick:be})):S("",!0)])]))]}),_:1}),t(Qe,{align:"right"},{default:b(()=>[Y.value?(i(),U(ae,{key:0,label:"Guardar",color:"green",disable:!C.value,onClick:_e},null,8,["disable"])):S("",!0),t(ae,{label:"Cerrar",color:"negative",onClick:e[16]||(e[16]=s=>$.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ye)]),_:1})}}};var ma=ll(xl,[["__scopeId","data-v-657b8536"]]);export{ma as default};
