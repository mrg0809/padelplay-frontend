import{y as C,a6 as Q,o as f,z as h,A as s,d as r,B as u,a9 as _,D as g,a as S,aa as x,ab as E,bG as B,t as w,aT as F}from"./index.a0492954.js";import{Q as D}from"./QHeader.30ed5ffd.js";import{Q as T,a as m}from"./QItem.f78ebf7f.js";import{Q as y}from"./QItemLabel.5c5982b3.js";import{Q as I}from"./QList.87883dfb.js";import{Q as N,a as j}from"./QLayout.34772a42.js";import{n as L}from"./navigationUtils.2c4b9dee.js";import{s as p}from"./supabase.6e6ca5a2.js";import{a as b}from"./api.fb60109d.js";import{C as M}from"./ClubNavigationMenu.dfae488b.js";import{_ as V}from"./plugin-vue_export-helper.21dcd24c.js";import"./QTabs.9c45f5db.js";import"./rtl.276c3f1b.js";import"./QFooter.a1ddf79c.js";const $={components:{ClubNavigationMenu:M},data(){return{clients:[],userStore:C()}},methods:{goBack(){this.$router.back()},goToDashboard(){L(this.$router,this.userStore)},async toggleFollow(a){const e=this.userStore.userId;if(e)try{a.is_following?await b.delete("community/unfollow",{data:{follower_id:e,followed_id:a.player_id}}):await b.post("community/follow",{follower_id:e,followed_id:a.player_id}),a.is_following=!a.is_following}catch(l){console.error("Error toggling follow:",l)}},async fetchClients(){if(this.userStore.userId){const e=this.userStore.clubId;try{const{data:l,error:n}=await p.from("matches").select("team1_players, team2_players").eq("club_id",e);if(n)throw n;const i={};l.forEach(o=>{o.team1_players.forEach(t=>{i[t]=(i[t]||0)+1}),o.team2_players.forEach(t=>{i[t]=(i[t]||0)+1})});const{data:c,error:d}=await p.from("players").select("user_id, first_name, last_name, photo_url").in("user_id",Object.keys(i));if(d)throw d;this.clients=await Promise.all(Object.keys(i).map(async o=>{const t=c.find(k=>k.user_id===o),v=await this.checkIfFollowing(o);return{player_id:o,player_name:t?`${t.first_name} ${t.last_name}`:"Unknown",photo_url:t?t.photo_url:null,visits:i[o],is_following:v}})),this.clients.sort((o,t)=>t.visits-o.visits)}catch(l){console.error("Error fetching clients:",l)}}},async checkIfFollowing(a){const e=this.userStore.userId;if(e)try{const{data:l,error:n}=await p.from("follows").select("id").eq("follower_id",e).eq("followed_id",a).single();if(n&&n.code!=="PGRST116")throw n;return!!l}catch(l){return console.error("Error checking follow status:",l),!1}return!1}},mounted(){this.fetchClients()}},q={class:"header-content"},P={class:"greeting"},A={class:"header-icons"},G=["src"];function H(a,e,l,n,i,c){const d=Q("ClubNavigationMenu");return f(),h(N,{view:"hHh lpR fFf",class:"body"},{default:s(()=>[r(D,{elevated:"",class:"text-white"},{default:s(()=>[u("div",q,[u("div",P,[u("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...o)=>c.goToDashboard&&c.goToDashboard(...o))}),e[1]||(e[1]=_(" Mejores clientes ",-1))]),u("div",A,[r(g,{flat:"",round:"",icon:"close",onClick:c.goBack},null,8,["onClick"])])])]),_:1}),r(j,null,{default:s(()=>[e[2]||(e[2]=u("div",{class:"q-mt-xl"},null,-1)),r(I,{class:"court-list"},{default:s(()=>[(f(!0),S(E,null,x(i.clients,o=>(f(),h(T,{key:o.player_id,clickable:"",onClick:t=>a.editClient(o),class:"text-black court-item"},{default:s(()=>[r(m,{avatar:""},{default:s(()=>[r(B,null,{default:s(()=>[u("img",{src:o.photo_url||"https://via.placeholder.com/150",alt:"Foto del jugador"},null,8,G)]),_:2},1024)]),_:2},1024),r(m,null,{default:s(()=>[r(y,null,{default:s(()=>[_(w(o.player_name),1)]),_:2},1024),r(y,{caption:"",class:"text-black"},{default:s(()=>[_(w(o.visits)+" Visitas a tu club ",1)]),_:2},1024)]),_:2},1024),r(m,{side:""},{default:s(()=>[r(g,{color:o.is_following?"secondary":"primary",icon:o.is_following?"o_remove_circle":"o_add_circle",label:o.is_following?"Dejar de seguir":"Seguir",onClick:F(t=>c.toggleFollow(o),["stop"])},null,8,["color","icon","label","onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),r(d)]),_:1})}var so=V($,[["render",H],["__scopeId","data-v-93409cf2"]]);export{so as default};
