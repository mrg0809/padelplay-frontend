import{F as L,a9 as O,r as m,y as U,aa as G,k as d,G as _,H as t,p as e,I as n,ad as M,J as g,l as P,ab as v,ac as u,aO as D,ag as f,q as I,s as A,K as T,ai as S,ah as H,aj as J}from"./index.63dc7e23.js";import{Q as K}from"./QHeader.fafcae42.js";import{Q as W}from"./QSpinnerGears.1eecb892.js";import{Q as X}from"./QInnerLoading.c65cd0c5.js";import{Q as V}from"./QImg.863399e1.js";import{Q as b}from"./QBanner.5416e3fa.js";import{Q as Y}from"./QForm.47e0b279.js";import{Q as Z}from"./QPage.2aaa1d93.js";import{Q as $,a as ee}from"./QLayout.554612a4.js";import{Q as ae}from"./QSpace.67348306.js";import{C as E}from"./ClosePopup.dd006cf1.js";import{u as oe}from"./use-quasar.a32cc7fc.js";import{a as Q}from"./api.e96a150b.js";import{n as te}from"./navigationUtils.2c4b9dee.js";import{u as ne}from"./userStore.45e0b5eb.js";import{C as re}from"./ClubNavigationMenu.e9a58f98.js";import{_ as se}from"./MP_RGB_horizontal.ee11db59.js";import{_ as le}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.c98ef0da.js";import"./pinia.53eba05e.js";import"./QTabs.6a3d63d5.js";import"./rtl.276c3f1b.js";import"./QFooter.9d6e02eb.js";const ie={name:"ManageAccounts",components:{ClubNavigationMenu:re},setup(){const y=L(),a=O(),i=oe(),o=ne(),x=m(!0),h=m(!1),C=m(!1),r=m(""),k=m(!1),q=m({mercadopago_seller_id:null,stripe_account_id:null,has_mercadopago_seller_id:!1,has_stripe_account_id:!1,last_updated:null}),z=m({accountId:""}),N=()=>{y.back()},w=async()=>{try{x.value=!0;const s=await Q.get("/clubs/payment-accounts");q.value=s.data}catch(s){console.error("Error loading payment accounts:",s),i.notify({type:"negative",message:"Error al cargar la informaci\xF3n de cuentas de pago"})}finally{x.value=!1}},B=async()=>{var s,p;try{h.value=!0;const l=o.clubId;if(!l){i.notify({type:"negative",message:"No se pudo obtener el ID del club. Por favor, inicie sesi\xF3n nuevamente."});return}console.log("Connecting MercadoPago OAuth with club_id:",l);const c=await Q.get(`/payments/mercadopago-oauth/authorize?club_id=${l}`);if(console.log("OAuth authorize response:",c.data),c.data&&c.data.authorization_url)console.log("Redirecting to:",c.data.authorization_url),window.location.href=c.data.authorization_url;else throw new Error("No se recibi\xF3 la URL de autorizaci\xF3n")}catch(l){console.error("Error connecting MercadoPago:",l),i.notify({type:"negative",message:((p=(s=l.response)==null?void 0:s.data)==null?void 0:p.detail)||"Error al conectar con MercadoPago. Verifique su configuraci\xF3n."})}finally{h.value=!1}},R=async()=>{var s,p;try{k.value=!0;const l=o.clubId;if(!l){i.notify({type:"negative",message:"No se pudo obtener el ID del club"});return}if(!r.value){i.notify({type:"warning",message:"Por favor ingresa un Access Token v\xE1lido"});return}const c=await Q.post("/payments/mercadopago/configure-manual",{club_id:l,access_token:r.value});c.data&&c.data.success&&(i.notify({type:"positive",message:c.data.message||"Cuenta de MercadoPago configurada correctamente",caption:`ID de vendedor: ${c.data.account_id}`}),C.value=!1,r.value="",await w())}catch(l){console.error("Error saving manual token:",l),i.notify({type:"negative",message:((p=(s=l.response)==null?void 0:s.data)==null?void 0:p.detail)||"Error al configurar MercadoPago manualmente"})}finally{k.value=!1}},j=s=>s?new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",F=()=>{const s=a.query.mercadopago;s==="success"?(i.notify({type:"positive",message:"\xA1Cuenta de MercadoPago conectada exitosamente!",timeout:3e3}),y.replace({query:{}}),w()):s==="error"&&(i.notify({type:"negative",message:"Error al conectar la cuenta de MercadoPago. Por favor, intente nuevamente.",timeout:3e3}),y.replace({query:{}}))};return U(()=>{w(),F()}),{loading:x,connectingMercadoPago:h,showManualConfigDialog:C,manualAccessToken:r,savingManualToken:k,paymentAccounts:q,stripeForm:z,goBack:N,connectMercadoPago:B,saveManualToken:R,formatDate:j,goToDashboard:()=>{te(y,o)}}}},ce={class:"header-content"},de={class:"greeting"},ue={class:"header-icons"},me={key:0,class:"q-gutter-md"},ge={class:"row items-center justify-between"},pe={class:"col-auto"},fe={key:0,class:"q-mb-md"},ye={class:"text-caption q-mt-xs"},_e={key:1,class:"q-mb-md"},ve={class:"row justify-center q-mt-md q-gutter-sm"},be={class:"row items-center justify-between"},xe={class:"col-auto"},he={class:"q-gutter-md"},Ce={class:"text-caption text-grey-7"};function ke(y,a,i,o,x,h){const C=G("ClubNavigationMenu");return d(),_($,{view:"hHh lpR fFf",class:"body text-white"},{default:t(()=>[e(K,{elevated:"",class:"bg-primary text-white"},{default:t(()=>[n("div",ce,[n("div",de,[n("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:a[0]||(a[0]=(...r)=>o.goToDashboard&&o.goToDashboard(...r))}),a[5]||(a[5]=M(" Cuentas de Pago "))]),n("div",ue,[e(g,{flat:"",round:"",icon:"arrow_back",onClick:o.goBack},null,8,["onClick"])])])]),_:1}),e(ee,null,{default:t(()=>[e(Z,{class:"q-pa-md"},{default:t(()=>[e(X,{showing:o.loading},{default:t(()=>[e(W,{size:"50px",color:"primary"})]),_:1},8,["showing"]),o.loading?A("",!0):(d(),P("div",me,[e(v,{class:"info-card"},{default:t(()=>[e(u,null,{default:t(()=>a[6]||(a[6]=[n("div",{class:"text-h6 text-primary"},"Informaci\xF3n de Cuentas de Pago",-1),n("p",{class:"text-body2 q-mt-sm"}," Configure sus cuentas de pago para recibir transferencias autom\xE1ticas cuando los jugadores realicen pagos en su club. Estos datos son encriptados y almacenados de forma segura. ",-1)])),_:1})]),_:1}),e(v,{class:"payment-card"},{default:t(()=>[e(u,null,{default:t(()=>[n("div",ge,[a[7]||(a[7]=n("div",{class:"col"},[n("div",{class:"text-h6 text-primary"},"MercadoPago"),n("div",{class:"text-body2 text-grey-7"},"Conecte su cuenta de MercadoPago para recibir pagos autom\xE1ticamente")],-1)),n("div",pe,[e(V,{src:se,style:{width:"80px",height:"40px"},contain:""})])])]),_:1}),e(D),e(u,null,{default:t(()=>[o.paymentAccounts.has_mercadopago_seller_id?(d(),P("div",fe,[e(b,{class:"bg-positive text-white rounded-borders"},{avatar:t(()=>[e(f,{name:"check_circle",color:"white"})]),default:t(()=>[a[8]||(a[8]=n("div",{class:"text-weight-medium"},"Cuenta de MercadoPago Conectada",-1)),n("div",ye," ID de Vendedor: "+I(o.paymentAccounts.mercadopago_seller_id),1)]),_:1})])):(d(),P("div",_e,[e(b,{class:"bg-secondary text-white rounded-borders"},{avatar:t(()=>[e(f,{name:"warning",color:"white"})]),default:t(()=>[a[9]||(a[9]=n("div",{class:"text-weight-medium"},"Cuenta de MercadoPago No Conectada",-1)),a[10]||(a[10]=n("div",{class:"text-caption q-mt-xs"}," Conecte su cuenta para recibir pagos de reservas, clases y torneos ",-1))]),_:1})])),n("div",ve,[o.paymentAccounts.has_mercadopago_seller_id?A("",!0):(d(),_(g,{key:0,color:"primary",label:"Conectar con MercadoPago (OAuth)",icon:"link",size:"md",loading:o.connectingMercadoPago,onClick:o.connectMercadoPago,class:"col-12 col-md-5"},null,8,["loading","onClick"])),o.paymentAccounts.has_mercadopago_seller_id?(d(),_(g,{key:2,color:"secondary",label:"Reconectar MercadoPago",icon:"refresh",size:"lg",loading:o.connectingMercadoPago,onClick:o.connectMercadoPago,class:"full-width",outline:""},null,8,["loading","onClick"])):(d(),_(g,{key:1,color:"grey-8","text-color":"primary",label:"Configurar Manualmente",icon:"settings",size:"md",onClick:a[1]||(a[1]=r=>o.showManualConfigDialog=!0),class:"col-12 col-md-5",outline:""}))]),e(b,{class:"bg-grey-9 text-white rounded-borders q-mt-md"},{avatar:t(()=>[e(f,{name:"info",color:"primary"})]),default:t(()=>[a[11]||(a[11]=n("div",{class:"text-body2"}," Al conectar su cuenta, ser\xE1 redirigido a MercadoPago para autorizar el acceso de forma segura. No compartimos sus credenciales - todo se maneja mediante OAuth. ",-1))]),_:1})]),_:1})]),_:1}),e(v,{class:"payment-card"},{default:t(()=>[e(u,null,{default:t(()=>[n("div",be,[a[12]||(a[12]=n("div",{class:"col"},[n("div",{class:"text-h6 text-primary"},"Stripe"),n("div",{class:"text-body2 text-grey-7"},"Configure su cuenta de Stripe para recibir pagos (pr\xF3ximamente)")],-1)),n("div",xe,[e(V,{src:"https://stripe.com/img/v3/newsroom/social.png",style:{width:"80px",height:"40px"},contain:""})])])]),_:1}),e(D),e(u,null,{default:t(()=>[e(Y,null,{default:t(()=>[n("div",he,[e(T,{modelValue:o.stripeForm.accountId,"onUpdate:modelValue":a[2]||(a[2]=r=>o.stripeForm.accountId=r),label:"Stripe Account ID",placeholder:o.paymentAccounts.stripe_account_id||"acct_xxxxxxxxxxxxxxxxxx",outlined:"",dense:"",suffix:o.paymentAccounts.has_stripe_account_id?"(Configurado)":"",hint:o.paymentAccounts.has_stripe_account_id?`Actual: ${o.paymentAccounts.stripe_account_id}`:"ID de su cuenta de Stripe Connect",disable:!0},null,8,["modelValue","placeholder","suffix","hint"]),e(b,{class:"bg-black-3"},{avatar:t(()=>[e(f,{name:"info",color:"primary"})]),default:t(()=>[a[13]||(a[13]=M(" La integraci\xF3n con Stripe estar\xE1 disponible pr\xF3ximamente para mercados internacionales. "))]),_:1})])]),_:1})]),_:1})]),_:1}),o.paymentAccounts.last_updated?(d(),_(v,{key:0,class:"q-mt-md"},{default:t(()=>[e(u,{class:"text-center"},{default:t(()=>[n("div",Ce," \xDAltima actualizaci\xF3n: "+I(o.formatDate(o.paymentAccounts.last_updated)),1)]),_:1})]),_:1})):A("",!0)]))]),_:1})]),_:1}),e(J,{modelValue:o.showManualConfigDialog,"onUpdate:modelValue":a[4]||(a[4]=r=>o.showManualConfigDialog=r),persistent:""},{default:t(()=>[e(v,{style:{"min-width":"400px"}},{default:t(()=>[e(u,{class:"row items-center q-pb-none"},{default:t(()=>[a[14]||(a[14]=n("div",{class:"text-h6"},"Configurar MercadoPago Manualmente",-1)),e(ae),S(e(g,{icon:"close",flat:"",round:"",dense:""},null,512),[[E]])]),_:1}),e(u,null,{default:t(()=>[a[17]||(a[17]=n("p",{class:"text-body2 text-grey-7"}," Ingresa tu Access Token de MercadoPago. Puedes obtenerlo desde tu panel de desarrolladores de MercadoPago. ",-1)),e(T,{modelValue:o.manualAccessToken,"onUpdate:modelValue":a[3]||(a[3]=r=>o.manualAccessToken=r),label:"Access Token de MercadoPago",placeholder:"TEST-4287668... o APP_USR-4287668...",filled:"",dense:"",rules:[r=>!!r||"El Access Token es requerido"],class:"q-mt-md"},{prepend:t(()=>[e(f,{name:"vpn_key"})]),_:1},8,["modelValue","rules"]),e(b,{class:"bg-grey-9 text-white rounded-borders q-mt-md"},{avatar:t(()=>[e(f,{name:"warning",color:"primary"})]),default:t(()=>[a[15]||(a[15]=n("strong",null,"Importante:",-1)),a[16]||(a[16]=M(" Este token debe ser de producci\xF3n para recibir pagos reales, o de prueba para testing. "))]),_:1})]),_:1}),e(H,{align:"right"},{default:t(()=>[S(e(g,{flat:"",label:"Cancelar",color:"grey-7"},null,512),[[E]]),e(g,{label:"Guardar",color:"primary",onClick:o.saveManualToken,loading:o.savingManualToken},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(C)]),_:1})}var Ke=le(ie,[["render",ke],["__scopeId","data-v-791df460"]]);export{Ke as default};
