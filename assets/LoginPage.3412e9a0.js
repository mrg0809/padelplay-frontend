import{r as p,x as R,y as x,o as m,z as I,A as f,s as y,d as s,B as u,D as i,a as v,e as _,E as L,t as S}from"./index.44d6004f.js";import{Q as U}from"./QForm.29e7d3c5.js";import{Q}from"./QPage.069cc100.js";import{Q as V,a as W}from"./QLayout.bdadfe99.js";import{a as F}from"./api.dcb17b1f.js";import{o as A}from"./auth.2bd99c66.js";import{u as G}from"./useMeta.7eeaf521.js";import{h as n}from"./haptics.bd260566.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";import"./supabase.3e81c9a1.js";import"./googleAuth.bf725d38.js";const B={name:"LoginPage",setup(){G({title:"Iniciar Sesi\xF3n"});const k=p(""),a=p(""),r=p(null),o=p(!1),b=p(!1),w=p(!1),e=R(),T=x();return{email:k,password:a,error:r,googleLoading:o,appleLoading:b,showTraditionalLogin:w,login:async()=>{var l,d;r.value=null;try{await n.light();const t=await F.post("/auth/login",{email:k.value,password:a.value}),{access_token:h}=t.data;await y.setItem("token",h),await n.success();const P=h.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),g=JSON.parse(atob(P));T.setUserDataFromToken(h),console.log("User type from token:",g.user_type);const C=await y.getItem("redirectAfterLogin");if(C){await y.removeItem("redirectAfterLogin"),e.push(C);return}g.user_type==="superuser"?(console.log("Redirecting to superuser dashboard"),e.push("/dashboard/superuser")):g.user_type==="admin"?(console.log("Redirecting to admin dashboard"),e.push("/dashboard/admin")):g.user_type==="club"?(console.log("Redirecting to club dashboard"),e.push("/dashboard/club")):g.user_type==="padelite"?(console.log("Redirecting to padelite dashboard"),e.push("/padelite/dashboard")):g.user_type==="association"?(console.log("Redirecting to association dashboard"),e.push("/dashboard/association")):(console.log("Redirecting to player dashboard"),e.push("/dashboard/player"))}catch(t){await n.error(),t.response&&t.response.data&&t.response.data.detail?r.value=t.response.data.detail:r.value="Ocurri\xF3 un error inesperado. Intenta de nuevo m\xE1s tarde.",console.error("Error al iniciar sesi\xF3n:",((d=(l=t.response)==null?void 0:l.data)==null?void 0:d.detail)||t.message)}},signInWithGoogle:async()=>{o.value=!0,r.value=null;try{await n.light();const l=await A.signInWithGoogle();if(l&&l.access_token){const{access_token:d}=l;await y.setItem("token",d),await n.success();const h=d.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),c=JSON.parse(atob(h));T.setUserDataFromToken(d),console.log("User type from token:",c.user_type),c.user_type==="superuser"?(console.log("Redirecting to superuser dashboard"),e.push("/dashboard/superuser")):c.user_type==="admin"?(console.log("Redirecting to admin dashboard"),e.push("/dashboard/admin")):c.user_type==="club"?(console.log("Redirecting to club dashboard"),e.push("/dashboard/club")):c.user_type==="padelite"?(console.log("Redirecting to padelite dashboard"),e.push("/padelite/dashboard")):c.user_type==="association"?(console.log("Redirecting to association dashboard"),e.push("/dashboard/association")):(console.log("Redirecting to player dashboard"),e.push("/dashboard/player"))}}catch(l){await n.error(),r.value="Error al iniciar sesi\xF3n con Google",console.error("Google OAuth error:",l)}finally{o.value=!1}},signInWithApple:async()=>{b.value=!0,r.value=null;try{await n.light(),await A.signInWithApple()}catch(l){await n.error(),r.value="Apple OAuth no est\xE1 disponible a\xFAn. Pronto estar\xE1 habilitado.",console.error("Apple OAuth error:",l)}finally{b.value=!1}},goToSignup:()=>{e.push("/signup")},goToForgotPassword:()=>{e.push("/forgot-password")},goToTerms:()=>{e.push("/terms")},goToPrivacy:()=>{e.push("/privacy")}}}},N={class:"login-container"},D={class:"oauth-buttons"},E={key:0,class:"traditional-login-toggle"},q={key:1,class:"divider"},J={key:0,class:"error-message"},j={class:"login-links"},z={class:"legal-links"};function H(k,a,r,o,b,w){return m(),I(V,{view:"lHh Lpr lFf"},{default:f(()=>[s(W,null,{default:f(()=>[s(Q,{class:"login-page"},{default:f(()=>[u("div",N,[a[4]||(a[4]=u("img",{src:"/logo.jpeg",alt:"Logo",class:"login-logo"},null,-1)),u("div",D,[s(i,{onClick:o.signInWithGoogle,loading:o.googleLoading,class:"google-btn",icon:"img:/google-icon.svg",label:"Continuar con Google",color:"white","text-color":"black","no-caps":"",style:{"margin-bottom":"12px"}},null,8,["onClick","loading"]),s(i,{onClick:o.signInWithApple,loading:o.appleLoading,class:"apple-btn",icon:"img:/apple-icon.svg",label:"Continuar con Apple",color:"dark","text-color":"white","no-caps":"",style:{"margin-bottom":"20px"}},null,8,["onClick","loading"])]),o.showTraditionalLogin?_("",!0):(m(),v("div",E,[s(i,{flat:"",label:"Ingresar con email y contrase\xF1a",color:"white",class:"toggle-link",onClick:a[0]||(a[0]=e=>o.showTraditionalLogin=!0),"no-caps":""})])),o.showTraditionalLogin?(m(),v("div",q,[...a[3]||(a[3]=[u("span",{class:"divider-text"},"o",-1)])])):_("",!0),o.showTraditionalLogin?(m(),I(U,{key:2,onSubmit:o.login,class:"login-form"},{default:f(()=>[s(L,{outlined:"",dark:"",modelValue:o.email,"onUpdate:modelValue":a[1]||(a[1]=e=>o.email=e),label:"Correo electr\xF3nico",type:"email",class:"q-mb-md input-dark"},null,8,["modelValue"]),s(L,{outlined:"",dark:"",modelValue:o.password,"onUpdate:modelValue":a[2]||(a[2]=e=>o.password=e),label:"Contrase\xF1a",type:"password",class:"q-mb-md input-dark"},null,8,["modelValue"]),s(i,{label:"Iniciar sesi\xF3n",color:"white","text-color":"black",type:"submit",class:"login-btn"}),o.error?(m(),v("div",J,S(o.error),1)):_("",!0)]),_:1},8,["onSubmit"])):_("",!0),u("div",j,[s(i,{flat:"",label:"Crear una cuenta",color:"white",class:"login-link",onClick:o.goToSignup},null,8,["onClick"]),s(i,{flat:"",label:"Olvid\xE9 mi contrase\xF1a",color:"white",class:"login-link",onClick:o.goToForgotPassword},null,8,["onClick"]),u("div",z,[s(i,{flat:"",label:"T\xE9rminos y Condiciones",color:"white",class:"legal-link",onClick:o.goToTerms},null,8,["onClick"]),s(i,{flat:"",label:"Aviso de Privacidad",color:"white",class:"legal-link",onClick:o.goToPrivacy},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})}var uo=O(B,[["render",H],["__scopeId","data-v-0cf85cb5"]]);export{uo as default};
