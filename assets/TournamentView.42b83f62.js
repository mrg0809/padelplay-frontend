import{a7 as G,F as L,r as _,j as H,B as U,a8 as P,q as d,G as f,H as l,v as o,I as t,J as O,s as c,a9 as Q,aa as w,x as n,ab as m,aM as A,ad as S,ac as N,ae as g,y as h,aQ as C}from"./index.2479bd01.js";import{Q as K}from"./QHeader.ca5ea2b4.js";import{Q as W}from"./QSpinnerDots.ee538334.js";import{Q as X,a as M}from"./QTabs.fbaedc0b.js";import{Q as x}from"./QBadge.cdf11368.js";import{a as Y,Q as B}from"./QTabPanel.ac5cafba.js";import{Q as V}from"./QMarkupTable.73f24d11.js";import{Q as Z}from"./QPage.3cd5c2ef.js";import{Q as $,a as tt}from"./QLayout.70ecc874.js";import{u as et}from"./use-quasar.ba979e2b.js";import{u as at}from"./userStore.bd33baf0.js";import{n as st}from"./navigationUtils.2c4b9dee.js";import{s as z}from"./supabase.6fa9548a.js";import{a as E}from"./api.2af71db3.js";import{P as ot}from"./PlayerNavigationMenu.3d66b2a3.js";import{N as nt}from"./NotificationBell.cbcdc58f.js";import{B as rt}from"./BannerPromoScrolling.a678cba0.js";import{D as lt}from"./DesktopNavigation.8473eca1.js";import{g as it}from"./tournamentUtils.cfdf57cc.js";import{_ as dt}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.c2f480d7.js";import"./use-render-cache.770e5fe8.js";import"./selection.b5ff7682.js";import"./pinia.7518c97c.js";import"./QFooter.e6ff5f16.js";import"./admin.c99b9bfe.js";import"./QTooltip.742eb3f5.js";import"./position-engine.df844202.js";const mt={name:"TournamentView",components:{PlayerNavigationMenu:ot,NotificationBell:nt,BannerPromoScrolling:rt,DesktopNavigation:lt},setup(){const p=G(),e=L(),b=et(),s=at(),D=_(null),k=_([]),T=_([]),q=_(null),y=_(!1),I=_("my-matches"),a=_(!1),v=H(()=>s.userId?k.value.filter(r=>r.team1_players.includes(s.userId)||r.team2_players.includes(s.userId)):[]);U(async()=>{await F(),await R(),await j(),await J()});const F=async()=>{y.value=!0;try{const r=p.params.tournamentId,{data:i,error:u}=await z.from("tournaments").select("*").eq("id",r).single();if(u)throw u;D.value=i}catch(r){console.error("Error loading tournament:",r),b.notify({type:"negative",message:"Error al cargar el torneo"})}finally{y.value=!1}},R=async()=>{try{const r=p.params.tournamentId,{data:i,error:u}=await z.from("tournament_teams").select("id").eq("tournament_id",r).or(`player1_id.eq.${s.userId},player2_id.eq.${s.userId}`).single();!u&&i&&(q.value=i.id)}catch(r){console.error("Error loading my team:",r)}},j=async()=>{try{const r=p.params.tournamentId,i=await E.get(`/tournaments/${r}/matches`);k.value=i.data.matches}catch(r){console.error("Error loading matches:",r),b.notify({type:"negative",message:"Error al cargar los partidos"})}},J=async()=>{try{const r=p.params.tournamentId,i=await E.get(`/tournaments/${r}/standings`);T.value=i.data.standings,a.value=i.data.is_retas||!1}catch(r){console.error("Error loading standings:",r),b.notify({type:"negative",message:"Error al cargar las posiciones"})}};return{tournament:D,matches:k,myMatches:v,standings:T,loading:y,activeTab:I,isRetasTournament:a,getSystemName:r=>it(r),formatDate:r=>{const i=new Date(r),u={year:"numeric",month:"long",day:"numeric"};return i.toLocaleDateString("es-ES",u)},formatScore:r=>{if(!r)return"Sin resultado";try{const i=typeof r=="string"?JSON.parse(r):r;let u=[];return i.set1&&u.push(`${i.set1.team1}-${i.set1.team2}`),i.set2&&u.push(`${i.set2.team1}-${i.set2.team2}`),i.set3&&u.push(`${i.set3.team1}-${i.set3.team2}`),u.join(", ")}catch{return"Error en formato"}},isMyTeam:r=>r===q.value,goBack:()=>{e.back()},goToDashboard:()=>{st(e,s)}}}},ct={class:"header-content"},ut={class:"greeting"},_t={class:"header-icons"},gt={key:0,class:"text-center q-mt-md"},ft={key:1},pt={class:"q-mt-none"},yt={class:"row q-gutter-md"},vt={class:"col"},ht={class:"col"},xt={class:"matches-list"},bt={class:"match-header"},kt={class:"q-my-none"},Tt={class:"text-caption q-mb-none"},qt={class:"text-caption q-mb-none"},Pt={key:0,class:"q-mt-md result-section"},Qt={key:1,class:"q-mt-md"},wt={key:0,class:"text-center q-pa-xl"},St={class:"matches-list"},Nt={class:"match-header"},Dt={class:"q-my-none"},It={class:"text-caption q-mb-none"},Mt={class:"text-caption q-mb-none"},Bt={key:0,class:"q-mt-md result-section"},Ct={key:1,class:"q-mt-md"},Vt={key:0,class:"text-center q-pa-xl"},zt={class:"text-left"},Et={class:"text-left"},Ft={class:"text-center"},Rt={class:"text-center"},jt={class:"text-center"},Jt={class:"text-center"},Gt={class:"text-left"},Lt={class:"text-left"},Ht={class:"text-center"},Ut={class:"text-center"},Ot={class:"text-center"},At={class:"text-center"},Kt={key:2,class:"text-center q-pa-xl"};function Wt(p,e,b,s,D,k){const T=P("NotificationBell"),q=P("BannerPromoScrolling"),y=P("DesktopNavigation"),I=P("PlayerNavigationMenu");return d(),f($,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:l(()=>[o(K,{elevated:"",class:"text-white"},{default:l(()=>[t("div",ct,[t("div",ut,[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...a)=>s.goToDashboard&&s.goToDashboard(...a))})]),t("div",_t,[o(T),o(O,{flat:"",round:"",icon:"arrow_back",onClick:s.goBack},null,8,["onClick"])])]),o(q)]),_:1}),o(y),o(tt,null,{default:l(()=>[o(Z,{class:"q-pa-md"},{default:l(()=>[s.loading?(d(),c("div",gt,[o(W,{color:"primary",size:"xl"}),e[3]||(e[3]=t("p",null,"Cargando informaci\xF3n del torneo...",-1))])):s.tournament?(d(),c("div",ft,[o(Q,{class:"q-mb-md transparent-card"},{default:l(()=>[o(w,null,{default:l(()=>[t("h4",pt,n(s.tournament.name),1),t("div",yt,[t("div",vt,[t("p",null,[e[4]||(e[4]=t("strong",null,"Sistema:",-1)),m(" "+n(s.getSystemName(s.tournament.system)),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"Categor\xEDa:",-1)),m(" "+n(s.tournament.category),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"G\xE9nero:",-1)),m(" "+n(s.tournament.gender),1)])]),t("div",ht,[t("p",null,[e[7]||(e[7]=t("strong",null,"Fecha Inicio:",-1)),m(" "+n(s.tournament.start_date),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Fecha Fin:",-1)),m(" "+n(s.tournament.end_date),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Premio:",-1)),m(" "+n(s.tournament.prize),1)])])])]),_:1})]),_:1}),o(X,{modelValue:s.activeTab,"onUpdate:modelValue":e[1]||(e[1]=a=>s.activeTab=a),dense:"",class:"text-white","active-color":"primary","indicator-color":"primary",align:"justify"},{default:l(()=>[o(M,{name:"my-matches",label:"Mis Partidos",icon:"calendar_today"}),o(M,{name:"all-matches",label:"Todos los Partidos",icon:"sports_tennis"}),o(M,{name:"standings",label:"Posiciones",icon:"emoji_events"})]),_:1},8,["modelValue"]),o(A),o(Y,{modelValue:s.activeTab,"onUpdate:modelValue":e[2]||(e[2]=a=>s.activeTab=a),animated:"",class:"transparent-bg"},{default:l(()=>[o(B,{name:"my-matches"},{default:l(()=>[t("div",xt,[(d(!0),c(S,null,N(s.myMatches,a=>(d(),f(Q,{key:a.id,class:"q-mb-md transparent-card"},{default:l(()=>[o(w,null,{default:l(()=>[t("div",bt,[t("h6",kt,n(a.team1)+" vs "+n(a.team2),1),t("p",Tt,[o(g,{name:"event",size:"xs"}),m(" "+n(s.formatDate(a.match_date))+" - "+n(a.match_time.substring(0,5)),1)]),t("p",qt,[o(g,{name:"place",size:"xs"}),m(" Cancha: "+n(a.court_name),1)])]),a.has_result?(d(),c("div",Pt,[o(x,{color:"green",class:"q-mb-sm"},{default:l(()=>e[10]||(e[10]=[m("Finalizado")])),_:1}),t("p",null,[e[11]||(e[11]=t("strong",null,"Resultado:",-1)),m(" "+n(s.formatScore(a.score)),1)])])):(d(),c("div",Qt,[o(x,{color:"orange"},{default:l(()=>e[12]||(e[12]=[m("Pendiente")])),_:1})]))]),_:2},1024)]),_:2},1024))),128)),s.myMatches.length===0?(d(),c("div",wt,[o(g,{name:"info",size:"3em",color:"grey"}),e[13]||(e[13]=t("p",null,"No tienes partidos programados",-1))])):h("",!0)])]),_:1}),o(B,{name:"all-matches"},{default:l(()=>[t("div",St,[(d(!0),c(S,null,N(s.matches,a=>(d(),f(Q,{key:a.id,class:"q-mb-md transparent-card"},{default:l(()=>[o(w,null,{default:l(()=>[t("div",Nt,[t("h6",Dt,n(a.team1)+" vs "+n(a.team2),1),t("p",It,[o(g,{name:"event",size:"xs"}),m(" "+n(s.formatDate(a.match_date))+" - "+n(a.match_time.substring(0,5)),1)]),t("p",Mt,[o(g,{name:"place",size:"xs"}),m(" Cancha: "+n(a.court_name),1)])]),a.has_result?(d(),c("div",Bt,[o(x,{color:"green",class:"q-mb-sm"},{default:l(()=>e[14]||(e[14]=[m("Finalizado")])),_:1}),t("p",null,[e[15]||(e[15]=t("strong",null,"Resultado:",-1)),m(" "+n(s.formatScore(a.score)),1)])])):(d(),c("div",Ct,[o(x,{color:"orange"},{default:l(()=>e[16]||(e[16]=[m("Pendiente")])),_:1})]))]),_:2},1024)]),_:2},1024))),128)),s.matches.length===0?(d(),c("div",Vt,[o(g,{name:"info",size:"3em",color:"grey"}),e[17]||(e[17]=t("p",null,"No hay partidos programados",-1))])):h("",!0)])]),_:1}),o(B,{name:"standings"},{default:l(()=>[o(Q,{class:"transparent-card"},{default:l(()=>[o(w,null,{default:l(()=>[e[22]||(e[22]=t("h6",{class:"q-mt-none"},"Tabla de Posiciones",-1)),s.isRetasTournament?(d(),f(V,{key:0,flat:"",bordered:"",class:"standings-table"},{default:l(()=>[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Jugador"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"% Victorias")])],-1)),t("tbody",null,[(d(!0),c(S,null,N(s.standings,(a,v)=>(d(),c("tr",{key:a.team_id,class:C({"my-team":s.isMyTeam(a.team_id)})},[t("td",zt,n(v+1),1),t("td",Et,n(a.team_name),1),t("td",Ft,n(a.matches_played),1),t("td",Rt,n(a.wins),1),t("td",jt,n(a.losses),1),t("td",Jt,[t("strong",null,n(a.win_percentage)+"%",1)])],2))),128))])]),_:1})):(d(),f(V,{key:1,flat:"",bordered:"",class:"standings-table"},{default:l(()=>[e[20]||(e[20]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Equipo"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"Total Pts")])],-1)),t("tbody",null,[(d(!0),c(S,null,N(s.standings,(a,v)=>(d(),c("tr",{key:a.team_id,class:C({"my-team":s.isMyTeam(a.team_id)})},[t("td",Gt,n(v+1),1),t("td",Lt,[m(n(a.team_name)+" ",1),s.isMyTeam(a.team_id)?(d(),f(x,{key:0,color:"primary",class:"q-ml-sm"},{default:l(()=>e[19]||(e[19]=[m(" Mi equipo ")])),_:1})):h("",!0)]),t("td",Ht,n(a.matches_played),1),t("td",Ut,n(a.wins),1),t("td",Ot,n(a.losses),1),t("td",At,[t("strong",null,n(a.total_points),1)])],2))),128))])]),_:1})),s.standings.length===0?(d(),c("div",Kt,[o(g,{name:"info",size:"3em",color:"grey"}),e[21]||(e[21]=t("p",null,"No hay resultados registrados a\xFAn",-1))])):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):h("",!0)]),_:1})]),_:1}),o(I)]),_:1})}var Ie=dt(mt,[["render",Wt],["__scopeId","data-v-696dde46"]]);export{Ie as default};
