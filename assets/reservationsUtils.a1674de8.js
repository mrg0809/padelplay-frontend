import{e as D}from"./hourUtils.24f4f451.js";function R(a,r){return a&&{60:a.price_per_hour||0,90:a.price_per_hour_and_half||0,120:a.price_per_two_hour||0}[r]||0}async function x(a,r,i,s){var m,u,_,f,y;console.log("Finalizando reserva de cancha post-pago exitoso (Util)..."),console.log(r);const{baseData:n,extraData:e,selectedProducts:b,paymentOrderId:l,totalAmount:w,amountToPay:I,itemDetails:O}=r;if(console.log(n),!n||!e||!l)return console.error("Faltan datos base/extra/paymentOrder para finalizar reserva (Util)",r),s&&s.notify({type:"negative",message:"Error interno al finalizar la reserva (datos faltantes Util)."}),{success:!1};try{const t={payment_order_id:l,payment_method:a.payment_method,payment_status:a.status,transaction_id:a.id,is_full_payment:e.paymentOption==="total"},o=await i.post("/payments/process-stripe-payment",t);if(console.log(o),!o.data.success)throw new Error(o.data.message||"Error al actualizar el estado del pago.");console.log("2",o);const E=(b||[]).map(p=>({name:p.product.name,price:p.product.price,quantity:p.quantity})),h=e.date,c=e.time,P=e.duration;if(!h||!c)throw new Error("Falta la fecha o la hora de inicio en los datos extra/base.");const U=D(c,P),z=e.paymentOption==="total",g={club_id:n.clubId,court_id:n.id,reservation_date:h,start_time:c,end_time:U,total_price:w,pay_total:z,club_commission:0,player_commission:0,additional_items:E,payment_order_id:l,is_public_match:e.isPublicMatch||!1};console.log("Payload final para POST /reservations (Util):",g);const v=await i.post("/reservations",g),d=(m=v.data)==null?void 0:m.match_id;if(!d)throw console.warn("API /reservations no devolvi\xF3 un match_id (Util):",v.data),new Error("No se pudo confirmar la creaci\xF3n del partido asociado.");return console.log("Reserva de cancha confirmada en backend (Util). Match ID:",d),{success:!0,matchId:d}}catch(t){console.error("Error en finalizeCourtReservationUtil API call:",t);const o=((_=(u=t.response)==null?void 0:u.data)==null?void 0:_.detail)||((y=(f=t.response)==null?void 0:f.data)==null?void 0:y.message)||t.message||"Error al confirmar la reserva en nuestro sistema.";return s&&s.notify({type:"negative",message:`El pago se realiz\xF3, pero hubo un problema al guardar tu reserva: ${o}`}),{success:!1}}}export{x as f,R as g};
