import{F as O,r as h,j as x,y as U,k as c,G as $,H as l,p as s,I as e,bI as q,ad as v,J as I,K as N,l as d,ab as p,ac as g,ag as b,q as r,af as P,ae as T,s as A}from"./index.63dc7e23.js";import{Q as G}from"./QHeader.fafcae42.js";import{Q as R}from"./QSpinnerPuff.c821ac7e.js";import{Q}from"./QChip.5e2441ba.js";import{Q as j}from"./QPage.2aaa1d93.js";import{Q as Y,a as z}from"./QLayout.554612a4.js";import{u as H}from"./use-quasar.a32cc7fc.js";import{u as J}from"./userStore.45e0b5eb.js";import{u as K}from"./useDashboardNavigation.0080d3f5.js";import{C as W}from"./ClubNavigationMenu.e9a58f98.js";import{a as X,d as Z,g as tt}from"./paymentsDebug.7b310cbf.js";import{_ as et}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.53eba05e.js";import"./QTabs.6a3d63d5.js";import"./rtl.276c3f1b.js";import"./QFooter.9d6e02eb.js";import"./supabase.87115abf.js";const ot={class:"header-content"},st={class:"greeting"},at={class:"header-icons"},lt={class:"row q-gutter-md q-mb-lg"},nt={class:"col-12 col-md-3"},rt={class:"col-12 col-md-3"},it={class:"col-12 col-md-3 flex items-end"},ct={key:0,class:"text-center q-my-lg"},dt={key:1,class:"row q-gutter-md q-mb-lg"},ut={class:"col-12 col-md-6 col-lg-3"},mt={class:"text-h6"},vt={class:"text-h4 q-mt-sm"},_t={class:"col-12 col-md-6 col-lg-3"},pt={class:"text-h6"},gt={class:"text-h4 q-mt-sm"},bt={class:"text-caption"},ft={class:"col-12 col-md-6 col-lg-3"},yt={class:"text-h6"},ht={class:"text-h4 q-mt-sm"},xt={class:"col-12 col-md-6 col-lg-3"},wt={class:"text-h6"},kt={class:"text-h4 q-mt-sm"},Ct={key:2,class:"row q-gutter-md"},qt={class:"col-12 col-md-6"},It={class:"col-6"},Nt={class:"col-3 text-right"},Pt={class:"col-3 text-right text-caption"},Tt={class:"col-12 col-md-6"},At={class:"col-6"},Qt={class:"col-3 text-right"},St={class:"col-3 text-right text-caption"},Ft={key:3,class:"text-center q-my-lg"},Dt={__name:"ClubPayments",setup(Et){const S=O(),{goToDashboard:w}=K(),k=H(),u=J(),_=h(!1),f=h(""),y=h(""),m=h([]),i=x(()=>{if(m.value.length===0)return{totalAmount:0,totalCommission:0,netAmount:0,transactionCount:0};const o=m.value.reduce((a,n)=>a+Number(n.total_amount||0),0),t=m.value.reduce((a,n)=>a+Number(n.club_commission||0)+Number(n.player_commission||0),0);return{totalAmount:o,totalCommission:t,netAmount:o-t,transactionCount:m.value.length}}),F=x(()=>i.value.totalAmount>0?i.value.totalCommission/i.value.totalAmount*100:0),D=x(()=>{const o={};return m.value.forEach(t=>{const a=t.event_type||"unknown";o[a]||(o[a]={amount:0,count:0}),o[a].amount+=Number(t.total_amount||0),o[a].count+=1}),o}),E=x(()=>{const o={};return m.value.forEach(t=>{const a=t.payment_method||"unknown";o[a]||(o[a]={amount:0,count:0}),o[a].amount+=Number(t.total_amount||0),o[a].count+=1}),o}),B=()=>{S.back()},M=o=>({reservation:"Reservas",lesson:"Lecciones",tournament:"Torneos",product:"Productos",unknown:"Otros"})[o]||o,V=o=>({reservation:"blue",lesson:"green",tournament:"orange",product:"purple",unknown:"grey"})[o]||"grey",L=o=>({credit_card:"Tarjeta de Cr\xE9dito",debit_card:"Tarjeta de D\xE9bito",cash:"Efectivo",bank_transfer:"Transferencia",mercadopago:"MercadoPago",stripe:"Stripe",unknown:"Otros"})[o]||o,C=async()=>{if(console.log("DEBUG: userStore data:",{userId:u.userId,clubId:u.clubId,userType:u.userType,email:u.email}),!u.clubId){k.notify({type:"negative",message:"No se encontr\xF3 informaci\xF3n del club"});return}_.value=!0;try{console.log("=== RUNNING PAYMENT DEBUG ANALYSIS ==="),await X(),await Z(u.clubId),console.log("=== DEBUG ANALYSIS COMPLETE ===");const o=await tt(u.clubId,f.value||null,y.value||null,null);m.value=o}catch(o){console.error("Error fetching payment summary:",o),k.notify({type:"negative",message:"Error al cargar el balance de pagos"})}finally{_.value=!1}};return U(()=>{const o=new Date,t=new Date(o.getFullYear(),o.getMonth(),1);f.value=t.toISOString().split("T")[0],y.value=o.toISOString().split("T")[0],C()}),(o,t)=>(c(),$(Y,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[s(G,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[e("div",ot,[e("div",st,[e("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...a)=>q(w)&&q(w)(...a))}),t[3]||(t[3]=v(" Balance de Pagos "))]),e("div",at,[s(I,{flat:"",round:"",icon:"arrow_back",onClick:B})])])]),_:1}),s(z,null,{default:l(()=>[s(j,{class:"q-pa-md"},{default:l(()=>[e("div",lt,[e("div",nt,[s(N,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),type:"date",label:"Fecha Inicio",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),e("div",rt,[s(N,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=a=>y.value=a),type:"date",label:"Fecha Fin",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),e("div",it,[s(I,{onClick:C,color:"primary",label:"Actualizar",loading:_.value,dense:""},null,8,["loading"])])]),_.value?(c(),d("div",ct,[s(R,{color:"primary",size:"3em"}),t[4]||(t[4]=e("p",{class:"q-mt-md"},"Cargando balance...",-1))])):(c(),d("div",dt,[e("div",ut,[s(p,{class:"bg-blue-7 text-white"},{default:l(()=>[s(g,null,{default:l(()=>[e("div",mt,[s(b,{name:"payments",class:"q-mr-sm"}),t[5]||(t[5]=v(" Total Facturado "))]),e("div",vt,"$"+r(i.value.totalAmount.toFixed(2)),1),t[6]||(t[6]=e("div",{class:"text-caption"},"Ingresos brutos del per\xEDodo",-1))]),_:1})]),_:1})]),e("div",_t,[s(p,{class:"bg-orange-7 text-white"},{default:l(()=>[s(g,null,{default:l(()=>[e("div",pt,[s(b,{name:"account_balance",class:"q-mr-sm"}),t[7]||(t[7]=v(" Comisi\xF3n Interbancaria "))]),e("div",gt,"$"+r(i.value.totalCommission.toFixed(2)),1),e("div",bt,r(F.value.toFixed(1))+"% del total",1)]),_:1})]),_:1})]),e("div",ft,[s(p,{class:"bg-green-7 text-white"},{default:l(()=>[s(g,null,{default:l(()=>[e("div",yt,[s(b,{name:"account_balance_wallet",class:"q-mr-sm"}),t[8]||(t[8]=v(" Total Recibido "))]),e("div",ht,"$"+r(i.value.netAmount.toFixed(2)),1),t[9]||(t[9]=e("div",{class:"text-caption"},"Ingresos netos recibidos",-1))]),_:1})]),_:1})]),e("div",xt,[s(p,{class:"bg-purple-7 text-white"},{default:l(()=>[s(g,null,{default:l(()=>[e("div",wt,[s(b,{name:"receipt_long",class:"q-mr-sm"}),t[10]||(t[10]=v(" Total Transacciones "))]),e("div",kt,r(i.value.transactionCount),1),t[11]||(t[11]=e("div",{class:"text-caption"},"Pagos procesados",-1))]),_:1})]),_:1})])])),!_.value&&i.value.totalAmount>0?(c(),d("div",Ct,[e("div",qt,[s(p,{class:"bg-dark text-white"},{default:l(()=>[s(g,null,{default:l(()=>[t[12]||(t[12]=e("div",{class:"text-h6 q-mb-md"},"Desglose por Tipo de Servicio",-1)),(c(!0),d(P,null,T(D.value,(a,n)=>(c(),d("div",{key:n,class:"row q-my-sm"},[e("div",It,[s(Q,{color:V(n),"text-color":"white",dense:""},{default:l(()=>[v(r(M(n)),1)]),_:2},1032,["color"])]),e("div",Nt,"$"+r(a.amount.toFixed(2)),1),e("div",Pt,r(a.count)+" transacciones",1)]))),128))]),_:1})]),_:1})]),e("div",Tt,[s(p,{class:"bg-dark text-white"},{default:l(()=>[s(g,null,{default:l(()=>[t[13]||(t[13]=e("div",{class:"text-h6 q-mb-md"},"M\xE9todos de Pago",-1)),(c(!0),d(P,null,T(E.value,(a,n)=>(c(),d("div",{key:n,class:"row q-my-sm"},[e("div",At,[s(Q,{color:"grey-7","text-color":"white",dense:""},{default:l(()=>[v(r(L(n)),1)]),_:2},1024)]),e("div",Qt,"$"+r(a.amount.toFixed(2)),1),e("div",St,r(a.count)+" pagos",1)]))),128))]),_:1})]),_:1})])])):A("",!0),!_.value&&i.value.totalAmount===0?(c(),d("div",Ft,[s(b,{name:"account_balance_wallet",size:"4em",color:"grey"}),t[14]||(t[14]=e("p",{class:"text-h6 q-mt-md"},"No hay pagos en este per\xEDodo",-1)),t[15]||(t[15]=e("p",{class:"text-grey"},"Ajusta las fechas para ver m\xE1s resultados",-1))])):A("",!0)]),_:1})]),_:1}),s(W)]),_:1}))}};var Zt=et(Dt,[["__scopeId","data-v-63181e36"]]);export{Zt as default};
