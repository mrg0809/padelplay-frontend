import{a9 as me,F as pe,r as n,j as ge,B as ve,q as r,G as p,H as o,v as t,I as l,ad as f,J as v,s as d,Q as L,ab as k,ac as _,x as u,ag as M,af as V,ae as $,aj as Y,K as Z,y as T,ah as ee,ai as U,bE as E,aS as fe}from"./index.9df047e9.js";import{Q as _e}from"./QHeader.59f6ab7c.js";import{Q as F,a as q}from"./QItem.c028cd76.js";import{Q as z}from"./QItemLabel.4373daf4.js";import{Q as N}from"./QList.07f095c7.js";import{Q as ye}from"./QSpace.69b9d60d.js";import{Q as be}from"./QSelect.52e691f8.js";import{Q as he}from"./QPage.3f03e3b3.js";import{Q as xe,a as ke}from"./QLayout.7b0d0242.js";import{C as R}from"./ClosePopup.c545d544.js";import{u as qe}from"./use-quasar.d3983b74.js";import{a as y}from"./api.2af71db3.js";import{_ as we}from"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.201c3a2b.js";import"./QMenu.faf47994.js";import"./position-engine.e234bce9.js";import"./selection.b2d879b3.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const Ce={class:"header-content"},Qe={class:"header-icons"},Ee={key:0,class:"text-center q-pa-xl"},Ge={key:1},Ve={class:"text-h5"},$e={class:"text-caption"},Te={class:"row items-center justify-between q-mb-md"},ze={class:"q-gutter-sm"},Pe={key:0,class:"text-center"},Se={key:1,class:"text-center text-grey q-pa-lg"},Ae={key:2},Be={class:"text-subtitle1 text-bold"},Ie=["src"],je={key:2,class:"q-pa-md bg-positive text-white rounded-borders"},De={class:"text-body2"},Le={class:"row items-center q-gutter-md"},Me={class:"col-5"},Ue={class:"row items-center"},Fe=["src"],Ne={class:"q-ml-md"},Re={class:"col-5"},He={key:2,class:"text-center q-pa-xl"},Oe={__name:"ManagePadeliteTournament",setup(Je){const ae=me(),H=pe(),i=qe(),b=ae.params.tournamentId,P=n(!1),S=n(!1),A=n(!1),B=n(!1),I=n(!1),G=n(!1),j=n(!1),D=n(!1),w=n(null),C=n([]),h=n({name:""}),x=n(""),Q=n([]),g=n(null),te=["Grupo A","Grupo B","Grupo C","Grupo D","Grupo E","Grupo F"],O=ge(()=>{const s={};return C.value.forEach(a=>{const e=a.group_name||"Sin Grupo";s[e]||(s[e]=[]),s[e].push(a)}),s});ve(async()=>{await oe(),await J()});const oe=async()=>{P.value=!0;try{const{data:s}=await y.get(`/padelite/tournaments/${b}`);w.value=s.data||s}catch(s){console.error("Error fetching tournament:",s),i.notify({type:"negative",message:"Error al cargar torneo"})}finally{P.value=!1}},J=async()=>{S.value=!0;try{const{data:s}=await y.get(`/padelite/tournaments/${b}/teams`);C.value=s.data||[]}catch(s){console.error("Error fetching teams:",s)}finally{S.value=!1}},se=async()=>{if(!x.value||x.value.length<2){Q.value=[];return}D.value=!0;try{const{data:s}=await y.get(`/padelite/search/players?query=${x.value}`);Q.value=s.data||[]}catch(s){console.error("Error searching captains:",s),i.notify({type:"negative",message:"Error al buscar jugadores"})}finally{D.value=!1}},le=s=>{g.value=s},re=async()=>{var s,a;if(!h.value.name||!g.value){i.notify({type:"warning",message:"Por favor completa todos los campos"});return}j.value=!0;try{await y.post(`/padelite/association/tournaments/${b}/assign-captain`,null,{params:{team_name:h.value.name,captain_id:g.value.id}}),i.notify({type:"positive",message:"Equipo creado exitosamente"}),h.value={name:""},x.value="",Q.value=[],g.value=null,G.value=!1,await J()}catch(e){console.error("Error creating team:",e),i.notify({type:"negative",message:((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.detail)||"Error al crear equipo"})}finally{j.value=!1}},ne=async s=>{var a,e;try{await y.post(`/padelite/association/tournaments/${b}/assign-group`,{team_id:s.id,group_name:s.group_name}),i.notify({type:"positive",message:`${s.name} asignado a ${s.group_name}`})}catch(c){console.error("Error assigning group:",c),i.notify({type:"negative",message:((e=(a=c.response)==null?void 0:a.data)==null?void 0:e.detail)||"Error al asignar grupo"})}},ie=async()=>{var s,a;A.value=!0;try{const{data:e}=await y.post(`/padelite/association/tournaments/${b}/generate-matches`);i.notify({type:"positive",message:e.message||"Partidos generados exitosamente"}),i.dialog({title:"Partidos Generados",message:`Se generaron ${e.data.total_matches} partidos organizados en ${e.data.structure.num_jornadas} jornadas.`,dark:!0})}catch(e){console.error("Error generating matches:",e),i.notify({type:"negative",message:((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.detail)||"Error al generar partidos"})}finally{A.value=!1}},de=async()=>{var s,a;B.value=!0;try{const{data:e}=await y.post(`/padelite/association/tournaments/${b}/generate-elimination`);i.notify({type:"positive",message:e.message||"Cuadro de eliminaci\xF3n generado"}),i.dialog({title:"Cuadro Final",message:`${e.data.qualified_teams} equipos clasificados para la fase final.`,dark:!0})}catch(e){console.error("Error generating elimination:",e),i.notify({type:"negative",message:((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.detail)||"Error al generar cuadro final"})}finally{B.value=!1}},K=s=>s?new Date(s).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric"}):"",ue=()=>{H.back()},ce=()=>{H.push("/association/dashboard")};return(s,a)=>(r(),p(xe,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:o(()=>[t(_e,{elevated:"",class:"bg-primary text-white"},{default:o(()=>[l("div",Ce,[l("div",{class:"greeting"},[l("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:ce}),a[6]||(a[6]=f(" Gestionar Torneo "))]),l("div",Qe,[t(v,{flat:"",round:"",icon:"arrow_back",onClick:ue})])])]),_:1}),t(ke,null,{default:o(()=>[t(he,{class:"q-pa-md"},{default:o(()=>[P.value?(r(),d("div",Ee,[t(L,{color:"primary",size:"50px"})])):w.value?(r(),d("div",Ge,[t(k,{flat:"",bordered:"",class:"q-mb-md bg-transparent text-white"},{default:o(()=>[t(_,null,{default:o(()=>[l("div",Ve,u(w.value.name),1),l("div",$e,u(K(w.value.start_date))+" - "+u(K(w.value.end_date)),1)]),_:1})]),_:1}),t(k,{flat:"",bordered:"",class:"q-mb-md bg-transparent text-white"},{default:o(()=>[t(_,null,{default:o(()=>[l("div",Te,[a[7]||(a[7]=l("div",{class:"text-h6"},"Equipos y Grupos",-1)),l("div",ze,[t(v,{flat:"",color:"primary",icon:"group_add",label:"Crear Equipo",onClick:a[0]||(a[0]=e=>G.value=!0)}),t(v,{flat:"",color:"primary",icon:"edit",label:"Asignar Grupos",onClick:a[1]||(a[1]=e=>I.value=!0),disable:C.value.length===0},null,8,["disable"])])]),S.value?(r(),d("div",Pe,[t(L,{color:"primary",size:"30px"})])):C.value.length===0?(r(),d("div",Se,[t(M,{name:"group_add",size:"48px",class:"q-mb-md"}),a[8]||(a[8]=l("div",{class:"text-subtitle1"},"No hay equipos creados",-1)),a[9]||(a[9]=l("div",{class:"text-caption"},"Crea equipos para comenzar el torneo",-1))])):(r(),d("div",Ae,[(r(!0),d(V,null,$(O.value,(e,c)=>(r(),d("div",{key:c,class:"q-mb-md"},[l("div",Be,u(c),1),t(N,{separator:""},{default:o(()=>[(r(!0),d(V,null,$(e,m=>(r(),p(F,{key:m.id},{default:o(()=>[t(q,{avatar:""},{default:o(()=>[m.logo_url?(r(),p(E,{key:0},{default:o(()=>[l("img",{src:m.logo_url},null,8,Ie)]),_:2},1024)):(r(),p(E,{key:1,color:"primary","text-color":"white"},{default:o(()=>[f(u(m.name.charAt(0)),1)]),_:2},1024))]),_:2},1024),t(q,null,{default:o(()=>[t(z,null,{default:o(()=>[f(u(m.name),1)]),_:2},1024),m.captain_name?(r(),p(z,{key:0,caption:""},{default:o(()=>[f(" Capit\xE1n: "+u(m.captain_name),1)]),_:2},1024)):T("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]))),128))]))]),_:1})]),_:1}),t(k,{flat:"",bordered:"",class:"q-mb-md bg-transparent text-white"},{default:o(()=>[t(_,null,{default:o(()=>[a[10]||(a[10]=l("div",{class:"text-h6 q-mb-md"},"Generaci\xF3n de Partidos",-1)),a[11]||(a[11]=l("p",{class:"text-caption q-mb-md"}," Los partidos se generar\xE1n autom\xE1ticamente basados en los grupos asignados y las categor\xEDas configuradas. ",-1)),t(v,{color:"primary",icon:"sports",label:"Generar Partidos de Grupos",onClick:ie,loading:A.value,disable:Object.keys(O.value).length===0},null,8,["loading","disable"])]),_:1})]),_:1}),t(k,{flat:"",bordered:"",class:"q-mb-md bg-transparent text-white"},{default:o(()=>[t(_,null,{default:o(()=>[a[12]||(a[12]=l("div",{class:"text-h6 q-mb-md"},"Cuadro de Eliminaci\xF3n",-1)),a[13]||(a[13]=l("p",{class:"text-caption q-mb-md"}," Una vez completada la fase de grupos, puedes generar el cuadro de eliminaci\xF3n. ",-1)),t(v,{color:"primary",icon:"emoji_events",label:"Generar Cuadro Final",onClick:de,loading:B.value},null,8,["loading"])]),_:1})]),_:1}),t(Y,{modelValue:G.value,"onUpdate:modelValue":a[4]||(a[4]=e=>G.value=e)},{default:o(()=>[t(k,{style:{"min-width":"500px"},class:"bg-dark text-white"},{default:o(()=>[t(_,null,{default:o(()=>a[14]||(a[14]=[l("div",{class:"text-h6"},"Crear Nuevo Equipo",-1)])),_:1}),t(_,{class:"q-gutter-md"},{default:o(()=>[t(Z,{modelValue:h.value.name,"onUpdate:modelValue":a[2]||(a[2]=e=>h.value.name=e),label:"Nombre del Equipo",outlined:"",dense:"",dark:"",rules:[e=>!!e||"El nombre es requerido"]},null,8,["modelValue","rules"]),t(Z,{modelValue:x.value,"onUpdate:modelValue":[a[3]||(a[3]=e=>x.value=e),se],label:"Buscar Capit\xE1n (nombre o email)",outlined:"",dense:"",dark:"",debounce:"500"},{append:o(()=>[t(M,{name:"search"})]),_:1},8,["modelValue"]),D.value?(r(),p(N,{key:0,class:"q-mt-md"},{default:o(()=>[t(F,null,{default:o(()=>[t(q,null,{default:o(()=>[t(L,{color:"primary",size:"20px"})]),_:1})]),_:1})]),_:1})):Q.value.length>0?(r(),p(N,{key:1,bordered:"",separator:"",class:"q-mt-md rounded-borders"},{default:o(()=>[(r(!0),d(V,null,$(Q.value,e=>{var c;return r(),p(F,{key:e.id,clickable:"",onClick:m=>le(e),class:fe({"bg-primary":((c=g.value)==null?void 0:c.id)===e.id})},{default:o(()=>{var m;return[t(q,{avatar:""},{default:o(()=>[t(E,{color:"primary","text-color":"white"},{default:o(()=>{var X,W;return[f(u(((X=e.name)==null?void 0:X.charAt(0))||((W=e.email)==null?void 0:W.charAt(0))),1)]}),_:2},1024)]),_:2},1024),t(q,null,{default:o(()=>[t(z,null,{default:o(()=>[f(u(e.name||e.email),1)]),_:2},1024),t(z,{caption:""},{default:o(()=>[f(u(e.email),1)]),_:2},1024)]),_:2},1024),((m=g.value)==null?void 0:m.id)===e.id?(r(),p(q,{key:0,side:""},{default:o(()=>[t(M,{name:"check_circle",color:"white"})]),_:1})):T("",!0)]}),_:2},1032,["onClick","class"])}),128))]),_:1})):T("",!0),g.value?(r(),d("div",je,[a[15]||(a[15]=l("div",{class:"text-subtitle2"},"Capit\xE1n Seleccionado:",-1)),l("div",De,u(g.value.name||g.value.email),1)])):T("",!0)]),_:1}),t(ee,{align:"right"},{default:o(()=>[U(t(v,{flat:"",label:"Cancelar",color:"grey"},null,512),[[R]]),t(v,{flat:"",label:"Crear Equipo",color:"primary",onClick:re,loading:j.value,disable:!h.value.name||!g.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Y,{modelValue:I.value,"onUpdate:modelValue":a[5]||(a[5]=e=>I.value=e),maximized:""},{default:o(()=>[t(k,{class:"bg-dark text-white"},{default:o(()=>[t(_,{class:"row items-center q-pb-none"},{default:o(()=>[a[16]||(a[16]=l("div",{class:"text-h6"},"Asignar Equipos a Grupos",-1)),t(ye),U(t(v,{icon:"close",flat:"",round:"",dense:""},null,512),[[R]])]),_:1}),t(_,null,{default:o(()=>[(r(!0),d(V,null,$(C.value,e=>(r(),d("div",{key:e.id,class:"q-mb-md"},[l("div",Le,[l("div",Me,[l("div",Ue,[e.logo_url?(r(),p(E,{key:0,size:"40px"},{default:o(()=>[l("img",{src:e.logo_url},null,8,Fe)]),_:2},1024)):(r(),p(E,{key:1,size:"40px",color:"primary","text-color":"white"},{default:o(()=>[f(u(e.name.charAt(0)),1)]),_:2},1024)),l("span",Ne,u(e.name),1)])]),l("div",Re,[t(be,{modelValue:e.group_name,"onUpdate:modelValue":[c=>e.group_name=c,c=>ne(e)],options:te,label:"Grupo",outlined:"",dense:"",dark:""},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1}),t(ee,{align:"right"},{default:o(()=>[U(t(v,{flat:"",label:"Cerrar",color:"grey"},null,512),[[R]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(r(),d("div",He,a[17]||(a[17]=[l("div",{class:"text-h6"},"Torneo no encontrado",-1)])))]),_:1})]),_:1})]),_:1}))}};var ga=we(Oe,[["__scopeId","data-v-1d594d11"]]);export{ga as default};
