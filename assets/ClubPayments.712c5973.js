import{F as V,r as h,j as x,B as L,q as d,G as O,H as l,v as s,I as e,ab as v,J as C,K as q,s as i,a9 as p,aa as g,ae as b,x as r,ad as I,ac as P,y as A}from"./index.ab1a8de1.js";import{Q as U}from"./QHeader.69bcea6e.js";import{Q as $}from"./QSpinnerPuff.7ddb8bbb.js";import{Q as N}from"./QChip.4032f711.js";import{Q as G}from"./QPage.5e199c97.js";import{Q as R,a as j}from"./QLayout.c9e50c75.js";import{u as Y}from"./use-quasar.5635c97f.js";import{u as z}from"./userStore.52ed276a.js";import{C as H}from"./ClubNavigationMenu.bf322301.js";import{a as J,d as K,g as W}from"./paymentsDebug.504d95d8.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.289f3bdd.js";import"./QTabs.c3b133c4.js";import"./rtl.276c3f1b.js";import"./QFooter.2ac9c73e.js";import"./supabase.e2fff660.js";const Z={class:"header-content"},tt={class:"header-icons"},et={class:"row q-gutter-md q-mb-lg"},ot={class:"col-12 col-md-3"},st={class:"col-12 col-md-3"},at={class:"col-12 col-md-3 flex items-end"},lt={key:0,class:"text-center q-my-lg"},nt={key:1,class:"row q-gutter-md q-mb-lg"},rt={class:"col-12 col-md-6 col-lg-3"},ct={class:"text-h6"},dt={class:"text-h4 q-mt-sm"},it={class:"col-12 col-md-6 col-lg-3"},ut={class:"text-h6"},mt={class:"text-h4 q-mt-sm"},vt={class:"text-caption"},_t={class:"col-12 col-md-6 col-lg-3"},pt={class:"text-h6"},gt={class:"text-h4 q-mt-sm"},bt={class:"col-12 col-md-6 col-lg-3"},ft={class:"text-h6"},yt={class:"text-h4 q-mt-sm"},ht={key:2,class:"row q-gutter-md"},xt={class:"col-12 col-md-6"},wt={class:"col-6"},kt={class:"col-3 text-right"},Ct={class:"col-3 text-right text-caption"},qt={class:"col-12 col-md-6"},It={class:"col-6"},Pt={class:"col-3 text-right"},At={class:"col-3 text-right text-caption"},Nt={key:3,class:"text-center q-my-lg"},Tt={__name:"ClubPayments",setup(Qt){const T=V(),w=Y(),u=z(),_=h(!1),f=h(""),y=h(""),m=h([]),c=x(()=>{if(m.value.length===0)return{totalAmount:0,totalCommission:0,netAmount:0,transactionCount:0};const o=m.value.reduce((a,n)=>a+Number(n.total_amount||0),0),t=m.value.reduce((a,n)=>a+Number(n.club_commission||0)+Number(n.player_commission||0),0);return{totalAmount:o,totalCommission:t,netAmount:o-t,transactionCount:m.value.length}}),Q=x(()=>c.value.totalAmount>0?c.value.totalCommission/c.value.totalAmount*100:0),S=x(()=>{const o={};return m.value.forEach(t=>{const a=t.event_type||"unknown";o[a]||(o[a]={amount:0,count:0}),o[a].amount+=Number(t.total_amount||0),o[a].count+=1}),o}),F=x(()=>{const o={};return m.value.forEach(t=>{const a=t.payment_method||"unknown";o[a]||(o[a]={amount:0,count:0}),o[a].amount+=Number(t.total_amount||0),o[a].count+=1}),o}),E=()=>{T.back()},B=o=>({reservation:"Reservas",lesson:"Lecciones",tournament:"Torneos",product:"Productos",unknown:"Otros"})[o]||o,D=o=>({reservation:"blue",lesson:"green",tournament:"orange",product:"purple",unknown:"grey"})[o]||"grey",M=o=>({credit_card:"Tarjeta de Cr\xE9dito",debit_card:"Tarjeta de D\xE9bito",cash:"Efectivo",bank_transfer:"Transferencia",mercadopago:"MercadoPago",stripe:"Stripe",unknown:"Otros"})[o]||o,k=async()=>{if(console.log("DEBUG: userStore data:",{userId:u.userId,clubId:u.clubId,userType:u.userType,email:u.email}),!u.clubId){w.notify({type:"negative",message:"No se encontr\xF3 informaci\xF3n del club"});return}_.value=!0;try{console.log("=== RUNNING PAYMENT DEBUG ANALYSIS ==="),await J(),await K(u.clubId),console.log("=== DEBUG ANALYSIS COMPLETE ===");const o=await W(u.clubId,f.value||null,y.value||null,null);m.value=o}catch(o){console.error("Error fetching payment summary:",o),w.notify({type:"negative",message:"Error al cargar el balance de pagos"})}finally{_.value=!1}};return L(()=>{const o=new Date,t=new Date(o.getFullYear(),o.getMonth(),1);f.value=t.toISOString().split("T")[0],y.value=o.toISOString().split("T")[0],k()}),(o,t)=>(d(),O(R,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[s(U,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[e("div",Z,[t[2]||(t[2]=e("div",{class:"greeting"},[e("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),v(" Balance de Pagos ")],-1)),e("div",tt,[s(C,{flat:"",round:"",icon:"arrow_back",onClick:E})])])]),_:1}),s(j,null,{default:l(()=>[s(G,{class:"q-pa-md"},{default:l(()=>[e("div",et,[e("div",ot,[s(q,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=a=>f.value=a),type:"date",label:"Fecha Inicio",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),e("div",st,[s(q,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=a=>y.value=a),type:"date",label:"Fecha Fin",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),e("div",at,[s(C,{onClick:k,color:"primary",label:"Actualizar",loading:_.value,dense:""},null,8,["loading"])])]),_.value?(d(),i("div",lt,[s($,{color:"primary",size:"3em"}),t[3]||(t[3]=e("p",{class:"q-mt-md"},"Cargando balance...",-1))])):(d(),i("div",nt,[e("div",rt,[s(p,{class:"bg-blue-7 text-white"},{default:l(()=>[s(g,null,{default:l(()=>[e("div",ct,[s(b,{name:"payments",class:"q-mr-sm"}),t[4]||(t[4]=v(" Total Facturado "))]),e("div",dt,"$"+r(c.value.totalAmount.toFixed(2)),1),t[5]||(t[5]=e("div",{class:"text-caption"},"Ingresos brutos del per\xEDodo",-1))]),_:1})]),_:1})]),e("div",it,[s(p,{class:"bg-orange-7 text-white"},{default:l(()=>[s(g,null,{default:l(()=>[e("div",ut,[s(b,{name:"account_balance",class:"q-mr-sm"}),t[6]||(t[6]=v(" Comisi\xF3n Interbancaria "))]),e("div",mt,"$"+r(c.value.totalCommission.toFixed(2)),1),e("div",vt,r(Q.value.toFixed(1))+"% del total",1)]),_:1})]),_:1})]),e("div",_t,[s(p,{class:"bg-green-7 text-white"},{default:l(()=>[s(g,null,{default:l(()=>[e("div",pt,[s(b,{name:"account_balance_wallet",class:"q-mr-sm"}),t[7]||(t[7]=v(" Total Recibido "))]),e("div",gt,"$"+r(c.value.netAmount.toFixed(2)),1),t[8]||(t[8]=e("div",{class:"text-caption"},"Ingresos netos recibidos",-1))]),_:1})]),_:1})]),e("div",bt,[s(p,{class:"bg-purple-7 text-white"},{default:l(()=>[s(g,null,{default:l(()=>[e("div",ft,[s(b,{name:"receipt_long",class:"q-mr-sm"}),t[9]||(t[9]=v(" Total Transacciones "))]),e("div",yt,r(c.value.transactionCount),1),t[10]||(t[10]=e("div",{class:"text-caption"},"Pagos procesados",-1))]),_:1})]),_:1})])])),!_.value&&c.value.totalAmount>0?(d(),i("div",ht,[e("div",xt,[s(p,{class:"bg-dark text-white"},{default:l(()=>[s(g,null,{default:l(()=>[t[11]||(t[11]=e("div",{class:"text-h6 q-mb-md"},"Desglose por Tipo de Servicio",-1)),(d(!0),i(I,null,P(S.value,(a,n)=>(d(),i("div",{key:n,class:"row q-my-sm"},[e("div",wt,[s(N,{color:D(n),"text-color":"white",dense:""},{default:l(()=>[v(r(B(n)),1)]),_:2},1032,["color"])]),e("div",kt,"$"+r(a.amount.toFixed(2)),1),e("div",Ct,r(a.count)+" transacciones",1)]))),128))]),_:1})]),_:1})]),e("div",qt,[s(p,{class:"bg-dark text-white"},{default:l(()=>[s(g,null,{default:l(()=>[t[12]||(t[12]=e("div",{class:"text-h6 q-mb-md"},"M\xE9todos de Pago",-1)),(d(!0),i(I,null,P(F.value,(a,n)=>(d(),i("div",{key:n,class:"row q-my-sm"},[e("div",It,[s(N,{color:"grey-7","text-color":"white",dense:""},{default:l(()=>[v(r(M(n)),1)]),_:2},1024)]),e("div",Pt,"$"+r(a.amount.toFixed(2)),1),e("div",At,r(a.count)+" pagos",1)]))),128))]),_:1})]),_:1})])])):A("",!0),!_.value&&c.value.totalAmount===0?(d(),i("div",Nt,[s(b,{name:"account_balance_wallet",size:"4em",color:"grey"}),t[13]||(t[13]=e("p",{class:"text-h6 q-mt-md"},"No hay pagos en este per\xEDodo",-1)),t[14]||(t[14]=e("p",{class:"text-grey"},"Ajusta las fechas para ver m\xE1s resultados",-1))])):A("",!0)]),_:1})]),_:1}),s(H)]),_:1}))}};var Ht=X(Tt,[["__scopeId","data-v-741a2668"]]);export{Ht as default};
