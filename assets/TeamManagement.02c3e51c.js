import{a5 as Ie,x as Le,y as Ue,r as n,f as ce,w as Ae,h as Be,o as r,z as d,A as l,d as a,B as s,D as g,a as m,Q as me,a7 as k,a8 as v,bE as w,a9 as h,t as u,ad as W,e as x,ab as $,aa as S,ac as D,af as Y,E as Z,ae as ee,bF as De,J as Je,aT as Ne,aS as Fe,aP as Re,bG as ae}from"./index.284c5517.js";import{Q as pe}from"./QHeader.54948f97.js";import{Q as te,a as Q}from"./QItem.756b5f76.js";import{Q as j}from"./QItemLabel.b8ba1298.js";import{Q as ge}from"./QBadge.d9f1db5b.js";import{Q as He}from"./QTooltip.f38bf134.js";import{Q as le}from"./QList.541389d3.js";import{Q as Oe}from"./QSelect.8e127923.js";import{Q as Ge}from"./QChip.baef4018.js";import{Q as Ke}from"./QChatMessage.961cc979.js";import{Q as ve}from"./QPage.dfd00166.js";import{Q as fe,a as ye}from"./QLayout.c9dda368.js";import{Q as Xe}from"./QToolbar.037a16d4.js";import{Q as We}from"./QFooter.d2ce5627.js";import{C as oe}from"./ClosePopup.a4e2cfa5.js";import{u as Ye}from"./use-quasar.58056b10.js";import{a as b}from"./api.9de4aea7.js";import{P as Ze}from"./PlayerNavigationMenu.3819ea2c.js";import{B as ea}from"./BannerPromoScrolling.c22fe0eb.js";import{u as aa}from"./uploadFileUtils.7eb1c781.js";import{_ as ta}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.0a68525e.js";import"./selection.fdad0a51.js";import"./QMenu.3b8f6fe8.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QTabs.b10b01c4.js";import"./admin.b5ca9f0e.js";const la={class:"header-content"},oa={class:"header-icons"},sa={key:0,class:"text-center q-pa-xl"},ra={key:1},na=["src"],ia={class:"col q-ml-md"},da={class:"text-h5"},ua={class:"text-caption"},ca={class:"row items-center justify-between"},ma={class:"text-subtitle1 text-bold q-mb-sm"},pa=["src"],ga={key:0,class:"column q-gutter-xs"},va={class:"row items-center justify-between"},fa={class:"row q-gutter-md q-mb-md"},ya={class:"text-h5"},_a={class:"text-h5 text-positive"},ha={class:"text-h5 text-warning"},ba={key:0},xa={class:"q-mt-md"},ka={key:1,class:"text-center text-positive q-pa-md"},wa={class:"q-mb-md"},Ca={class:"logo-upload-container"},qa=["src"],Pa={class:"logo-overlay"},Qa={key:1,class:"q-mb-md"},Ea={class:"header-content"},Va={class:"header-icons"},Ta=["src"],$a={key:0,class:"text-center text-grey q-pa-xl"},Sa={key:2,class:"text-center q-pa-xl"},ja={__name:"TeamManagement",setup(za){const _e=Ie(),J=Le(),c=Ye(),z=Ue(),f=_e.params.teamId,N=n(!1),F=n(!1),R=n(!1),H=n(!1),O=n(!1),y=n(null),se=n([]),G=n([]),E=n([]),V=n(""),T=n(""),M=n(!1),I=n(!1),L=n(!1),U=n(null),re=n(null),C=n({name:"",logo_url:""}),p=n({category:null,player_id:null,partner_id:null}),K=n(!1),q=n(null),_=n([]),he=n(["tercera","cuarta","quinta","sexta","libre"]),be=ce(()=>{const o={};return se.value.forEach(e=>{const t=e.category;o[t]||(o[t]={name:t,players:[]}),o[t].players.push(e)}),Object.values(o)}),A=ce(()=>{var o;return((o=y.value)==null?void 0:o.captain_id)===z.userId});Ae(L,o=>{o&&ie()}),Be(async()=>{await ne(),await B(),await X()});const ne=async()=>{N.value=!0;try{const{data:o}=await b.get(`/padelite/teams/${f}`);y.value=o.data,C.value={name:y.value.name,logo_url:y.value.logo_url||""}}catch(o){console.error("Error fetching team:",o),c.notify({type:"negative",message:"Error al cargar equipo"})}finally{N.value=!1}},B=async()=>{F.value=!0;try{const{data:o}=await b.get(`/padelite/teams/${f}/players`);se.value=o.data||[]}catch(o){console.error("Error fetching players:",o)}finally{F.value=!1}},xe=()=>{re.value.click()},ke=async o=>{const e=o.target.files[0];if(e){const t=await aa(e);t&&(C.value.logo_url=t)}},we=async()=>{var o,e;R.value=!0;try{await b.put(`/padelite/teams/${f}`,C.value),c.notify({type:"positive",message:"Equipo actualizado exitosamente"}),M.value=!1,await ne()}catch(t){console.error("Error updating team:",t),c.notify({type:"negative",message:((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.detail)||"Error al actualizar equipo"})}finally{R.value=!1}},Ce=async()=>{if(!V.value||V.value.length<2){E.value=[];return}try{const{data:o}=await b.get("/padelite/search/players",{params:{query:V.value}});E.value=o.data||[]}catch(o){console.error("Error searching players:",o)}},qe=o=>{p.value.player_id=o.id},Pe=o=>{const e=E.value.find(t=>t.id===o);return(e==null?void 0:e.full_name)||""},Qe=async()=>{var o,e;H.value=!0;try{const t={team_id:f,player_id:p.value.player_id,category:p.value.category,partner_id:p.value.partner_id};await b.post(`/padelite/teams/${f}/players`,t),c.notify({type:"positive",message:"Jugador agregado exitosamente"}),I.value=!1,p.value={category:null,player_id:null,partner_id:null},V.value="",E.value=[],await B()}catch(t){console.error("Error adding player:",t),c.notify({type:"negative",message:((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.detail)||"Error al agregar jugador"})}finally{H.value=!1}},Ee=o=>{var e;c.dialog({title:"Confirmar",message:`\xBFEst\xE1s seguro de eliminar a ${((e=o.profiles)==null?void 0:e.full_name)||"este jugador"} del equipo?`,cancel:!0,persistent:!0,dark:!0}).onOk(async()=>{var t,i;try{await b.delete(`/padelite/teams/${f}/players/${o.player_id}`),c.notify({type:"positive",message:"Jugador eliminado exitosamente"}),await B()}catch(P){console.error("Error removing player:",P),c.notify({type:"negative",message:((i=(t=P.response)==null?void 0:t.data)==null?void 0:i.detail)||"Error al eliminar jugador"})}})},ie=async()=>{try{const{data:o}=await b.get(`/padelite/teams/${f}/chat`);G.value=(o.data||[]).reverse(),await Je(),U.value&&(U.value.scrollTop=U.value.scrollHeight)}catch(o){console.error("Error fetching chat messages:",o)}},de=async()=>{if(!!T.value.trim()){O.value=!0;try{await b.post(`/padelite/teams/${f}/chat`,{team_id:f,message:T.value}),T.value="",await ie()}catch(o){console.error("Error sending message:",o),c.notify({type:"negative",message:"Error al enviar mensaje"})}finally{O.value=!1}}},Ve=()=>{L.value=!0},ue=o=>({pending:"Pendiente",partial:"Parcial",completed:"Completado",paid:"Pagado"})[o]||o,Te=o=>{o&&J.push(`/player/${o}`)},$e=o=>o?new Date(o).toLocaleString("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",X=async()=>{K.value=!0;try{const{data:o}=await b.get(`/padelite/teams/${f}/payment-status`);q.value=o.data}catch(o){console.error("Error fetching payment status:",o),c.notify({type:"negative",message:"Error al cargar estado de pagos"})}finally{K.value=!1}},Se=()=>{if(_.value.length===0){c.notify({type:"warning",message:"Selecciona al menos un jugador para pagar"});return}c.dialog({title:"Confirmar Pago",message:`Vas a pagar la inscripci\xF3n de ${_.value.length} jugador${_.value.length!==1?"es":""}. \xBFDeseas continuar?`,cancel:!0,persistent:!0,dark:!0}).onOk(async()=>{await je()})},je=async()=>{var o,e;try{const{data:t}=await b.post(`/padelite/teams/${f}/payment`,{player_ids:_.value});c.notify({type:"positive",message:t.message||"Pago procesado exitosamente"}),_.value=[],await X(),await B()}catch(t){console.error("Error processing payment:",t),c.notify({type:"negative",message:((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.detail)||"Error al procesar pago"})}},ze=()=>{J.back()},Me=()=>{J.push("/player/dashboard")};return(o,e)=>(r(),d(fe,{view:"hHh lpR fFf",class:"text-white"},{default:l(()=>[a(pe,{elevated:"",class:"text-white"},{default:l(()=>[s("div",la,[s("div",{class:"greeting"},[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:Me})]),s("div",oa,[a(g,{flat:"",round:"",icon:"arrow_back",onClick:ze})])]),a(ea)]),_:1}),a(ye,null,{default:l(()=>[a(ve,{class:"q-pa-md"},{default:l(()=>[N.value?(r(),m("div",sa,[a(me,{color:"primary",size:"50px"})])):y.value?(r(),m("div",ra,[a(k,{flat:"",bordered:"",class:"q-mb-md text-white"},{default:l(()=>[a(v,{class:"row items-center"},{default:l(()=>[y.value.logo_url?(r(),d(w,{key:0,size:"80px"},{default:l(()=>[s("img",{src:y.value.logo_url},null,8,na)]),_:1})):(r(),d(w,{key:1,size:"80px",color:"primary","text-color":"white"},{default:l(()=>[h(u(y.value.name.charAt(0)),1)]),_:1})),s("div",ia,[s("div",da,u(y.value.name),1),s("div",ua," Pago: "+u(ue(y.value.payment_status)),1)])]),_:1}),a(W,null,{default:l(()=>[A.value?(r(),d(g,{key:0,flat:"",color:"primary",label:"Editar Equipo",onClick:e[0]||(e[0]=t=>M.value=!0)})):x("",!0),a(g,{flat:"",color:"primary",label:"Ver Chat",onClick:Ve})]),_:1})]),_:1}),a(k,{flat:"",bordered:"",class:"q-mb-md text-white"},{default:l(()=>[a(v,null,{default:l(()=>[s("div",ca,[e[11]||(e[11]=s("div",{class:"text-h6"},"Jugadores por Categor\xEDa",-1)),A.value?(r(),d(g,{key:0,flat:"",color:"primary",icon:"add",label:"Agregar Jugador",onClick:e[1]||(e[1]=t=>I.value=!0)})):x("",!0)])]),_:1}),F.value?(r(),d(v,{key:0},{default:l(()=>[a(me,{color:"primary",size:"30px"})]),_:1})):(r(),d(v,{key:1},{default:l(()=>[(r(!0),m($,null,S(be.value,t=>(r(),m("div",{key:t.name,class:"q-mb-md"},[s("div",ma," Categor\xEDa "+u(t.name),1),a(le,{separator:""},{default:l(()=>[(r(!0),m($,null,S(t.players,i=>(r(),d(te,{key:i.id,clickable:"",onClick:P=>Te(i.player_id)},{default:l(()=>[a(Q,{avatar:""},{default:l(()=>[i.photo_url?(r(),d(w,{key:0},{default:l(()=>[s("img",{src:i.photo_url},null,8,pa)]),_:2},1024)):(r(),d(w,{key:1,color:"primary","text-color":"white"},{default:l(()=>{var P;return[h(u(((P=i.player_name)==null?void 0:P.charAt(0))||"?"),1)]}),_:2},1024))]),_:2},1024),a(Q,null,{default:l(()=>[a(j,null,{default:l(()=>[h(u(i.player_name||"Sin nombre"),1)]),_:2},1024),A.value?(r(),d(j,{key:0,caption:""},{default:l(()=>[h(" Pago: "+u(ue(i.payment_status)),1)]),_:2},1024)):x("",!0)]),_:2},1024),a(Q,{side:""},{default:l(()=>[A.value?(r(),m("div",ga,[a(ge,{color:i.payment_status==="paid"?"positive":"warning",label:i.payment_status==="paid"?"Pagado":"Pendiente"},null,8,["color","label"]),a(g,{flat:"",round:"",icon:"delete",color:"negative",onClick:Ne(P=>Ee(i),["stop"]),disable:i.payment_status==="paid"},{default:l(()=>[i.payment_status==="paid"?(r(),d(He,{key:0},{default:l(()=>[...e[12]||(e[12]=[h(" No se puede eliminar un jugador que ya pag\xF3 ",-1)])]),_:1})):x("",!0)]),_:2},1032,["onClick","disable"])])):x("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]))),128))]),_:1}))]),_:1}),a(k,{flat:"",bordered:"",class:"q-mb-md text-white"},{default:l(()=>[a(v,null,{default:l(()=>[s("div",va,[e[13]||(e[13]=s("div",{class:"text-h6"},"Estado de Pagos",-1)),a(g,{flat:"",color:"primary",icon:"refresh",label:"Actualizar",onClick:X,loading:K.value},null,8,["loading"])])]),_:1}),q.value?(r(),d(v,{key:0},{default:l(()=>[s("div",fa,[a(k,{flat:"",bordered:"",class:"col bg-grey-9"},{default:l(()=>[a(v,null,{default:l(()=>[e[14]||(e[14]=s("div",{class:"text-caption"},"Total Jugadores",-1)),s("div",ya,u(q.value.total_players),1)]),_:1})]),_:1}),a(k,{flat:"",bordered:"",class:"col bg-grey-9"},{default:l(()=>[a(v,null,{default:l(()=>[e[15]||(e[15]=s("div",{class:"text-caption"},"Pagados",-1)),s("div",_a,u(q.value.paid_players),1)]),_:1})]),_:1}),a(k,{flat:"",bordered:"",class:"col bg-grey-9"},{default:l(()=>[a(v,null,{default:l(()=>[e[16]||(e[16]=s("div",{class:"text-caption"},"Pendientes",-1)),s("div",ha,u(q.value.pending_players),1)]),_:1})]),_:1})]),q.value.pending_players>0?(r(),m("div",ba,[e[17]||(e[17]=s("div",{class:"text-subtitle2 q-mb-md"},"Selecciona jugadores para pagar:",-1)),a(le,{separator:""},{default:l(()=>[(r(!0),m($,null,S(q.value.players.filter(t=>t.payment_status!=="paid"),t=>(r(),d(te,{key:t.player_id,tag:"label"},{default:l(()=>[a(Q,{avatar:""},{default:l(()=>[a(Fe,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=i=>_.value=i),val:t.player_id,color:"primary"},null,8,["modelValue","val"])]),_:2},1024),a(Q,null,{default:l(()=>[a(j,null,{default:l(()=>[h(u(t.player_name),1)]),_:2},1024),a(j,{caption:""},{default:l(()=>[h("Categor\xEDa: "+u(t.category),1)]),_:2},1024)]),_:2},1024),a(Q,{side:""},{default:l(()=>[a(ge,{color:"warning",label:"Pendiente"})]),_:1})]),_:2},1024))),128))]),_:1}),s("div",xa,[a(g,{color:"primary",icon:"payment",label:`Pagar ${_.value.length} jugador${_.value.length!==1?"es":""}`,onClick:Se,disable:_.value.length===0,class:"full-width"},null,8,["label","disable"])])])):(r(),m("div",ka,[a(D,{name:"check_circle",size:"48px"}),e[18]||(e[18]=s("div",{class:"text-subtitle1 q-mt-md"}," Todos los jugadores han pagado ",-1))]))]),_:1})):x("",!0)]),_:1}),a(Y,{modelValue:M.value,"onUpdate:modelValue":e[4]||(e[4]=t=>M.value=t)},{default:l(()=>[a(k,{class:"bg-dark text-white edit-team-dialog"},{default:l(()=>[a(v,null,{default:l(()=>[...e[19]||(e[19]=[s("div",{class:"text-h6"},"Editar Equipo",-1)])]),_:1}),a(v,null,{default:l(()=>[a(Z,{modelValue:C.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>C.value.name=t),label:"Nombre del Equipo",outlined:"",dense:"",dark:"",class:"q-mb-md"},null,8,["modelValue"]),s("div",wa,[e[21]||(e[21]=s("div",{class:"text-subtitle2 q-mb-sm"},"Logo del Equipo",-1)),s("div",Ca,[s("div",{class:"logo-preview",onClick:xe},[C.value.logo_url?(r(),d(w,{key:0,size:"100px"},{default:l(()=>[s("img",{src:C.value.logo_url,alt:"Logo del equipo"},null,8,qa)]),_:1})):(r(),d(w,{key:1,size:"100px",color:"grey-7","text-color":"white"},{default:l(()=>[a(D,{name:"image",size:"50px"})]),_:1})),s("div",Pa,[a(D,{name:"camera_alt",size:"30px"}),e[20]||(e[20]=s("div",{class:"text-caption"},"Cambiar logo",-1))])]),s("input",{type:"file",ref_key:"logoInput",ref:re,class:"hidden",accept:"image/*",onChange:ke},null,544)])])]),_:1}),a(W,{align:"right"},{default:l(()=>[ee(a(g,{flat:"",label:"Cancelar",color:"grey"},null,512),[[oe]]),a(g,{flat:"",label:"Guardar",color:"primary",onClick:we,loading:R.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:I.value,"onUpdate:modelValue":e[8]||(e[8]=t=>I.value=t)},{default:l(()=>[a(k,{class:"bg-dark text-white add-player-dialog"},{default:l(()=>[a(v,null,{default:l(()=>[...e[22]||(e[22]=[s("div",{class:"text-h6"},"Agregar Jugador al Equipo",-1)])]),_:1}),a(v,null,{default:l(()=>[a(Oe,{modelValue:p.value.category,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value.category=t),options:he.value,label:"Categor\xEDa",outlined:"",dense:"",dark:"",class:"q-mb-md"},null,8,["modelValue","options"]),a(Z,{modelValue:V.value,"onUpdate:modelValue":[e[6]||(e[6]=t=>V.value=t),Ce],label:"Buscar Jugador",outlined:"",dense:"",dark:"",class:"q-mb-md",debounce:"300"},{append:l(()=>[a(D,{name:"search"})]),_:1},8,["modelValue"]),E.value.length>0?(r(),d(le,{key:0,bordered:"",separator:"",class:"q-mb-md"},{default:l(()=>[(r(!0),m($,null,S(E.value,t=>(r(),d(te,{key:t.id,clickable:"",onClick:i=>qe(t),class:Re({"bg-primary":p.value.player_id===t.id})},{default:l(()=>[a(Q,null,{default:l(()=>[a(j,null,{default:l(()=>[h(u(t.full_name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})):x("",!0),p.value.player_id?(r(),m("div",Qa,[e[23]||(e[23]=s("div",{class:"text-caption"},"Jugador seleccionado:",-1)),a(Ge,{color:"primary","text-color":"white",removable:"",onRemove:e[7]||(e[7]=t=>p.value.player_id=null)},{default:l(()=>[h(u(Pe(p.value.player_id)),1)]),_:1})])):x("",!0)]),_:1}),a(W,{align:"right"},{default:l(()=>[ee(a(g,{flat:"",label:"Cancelar",color:"grey"},null,512),[[oe]]),a(g,{flat:"",label:"Agregar",color:"primary",onClick:Qe,loading:H.value,disable:!p.value.player_id||!p.value.category},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:L.value,"onUpdate:modelValue":e[10]||(e[10]=t=>L.value=t),maximized:""},{default:l(()=>[a(fe,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:l(()=>[a(pe,{elevated:"",class:"text-white"},{default:l(()=>[s("div",Ea,[e[24]||(e[24]=s("div",{class:"greeting"},[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),s("span",{class:"text-h6"},"Chat del Equipo")],-1)),s("div",Va,[ee(a(g,{flat:"",round:"",icon:"close"},null,512),[[oe]])])])]),_:1}),a(ye,null,{default:l(()=>[a(ve,{class:"q-pa-md"},{default:l(()=>[s("div",{style:{height:"calc(100vh - 180px)","overflow-y":"auto"},ref_key:"chatContainer",ref:U},[(r(!0),m($,null,S(G.value,t=>(r(),d(Ke,{key:t.id,name:t.sender_name,text:[t.message],stamp:$e(t.timestamp),sent:t.sender_id===ae(z).userId,"bg-color":t.sender_id===ae(z).userId?"primary":"secondary","text-color":t.sender_id===ae(z).userId?"black":"white"},{avatar:l(()=>[t.sender_photo?(r(),d(w,{key:0},{default:l(()=>[s("img",{src:t.sender_photo},null,8,Ta)]),_:2},1024)):(r(),d(w,{key:1,color:"primary","text-color":"white"},{default:l(()=>{var i;return[h(u(((i=t.sender_name)==null?void 0:i.charAt(0))||"?"),1)]}),_:2},1024))]),_:2},1032,["name","text","stamp","sent","bg-color","text-color"]))),128)),G.value.length===0?(r(),m("div",$a," No hay mensajes todav\xEDa ")):x("",!0)],512)]),_:1})]),_:1}),a(We,{elevated:"",class:"bg-black"},{default:l(()=>[a(Xe,null,{default:l(()=>[a(Z,{modelValue:T.value,"onUpdate:modelValue":e[9]||(e[9]=t=>T.value=t),outlined:"",dense:"",dark:"","bg-color":"grey-9",placeholder:"Escribe un mensaje...",class:"col",onKeyup:De(de,["enter"])},null,8,["modelValue"]),a(g,{flat:"",round:"",color:"primary",icon:"send",onClick:de,loading:O.value,class:"q-ml-sm"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(r(),m("div",Sa,[...e[25]||(e[25]=[s("div",{class:"text-h6"},"Equipo no encontrado",-1)])]))]),_:1})]),_:1}),a(Ze)]),_:1}))}};var dt=ta(ja,[["__scopeId","data-v-38091e01"]]);export{dt as default};
