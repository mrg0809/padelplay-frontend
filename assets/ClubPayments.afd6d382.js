import{x as O,y as U,r as h,f as x,h as $,o as d,z as R,A as l,d as s,B as e,bK as q,a9 as v,D as A,E as I,a as i,a7 as g,a8 as p,ac as b,t as r,ab as N,aa as P,e as T}from"./index.39adb644.js";import{Q as z}from"./QHeader.3330d6d5.js";import{Q as G}from"./QSpinnerPuff.4faddef9.js";import{Q}from"./QChip.4e1820bf.js";import{Q as Y}from"./QPage.28b7989a.js";import{Q as j,a as H}from"./QLayout.136fc703.js";import{u as K}from"./use-quasar.eb482957.js";import{u as W}from"./useDashboardNavigation.baccc7a3.js";import{C as J}from"./ClubNavigationMenu.0f9de636.js";import{a as X,d as Z,g as tt}from"./paymentsDebug.38a07bb7.js";import{_ as et}from"./plugin-vue_export-helper.21dcd24c.js";import"./QTabs.de2e2033.js";import"./rtl.276c3f1b.js";import"./QFooter.c2826d80.js";import"./supabase.6e6ca5a2.js";const ot={class:"header-content"},st={class:"greeting"},at={class:"header-icons"},lt={class:"row q-gutter-md q-mb-lg"},nt={class:"col-12 col-md-3"},rt={class:"col-12 col-md-3"},ct={class:"col-12 col-md-3 flex items-end"},dt={key:0,class:"text-center q-my-lg"},it={key:1,class:"row q-gutter-md q-mb-lg"},ut={class:"col-12 col-md-6 col-lg-3"},mt={class:"text-h6"},vt={class:"text-h4 q-mt-sm"},_t={class:"col-12 col-md-6 col-lg-3"},gt={class:"text-h6"},pt={class:"text-h4 q-mt-sm"},bt={class:"text-caption"},ft={class:"col-12 col-md-6 col-lg-3"},yt={class:"text-h6"},ht={class:"text-h4 q-mt-sm"},xt={class:"col-12 col-md-6 col-lg-3"},wt={class:"text-h6"},kt={class:"text-h4 q-mt-sm"},Ct={key:2,class:"row q-gutter-md"},qt={class:"col-12 col-md-6"},At={class:"col-6"},It={class:"col-3 text-right"},Nt={class:"col-3 text-right text-caption"},Pt={class:"col-12 col-md-6"},Tt={class:"col-6"},Qt={class:"col-3 text-right"},St={class:"col-3 text-right text-caption"},Dt={key:3,class:"text-center q-my-lg"},Et={__name:"ClubPayments",setup(Ft){const S=O(),{goToDashboard:w}=W(),k=K(),u=U(),_=h(!1),f=h(""),y=h(""),m=h([]),c=x(()=>{if(m.value.length===0)return{totalAmount:0,totalCommission:0,netAmount:0,transactionCount:0};const o=m.value.reduce((a,n)=>a+Number(n.total_amount||0),0),t=m.value.reduce((a,n)=>a+Number(n.club_commission||0)+Number(n.player_commission||0),0);return{totalAmount:o,totalCommission:t,netAmount:o-t,transactionCount:m.value.length}}),D=x(()=>c.value.totalAmount>0?c.value.totalCommission/c.value.totalAmount*100:0),E=x(()=>{const o={};return m.value.forEach(t=>{const a=t.event_type||"unknown";o[a]||(o[a]={amount:0,count:0}),o[a].amount+=Number(t.total_amount||0),o[a].count+=1}),o}),F=x(()=>{const o={};return m.value.forEach(t=>{const a=t.payment_method||"unknown";o[a]||(o[a]={amount:0,count:0}),o[a].amount+=Number(t.total_amount||0),o[a].count+=1}),o}),B=()=>{S.back()},M=o=>({reservation:"Reservas",lesson:"Lecciones",tournament:"Torneos",product:"Productos",unknown:"Otros"})[o]||o,V=o=>({reservation:"blue",lesson:"green",tournament:"orange",product:"purple",unknown:"grey"})[o]||"grey",L=o=>({credit_card:"Tarjeta de Cr\xE9dito",debit_card:"Tarjeta de D\xE9bito",cash:"Efectivo",bank_transfer:"Transferencia",mercadopago:"MercadoPago",stripe:"Stripe",unknown:"Otros"})[o]||o,C=async()=>{if(console.log("DEBUG: userStore data:",{userId:u.userId,clubId:u.clubId,userType:u.userType,email:u.email}),!u.clubId){k.notify({type:"negative",message:"No se encontr\xF3 informaci\xF3n del club"});return}_.value=!0;try{console.log("=== RUNNING PAYMENT DEBUG ANALYSIS ==="),await X(),await Z(u.clubId),console.log("=== DEBUG ANALYSIS COMPLETE ===");const o=await tt(u.clubId,f.value||null,y.value||null,null);m.value=o}catch(o){console.error("Error fetching payment summary:",o),k.notify({type:"negative",message:"Error al cargar el balance de pagos"})}finally{_.value=!1}};return $(()=>{const o=new Date,t=new Date(o.getFullYear(),o.getMonth(),1);f.value=t.toISOString().split("T")[0],y.value=o.toISOString().split("T")[0],C()}),(o,t)=>(d(),R(j,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[s(z,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[e("div",ot,[e("div",st,[e("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...a)=>q(w)&&q(w)(...a))}),t[3]||(t[3]=v(" Balance de Pagos ",-1))]),e("div",at,[s(A,{flat:"",round:"",icon:"arrow_back",onClick:B})])])]),_:1}),s(H,null,{default:l(()=>[s(Y,{class:"q-pa-md"},{default:l(()=>[e("div",lt,[e("div",nt,[s(I,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),type:"date",label:"Fecha Inicio",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),e("div",rt,[s(I,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=a=>y.value=a),type:"date",label:"Fecha Fin",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),e("div",ct,[s(A,{onClick:C,color:"primary",label:"Actualizar",loading:_.value,dense:""},null,8,["loading"])])]),_.value?(d(),i("div",dt,[s(G,{color:"primary",size:"3em"}),t[4]||(t[4]=e("p",{class:"q-mt-md"},"Cargando balance...",-1))])):(d(),i("div",it,[e("div",ut,[s(g,{class:"bg-blue-7 text-white"},{default:l(()=>[s(p,null,{default:l(()=>[e("div",mt,[s(b,{name:"payments",class:"q-mr-sm"}),t[5]||(t[5]=v(" Total Facturado ",-1))]),e("div",vt,"$"+r(c.value.totalAmount.toFixed(2)),1),t[6]||(t[6]=e("div",{class:"text-caption"},"Ingresos brutos del per\xEDodo",-1))]),_:1})]),_:1})]),e("div",_t,[s(g,{class:"bg-orange-7 text-white"},{default:l(()=>[s(p,null,{default:l(()=>[e("div",gt,[s(b,{name:"account_balance",class:"q-mr-sm"}),t[7]||(t[7]=v(" Comisi\xF3n Interbancaria ",-1))]),e("div",pt,"$"+r(c.value.totalCommission.toFixed(2)),1),e("div",bt,r(D.value.toFixed(1))+"% del total",1)]),_:1})]),_:1})]),e("div",ft,[s(g,{class:"bg-green-7 text-white"},{default:l(()=>[s(p,null,{default:l(()=>[e("div",yt,[s(b,{name:"account_balance_wallet",class:"q-mr-sm"}),t[8]||(t[8]=v(" Total Recibido ",-1))]),e("div",ht,"$"+r(c.value.netAmount.toFixed(2)),1),t[9]||(t[9]=e("div",{class:"text-caption"},"Ingresos netos recibidos",-1))]),_:1})]),_:1})]),e("div",xt,[s(g,{class:"bg-purple-7 text-white"},{default:l(()=>[s(p,null,{default:l(()=>[e("div",wt,[s(b,{name:"receipt_long",class:"q-mr-sm"}),t[10]||(t[10]=v(" Total Transacciones ",-1))]),e("div",kt,r(c.value.transactionCount),1),t[11]||(t[11]=e("div",{class:"text-caption"},"Pagos procesados",-1))]),_:1})]),_:1})])])),!_.value&&c.value.totalAmount>0?(d(),i("div",Ct,[e("div",qt,[s(g,{class:"bg-dark text-white"},{default:l(()=>[s(p,null,{default:l(()=>[t[12]||(t[12]=e("div",{class:"text-h6 q-mb-md"},"Desglose por Tipo de Servicio",-1)),(d(!0),i(N,null,P(E.value,(a,n)=>(d(),i("div",{key:n,class:"row q-my-sm"},[e("div",At,[s(Q,{color:V(n),"text-color":"white",dense:""},{default:l(()=>[v(r(M(n)),1)]),_:2},1032,["color"])]),e("div",It,"$"+r(a.amount.toFixed(2)),1),e("div",Nt,r(a.count)+" transacciones",1)]))),128))]),_:1})]),_:1})]),e("div",Pt,[s(g,{class:"bg-dark text-white"},{default:l(()=>[s(p,null,{default:l(()=>[t[13]||(t[13]=e("div",{class:"text-h6 q-mb-md"},"M\xE9todos de Pago",-1)),(d(!0),i(N,null,P(F.value,(a,n)=>(d(),i("div",{key:n,class:"row q-my-sm"},[e("div",Tt,[s(Q,{color:"grey-7","text-color":"white",dense:""},{default:l(()=>[v(r(L(n)),1)]),_:2},1024)]),e("div",Qt,"$"+r(a.amount.toFixed(2)),1),e("div",St,r(a.count)+" pagos",1)]))),128))]),_:1})]),_:1})])])):T("",!0),!_.value&&c.value.totalAmount===0?(d(),i("div",Dt,[s(b,{name:"account_balance_wallet",size:"4em",color:"grey"}),t[14]||(t[14]=e("p",{class:"text-h6 q-mt-md"},"No hay pagos en este per\xEDodo",-1)),t[15]||(t[15]=e("p",{class:"text-grey"},"Ajusta las fechas para ver m\xE1s resultados",-1))])):T("",!0)]),_:1})]),_:1}),s(J)]),_:1}))}};var Jt=et(Et,[["__scopeId","data-v-63181e36"]]);export{Jt as default};
