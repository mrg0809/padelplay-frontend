import{r as _,F as A,B as P,q as d,G as w,H as p,v as n,I as l,s as h,Q as x,y as f,ae as E,x as O,J as S}from"./index.cf1ae381.js";import{Q as C}from"./QPage.3d29d4c0.js";import{Q as U,a as Q}from"./QLayout.3b12d370.js";import{u as L}from"./userStore.f5a1e81d.js";import{o as v}from"./auth.79f81671.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.063153d6.js";import"./supabase.ad40cb04.js";import"./api.f1a1189d.js";const N={class:"callback-container"},R={key:0,class:"loading-container"},F={key:1,class:"error-container"},G={class:"error-text"},H={__name:"AuthCallbackPage",setup(I){const g=_(!0),a=_(null),o=A(),b=L();P(async()=>{try{console.log("OAuth callback page loaded"),v.debugOAuthState();const e=new URLSearchParams(window.location.search),r=new URLSearchParams(window.location.hash.substring(1)),s=e.get("error")||r.get("error"),m=e.get("error_code")||r.get("error_code"),i=e.get("error_description")||r.get("error_description");if(s){console.error("OAuth error from URL parameters:",{error:s,error_code:m,error_description:i});let t="Error durante la autenticaci\xF3n con Google.";throw s==="server_error"&&m==="unexpected_failure"?i&&i.includes("Unable to exchange external code")?t="Error de configuraci\xF3n OAuth. La conexi\xF3n con Google no se complet\xF3 correctamente. Esto puede deberse a un problema de configuraci\xF3n del proveedor OAuth.":t="Error del servidor durante la autenticaci\xF3n. Por favor, intenta de nuevo.":s==="access_denied"?t="Acceso denegado. Has cancelado la autenticaci\xF3n con Google.":s==="invalid_request"&&(t="Solicitud de autenticaci\xF3n inv\xE1lida. Por favor, intenta de nuevo."),new Error(t)}const{access_token:u}=await v.handleOAuthCallback();localStorage.setItem("token",u),b.setUserDataFromToken(u);const y=u.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),c=JSON.parse(atob(y));console.log("OAuth login successful, user type:",c.user_type),c.user_type==="superuser"?o.push("/dashboard/superuser"):c.user_type==="admin"?o.push("/dashboard/admin"):c.user_type==="club"?o.push("/dashboard/club"):o.push("/dashboard/player")}catch(e){console.error("OAuth callback error:",e),e.message&&e.message.includes("No active session found")?a.value="No se encontr\xF3 una sesi\xF3n activa. Esto puede suceder si la configuraci\xF3n de OAuth no est\xE1 completa. Revisa OAUTH_SETUP.md para m\xE1s informaci\xF3n.":e.response&&e.response.status===503?a.value="Error de configuraci\xF3n de la base de datos. Contacta al administrador.":e.message&&e.message.includes("Error de configuraci\xF3n OAuth")?a.value=e.message:a.value="Error durante la autenticaci\xF3n. Por favor, intenta de nuevo.",g.value=!1}});const k=()=>{o.push("/")};return(e,r)=>(d(),w(U,{view:"lHh Lpr lFf"},{default:p(()=>[n(Q,null,{default:p(()=>[n(C,{class:"auth-callback-page"},{default:p(()=>[l("div",N,[r[1]||(r[1]=l("img",{src:"/logo.jpeg",alt:"Logo",class:"callback-logo"},null,-1)),g.value?(d(),h("div",R,[n(x,{size:"lg",color:"white"}),r[0]||(r[0]=l("p",{class:"loading-text"},"Procesando autenticaci\xF3n...",-1))])):f("",!0),a.value?(d(),h("div",F,[n(E,{name:"error",size:"lg",color:"red"}),l("p",G,O(a.value),1),n(S,{label:"Volver al inicio",color:"white","text-color":"black",onClick:k})])):f("",!0)])]),_:1})]),_:1})]),_:1}))}};var X=B(H,[["__scopeId","data-v-1e1cd586"]]);export{X as default};
