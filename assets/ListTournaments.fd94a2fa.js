import{f as S,r as b,w as K,o as f,z as k,A as l,d as o,a8 as E,B as t,a9 as C,t as y,ac as G,aM as ee,bT as ae,a as N,e as q,ad as F,D as p,a7 as j,af as O,x as oe,h as le,s as te,a6 as X,ab as ne,aa as se,ae as M}from"./index.44d6004f.js";import{Q as re}from"./QHeader.8ed599dc.js";import{Q as ie}from"./QBadge.182a08f3.js";import{Q as de}from"./QPage.069cc100.js";import{Q as A,a as R}from"./QItem.cafd0d6f.js";import{Q as ue}from"./QList.8f6ea51c.js";import{Q as me}from"./QMenu.aa52843c.js";import{Q as ce,a as fe}from"./QLayout.bdadfe99.js";import{C as I}from"./ClosePopup.8579e57c.js";import{s as z}from"./supabase.3e81c9a1.js";import{a as ge}from"./dateUtils.b30b2858.js";import{n as pe}from"./navigationUtils.2c4b9dee.js";import{u as ve}from"./use-quasar.00fa2d0c.js";import"./api.dcb17b1f.js";import{C as be}from"./ClubNavigationMenu.c0ded129.js";import{Q as Y}from"./QItemLabel.30a3dfed.js";import{Q as Z}from"./QSelect.22e7e4d3.js";import{Q as Ce}from"./QSlider.87f5f51f.js";import{_ as $}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.d7eef48c.js";import"./selection.ab0d7921.js";import"./QTabs.02ad9b81.js";import"./rtl.276c3f1b.js";import"./QFooter.dec25843.js";import"./QChip.d99417f0.js";import"./format.de7e9769.js";import"./TouchPan.14df6e61.js";import"./touch.9135741d.js";const _e={name:"CombinedTournamentConfigDialog",props:{modelValue:{type:Boolean,default:!1},numTeams:{type:Number,required:!0}},emits:["update:modelValue","confirm","cancel"],setup(u,{emit:e}){const v=S({get:()=>u.modelValue,set:i=>e("update:modelValue",i)}),a=b(null),g=b(2),_=b("cuartos"),r=S(()=>{const i=[],m=u.numTeams;for(let c=2;c<=Math.min(8,Math.floor(m/3));c++){const B=m/c,D=Math.floor(B),w=m%c;let P="";if(w===0)P=`${c} grupos de ${D} parejas`;else{const U=w;P=`${c-w} grupos de ${D} parejas y ${U} de ${D+1} parejas`}i.push({value:{numGroups:c,baseSize:D,remainder:w},label:P,description:`Total: ${m} parejas`})}return i}),h=S(()=>2),d=S(()=>{if(!a.value)return 2;const i=a.value.baseSize;return Math.max(2,i-1)}),n=S(()=>{const i=[],m=u.numTeams;return i.push({label:"Final",value:"final"}),m>=4&&i.push({label:"Semifinales",value:"semifinal"}),m>=10&&i.push({label:"Cuartos de Final",value:"cuartos"}),m>=20&&i.push({label:"Octavos de Final",value:"octavos"}),i.reverse()}),x=S(()=>a.value!==null&&g.value>=h.value&&g.value<=d.value&&_.value!==null);return K(a,i=>{i&&g.value>d.value&&(g.value=d.value)}),K(()=>u.modelValue,i=>{if(i&&r.value.length>0&&!a.value){const m=r.value.find(c=>c.value.baseSize===4||c.value.baseSize===3);a.value=m?m.value:r.value[0].value}}),{showDialog:v,selectedGroupConfig:a,matchesPerTeam:g,playoffStartStage:_,groupOptions:r,minMatchesPerTeam:h,maxMatchesPerTeam:d,playoffStageOptions:n,isValid:x,confirm:()=>{if(!x.value)return;const i={groupConfig:a.value,matchesPerTeam:g.value,playoffStartStage:_.value};e("confirm",i),v.value=!1},cancel:()=>{e("cancel"),v.value=!1}}}},ye={class:"q-mb-md"},Te={class:"text-subtitle2 q-mb-sm"},ke={class:"q-mb-md"},he={class:"text-subtitle1 q-mb-sm"},xe={key:0,class:"q-mb-md"},Ve={class:"text-subtitle1 q-mb-sm"},De={class:"text-caption q-mt-xs text-grey-4"},we={class:"q-mb-md"},Qe={class:"text-subtitle1 q-mb-sm"};function Se(u,e,v,a,g,_){return f(),k(O,{modelValue:a.showDialog,"onUpdate:modelValue":e[3]||(e[3]=r=>a.showDialog=r),persistent:""},{default:l(()=>[o(j,{class:"config-dialog bg-black text-white",style:{"min-width":"400px"}},{default:l(()=>[o(E,{class:"row items-center bg-purple-8"},{default:l(()=>[...e[4]||(e[4]=[t("div",{class:"text-h6"},"Configuraci\xF3n del Torneo Combinado",-1)])]),_:1}),o(E,null,{default:l(()=>[t("div",ye,[t("div",Te,[e[5]||(e[5]=t("strong",null,"Parejas inscritas:",-1)),C(" "+y(v.numTeams),1)])]),t("div",ke,[t("div",he,[o(G,{name:"groups"}),e[6]||(e[6]=C(" Configuraci\xF3n de Grupos ",-1))]),o(Z,{modelValue:a.selectedGroupConfig,"onUpdate:modelValue":e[0]||(e[0]=r=>a.selectedGroupConfig=r),options:a.groupOptions,label:"Selecciona la distribuci\xF3n de grupos",outlined:"",dark:"","emit-value":"","map-options":"","option-label":r=>r.label,"option-value":r=>r.value},{option:l(r=>[o(A,ee(ae(r.itemProps)),{default:l(()=>[o(R,null,{default:l(()=>[o(Y,null,{default:l(()=>[C(y(r.opt.label),1)]),_:2},1024),o(Y,{caption:""},{default:l(()=>[C(y(r.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label","option-value"])]),a.selectedGroupConfig?(f(),N("div",xe,[t("div",Ve,[o(G,{name:"sports"}),e[7]||(e[7]=C(" Partidos por Pareja en Fase de Grupos ",-1))]),o(Ce,{modelValue:a.matchesPerTeam,"onUpdate:modelValue":e[1]||(e[1]=r=>a.matchesPerTeam=r),min:a.minMatchesPerTeam,max:a.maxMatchesPerTeam,step:1,label:"","label-value":`${a.matchesPerTeam} partidos`,color:"purple",dark:""},null,8,["modelValue","min","max","label-value"]),t("div",De," M\xEDnimo: "+y(a.minMatchesPerTeam)+" | M\xE1ximo: "+y(a.maxMatchesPerTeam),1)])):q("",!0),t("div",we,[t("div",Qe,[o(G,{name:"emoji_events"}),e[8]||(e[8]=C(" Etapa Inicial de Eliminaci\xF3n ",-1))]),o(Z,{modelValue:a.playoffStartStage,"onUpdate:modelValue":e[2]||(e[2]=r=>a.playoffStartStage=r),options:a.playoffStageOptions,label:"Desde qu\xE9 etapa comenzar los playoffs",outlined:"",dark:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]),_:1}),o(F,{align:"right",class:"q-pa-md"},{default:l(()=>[o(p,{flat:"",label:"Cancelar",color:"red",onClick:a.cancel},null,8,["onClick"]),o(p,{label:"Generar Cuadro",color:"purple",onClick:a.confirm,disable:!a.isValid},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Pe=$(_e,[["render",Se],["__scopeId","data-v-1af1ed3a"]]);const qe={name:"ListTournaments",components:{ClubNavigationMenu:be,CombinedTournamentConfigDialog:Pe},setup(){const u=oe(),e=ve(),v=b([]),a=b(null),g=b(!1),_=b(!1),r=b(!1),h=b(null),d=b(null),n=b(null),x=async()=>{try{if(!a.value){console.error("Club ID no encontrado.");return}const{data:s,error:T}=await z.from("tournaments").select("id, name, start_date, min_pairs, status").eq("club_id",a.value).order("start_date",{ascending:!1});if(T){console.error("Error fetching tournaments:",T.message);return}const Q=await Promise.all(s.map(async V=>{const{data:L,error:Ue}=await z.from("tournament_teams").select("id",{count:"exact"}).eq("tournament_id",V.id).eq("status","confirmed");return{id:V.id,name:V.name,start_date:V.start_date,min_pairs:V.min_pairs,registered_teams:(L==null?void 0:L.length)||0,status:V.status||"open"}}));v.value=Q}catch(s){console.error("Unexpected error fetching tournaments:",s.message)}},H=s=>{u.push({name:"EditTournament",params:{tournamentId:s}})},J=s=>{h.value=s,g.value=!0},i=async()=>{try{const{error:s}=await z.from("tournaments").delete().eq("id",h.value);if(s)throw s;v.value=v.value.filter(T=>T.id!==h.value),g.value=!1,e.notify({type:"positive",message:"Torneo eliminado exitosamente."})}catch(s){console.error("Error al eliminar el torneo:",s.message),e.notify({type:"negative",message:"Error al eliminar torneo."})}},m=async s=>{d.value=s;try{const{data:T,error:Q}=await z.from("tournaments").select("system").eq("id",s.id).single();if(Q)throw Q;T.system==="combinado"?r.value=!0:_.value=!0}catch(T){console.error("Error fetching tournament system:",T),e.notify({type:"negative",message:"Error al cargar informaci\xF3n del torneo."})}},c=async()=>{try{if(console.log("Cerrando torneo:",d.value.id),d.value.registered_teams<d.value.min_pairs){e.notify({type:"negative",message:"El torneo no tiene suficientes parejas inscritas para cerrarlo."}),_.value=!1;return}const s={name:"PreviewTournament",params:{tournamentId:d.value.id}};n.value&&(s.query={config:JSON.stringify(n.value)}),u.push(s),_.value=!1}catch(s){console.error("Error navigating to preview:",s),e.notify({type:"negative",message:"Error al navegar a la vista previa del torneo."})}},B=s=>{console.log("Combined tournament config:",s),n.value=s,r.value=!1,c()},D=()=>{r.value=!1,d.value=null,n.value=null},w=s=>{u.push("/club/creartorneos")},P=s=>{u.push({name:"ManageTournament",params:{tournamentId:s}})},U=()=>{u.back()},W=()=>{pe(u,userStore)};return le(async()=>{const s=await te.getItem("token");if(s){const Q=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),V=JSON.parse(atob(Q));a.value=V.club_id||null}x()}),{tournaments:v,goBack:U,editTournament:H,openDeleteDialog:J,openCloseDialog:m,deleteDialogVisible:g,closeDialogVisible:_,showCombinedConfigDialog:r,deleteTournament:i,closeTournament:c,handleCombinedConfig:B,cancelCombinedConfig:D,openCreateTournament:w,manageTournament:P,goToDashboard:W,selectedTournament:d,formatShortDate:ge}}},Ee={class:"header-content"},Me={class:"greeting"},Ie={class:"header-icons"},ze={key:0,class:"text-center q-mt-md"},Ge={key:1,class:"tournaments-list"},Ne={class:"tournament-title"},je={class:"actions"};function Be(u,e,v,a,g,_){const r=X("CombinedTournamentConfigDialog"),h=X("ClubNavigationMenu");return f(),k(ce,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[o(re,{elevated:"",class:"text-white"},{default:l(()=>[t("div",Ee,[t("div",Me,[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...d)=>a.goToDashboard&&a.goToDashboard(...d))}),e[4]||(e[4]=C(" Mis Torneos ",-1))]),t("div",Ie,[o(p,{flat:"",round:"",icon:"arrow_back",onClick:a.goBack},null,8,["onClick"])])])]),_:1}),o(fe,null,{default:l(()=>{var d;return[o(de,{class:"q-pa-md"},{default:l(()=>[a.tournaments.length===0?(f(),N("div",ze,[o(G,{name:"event_busy",size:"64px"}),e[5]||(e[5]=t("p",null,"No has creado torneos todav\xEDa.",-1))])):(f(),N("div",Ge,[(f(!0),N(ne,null,se(a.tournaments,n=>(f(),k(j,{key:n.id,class:"transparent-card"},{default:l(()=>[o(E,null,{default:l(()=>[t("h4",Ne,y(n.name),1),t("p",null,[e[6]||(e[6]=t("strong",null,"Fecha:",-1)),C(" "+y(a.formatShortDate(n.start_date).replace(/-/g,"/"))+" ",1),e[7]||(e[7]=t("br",null,null,-1)),e[8]||(e[8]=t("strong",null,"M\xEDnimo de Parejas:",-1)),C(" "+y(n.min_pairs)+" ",1),e[9]||(e[9]=t("br",null,null,-1)),e[10]||(e[10]=t("strong",null,"Parejas Inscritas:",-1)),C(" "+y(n.registered_teams)+" ",1),e[11]||(e[11]=t("br",null,null,-1)),e[12]||(e[12]=t("strong",null,"Estado:",-1)),o(ie,{color:n.status==="closed"?"secondary":"primary","text-color":n.status==="closed"?"white":"black"},{default:l(()=>[C(y(n.status==="closed"?"Cerrado":"Abierto"),1)]),_:2},1032,["color","text-color"])]),t("div",je,[n.status!=="closed"?(f(),k(p,{key:0,icon:"edit",label:"Editar",color:"primary","text-color":"black",size:"sm",onClick:x=>a.editTournament(n.id)},null,8,["onClick"])):q("",!0),n.status!=="closed"?(f(),k(p,{key:1,icon:"delete",label:"Eliminar",color:"negative","text-color":"black",size:"sm",disable:n.registered_teams>0,onClick:x=>a.openDeleteDialog(n.id)},null,8,["disable","onClick"])):q("",!0),n.status!=="closed"?(f(),k(p,{key:2,icon:"preview",label:"Cerrar Torneo",color:"secondary","text-color":"black",size:"sm",onClick:x=>a.openCloseDialog(n)},null,8,["onClick"])):q("",!0),n.status==="closed"?(f(),k(p,{key:3,icon:"dashboard",label:"Administrar",color:"secondary",size:"sm",onClick:x=>a.manageTournament(n.id)},null,8,["onClick"])):q("",!0)])]),_:2},1024)]),_:2},1024))),128))]))]),_:1}),o(p,{glossy:"",round:"",size:"lg",color:"black",icon:"add",class:"fixed-bottom-right q-mb-xl"},{default:l(()=>[o(me,{anchor:"top end",self:"bottom end"},{default:l(()=>[o(ue,{style:{"min-width":"150px"}},{default:l(()=>[M((f(),k(A,{clickable:"",onClick:a.openCreateTournament},{default:l(()=>[o(R,null,{default:l(()=>[...e[13]||(e[13]=[t("strong",null,"Retas",-1)])]),_:1})]),_:1},8,["onClick"])),[[I]]),M((f(),k(A,{clickable:"",onClick:a.openCreateTournament},{default:l(()=>[o(R,null,{default:l(()=>[...e[14]||(e[14]=[t("strong",null,"Torneo",-1)])]),_:1})]),_:1},8,["onClick"])),[[I]])]),_:1})]),_:1})]),_:1}),o(O,{modelValue:a.deleteDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=n=>a.deleteDialogVisible=n)},{default:l(()=>[o(j,{class:"bg-black text-white"},{default:l(()=>[o(E,null,{default:l(()=>[...e[15]||(e[15]=[t("div",{class:"text-h6"},"Confirmar eliminaci\xF3n",-1),t("div",null,"\xBFEst\xE1s seguro de que deseas eliminar este torneo?",-1)])]),_:1}),o(F,{align:"right"},{default:l(()=>[M(o(p,{flat:"",label:"Cancelar",color:"primary"},null,512),[[I]]),o(p,{flat:"",label:"Eliminar",color:"negative",onClick:a.deleteTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(O,{modelValue:a.closeDialogVisible,"onUpdate:modelValue":e[2]||(e[2]=n=>a.closeDialogVisible=n)},{default:l(()=>[o(j,{class:"bg-black text-white"},{default:l(()=>[o(E,null,{default:l(()=>[...e[16]||(e[16]=[t("div",{class:"text-h6"},"Confirmar cierre",-1),t("div",null," \xBFEst\xE1s seguro de que deseas cerrar este torneo? Esto generar\xE1 el fixture autom\xE1ticamente. ",-1)])]),_:1}),o(F,{align:"right"},{default:l(()=>[M(o(p,{flat:"",label:"Cancelar",color:"red"},null,512),[[I]]),o(p,{flat:"",label:"Cerrar Torneo",color:"green",onClick:a.closeTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(r,{modelValue:a.showCombinedConfigDialog,"onUpdate:modelValue":e[3]||(e[3]=n=>a.showCombinedConfigDialog=n),"num-teams":((d=a.selectedTournament)==null?void 0:d.registered_teams)||0,onConfirm:a.handleCombinedConfig,onCancel:a.cancelCombinedConfig},null,8,["modelValue","num-teams","onConfirm","onCancel"])]}),_:1}),o(h)]),_:1})}var pa=$(qe,[["render",Be],["__scopeId","data-v-6e39239e"]]);export{pa as default};
