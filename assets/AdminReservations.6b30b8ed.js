import{a6 as D,o as g,z as b,A as t,d as e,ac as v,a9 as c,D as h,B as r,a7 as m,a8 as f,E as y,t as n,e as Q}from"./index.673cf58d.js";import{Q as C}from"./QToolbarTitle.073efba4.js";import{Q as R}from"./QToolbar.5cbbc300.js";import{Q as V}from"./QHeader.08eb5fd8.js";import{Q as k}from"./QSelect.4a6653a3.js";import{Q as u}from"./QTd.6b24d957.js";import{Q as A}from"./QBadge.dc3230c9.js";import{Q as N}from"./QTable.07fea183.js";import{Q as q}from"./QBanner.75bf9cfb.js";import{Q as T}from"./QPage.1da70bf2.js";import{Q as I,a as F}from"./QLayout.6bdb52fd.js";import{a as P,d as B}from"./admin.929dac80.js";import{A as S}from"./AdminNavigationMenu.5f23d4e4.js";import{_ as U}from"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.1e99043f.js";import"./QItem.129857ec.js";import"./QItemLabel.20b62e60.js";import"./QMenu.3db3e33e.js";import"./position-engine.e7dd3b6a.js";import"./selection.3a608fc8.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QList.0e5fa6ef.js";import"./QMarkupTable.15b9eef6.js";import"./use-fullscreen.b6ddb764.js";import"./api.5f33f013.js";import"./QTabs.decd7594.js";import"./QFooter.925a22ea.js";const H={name:"AdminReservations",components:{AdminNavigationMenu:S},data(){return{reservationData:{reservations:[],total_count:0},clubOptions:[],filters:{startDate:"",endDate:"",clubId:null},loading:!1,error:null,pagination:{rowsPerPage:15},columns:[{name:"reservation_date",required:!0,label:"Fecha",align:"left",field:"reservation_date",sortable:!0},{name:"time_range",label:"Horario",align:"left",field:"time_range"},{name:"user_name",label:"Usuario",align:"left",field:"user_name"},{name:"club_name",label:"Club",align:"left",field:"club_name"},{name:"court_name",label:"Cancha",align:"left",field:"court_name"},{name:"total_price",label:"Precio",align:"right",field:"total_price",sortable:!0},{name:"status",label:"Estado",align:"center",field:"status"}]}},computed:{totalRevenue(){return this.reservationData.reservations.reduce((s,l)=>s+(parseFloat(l.total_price)||0),0)},averagePrice(){return this.reservationData.reservations.length>0?this.totalRevenue/this.reservationData.reservations.length:0},totalHours(){return this.reservationData.reservations.reduce((s,l)=>{const p=new Date(`1970-01-01T${l.start_time}:00`),o=(new Date(`1970-01-01T${l.end_time}:00`)-p)/(1e3*60*60);return s+(o>0?o:0)},0).toFixed(1)}},async mounted(){await this.loadClubs(),await this.loadReservations()},methods:{async loadClubs(){try{const s=await P();this.clubOptions=[{label:"Todos los clubes",value:null},...s.clubs.map(l=>({label:l.name,value:l.id}))]}catch(s){console.error("Error loading clubs:",s)}},async loadReservations(){this.loading=!0,this.error=null;try{const s={startDate:this.filters.startDate||void 0,endDate:this.filters.endDate||void 0,clubId:this.filters.clubId||void 0};this.reservationData=await B(s)}catch(s){this.error="Error al cargar las reservas: "+s.message,console.error("Error loading reservations:",s)}finally{this.loading=!1}},clearFilters(){this.filters={startDate:"",endDate:"",clubId:null},this.loadReservations()},formatCurrency(s){return s?new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(s):"$0.00"},formatDate(s){return s?new Date(s).toLocaleDateString("es-MX"):"N/A"},formatStatus(s){return{confirmed:"Confirmada",completed:"Completada",cancelled:"Cancelada",pending:"Pendiente"}[s]||s},getStatusColor(s){return{confirmed:"positive",completed:"blue",cancelled:"negative",pending:"warning"}[s]||"grey"}}},M={class:"q-pa-md"},E={class:"row q-gutter-md items-end"},L={class:"col-md-3 col-sm-6"},O={class:"col-md-3 col-sm-6"},X={class:"col-md-4 col-sm-12"},z={class:"col-auto"},j={class:"row q-gutter-md q-mb-lg"},G={class:"col-md-3"},J={class:"text-h4 text-primary"},K={class:"col-md-3"},W={class:"text-h4 text-positive"},Y={class:"col-md-3"},Z={class:"text-h4 text-secondary"},$={class:"col-md-3"},ee={class:"text-h4 text-info"},te={class:"time-range"},ae={class:"text-weight-bold text-positive"},le={class:"text-weight-medium"},re={class:"text-caption text-grey-5"};function se(s,l,p,w,o,i){const x=D("AdminNavigationMenu");return g(),b(I,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:t(()=>[e(V,{elevated:"",class:"bg-primary text-white"},{default:t(()=>[e(R,null,{default:t(()=>[e(C,null,{default:t(()=>[e(v,{name:"event_seat",class:"q-mr-sm"}),l[3]||(l[3]=c(" Reservas ",-1))]),_:1}),e(h,{flat:"",icon:"refresh",onClick:i.loadReservations,loading:o.loading,label:"Actualizar"},null,8,["onClick","loading"])]),_:1})]),_:1}),e(F,null,{default:t(()=>[e(T,{padding:"",class:"bg-dark"},{default:t(()=>[r("div",M,[l[8]||(l[8]=r("div",{class:"row q-mb-lg"},[r("div",{class:"col"},[r("p",{class:"text-grey-4"}," Consulta todas las reservas de cualquier club ")])],-1)),e(m,{class:"filter-card q-mb-md"},{default:t(()=>[e(f,null,{default:t(()=>[r("div",E,[r("div",L,[e(y,{modelValue:o.filters.startDate,"onUpdate:modelValue":[l[0]||(l[0]=a=>o.filters.startDate=a),i.loadReservations],type:"date",label:"Fecha inicio",filled:"",dark:""},null,8,["modelValue","onUpdate:modelValue"])]),r("div",O,[e(y,{modelValue:o.filters.endDate,"onUpdate:modelValue":[l[1]||(l[1]=a=>o.filters.endDate=a),i.loadReservations],type:"date",label:"Fecha fin",filled:"",dark:""},null,8,["modelValue","onUpdate:modelValue"])]),r("div",X,[e(k,{modelValue:o.filters.clubId,"onUpdate:modelValue":[l[2]||(l[2]=a=>o.filters.clubId=a),i.loadReservations],options:o.clubOptions,"option-value":"value","option-label":"label",label:"Filtrar por club",filled:"",dark:"",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"])]),r("div",z,[e(h,{flat:"",icon:"clear",color:"grey-7",onClick:i.clearFilters,label:"Limpiar"},null,8,["onClick"])])])]),_:1})]),_:1}),r("div",j,[r("div",G,[e(m,{class:"summary-card"},{default:t(()=>[e(f,null,{default:t(()=>[l[4]||(l[4]=r("div",{class:"text-h6 text-white"},"Total Reservas",-1)),r("div",J,n(o.reservationData.total_count),1)]),_:1})]),_:1})]),r("div",K,[e(m,{class:"summary-card"},{default:t(()=>[e(f,null,{default:t(()=>[l[5]||(l[5]=r("div",{class:"text-h6 text-white"},"Ingresos Total",-1)),r("div",W,n(i.formatCurrency(i.totalRevenue)),1)]),_:1})]),_:1})]),r("div",Y,[e(m,{class:"summary-card"},{default:t(()=>[e(f,null,{default:t(()=>[l[6]||(l[6]=r("div",{class:"text-h6 text-white"},"Precio Promedio",-1)),r("div",Z,n(i.formatCurrency(i.averagePrice)),1)]),_:1})]),_:1})]),r("div",$,[e(m,{class:"summary-card"},{default:t(()=>[e(f,null,{default:t(()=>[l[7]||(l[7]=r("div",{class:"text-h6 text-white"},"Horas Totales",-1)),r("div",ee,n(i.totalHours)+"h ",1)]),_:1})]),_:1})])]),e(m,{class:"table-card"},{default:t(()=>[e(f,{class:"q-pa-none"},{default:t(()=>[e(N,{rows:o.reservationData.reservations,columns:o.columns,"row-key":"id",flat:"",dark:"",loading:o.loading,pagination:o.pagination},{"body-cell-reservation_date":t(a=>[e(u,{props:a},{default:t(()=>[c(n(i.formatDate(a.value)),1)]),_:2},1032,["props"])]),"body-cell-time_range":t(a=>[e(u,{props:a},{default:t(()=>[r("div",te,[e(v,{name:"schedule",class:"q-mr-sm"}),c(" "+n(a.row.start_time)+" - "+n(a.row.end_time),1)])]),_:2},1032,["props"])]),"body-cell-total_price":t(a=>[e(u,{props:a},{default:t(()=>[r("span",ae,n(i.formatCurrency(a.value)),1)]),_:2},1032,["props"])]),"body-cell-club_name":t(a=>[e(u,{props:a},{default:t(()=>{var d,_;return[c(n(((_=(d=a.row.courts)==null?void 0:d.clubs)==null?void 0:_.name)||"N/A"),1)]}),_:2},1032,["props"])]),"body-cell-court_name":t(a=>[e(u,{props:a},{default:t(()=>{var d;return[c(n(((d=a.row.courts)==null?void 0:d.name)||"N/A"),1)]}),_:2},1032,["props"])]),"body-cell-user_name":t(a=>[e(u,{props:a},{default:t(()=>{var d,_;return[r("div",null,[r("div",le,n(((d=a.row.profiles)==null?void 0:d.full_name)||"N/A"),1),r("div",re,n(((_=a.row.profiles)==null?void 0:_.email)||""),1)])]}),_:2},1032,["props"])]),"body-cell-status":t(a=>[e(u,{props:a},{default:t(()=>[e(A,{color:i.getStatusColor(a.value),label:i.formatStatus(a.value)},null,8,["color","label"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination"])]),_:1})]),_:1}),o.error?(g(),b(q,{key:0,class:"bg-negative text-white q-mt-md"},{avatar:t(()=>[e(v,{name:"error"})]),default:t(()=>[c(" "+n(o.error),1)]),_:1})):Q("",!0)])]),_:1})]),_:1}),e(x)]),_:1})}var Fe=U(H,[["render",se],["__scopeId","data-v-150b90fa"]]);export{Fe as default};
