import{x as de,y as ce,r as n,w as me,h as pe,o as i,z as p,A as o,d as a,B as v,a9 as g,D as y,a7 as P,a8 as b,a as F,ab as j,aa as H,e as V,af as O,E as R,ad as G,ae as X,t as d}from"./index.687b44e8.js";import{Q as ve}from"./QHeader.289f0645.js";import{Q as S}from"./QSelect.8af2919e.js";import{Q as fe}from"./QSpinnerGears.810653c0.js";import{Q as ge}from"./QInnerLoading.ae9b64c1.js";import{Q as J}from"./QItemLabel.bbebea39.js";import{Q as N,a as C}from"./QItem.eb9291fb.js";import{Q as ye}from"./QChip.c9b5cbc6.js";import{Q as K}from"./QList.1288e946.js";import{Q as _e}from"./QBanner.7143372b.js";import{Q as be}from"./QPage.fcc9aae1.js";import{Q as Ce}from"./QSpace.0ef43295.js";import{Q as we,a as he}from"./QLayout.30990248.js";import{C as W}from"./ClosePopup.89fae5e1.js";import{u as Qe}from"./use-quasar.ba375293.js";import{n as Ve}from"./navigationUtils.2c4b9dee.js";import{C as ke}from"./ClubNavigationMenu.44af5278.js";import{l as Ae,c as xe,g as T,a as qe,r as Ie,b as De}from"./courtAccounts.b741342b.js";import{f as Ee}from"./courts.547bbdef.js";import{g as Se}from"./products.03f65746.js";import{_ as Be}from"./plugin-vue_export-helper.21dcd24c.js";import"./QMenu.df8dfc7c.js";import"./position-engine.46674690.js";import"./selection.0f785986.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QTabs.979bee57.js";import"./QFooter.b7b22f15.js";import"./api.1c42dce4.js";import"./supabase.66aa98e2.js";const Le={class:"header-content"},Ue={class:"header-icons"},$e={class:"row items-center justify-between"},Pe={key:0,class:"q-gutter-md"},Fe={class:"text-h6"},Ne={class:"row q-gutter-sm"},Te={class:"text-right q-mt-md text-h6"},Me={__name:"CourtAccounts",setup(ze){const M=de(),c=Qe(),k=ce(),A=n(!1),B=n([]),x=n(null),q=n(!1),I=n(!1),Y=n([]),L=n([]),_=n(null),w=n([]),h=n(0),D=n("efectivo"),f=n({court_id:null,guest_label:""}),s=n({product_id:null,quantity:1}),U=n([]),z=n([]);function Z(l){return l?new Date(l).toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function ee(l){const e=L.value.find(t=>t.id===l);return e?e.name:l}function te(){M.back()}function ae(){Ve(M,k)}async function E(){var l,e;A.value=!0;try{const t=await Ae(x.value||void 0);B.value=t}catch(t){c.notify({type:"negative",message:((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.detail)||"Error al cargar cuentas"})}finally{A.value=!1}}async function oe(){if(!!k.clubId)try{const[l,e]=await Promise.all([Ee(k.clubId),Se(k.clubId)]);Y.value=l||[],L.value=e||[],U.value=(l||[]).map(t=>({id:t.id,name:t.name})),z.value=(e||[]).map(t=>({id:t.id,name:`${t.name} \u2013 $${t.price}`}))}catch(l){console.error(l)}}function le(){var l;f.value={court_id:((l=U.value[0])==null?void 0:l.id)||null,guest_label:""},q.value=!0}async function re(){var l,e;if(!f.value.court_id){c.notify({type:"warning",message:"Elige una cancha"});return}try{await xe({court_id:f.value.court_id,guest_label:f.value.guest_label||void 0}),c.notify({type:"positive",message:"Cuenta abierta"}),q.value=!1,E()}catch(t){c.notify({type:"negative",message:((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.detail)||"Error al crear cuenta"})}}let m=null;async function ue(l){var e,t;m=l;try{const u=await T(l);_.value=u.account,w.value=u.items||[],h.value=u.total||0,D.value="efectivo",I.value=!0}catch(u){c.notify({type:"negative",message:((t=(e=u.response)==null?void 0:e.data)==null?void 0:t.detail)||"Error al cargar cuenta"})}}async function ne(){var t,u;if(!m||!s.value.product_id||!s.value.quantity)return;const l=L.value.find(r=>r.id===s.value.product_id),e=l?parseFloat(l.price):0;try{await qe(m,{club_product_id:s.value.product_id,quantity:s.value.quantity,unit_price:e});const r=await T(m);w.value=r.items||[],h.value=r.total||0,s.value={product_id:null,quantity:1}}catch(r){c.notify({type:"negative",message:((u=(t=r.response)==null?void 0:t.data)==null?void 0:u.detail)||"Error al agregar"})}}async function se(l){var e,t;if(!!m)try{await Ie(m,l);const u=await T(m);w.value=u.items||[],h.value=u.total||0}catch(u){c.notify({type:"negative",message:((t=(e=u.response)==null?void 0:e.data)==null?void 0:t.detail)||"Error al eliminar"})}}async function ie(){var l,e;if(!!m)try{await De(m,D.value),c.notify({type:"positive",message:"Cuenta cerrada y cobrada (registrada en corte)"}),I.value=!1,E()}catch(t){c.notify({type:"negative",message:((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.detail)||"Error al cerrar"})}}return me(x,E),pe(()=>{oe(),E()}),(l,e)=>(i(),p(we,{view:"hHh lpR fFf",class:"body text-white"},{default:o(()=>[a(ve,{elevated:"",class:"text-white"},{default:o(()=>[v("div",Le,[v("div",{class:"greeting"},[v("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:ae}),e[8]||(e[8]=g(" Cuentas por cancha ",-1))]),v("div",Ue,[a(y,{flat:"",round:"",icon:"arrow_back",onClick:te})])])]),_:1}),a(he,null,{default:o(()=>[a(be,{class:"q-pa-md"},{default:o(()=>[a(P,{flat:"",class:"bg-grey-9 q-mb-md"},{default:o(()=>[a(b,null,{default:o(()=>[v("div",$e,[a(S,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),options:[{label:"Todas",value:null},{label:"Abiertas",value:"open"},{label:"Cerradas",value:"closed"}],label:"Estado","emit-value":"","map-options":"",dense:"",outlined:"",color:"white","bg-color":"grey-8",class:"col-grow q-mr-md"},null,8,["modelValue"]),a(y,{color:"primary",icon:"add",label:"Abrir cuenta",onClick:le})])]),_:1})]),_:1}),a(ge,{showing:A.value},{default:o(()=>[a(fe,{size:"50px",color:"primary"})]),_:1},8,["showing"]),A.value?V("",!0):(i(),F("div",Pe,[B.value.length?(i(),p(K,{key:0,bordered:"",class:"rounded-borders bg-grey-9"},{default:o(()=>[(i(!0),F(j,null,H(B.value,t=>(i(),p(N,{key:t.id,clickable:"",onClick:u=>ue(t.id)},{default:o(()=>[a(C,null,{default:o(()=>[a(J,null,{default:o(()=>{var u;return[g(d(((u=t.courts)==null?void 0:u.name)||"Cancha")+" \u2013 "+d(t.guest_label||(t.reservation_id?"Con reserva":"Suelo")),1)]}),_:2},1024),a(J,{caption:""},{default:o(()=>[g(d(t.status==="open"?"Abierta":"Cerrada")+" \xB7 "+d(Z(t.opened_at)),1)]),_:2},1024)]),_:2},1024),a(C,{side:""},{default:o(()=>[a(ye,{color:t.status==="open"?"green":"grey","text-color":"white",size:"sm"},{default:o(()=>[g(d(t.status==="open"?"Abierta":"Cerrada"),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(i(),p(_e,{key:1,class:"bg-grey-8 rounded-borders"},{default:o(()=>[...e[9]||(e[9]=[g(" No hay cuentas. Abre una cuenta para una cancha y agrega consumos. ",-1)])]),_:1}))]))]),_:1}),a(O,{modelValue:q.value,"onUpdate:modelValue":e[3]||(e[3]=t=>q.value=t)},{default:o(()=>[a(P,{class:"bg-grey-9 text-white",style:{"min-width":"320px"}},{default:o(()=>[a(b,null,{default:o(()=>[...e[10]||(e[10]=[v("div",{class:"text-h6"},"Abrir cuenta",-1)])]),_:1}),a(b,{class:"q-gutter-md"},{default:o(()=>[a(S,{modelValue:f.value.court_id,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value.court_id=t),options:U.value,"option-value":"id","option-label":"name",label:"Cancha","emit-value":"","map-options":"",outlined:"",dense:"",color:"white","bg-color":"grey-8"},null,8,["modelValue","options"]),a(R,{modelValue:f.value.guest_label,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value.guest_label=t),label:"Etiqueta (opcional)",outlined:"",dense:"",color:"white","bg-color":"grey-8"},null,8,["modelValue"])]),_:1}),a(G,{align:"right"},{default:o(()=>[X(a(y,{flat:"",label:"Cancelar"},null,512),[[W]]),a(y,{color:"primary",label:"Abrir",onClick:re})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=t=>I.value=t),"full-width":"",persistent:""},{default:o(()=>[a(P,{class:"bg-grey-9 text-white"},{default:o(()=>{var t,u;return[a(b,{class:"row items-center"},{default:o(()=>{var r,Q,$;return[v("div",Fe,d(((Q=(r=_.value)==null?void 0:r.courts)==null?void 0:Q.name)||"Cuenta")+" \u2013 "+d((($=_.value)==null?void 0:$.guest_label)||"Consumos"),1),a(Ce),X(a(y,{flat:"",round:"",icon:"close"},null,512),[[W]])]}),_:1}),((t=_.value)==null?void 0:t.status)==="open"?(i(),p(b,{key:0},{default:o(()=>[v("div",Ne,[a(S,{modelValue:s.value.product_id,"onUpdate:modelValue":e[4]||(e[4]=r=>s.value.product_id=r),options:z.value,"option-value":"id","option-label":"name",label:"Producto","emit-value":"","map-options":"",dense:"",outlined:"",color:"white","bg-color":"grey-8",class:"col"},null,8,["modelValue","options"]),a(R,{modelValue:s.value.quantity,"onUpdate:modelValue":e[5]||(e[5]=r=>s.value.quantity=r),modelModifiers:{number:!0},type:"number",label:"Cant.",dense:"",outlined:"",color:"white","bg-color":"grey-8",class:"col",style:{"max-width":"100px"}},null,8,["modelValue"]),a(y,{color:"primary",icon:"add",label:"Agregar",onClick:ne,disable:!s.value.product_id||!s.value.quantity},null,8,["disable"])])]),_:1})):V("",!0),a(b,null,{default:o(()=>[a(K,{bordered:""},{default:o(()=>[(i(!0),F(j,null,H(w.value,r=>(i(),p(N,{key:r.id},{default:o(()=>{var Q;return[a(C,null,{default:o(()=>[g(d(r.description||ee(r.club_product_id))+d(r.club_product_id?` \xD7 ${r.quantity}`:""),1)]),_:2},1024),a(C,{side:""},{default:o(()=>[g("$ "+d((r.quantity*parseFloat(r.unit_price)).toFixed(2)),1)]),_:2},1024),((Q=_.value)==null?void 0:Q.status)==="open"?(i(),p(C,{key:0,side:""},{default:o(()=>[a(y,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:$=>se(r.id)},null,8,["onClick"])]),_:2},1024)):V("",!0)]}),_:2},1024))),128)),w.value.length===0?(i(),p(N,{key:0},{default:o(()=>[a(C,null,{default:o(()=>[...e[11]||(e[11]=[g("Sin consumos",-1)])]),_:1})]),_:1})):V("",!0)]),_:1}),v("div",Te,"Total: $ "+d((h.value||0).toFixed(2)),1)]),_:1}),((u=_.value)==null?void 0:u.status)==="open"&&h.value>0?(i(),p(G,{key:1,align:"right"},{default:o(()=>[a(S,{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=r=>D.value=r),options:[{label:"Efectivo",value:"efectivo"},{label:"Tarjeta",value:"tarjeta"}],label:"Cobrar con","emit-value":"","map-options":"",dense:"",outlined:"",class:"q-mr-sm",style:{"min-width":"140px"}},null,8,["modelValue"]),a(y,{color:"green",label:"Cerrar y cobrar",onClick:ie})]),_:1})):V("",!0)]}),_:1})]),_:1},8,["modelValue"])]),_:1}),a(ke)]),_:1}))}};var bt=Be(Me,[["__scopeId","data-v-d2447942"]]);export{bt as default};
