import{Q as Pe}from"./QHeader.30ed5ffd.js";import{r as p,x as Se,y as he,bL as Ne,h as Te,a6 as xe,o as i,z as U,A as b,d as t,B as l,bK as ue,E as N,a as m,aa as le,ab as $,a7 as qe,a8 as Qe,e as S,a9 as k,t as _,D as ae,ad as De,af as Ee,aP as Be,ac as W,bG as Ue}from"./index.a0492954.js";import{Q as de}from"./QTooltip.e4efa9d8.js";import{Q as $e}from"./QPage.ba13530a.js";import{Q as Ie,a as Me}from"./QLayout.34772a42.js";import{Q as X}from"./QSelect.a49ffe54.js";import{Q as oe}from"./QChip.a56927f6.js";import{Q as Re,a as ce}from"./QItem.f78ebf7f.js";import{Q as He}from"./QItemLabel.5c5982b3.js";import{Q as ze}from"./QList.87883dfb.js";import{u as Le}from"./use-quasar.5174e024.js";import{c as Fe,a as Ae}from"./lessons.88fc628b.js";import{u as Oe}from"./useDashboardNavigation.899ac9d5.js";import{a as pe}from"./api.fb60109d.js";import{s as se}from"./supabase.6e6ca5a2.js";import{f as je}from"./reservations.863fa680.js";import{f as Ge}from"./lessons.181478ec.js";import{f as Je}from"./clubs.0a13e666.js";import{g as Ke}from"./hourUtils.51636ade.js";import{s as We}from"./commun.c202e6ca.js";import{B as Xe}from"./BannerPromoScrolling.beb49cbe.js";import{C as Ye}from"./ClubNavigationMenu.dfae488b.js";import{C as Ze}from"./ClubTopMenu.46e66090.js";import{N as el}from"./NotificationBell.5a3b411e.js";import{_ as ll}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.f9bd9f7c.js";import"./selection.3cd24490.js";import"./QMenu.c2db426c.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./admin.24c23482.js";import"./QTabs.9c45f5db.js";import"./QFooter.a1ddf79c.js";import"./QBtnDropdown.d976777e.js";import"./QBtnGroup.5f6c94b1.js";import"./haptics.19516dd6.js";import"./QBadge.2e0b0375.js";const al=async V=>{try{return(await pe.post("/blocks/block-court",V)).data}catch(c){throw console.error("Error al crear bloqueo:",c),c}},ol=async V=>{try{return(await pe.delete(`/blocks/delete-block/${V}`)).data}catch(c){throw console.error("Error al eliminar bloqueo:",c),c}},tl=async(V,c)=>{try{const{data:g,error:H}=await se.from("court_blocks").select("*").eq("club_id",c).lte("start_date",V).gte("end_date",V);if(H)throw H;return g}catch(g){throw console.error("Error fetching court blocks:",g),g}},sl=async V=>{const{data:c,error:g}=await se.from("courts").select("id, name").eq("club_id",V);if(g)throw new Error(g.message);return c},rl=async V=>{const{data:c,error:g}=await se.from("courts").select("id, name, price_per_hour, price_per_hour_and_half, price_per_two_hour").eq("id",V);if(g)throw new Error(g.message);return c};const nl={class:"header-content"},il={class:"greeting"},ul={class:"header-icons"},dl={class:"date-selector"},cl={class:"reservation-calendar responsive-table"},pl={class:"reservation-table"},ml=["onClick"],vl={key:0},fl={key:1},bl={key:0},gl={key:0},yl={key:1},_l={key:2},kl={key:1},Vl={key:0},wl={key:1},Cl={key:0},Pl={key:1},Sl={key:2},hl={class:"q-mt-md"},Nl={__name:"ViewSchedule",setup(V){const c=p(new Date().toISOString().split("T")[0]),g=p([]),H=p([]);p([]);const v=p({}),re=Se(),{goToDashboard:ne}=Oe(),E=Le(),T=he().clubId,I=p(!1),Y=p(!1),n=p(null);p({playerName:"",isPaid:!1,eventType:"Reserva"});const z=p(null),L=p([]),x=p(null),y=p(null),w=p(""),F=p(""),te=p([{label:"60 min",value:60},{label:"90 min",value:90},{label:"120 min",value:120}]),C=p(null),me=p([{label:"Reserva",value:"reservation"},{label:"Clase",value:"lesson"},{label:"Bloqueo",value:"block"}]),A=p(""),O=p(""),j=p(null),Z=p(""),ee=p(""),G=p(""),ve=async(o,e)=>{if(!o)return e(()=>L.value=[]);try{const d=await We(o);L.value=d.map(s=>({...s,full_name:`${s.first_name} ${s.last_name}`})),e(()=>L.value=L.value)}catch(d){console.error("Error buscando jugadores:",d)}},ie=()=>{z.value=null,y.value=null,w.value="",A.value="",O.value="",j.value=null,Z.value="",ee.value="",G.value=""},fe=()=>{n.value.type==="reservation"&&n.value.matchId?re.push(`/player/match/${n.value.matchId}?from=club`):n.value.type==="lesson"&&re.push(`/club/clases/${n.value.id}`)},be=()=>{E.dialog({title:"Confirmar",message:"\xBFEst\xE1s seguro de que quieres eliminar este bloqueo?",cancel:!0,persistent:!0}).onOk(async()=>{try{await ol(n.value.id),E.notify({type:"positive",message:"Bloqueo eliminado exitosamente"}),I.value=!1,J()}catch(o){console.error("Error al eliminar bloqueo:",o),E.notify({type:"negative",message:"Error al eliminar el bloqueo"})}})},ge=async()=>{if(console.log("selectedDuration.value:",y.value),console.log("selectedCourtId.value:",x.value),!y.value||!x.value){w.value="No disponible";return}try{const o=await rl(x.value);if(console.log("courtPrices:",o),!o||o.length===0){w.value="No disponible";return}const e=o[0];let d="No disponible";y.value.value===60?(d=e.price_per_hour,console.log("Duraci\xF3n 60, precio:",d)):y.value.value===90?(d=e.price_per_hour_and_half,console.log("Duraci\xF3n 90, precio:",d)):y.value.value===120&&(d=e.price_per_two_hour,console.log("Duraci\xF3n 120, precio:",d)),d==null?(w.value="No disponible",console.log("Precio es null o undefined")):(w.value=d.toString(),console.log("Precio asignado:",w.value))}catch(o){console.error("Error obteniendo precios:",o),w.value="No disponible"}},ye=(o,e)=>{var d;(d=v.value[o])!=null&&d[e]?(n.value=v.value[o][e],Y.value=!1):(x.value=o,F.value=e,Y.value=!0,C.value=null,ie()),I.value=!0},_e=async()=>{if(!C.value||!x.value||!F.value||!y.value){console.error("Faltan datos b\xE1sicos para crear el evento.");return}const o=F.value,e=y.value.value,[d,s]=o.split(":").map(Number);let u=s+e,h=d+Math.floor(u/60);u=u%60;const a=String(h).padStart(2,"0")+":"+String(u).padStart(2,"0");try{if(C.value.value==="reservation"){if(!z.value||!w.value){console.error("Faltan datos para crear la reserva.");return}const r={club_id:T,court_id:x.value,reservation_date:c.value,start_time:o,end_time:a,total_price:w.value,player_id:z.value.user_id};await Fe(r),E.notify({type:"positive",message:"Reserva creada exitosamente"})}else if(C.value.value==="lesson"){if(!A.value||!O.value){console.error("Faltan datos para crear la lecci\xF3n.");return}const r={club_id:T,court_id:x.value,lesson_date:c.value,lesson_time:o+":00",duration:e,coach:O.value,lesson_type:"public",name:A.value,description:ee.value,price:parseFloat(Z.value)||0,max_participants:j.value?parseInt(j.value):null};await Ae(r),E.notify({type:"positive",message:"Lecci\xF3n creada exitosamente"})}else if(C.value.value==="block"){if(!G.value){console.error("Falta la raz\xF3n del bloqueo.");return}const r={court_id:x.value,club_id:T,start_date:c.value,end_date:c.value,start_time:o+":00",end_time:a+":00",reason:G.value};await al(r),E.notify({type:"positive",message:"Bloqueo creado exitosamente"})}console.log("Evento creado exitosamente"),I.value=!1,J()}catch(r){console.error("Error al crear el evento:",r),E.notify({type:"negative",message:"Error al crear el evento"})}},ke=(o,e)=>{var d;if((d=v.value[o])!=null&&d[e]){if(v.value[o][e].type==="block")return"blocked";if(v.value[o][e].type==="reservation")return"occupied";if(v.value[o][e].type==="lesson")return"lesson"}return"available"},J=async()=>{try{const o=await je(c.value,T),e=await tl(c.value,T),d=await Ge(c.value,T),s=o.reduce((a,r)=>{var B,M;const P=r.court_id,K=r.start_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"reservation",playerName:r.profiles.full_name,courtName:r.courts.name,isPaid:r.is_paid,id:r.id,matchId:(M=(B=r.matches)==null?void 0:B[0])==null?void 0:M.id};const[Q,D]=f.split(":").map(Number);let R=D+30,Ce=Q+Math.floor(R/60);if(R=R%60,f=`${String(Ce).padStart(2,"0")}:${String(R).padStart(2,"0")}`,f>q)break}return a},{}),u=d.reduce((a,r)=>{var B;const P=r.court_id,K=r.lesson_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"lesson",lessonName:r.name,coachName:((B=r.coaches)==null?void 0:B.name)||r.coach,lessonType:r.lesson_type,maxParticipants:r.max_participants,currentParticipants:r.players?r.players.length:0,id:r.id,price:r.price};const[M,Q]=f.split(":").map(Number);let D=Q+30,R=M+Math.floor(D/60);if(D=D%60,f=`${String(R).padStart(2,"0")}:${String(D).padStart(2,"0")}`,f>q)break}return a},{}),h=e.reduce((a,r)=>{const P=r.court_id,K=r.start_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"block",isBlock:!0,reason:r.reason,id:r.id};const[B,M]=f.split(":").map(Number);let Q=M+30,D=B+Math.floor(Q/60);if(Q=Q%60,f=`${String(D).padStart(2,"0")}:${String(Q).padStart(2,"0")}`,f>q)break}return a},{});v.value={},v.value=Object.assign({},s,u,h)}catch(o){console.error("Unexpected error:",o.message)}},Ve=async()=>{try{const o=await Je(T),e=o.reduce((s,u)=>u.opening_time<s?u.opening_time:s,o[0].opening_time),d=o.reduce((s,u)=>u.closing_time>s?u.closing_time:s,o[0].closing_time);H.value=Ke(e,d)}catch(o){console.error("Unexpected error:",o.message)}},we=async()=>{try{const o=await sl(T);g.value=o}catch(o){console.error("Unexpected error:",o.message)}};return Ne(()=>{J()}),Te(()=>{we(),Ve(),J()}),(o,e)=>{const d=xe("q-textarea");return i(),U(Ie,{view:"hHh lpR fFf",class:"text-white"},{default:b(()=>[t(Pe,{elevated:"",class:"text-white"},{default:b(()=>[l("div",nl,[l("div",il,[l("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...s)=>ue(ne)&&ue(ne)(...s))})]),l("div",ul,[t(el),t(Ze)])]),t(Xe)]),_:1}),t(Me,null,{default:b(()=>[t($e,{class:"q-pa-md schedule-desktop"},{default:b(()=>[l("div",dl,[t(N,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),type:"date",label:"Selecciona una fecha",outlined:"",dense:"",color:"white","bg-color":"grey-9",onChange:J},null,8,["modelValue"])]),e[19]||(e[19]=l("div",{class:"color-legend q-mt-lg q-mb-md"},[l("div",{class:"legend-items"},[l("div",{class:"legend-item"},[l("div",{class:"legend-color available"}),l("span",null,"Disponible")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color occupied"}),l("span",null,"Reserva")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color lesson"}),l("span",null,"Clase")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color blocked"}),l("span",null,"Bloqueo")])])],-1)),l("div",cl,[l("table",pl,[l("thead",null,[l("tr",null,[e[18]||(e[18]=l("th",null,"Hora",-1)),(i(!0),m($,null,le(g.value,s=>(i(),m("th",{key:s.id},_(s.name),1))),128))])]),l("tbody",null,[(i(!0),m($,null,le(H.value,s=>(i(),m("tr",{key:s},[l("td",null,_(s),1),(i(!0),m($,null,le(g.value,u=>{var h;return i(),m("td",{key:u.id,class:Be(ke(u.id,s)),onClick:a=>ye(u.id,s)},[(h=v.value[u.id])!=null&&h[s]?(i(),m("div",vl,[v.value[u.id][s].type==="reservation"?(i(),m($,{key:0},[l("strong",null,_(v.value[u.id][s].playerName),1),v.value[u.id][s].isPaid?(i(),U(W,{key:0,name:"o_paid",color:"green",size:"sm",class:"q-ml-sm"})):(i(),U(W,{key:1,name:"money_off",color:"red",size:"sm",class:"q-ml-sm"}))],64)):v.value[u.id][s].type==="lesson"?(i(),m($,{key:1},[l("strong",null,_(v.value[u.id][s].lessonName),1),t(W,{name:"school",color:"blue",size:"sm",class:"q-ml-sm"}),t(de,null,{default:b(()=>[k("Instructor: "+_(v.value[u.id][s].coachName),1)]),_:2},1024)],64)):v.value[u.id][s].type==="block"?(i(),m($,{key:2},[t(de,null,{default:b(()=>[k(_(v.value[u.id][s].reason),1)]),_:2},1024),t(W,{name:"block",color:"red",size:"xs"})],64)):S("",!0)])):(i(),m("div",fl,[t(W,{name:"add",color:"primary",size:"xs"})]))],10,ml)}),128))]))),128))])])])]),_:1})]),_:1}),t(Ee,{modelValue:I.value,"onUpdate:modelValue":e[17]||(e[17]=s=>I.value=s)},{default:b(()=>[t(qe,{class:"bg-black"},{default:b(()=>[t(Qe,null,{default:b(()=>{var s,u,h;return[Y.value?(i(),m("div",bl,[e[20]||(e[20]=l("h6",null,"Crear Evento",-1)),t(X,{modelValue:C.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>C.value=a),ie],options:me.value,label:"Tipo de evento"},null,8,["modelValue","options"]),((s=C.value)==null?void 0:s.value)==="reservation"?(i(),m("div",gl,[t(X,{modelValue:z.value,"onUpdate:modelValue":e[3]||(e[3]=a=>z.value=a),"use-input":"","fill-input":"","input-debounce":"300",label:"Buscar jugador",options:L.value,"option-label":"full_name","option-value":"user_id",onFilter:ve},null,8,["modelValue","options"]),t(X,{modelValue:y.value,"onUpdate:modelValue":[e[4]||(e[4]=a=>y.value=a),ge],options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"]),t(N,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=a=>w.value=a),label:"Precio",disable:""},null,8,["modelValue"])])):S("",!0),((u=C.value)==null?void 0:u.value)==="lesson"?(i(),m("div",yl,[t(N,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=a=>A.value=a),label:"Nombre de la clase"},null,8,["modelValue"]),t(N,{modelValue:O.value,"onUpdate:modelValue":e[7]||(e[7]=a=>O.value=a),label:"Instructor"},null,8,["modelValue"]),t(X,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"]),t(N,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=a=>j.value=a),type:"number",label:"M\xE1ximo participantes"},null,8,["modelValue"]),t(N,{modelValue:Z.value,"onUpdate:modelValue":e[10]||(e[10]=a=>Z.value=a),type:"number",label:"Precio por persona"},null,8,["modelValue"]),t(d,{modelValue:ee.value,"onUpdate:modelValue":e[11]||(e[11]=a=>ee.value=a),label:"Descripci\xF3n (opcional)"},null,8,["modelValue"])])):S("",!0),((h=C.value)==null?void 0:h.value)==="block"?(i(),m("div",_l,[t(N,{modelValue:G.value,"onUpdate:modelValue":e[12]||(e[12]=a=>G.value=a),label:"Raz\xF3n del bloqueo"},null,8,["modelValue"]),t(X,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=a=>y.value=a),options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"])])):S("",!0),t(N,{modelValue:c.value,"onUpdate:modelValue":e[14]||(e[14]=a=>c.value=a),label:"Fecha",disable:""},null,8,["modelValue"]),t(N,{modelValue:F.value,"onUpdate:modelValue":e[15]||(e[15]=a=>F.value=a),label:"Hora de inicio",disable:""},null,8,["modelValue"])])):(i(),m("div",kl,[e[34]||(e[34]=l("h6",null,"Detalles del Evento",-1)),n.value.type==="reservation"?(i(),m("div",Vl,[e[24]||(e[24]=l("p",null,[l("strong",null,"Tipo:"),k(" Reserva")],-1)),l("p",null,[e[21]||(e[21]=l("strong",null,"Jugador:",-1)),k(" "+_(n.value.playerName),1)]),l("p",null,[e[22]||(e[22]=l("strong",null,"Cancha:",-1)),k(" "+_(n.value.courtName),1)]),l("p",null,[e[23]||(e[23]=l("strong",null,"Estado de pago:",-1)),t(oe,{color:n.value.isPaid?"green":"red","text-color":"white",icon:n.value.isPaid?"check_circle":"pending",label:n.value.isPaid?"Pagado":"Pendiente"},null,8,["color","icon","label"])])])):n.value.type==="lesson"?(i(),m("div",wl,[e[31]||(e[31]=l("p",null,[l("strong",null,"Tipo:"),k(" Clase")],-1)),l("p",null,[e[25]||(e[25]=l("strong",null,"Nombre:",-1)),k(" "+_(n.value.lessonName),1)]),l("p",null,[e[26]||(e[26]=l("strong",null,"Instructor:",-1)),k(" "+_(n.value.coachName),1)]),l("p",null,[e[27]||(e[27]=l("strong",null,"Tipo de clase:",-1)),t(oe,{color:n.value.lessonType==="private"?"purple":"blue","text-color":"white",label:n.value.lessonType==="private"?"Privada":"Grupal"},null,8,["color","label"])]),l("p",null,[e[28]||(e[28]=l("strong",null,"Participantes:",-1)),t(oe,{color:"blue","text-color":"white",label:`${n.value.currentParticipants}/${n.value.maxParticipants||"\u221E"}`},null,8,["label"])]),n.value.price?(i(),m("p",Cl,[e[29]||(e[29]=l("strong",null,"Precio:",-1)),k(" $"+_(n.value.price),1)])):S("",!0),n.value.lessonType==="public"&&n.value.currentParticipants>0?(i(),m("div",Pl,[e[30]||(e[30]=l("p",null,[l("strong",null,"Participantes inscritos:")],-1)),t(ze,{dense:""},{default:b(()=>[(i(!0),m($,null,le(n.value.currentParticipants,a=>(i(),U(Re,{key:a,dense:""},{default:b(()=>[t(ce,{avatar:""},{default:b(()=>[t(Ue,{size:"sm",color:"blue","text-color":"white"},{default:b(()=>[k(_(a),1)]),_:2},1024)]),_:2},1024),t(ce,null,{default:b(()=>[t(He,{caption:""},{default:b(()=>[k("Participante "+_(a),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):S("",!0)])):n.value.type==="block"?(i(),m("div",Sl,[e[33]||(e[33]=l("p",null,[l("strong",null,"Tipo:"),k(" Bloqueo")],-1)),l("p",null,[e[32]||(e[32]=l("strong",null,"Raz\xF3n:",-1)),k(" "+_(n.value.reason),1)]),t(oe,{color:"red","text-color":"white",icon:"block",label:"Cancha bloqueada"})])):S("",!0),l("div",hl,[n.value.type!=="block"?(i(),U(ae,{key:0,flat:"",color:"primary",label:"Ver m\xE1s detalles",onClick:fe})):S("",!0),n.value.type==="block"?(i(),U(ae,{key:1,flat:"",color:"negative",label:"Eliminar bloqueo",onClick:be})):S("",!0)])]))]}),_:1}),t(De,{align:"right"},{default:b(()=>[Y.value?(i(),U(ae,{key:0,label:"Guardar",color:"green",disable:!C.value,onClick:_e},null,8,["disable"])):S("",!0),t(ae,{label:"Cerrar",color:"negative",onClick:e[16]||(e[16]=s=>I.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ye)]),_:1})}}};var pa=ll(Nl,[["__scopeId","data-v-22233d60"]]);export{pa as default};
