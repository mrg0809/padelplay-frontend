import{Q as R}from"./QHeader.289f0645.js";import{a5 as S,f as P,a6 as u,o as m,z as _,A as t,d as e,B as a,D as y,a7 as f,a8 as p,E as w,t as i,a9 as g,ac as x,e as V}from"./index.687b44e8.js";import{Q as M}from"./QSelect.8af2919e.js";import{Q as c}from"./QTd.aec4174c.js";import{Q as T}from"./QBadge.0c3a126f.js";import{Q as B}from"./QTable.d55388d6.js";import{Q as I}from"./QBanner.7143372b.js";import{Q as q}from"./QPage.fcc9aae1.js";import{Q as F,a as U}from"./QLayout.30990248.js";import{B as H,b as E,e as L}from"./BannerPromoScrolling.1700e538.js";import{A as O}from"./AdminNavigationMenu.f2a013a2.js";import{S as X}from"./SuperuserNavigationMenu.fa61df71.js";import{A as z}from"./AdminTopMenu.86b099e2.js";import{S as W}from"./SuperuserTopMenu.ed9d82e7.js";import{N as j}from"./NotificationBell.9fdba392.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.c9b5cbc6.js";import"./QItem.eb9291fb.js";import"./QItemLabel.bbebea39.js";import"./QMenu.df8dfc7c.js";import"./position-engine.46674690.js";import"./selection.0f785986.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QList.1288e946.js";import"./QMarkupTable.41f62a4b.js";import"./use-fullscreen.637c26ee.js";import"./api.1c42dce4.js";import"./QTabs.979bee57.js";import"./QFooter.b7b22f15.js";import"./QBtnDropdown.17175f2e.js";import"./QBtnGroup.6b9d07ee.js";import"./haptics.57409bd0.js";const J={name:"AdminReservations",components:{AdminNavigationMenu:O,SuperuserNavigationMenu:X,AdminTopMenu:z,SuperuserTopMenu:W,NotificationBell:j,BannerPromoScrolling:H},setup(){const s=S();return{isAdminPath:P(()=>s.path.startsWith("/admin"))}},data(){return{reservationData:{reservations:[],total_count:0},clubOptions:[],filters:{startDate:"",endDate:"",clubId:null},loading:!1,error:null,pagination:{rowsPerPage:15},columns:[{name:"reservation_date",required:!0,label:"Fecha",align:"left",field:"reservation_date",sortable:!0},{name:"time_range",label:"Horario",align:"left",field:"time_range"},{name:"user_name",label:"Usuario",align:"left",field:"user_name"},{name:"club_name",label:"Club",align:"left",field:"club_name"},{name:"court_name",label:"Cancha",align:"left",field:"court_name"},{name:"total_price",label:"Precio",align:"right",field:"total_price",sortable:!0},{name:"status",label:"Estado",align:"center",field:"status"}]}},computed:{totalRevenue(){return this.reservationData.reservations.reduce((s,l)=>s+(parseFloat(l.total_price)||0),0)},averagePrice(){return this.reservationData.reservations.length>0?this.totalRevenue/this.reservationData.reservations.length:0},totalHours(){return this.reservationData.reservations.reduce((s,l)=>{const b=new Date(`1970-01-01T${l.start_time}:00`),r=(new Date(`1970-01-01T${l.end_time}:00`)-b)/(1e3*60*60);return s+(r>0?r:0)},0).toFixed(1)}},async mounted(){await this.loadClubs(),await this.loadReservations()},methods:{async loadClubs(){try{const s=await E();this.clubOptions=[{label:"Todos los clubes",value:null},...s.clubs.map(l=>({label:l.name,value:l.id}))]}catch(s){console.error("Error loading clubs:",s)}},async loadReservations(){this.loading=!0,this.error=null;try{const s={startDate:this.filters.startDate||void 0,endDate:this.filters.endDate||void 0,clubId:this.filters.clubId||void 0};this.reservationData=await L(s)}catch(s){this.error="Error al cargar las reservas: "+s.message,console.error("Error loading reservations:",s)}finally{this.loading=!1}},clearFilters(){this.filters={startDate:"",endDate:"",clubId:null},this.loadReservations()},formatCurrency(s){return s?new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(s):"$0.00"},formatDate(s){return s?new Date(s).toLocaleDateString("es-MX"):"N/A"},formatStatus(s){return{confirmed:"Confirmada",completed:"Completada",cancelled:"Cancelada",pending:"Pendiente"}[s]||s},getStatusColor(s){return{confirmed:"positive",completed:"blue",cancelled:"negative",pending:"warning"}[s]||"grey"}}},K={class:"header-content"},Y={class:"header-icons"},Z={class:"q-pa-md"},$={class:"row q-mb-md"},ee={class:"col"},te={class:"row q-gutter-md items-end"},ae={class:"col-md-3 col-sm-6"},oe={class:"col-md-3 col-sm-6"},le={class:"col-md-4 col-sm-12"},se={class:"col-auto"},re={class:"row q-gutter-md q-mb-lg"},ne={class:"col-md-3"},ie={class:"text-h4 text-primary"},de={class:"col-md-3"},ce={class:"text-h4 text-positive"},ue={class:"col-md-3"},me={class:"text-h4 text-secondary"},_e={class:"col-md-3"},fe={class:"text-h4 text-info"},pe={class:"time-range"},ve={class:"text-weight-bold text-positive"},ge={class:"text-weight-medium"},he={class:"text-caption text-grey-5"};function be(s,l,b,h,r,n){const D=u("NotificationBell"),C=u("AdminTopMenu"),A=u("SuperuserTopMenu"),Q=u("BannerPromoScrolling"),N=u("AdminNavigationMenu"),k=u("SuperuserNavigationMenu");return m(),_(F,{view:"hHh lpR fFf",class:"bg-dark text-white layout-with-bottom-nav"},{default:t(()=>[e(R,{elevated:"",class:"text-white admin-header"},{default:t(()=>[a("div",K,[l[3]||(l[3]=a("div",{class:"greeting"},[a("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),a("span",{class:"text-subtitle1"},"Reservas")],-1)),a("div",Y,[e(D),h.isAdminPath?(m(),_(C,{key:0})):(m(),_(A,{key:1}))])]),e(Q)]),_:1}),e(U,null,{default:t(()=>[e(q,{padding:"",class:"bg-dark"},{default:t(()=>[a("div",Z,[a("div",$,[a("div",ee,[e(y,{flat:"",icon:"refresh",onClick:n.loadReservations,loading:r.loading,label:"Actualizar",color:"white"},null,8,["onClick","loading"])])]),e(f,{class:"filter-card q-mb-md"},{default:t(()=>[e(p,null,{default:t(()=>[a("div",te,[a("div",ae,[e(w,{modelValue:r.filters.startDate,"onUpdate:modelValue":[l[0]||(l[0]=o=>r.filters.startDate=o),n.loadReservations],type:"date",label:"Fecha inicio",filled:"",dark:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",oe,[e(w,{modelValue:r.filters.endDate,"onUpdate:modelValue":[l[1]||(l[1]=o=>r.filters.endDate=o),n.loadReservations],type:"date",label:"Fecha fin",filled:"",dark:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",le,[e(M,{modelValue:r.filters.clubId,"onUpdate:modelValue":[l[2]||(l[2]=o=>r.filters.clubId=o),n.loadReservations],options:r.clubOptions,"option-value":"value","option-label":"label",label:"Filtrar por club",filled:"",dark:"",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"])]),a("div",se,[e(y,{flat:"",icon:"clear",color:"grey-7",onClick:n.clearFilters,label:"Limpiar"},null,8,["onClick"])])])]),_:1})]),_:1}),a("div",re,[a("div",ne,[e(f,{class:"summary-card"},{default:t(()=>[e(p,null,{default:t(()=>[l[4]||(l[4]=a("div",{class:"text-h6 text-white"},"Total Reservas",-1)),a("div",ie,i(r.reservationData.total_count),1)]),_:1})]),_:1})]),a("div",de,[e(f,{class:"summary-card"},{default:t(()=>[e(p,null,{default:t(()=>[l[5]||(l[5]=a("div",{class:"text-h6 text-white"},"Ingresos Total",-1)),a("div",ce,i(n.formatCurrency(n.totalRevenue)),1)]),_:1})]),_:1})]),a("div",ue,[e(f,{class:"summary-card"},{default:t(()=>[e(p,null,{default:t(()=>[l[6]||(l[6]=a("div",{class:"text-h6 text-white"},"Precio Promedio",-1)),a("div",me,i(n.formatCurrency(n.averagePrice)),1)]),_:1})]),_:1})]),a("div",_e,[e(f,{class:"summary-card"},{default:t(()=>[e(p,null,{default:t(()=>[l[7]||(l[7]=a("div",{class:"text-h6 text-white"},"Horas Totales",-1)),a("div",fe,i(n.totalHours)+"h ",1)]),_:1})]),_:1})])]),e(f,{class:"table-card"},{default:t(()=>[e(p,{class:"q-pa-none"},{default:t(()=>[e(B,{rows:r.reservationData.reservations,columns:r.columns,"row-key":"id",flat:"",dark:"",loading:r.loading,pagination:r.pagination},{"body-cell-reservation_date":t(o=>[e(c,{props:o},{default:t(()=>[g(i(n.formatDate(o.value)),1)]),_:2},1032,["props"])]),"body-cell-time_range":t(o=>[e(c,{props:o},{default:t(()=>[a("div",pe,[e(x,{name:"schedule",class:"q-mr-sm"}),g(" "+i(o.row.start_time)+" - "+i(o.row.end_time),1)])]),_:2},1032,["props"])]),"body-cell-total_price":t(o=>[e(c,{props:o},{default:t(()=>[a("span",ve,i(n.formatCurrency(o.value)),1)]),_:2},1032,["props"])]),"body-cell-club_name":t(o=>[e(c,{props:o},{default:t(()=>{var d,v;return[g(i(((v=(d=o.row.courts)==null?void 0:d.clubs)==null?void 0:v.name)||"N/A"),1)]}),_:2},1032,["props"])]),"body-cell-court_name":t(o=>[e(c,{props:o},{default:t(()=>{var d;return[g(i(((d=o.row.courts)==null?void 0:d.name)||"N/A"),1)]}),_:2},1032,["props"])]),"body-cell-user_name":t(o=>[e(c,{props:o},{default:t(()=>{var d,v;return[a("div",null,[a("div",ge,i(((d=o.row.profiles)==null?void 0:d.full_name)||"N/A"),1),a("div",he,i(((v=o.row.profiles)==null?void 0:v.email)||""),1)])]}),_:2},1032,["props"])]),"body-cell-status":t(o=>[e(c,{props:o},{default:t(()=>[e(T,{color:n.getStatusColor(o.value),label:n.formatStatus(o.value)},null,8,["color","label"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination"])]),_:1})]),_:1}),r.error?(m(),_(I,{key:0,class:"bg-negative text-white q-mt-md"},{avatar:t(()=>[e(x,{name:"error"})]),default:t(()=>[g(" "+i(r.error),1)]),_:1})):V("",!0)])]),_:1})]),_:1}),h.isAdminPath?(m(),_(N,{key:0})):(m(),_(k,{key:1}))]),_:1})}var $e=G(J,[["render",be],["__scopeId","data-v-ff63ffba"]]);export{$e as default};
