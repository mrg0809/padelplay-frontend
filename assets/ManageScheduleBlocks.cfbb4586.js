import{y as U,a6 as x,o as u,z as f,A as a,d as l,B as n,a9 as S,D as k,a7 as q,a8 as C,a as p,Q as H,ac as r,ae as g,af as Q,e as D,E as d,ad as B}from"./index.a0492954.js";import{Q as M}from"./QHeader.30ed5ffd.js";import{Q as Y}from"./QTd.a13ab39d.js";import{Q as I}from"./QTable.d1eadde1.js";import{Q as w,a as F}from"./QItem.f78ebf7f.js";import{Q as E}from"./QList.87883dfb.js";import{Q as N}from"./QMenu.c2db426c.js";import{Q as T}from"./QSelect.a49ffe54.js";import{Q as _,a as V}from"./QTime.1fd8b234.js";import{Q as b}from"./QPopupProxy.11541dfb.js";import{Q as P}from"./QPage.ba13530a.js";import{Q as R,a as z}from"./QLayout.34772a42.js";import{C as h}from"./ClosePopup.5f41115c.js";import{n as A}from"./navigationUtils.2c4b9dee.js";import{C as L}from"./ClubNavigationMenu.dfae488b.js";import{a as y,g as O}from"./api.fb60109d.js";import{s as j}from"./supabase.6e6ca5a2.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import"./QMarkupTable.f8726413.js";import"./use-fullscreen.576a914f.js";import"./position-engine.f9bd9f7c.js";import"./selection.3cd24490.js";import"./QChip.a56927f6.js";import"./QItemLabel.5c5982b3.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./use-render-cache.3aae9b27.js";import"./TouchPan.538d5657.js";import"./touch.9135741d.js";import"./QTabs.9c45f5db.js";import"./QFooter.a1ddf79c.js";const J={data(){return{confirmDialogVisible:!1,blockCourtDialogVisible:!1,blockClubDialogVisible:!1,blockClubData:{block_type:null,start_date:null,start_time:null,end_date:null,end_time:null,reason:""},blockCourtData:{block_type:null,court_id:null,start_date:null,start_time:null,end_date:null,end_time:null,reason:""},blockType:"Fecha",courts:[],futureBlocks:[],loading:!1,columns:[{name:"court_name",label:"Cancha",field:"court_name",align:"left"},{name:"start_date",label:"Fecha Inicio",field:"start_date",align:"left"},{name:"start_time",label:"Hora Inicio",field:"start_time",align:"left"},{name:"end_date",label:"Fecha Fin",field:"end_date",align:"left"},{name:"end_time",label:"Hora Fin",field:"end_time",align:"left"},{name:"reason",label:"Raz\xF3n",field:"reason",align:"left"},{name:"actions",label:"Acciones",field:"actions",align:"center"}]}},components:{ClubNavigationMenu:L},setup(){return{userStore:U()}},methods:{async fetchCourts(){try{const s=await y.get("/courts/");this.courts=s.data.map(e=>({id:e.id,name:e.name,club_id:e.club_id}))}catch(s){console.error("Error al obtener las canchas:",s)}},async fetchFutureBlocks(){this.loading=!0;try{const s=O();if(!s||!s.club_id)throw new Error("No se pudo obtener el club_id del usuario.");const e=new Date().toISOString().split("T")[0],{data:c,error:m}=await j.from("court_blocks").select("*, courts(name)").eq("club_id",s.club_id).gte("start_date",e).order("start_date",{ascending:!0});if(m)throw m;this.futureBlocks=c.map(t=>({...t,court_name:t.courts.name}))}catch(s){console.error("Error al obtener los bloqueos futuros:",s),this.$q.notify({type:"negative",message:"Error al cargar los bloqueos futuros"})}finally{this.loading=!1}},goToBlockClubPage(){this.blockClubDialogVisible=!0},goToBlockCourtPage(){this.blockCourtDialogVisible=!0},goBack(){this.$router.back()},goToDashboard(){A(this.$router,this.userStore)},async blockClub(){try{if(this.blockType==="Fecha"&&!this.blockClubData.start_date)return this.$q.notify({type:"negative",message:"Selecciona una fecha"});if(this.blockType==="Rango"&&(!this.blockClubData.start_date||!this.blockClubData.end_date))return this.$q.notify({type:"negative",message:"Selecciona un rango de fechas v\xE1lido"});let s=this.blockClubData.start_date,e=this.blockClubData.end_date,c=this.blockClubData.start_time,m=this.blockClubData.end_time;this.blockType==="Fecha"&&(s=e=this.blockClubData.start_date,c="00:00",m="23:59");const i={courts:this.courts.map(v=>v.id),club_id:this.courts[0].club_id,start_date:s,start_time:c,end_date:e,end_time:m,reason:this.blockClubData.reason};await y.post("/block/block-club",i),this.$q.notify({type:"positive",message:"Club bloqueado exitosamente"}),this.blockClubDialogVisible=!1,this.blockClubData={club_id:null,start_date:null,start_time:null,end_date:null,end_time:null,reason:""}}catch(s){console.error("Error al bloquear el club:",s),this.$q.notify({type:"negative",message:"Error al bloquear el club. Intenta nuevamente."})}},async blockCourt(){try{if(!this.blockCourtData.court_id)return this.$q.notify({type:"negative",message:"Selecciona una cancha"});if(this.blockType==="Fecha"&&!this.blockCourtData.start_date)return this.$q.notify({type:"negative",message:"Selecciona una fecha"});if(this.blockType==="Rango"&&(!this.blockCourtData.start_date||!this.blockCourtData.end_date))return this.$q.notify({type:"negative",message:"Selecciona un rango de fechas v\xE1lido"});let s=this.blockCourtData.start_date,e=this.blockCourtData.end_date,c=this.blockCourtData.start_time,m=this.blockCourtData.end_time;this.blockType==="Fecha"&&(s=e=this.blockCourtData.start_date,c="00:00",m="23:59");const t={court_id:this.blockCourtData.court_id.id,club_id:this.courts[0].club_id,start_date:s,start_time:c,end_date:e,end_time:m,reason:this.blockCourtData.reason};await y.post("/block/block-court",t),this.$q.notify({type:"positive",message:"Cancha bloqueada exitosamente"}),this.blockCourtDialogVisible=!1,this.blockCourtData={court_id:null,club_id:null,date:null,start_date:null,start_time:null,end_date:null,end_time:null,reason:""}}catch(s){console.error("Error al bloquear la cancha:",s),this.$q.notify({type:"negative",message:"Error al bloquear la cancha. Intenta nuevamente."})}},async deleteBlock(s){try{await y.delete(`block/delete-block/${s}`),this.$q.notify({type:"positive",message:"Bloqueo eliminado exitosamente."}),await this.fetchFutureBlocks()}catch(e){console.error("Error al eliminar el bloqueo:",e),this.$q.notify({type:"negative",message:"Error al eliminar el bloqueo. Intenta nuevamente."})}}},mounted(){this.fetchCourts(),this.fetchFutureBlocks()}},K={class:"header-content"},W={class:"greeting"},X={class:"header-icons"},Z={key:0,class:"text-center q-pa-md"},$={key:1,class:"text-center q-pa-md"},ee={key:0,class:"q-gutter-y-md"},le={key:1,class:"q-gutter-y-md"},te={key:0,class:"q-gutter-y-md"},oe={key:1,class:"q-gutter-y-md"};function ae(s,e,c,m,t,i){const v=x("ClubNavigationMenu");return u(),f(R,{view:"hHh lpR fFf",class:"body text-black"},{default:a(()=>[l(M,{elevated:"",class:"bg-primary text-white"},{default:a(()=>[n("div",K,[n("div",W,[n("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...o)=>i.goToDashboard&&i.goToDashboard(...o))}),e[26]||(e[26]=S(" Bloquear horarios ",-1))]),n("div",X,[l(k,{flat:"",round:"",icon:"close",onClick:i.goBack},null,8,["onClick"])])])]),_:1}),l(z,null,{default:a(()=>[l(P,{class:"q-pa-md"},{default:a(()=>[l(q,{class:"transparent-card q-mb-md"},{default:a(()=>[l(C,null,{default:a(()=>[...e[27]||(e[27]=[n("div",{class:"text-h6"},"Bloqueos Futuros",-1)])]),_:1}),l(C,null,{default:a(()=>[t.loading?(u(),p("div",Z,[l(H,{color:"primary",size:"xl"}),e[28]||(e[28]=n("p",{class:"q-mt-sm"},"Cargando bloqueos...",-1))])):t.futureBlocks.length===0?(u(),p("div",$,[l(r,{name:"o_event_busy",size:"2em"}),e[29]||(e[29]=n("p",{class:"q-mt-sm"},"No tienes bloqueos programados.",-1))])):(u(),f(I,{key:2,rows:t.futureBlocks,columns:t.columns,"row-key":"id",flat:"",bordered:"",class:"transparent-table"},{"body-cell-actions":a(o=>[l(Y,{props:o},{default:a(()=>[l(k,{flat:"",round:"",color:"negative",icon:"delete",onClick:se=>i.deleteBlock(o.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]))]),_:1})]),_:1}),l(k,{glossy:"",round:"",size:"lg",color:"black",icon:"add",class:"fixed-bottom-right q-mb-xl"},{default:a(()=>[l(N,{anchor:"top end",self:"bottom end"},{default:a(()=>[l(E,{style:{"min-width":"150px"}},{default:a(()=>[g((u(),f(w,{clickable:"",onClick:i.goToBlockClubPage},{default:a(()=>[l(r,{name:"o_block",size:"md",rounded:""}),l(F,null,{default:a(()=>[...e[30]||(e[30]=[n("strong",null,"Bloquear club",-1)])]),_:1})]),_:1},8,["onClick"])),[[h]]),g((u(),f(w,{clickable:"",onClick:i.goToBlockCourtPage},{default:a(()=>[l(r,{name:"o_event_busy",size:"md",rounded:""}),l(F,null,{default:a(()=>[...e[31]||(e[31]=[n("strong",null,"Bloquear cancha",-1)])]),_:1})]),_:1},8,["onClick"])),[[h]])]),_:1})]),_:1})]),_:1}),l(Q,{modelValue:t.blockClubDialogVisible,"onUpdate:modelValue":e[12]||(e[12]=o=>t.blockClubDialogVisible=o)},{default:a(()=>[l(q,{class:"bg-black text-white"},{default:a(()=>[l(C,null,{default:a(()=>[e[32]||(e[32]=n("div",{class:"text-h6"},"Bloquear Club",-1)),l(T,{modelValue:t.blockType,"onUpdate:modelValue":e[1]||(e[1]=o=>t.blockType=o),options:["Fecha","Rango"],label:"Tipo de bloqueo",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t.blockType==="Fecha"?(u(),p("div",ee,[l(_,{modelValue:t.blockClubData.start_date,"onUpdate:modelValue":e[2]||(e[2]=o=>t.blockClubData.start_date=o),label:"Fecha",dense:""},null,8,["modelValue"])])):D("",!0),t.blockType==="Rango"?(u(),p("div",le,[l(d,{modelValue:t.blockClubData.start_date,"onUpdate:modelValue":e[4]||(e[4]=o=>t.blockClubData.start_date=o),label:"Fecha de Inicio",outlined:"",dense:"",mask:"####-##-##"},{append:a(()=>[l(r,{name:"event",class:"cursor-pointer"},{default:a(()=>[l(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(_,{modelValue:t.blockClubData.start_date,"onUpdate:modelValue":e[3]||(e[3]=o=>t.blockClubData.start_date=o),mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(d,{modelValue:t.blockClubData.start_time,"onUpdate:modelValue":e[6]||(e[6]=o=>t.blockClubData.start_time=o),label:"Hora de Inicio",outlined:"",dense:"",mask:"##:##"},{append:a(()=>[l(r,{name:"access_time",class:"cursor-pointer"},{default:a(()=>[l(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(V,{modelValue:t.blockClubData.start_time,"onUpdate:modelValue":e[5]||(e[5]=o=>t.blockClubData.start_time=o),mask:"HH:mm",format24h:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(d,{modelValue:t.blockClubData.end_date,"onUpdate:modelValue":e[8]||(e[8]=o=>t.blockClubData.end_date=o),label:"Fecha de Fin",outlined:"",dense:"",mask:"####-##-##"},{append:a(()=>[l(r,{name:"event",class:"cursor-pointer"},{default:a(()=>[l(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(_,{modelValue:t.blockClubData.end_date,"onUpdate:modelValue":e[7]||(e[7]=o=>t.blockClubData.end_date=o),mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(d,{modelValue:t.blockClubData.end_time,"onUpdate:modelValue":e[10]||(e[10]=o=>t.blockClubData.end_time=o),label:"Hora de Fin",outlined:"",dense:"",mask:"##:##"},{append:a(()=>[l(r,{name:"access_time",class:"cursor-pointer"},{default:a(()=>[l(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(V,{modelValue:t.blockClubData.end_time,"onUpdate:modelValue":e[9]||(e[9]=o=>t.blockClubData.end_time=o),mask:"HH:mm",format24h:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):D("",!0),l(d,{modelValue:t.blockClubData.reason,"onUpdate:modelValue":e[11]||(e[11]=o=>t.blockClubData.reason=o),label:"Motivo",outlined:"",dense:"",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),l(B,{align:"right"},{default:a(()=>[g(l(k,{flat:"",label:"Cancelar",color:"primary"},null,512),[[h]]),l(k,{flat:"",label:"Bloquear",color:"negative",onClick:i.blockClub},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Q,{modelValue:t.blockCourtDialogVisible,"onUpdate:modelValue":e[25]||(e[25]=o=>t.blockCourtDialogVisible=o)},{default:a(()=>[l(q,{class:"bg-black text-white"},{default:a(()=>[l(C,null,{default:a(()=>[e[33]||(e[33]=n("div",{class:"text-h6"},"Bloquear Cancha",-1)),l(T,{modelValue:t.blockCourtData.court_id,"onUpdate:modelValue":e[13]||(e[13]=o=>t.blockCourtData.court_id=o),options:t.courts,"option-label":"name","option-value":"id",label:"Seleccionar Cancha",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue","options"]),l(T,{modelValue:t.blockType,"onUpdate:modelValue":e[14]||(e[14]=o=>t.blockType=o),options:["Fecha","Rango"],label:"Tipo de bloqueo",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t.blockType==="Fecha"?(u(),p("div",te,[l(_,{modelValue:t.blockCourtData.start_date,"onUpdate:modelValue":e[15]||(e[15]=o=>t.blockCourtData.start_date=o),label:"Fecha",dense:"",color:"orange"},null,8,["modelValue"])])):D("",!0),t.blockType==="Rango"?(u(),p("div",oe,[l(d,{modelValue:t.blockCourtData.start_date,"onUpdate:modelValue":e[17]||(e[17]=o=>t.blockCourtData.start_date=o),label:"Fecha de Inicio",outlined:"",dense:"",mask:"####-##-##"},{append:a(()=>[l(r,{name:"event",class:"cursor-pointer"},{default:a(()=>[l(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(_,{modelValue:t.blockCourtData.start_date,"onUpdate:modelValue":e[16]||(e[16]=o=>t.blockCourtData.start_date=o),mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(d,{modelValue:t.blockCourtData.start_time,"onUpdate:modelValue":e[19]||(e[19]=o=>t.blockCourtData.start_time=o),label:"Hora de Inicio",outlined:"",dense:"",mask:"##:##"},{append:a(()=>[l(r,{name:"access_time",class:"cursor-pointer"},{default:a(()=>[l(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(V,{modelValue:t.blockCourtData.start_time,"onUpdate:modelValue":e[18]||(e[18]=o=>t.blockCourtData.start_time=o),mask:"HH:mm",format24h:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(d,{modelValue:t.blockCourtData.end_date,"onUpdate:modelValue":e[21]||(e[21]=o=>t.blockCourtData.end_date=o),label:"Fecha de Fin",outlined:"",dense:"",mask:"####-##-##"},{append:a(()=>[l(r,{name:"event",class:"cursor-pointer"},{default:a(()=>[l(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(_,{modelValue:t.blockCourtData.end_date,"onUpdate:modelValue":e[20]||(e[20]=o=>t.blockCourtData.end_date=o),mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(d,{modelValue:t.blockCourtData.end_time,"onUpdate:modelValue":e[23]||(e[23]=o=>t.blockCourtData.end_time=o),label:"Hora de Fin",outlined:"",dense:"",mask:"##:##"},{append:a(()=>[l(r,{name:"access_time",class:"cursor-pointer"},{default:a(()=>[l(b,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[l(V,{modelValue:t.blockCourtData.end_time,"onUpdate:modelValue":e[22]||(e[22]=o=>t.blockCourtData.end_time=o),mask:"HH:mm",format24h:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):D("",!0),l(d,{modelValue:t.blockCourtData.reason,"onUpdate:modelValue":e[24]||(e[24]=o=>t.blockCourtData.reason=o),label:"Motivo",outlined:"",dense:"",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),l(B,{align:"right"},{default:a(()=>[g(l(k,{flat:"",label:"Cancelar",color:"primary"},null,512),[[h]]),l(k,{flat:"",label:"Bloquear",color:"negative",onClick:i.blockCourt},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(v)]),_:1})}var Ie=G(J,[["render",ae],["__scopeId","data-v-9db28b6a"]]);export{Ie as default};
