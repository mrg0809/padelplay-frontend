import{ax as _,aD as h,Y,bt as k,ar as y,bu as b,aB as M,b5 as C,bg as P,aq as E,O as A,k as O,r as w,j as x,w as X,bc as F,p as Q,E as j,ah as B}from"./index.44ff7f36.js";import{g as D,s as S}from"./use-render-cache.770e5fe8.js";import{c as T}from"./selection.fc24a828.js";import{Q as H}from"./QMenu.75efc905.js";import{e as L,c as z}from"./position-engine.6138d72b.js";function q(a,n,s){const d=P(a);let e,t=d.left-n.event.x,o=d.top-n.event.y,u=Math.abs(t),i=Math.abs(o);const r=n.direction;r.horizontal===!0&&r.vertical!==!0?e=t<0?"left":"right":r.horizontal!==!0&&r.vertical===!0?e=o<0?"up":"down":r.up===!0&&o<0?(e="up",u>i&&(r.left===!0&&t<0?e="left":r.right===!0&&t>0&&(e="right"))):r.down===!0&&o>0?(e="down",u>i&&(r.left===!0&&t<0?e="left":r.right===!0&&t>0&&(e="right"))):r.left===!0&&t<0?(e="left",u<i&&(r.up===!0&&o<0?e="up":r.down===!0&&o>0&&(e="down"))):r.right===!0&&t>0&&(e="right",u<i&&(r.up===!0&&o<0?e="up":r.down===!0&&o>0&&(e="down")));let f=!1;if(e===void 0&&s===!1){if(n.event.isFirst===!0||n.event.lastDir===void 0)return{};e=n.event.lastDir,f=!0,e==="left"||e==="right"?(d.left-=t,u=0,t=0):(d.top-=o,i=0,o=0)}return{synthetic:f,payload:{evt:a,touch:n.event.mouse!==!0,mouse:n.event.mouse===!0,position:d,direction:e,isFirst:n.event.isFirst,isFinal:s===!0,duration:Date.now()-n.event.time,distance:{x:u,y:i},offset:{x:t,y:o},delta:{x:d.left-n.event.lastX,y:d.top-n.event.lastY}}}}let $=0;var V=_({name:"touch-pan",beforeMount(a,{value:n,modifiers:s}){if(s.mouse!==!0&&h.has.touch!==!0)return;function d(t,o){s.mouse===!0&&o===!0?A(t):(s.stop===!0&&C(t),s.prevent===!0&&M(t))}const e={uid:"qvtp_"+$++,handler:n,modifiers:s,direction:D(s),noop:Y,mouseStart(t){S(t,e)&&k(t)&&(y(e,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),e.start(t,!0))},touchStart(t){if(S(t,e)){const o=t.target;y(e,"temp",[[o,"touchmove","move","notPassiveCapture"],[o,"touchcancel","end","passiveCapture"],[o,"touchend","end","passiveCapture"]]),e.start(t)}},start(t,o){if(h.is.firefox===!0&&b(a,!0),e.lastEvt=t,o===!0||s.stop===!0){if(e.direction.all!==!0&&(o!==!0||e.modifiers.mouseAllDir!==!0&&e.modifiers.mousealldir!==!0)){const r=t.type.indexOf("mouse")!==-1?new MouseEvent(t.type,t):new TouchEvent(t.type,t);t.defaultPrevented===!0&&M(r),t.cancelBubble===!0&&C(r),Object.assign(r,{qKeyEvent:t.qKeyEvent,qClickOutside:t.qClickOutside,qAnchorHandled:t.qAnchorHandled,qClonedBy:t.qClonedBy===void 0?[e.uid]:t.qClonedBy.concat(e.uid)}),e.initialEvent={target:t.target,event:r}}C(t)}const{left:u,top:i}=P(t);e.event={x:u,y:i,time:Date.now(),mouse:o===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:u,lastY:i}},move(t){if(e.event===void 0)return;const o=P(t),u=o.left-e.event.x,i=o.top-e.event.y;if(u===0&&i===0)return;e.lastEvt=t;const r=e.event.mouse===!0,f=()=>{d(t,r);let p;s.preserveCursor!==!0&&s.preservecursor!==!0&&(p=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),r===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),T(),e.styleCleanup=m=>{if(e.styleCleanup=void 0,p!==void 0&&(document.documentElement.style.cursor=p),document.body.classList.remove("non-selectable"),r===!0){const l=()=>{document.body.classList.remove("no-pointer-events--children")};m!==void 0?setTimeout(()=>{l(),m()},50):l()}else m!==void 0&&m()}};if(e.event.detected===!0){e.event.isFirst!==!0&&d(t,e.event.mouse);const{payload:p,synthetic:m}=q(t,e,!1);p!==void 0&&(e.handler(p)===!1?e.end(t):(e.styleCleanup===void 0&&e.event.isFirst===!0&&f(),e.event.lastX=p.position.left,e.event.lastY=p.position.top,e.event.lastDir=m===!0?void 0:p.direction,e.event.isFirst=!1));return}if(e.direction.all===!0||r===!0&&(e.modifiers.mouseAllDir===!0||e.modifiers.mousealldir===!0)){f(),e.event.detected=!0,e.move(t);return}const c=Math.abs(u),v=Math.abs(i);c!==v&&(e.direction.horizontal===!0&&c>v||e.direction.vertical===!0&&c<v||e.direction.up===!0&&c<v&&i<0||e.direction.down===!0&&c<v&&i>0||e.direction.left===!0&&c>v&&u<0||e.direction.right===!0&&c>v&&u>0?(e.event.detected=!0,e.move(t)):e.end(t,!0))},end(t,o){if(e.event!==void 0){if(E(e,"temp"),h.is.firefox===!0&&b(a,!1),o===!0)e.styleCleanup!==void 0&&e.styleCleanup(),e.event.detected!==!0&&e.initialEvent!==void 0&&e.initialEvent.target.dispatchEvent(e.initialEvent.event);else if(e.event.detected===!0){e.event.isFirst===!0&&e.handler(q(t===void 0?e.lastEvt:t,e).payload);const{payload:u}=q(t===void 0?e.lastEvt:t,e,!0),i=()=>{e.handler(u)};e.styleCleanup!==void 0?e.styleCleanup(i):i()}e.event=void 0,e.initialEvent=void 0,e.lastEvt=void 0}}};if(a.__qtouchpan=e,s.mouse===!0){const t=s.mouseCapture===!0||s.mousecapture===!0?"Capture":"";y(e,"main",[[a,"mousedown","mouseStart",`passive${t}`]])}h.has.touch===!0&&y(e,"main",[[a,"touchstart","touchStart",`passive${s.capture===!0?"Capture":""}`],[a,"touchmove","noop","notPassiveCapture"]])},updated(a,n){const s=a.__qtouchpan;s!==void 0&&(n.oldValue!==n.value&&(typeof value!="function"&&s.end(),s.handler=n.value),s.direction=D(n.modifiers))},beforeUnmount(a){const n=a.__qtouchpan;n!==void 0&&(n.event!==void 0&&n.end(),E(n,"main"),E(n,"temp"),h.is.firefox===!0&&b(a,!1),n.styleCleanup!==void 0&&n.styleCleanup(),delete a.__qtouchpan)}}),G=O({name:"QPopupProxy",props:{...L,breakpoint:{type:[String,Number],default:450}},emits:["show","hide"],setup(a,{slots:n,emit:s,attrs:d}){const{proxy:e}=j(),{$q:t}=e,o=w(!1),u=w(null),i=x(()=>parseInt(a.breakpoint,10)),{canShow:r}=z({showing:o});function f(){return t.screen.width<i.value||t.screen.height<i.value?"dialog":"menu"}const c=w(f()),v=x(()=>c.value==="menu"?{maxHeight:"99vh"}:{});X(()=>f(),l=>{o.value!==!0&&(c.value=l)});function p(l){o.value=!0,s("show",l)}function m(l){o.value=!1,c.value=f(),s("hide",l)}return Object.assign(e,{show(l){r(l)===!0&&u.value.show(l)},hide(l){u.value.hide(l)},toggle(l){u.value.toggle(l)}}),F(e,"currentComponent",()=>({type:c.value,ref:u.value})),()=>{const l={ref:u,...v.value,...d,onShow:p,onHide:m};let g;return c.value==="dialog"?g=B:(g=H,Object.assign(l,{target:a.target,contextMenu:a.contextMenu,noParentEvent:!0,separateClosePopup:!0})),Q(g,l,n.default)}}});export{G as Q,V as T};
