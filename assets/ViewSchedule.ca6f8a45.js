import{Q as we}from"./QHeader.9d145f00.js";import{r as m,F as Ce,bG as Pe,B as Se,a8 as xe,q as i,G as U,H as b,v as t,I as l,K as N,s as p,ac as le,ad as I,a9 as Ne,aa as Te,y as S,ab as k,x as _,J as ae,af as he,ah as qe,aQ as Qe,ae as W,bC as De}from"./index.a1ce2d53.js";import{Q as ie}from"./QTooltip.28ffdfc5.js";import{Q as Ee}from"./QPage.6605c4e6.js";import{Q as Be,a as Ue}from"./QLayout.3cda2fb6.js";import{Q as X}from"./QSelect.321e87e7.js";import{Q as oe}from"./QChip.f51e2514.js";import{Q as Ie,a as ue}from"./QItem.732812ed.js";import{Q as $e}from"./QItemLabel.c6dfb6ef.js";import{Q as He}from"./QList.2919e8db.js";import{u as Me}from"./use-quasar.5ff78dbd.js";import{c as Re,a as ze}from"./lessons.c17c167a.js";import{a as de}from"./api.f1a1189d.js";import{s as se}from"./supabase.5fdacb3a.js";import{f as Fe}from"./reservations.393429b2.js";import{f as Le}from"./lessons.c4cb8cd6.js";import{f as Oe}from"./clubs.39325f9c.js";import{g as Ae}from"./hourUtils.24f4f451.js";import{s as Ge}from"./commun.3f075284.js";import{u as je}from"./userStore.9db530aa.js";import{B as Je}from"./BannerPromoScrolling.81df9bd0.js";import{C as Ke}from"./ClubNavigationMenu.a9f83cb2.js";import{C as We}from"./ClubTopMenu.4265189f.js";import{N as Xe}from"./NotificationBell.5466255c.js";import{_ as Ye}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.a0b7645d.js";import"./selection.aef80a80.js";import"./QMenu.cd8dc468.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./pinia.e7392a2a.js";import"./admin.5ab62d8c.js";import"./QTabs.479caf1e.js";import"./QFooter.97aa8ebd.js";import"./QBtnDropdown.a2172834.js";import"./QBadge.b6830e3e.js";const Ze=async V=>{try{return(await de.post("/blocks/block-court",V)).data}catch(c){throw console.error("Error al crear bloqueo:",c),c}},el=async V=>{try{return(await de.delete(`/blocks/delete-block/${V}`)).data}catch(c){throw console.error("Error al eliminar bloqueo:",c),c}},ll=async(V,c)=>{try{const{data:g,error:R}=await se.from("court_blocks").select("*").eq("club_id",c).lte("start_date",V).gte("end_date",V);if(R)throw R;return g}catch(g){throw console.error("Error fetching court blocks:",g),g}},al=async V=>{const{data:c,error:g}=await se.from("courts").select("id, name").eq("club_id",V);if(g)throw new Error(g.message);return c},ol=async V=>{const{data:c,error:g}=await se.from("courts").select("id, name, price_per_hour, price_per_hour_and_half, price_per_two_hour").eq("id",V);if(g)throw new Error(g.message);return c};const tl={class:"header-content"},sl={class:"header-icons"},rl={class:"date-selector"},nl={class:"reservation-calendar responsive-table"},il={class:"reservation-table"},ul=["onClick"],dl={key:0},cl={key:1},ml={key:0},pl={key:0},vl={key:1},fl={key:2},bl={key:1},gl={key:0},yl={key:1},_l={key:0},kl={key:1},Vl={key:2},wl={class:"q-mt-md"},Cl={__name:"ViewSchedule",setup(V){const c=m(new Date().toISOString().split("T")[0]),g=m([]),R=m([]);m([]);const v=m({}),re=Ce(),E=Me(),T=je().clubId,$=m(!1),Y=m(!1),n=m(null);m({playerName:"",isPaid:!1,eventType:"Reserva"});const z=m(null),F=m([]),h=m(null),y=m(null),w=m(""),L=m(""),te=m([{label:"60 min",value:60},{label:"90 min",value:90},{label:"120 min",value:120}]),C=m(null),ce=m([{label:"Reserva",value:"reservation"},{label:"Clase",value:"lesson"},{label:"Bloqueo",value:"block"}]),O=m(""),A=m(""),G=m(null),Z=m(""),ee=m(""),j=m(""),me=async(o,e)=>{if(!o)return e(()=>F.value=[]);try{const d=await Ge(o);F.value=d.map(s=>({...s,full_name:`${s.first_name} ${s.last_name}`})),e(()=>F.value=F.value)}catch(d){console.error("Error buscando jugadores:",d)}},ne=()=>{z.value=null,y.value=null,w.value="",O.value="",A.value="",G.value=null,Z.value="",ee.value="",j.value=""},pe=()=>{n.value.type==="reservation"&&n.value.matchId?re.push(`/player/match/${n.value.matchId}?from=club`):n.value.type==="lesson"&&re.push(`/club/clases/${n.value.id}`)},ve=()=>{E.dialog({title:"Confirmar",message:"\xBFEst\xE1s seguro de que quieres eliminar este bloqueo?",cancel:!0,persistent:!0}).onOk(async()=>{try{await el(n.value.id),E.notify({type:"positive",message:"Bloqueo eliminado exitosamente"}),$.value=!1,J()}catch(o){console.error("Error al eliminar bloqueo:",o),E.notify({type:"negative",message:"Error al eliminar el bloqueo"})}})},fe=async()=>{if(console.log("selectedDuration.value:",y.value),console.log("selectedCourtId.value:",h.value),!y.value||!h.value){w.value="No disponible";return}try{const o=await ol(h.value);if(console.log("courtPrices:",o),!o||o.length===0){w.value="No disponible";return}const e=o[0];let d="No disponible";y.value.value===60?(d=e.price_per_hour,console.log("Duraci\xF3n 60, precio:",d)):y.value.value===90?(d=e.price_per_hour_and_half,console.log("Duraci\xF3n 90, precio:",d)):y.value.value===120&&(d=e.price_per_two_hour,console.log("Duraci\xF3n 120, precio:",d)),d==null?(w.value="No disponible",console.log("Precio es null o undefined")):(w.value=d.toString(),console.log("Precio asignado:",w.value))}catch(o){console.error("Error obteniendo precios:",o),w.value="No disponible"}},be=(o,e)=>{var d;(d=v.value[o])!=null&&d[e]?(n.value=v.value[o][e],Y.value=!1):(h.value=o,L.value=e,Y.value=!0,C.value=null,ne()),$.value=!0},ge=async()=>{if(!C.value||!h.value||!L.value||!y.value){console.error("Faltan datos b\xE1sicos para crear el evento.");return}const o=L.value,e=y.value.value,[d,s]=o.split(":").map(Number);let u=s+e,x=d+Math.floor(u/60);u=u%60;const a=String(x).padStart(2,"0")+":"+String(u).padStart(2,"0");try{if(C.value.value==="reservation"){if(!z.value||!w.value){console.error("Faltan datos para crear la reserva.");return}const r={club_id:T,court_id:h.value,reservation_date:c.value,start_time:o,end_time:a,total_price:w.value,player_id:z.value.user_id};await Re(r),E.notify({type:"positive",message:"Reserva creada exitosamente"})}else if(C.value.value==="lesson"){if(!O.value||!A.value){console.error("Faltan datos para crear la lecci\xF3n.");return}const r={club_id:T,court_id:h.value,lesson_date:c.value,lesson_time:o+":00",duration:e,coach:A.value,lesson_type:"public",name:O.value,description:ee.value,price:parseFloat(Z.value)||0,max_participants:G.value?parseInt(G.value):null};await ze(r),E.notify({type:"positive",message:"Lecci\xF3n creada exitosamente"})}else if(C.value.value==="block"){if(!j.value){console.error("Falta la raz\xF3n del bloqueo.");return}const r={court_id:h.value,club_id:T,start_date:c.value,end_date:c.value,start_time:o+":00",end_time:a+":00",reason:j.value};await Ze(r),E.notify({type:"positive",message:"Bloqueo creado exitosamente"})}console.log("Evento creado exitosamente"),$.value=!1,J()}catch(r){console.error("Error al crear el evento:",r),E.notify({type:"negative",message:"Error al crear el evento"})}},ye=(o,e)=>{var d;if((d=v.value[o])!=null&&d[e]){if(v.value[o][e].type==="block")return"blocked";if(v.value[o][e].type==="reservation")return"occupied";if(v.value[o][e].type==="lesson")return"lesson"}return"available"},J=async()=>{try{const o=await Fe(c.value,T),e=await ll(c.value,T),d=await Le(c.value,T),s=o.reduce((a,r)=>{var B,H;const P=r.court_id,K=r.start_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"reservation",playerName:r.profiles.full_name,courtName:r.courts.name,isPaid:r.is_paid,id:r.id,matchId:(H=(B=r.matches)==null?void 0:B[0])==null?void 0:H.id};const[Q,D]=f.split(":").map(Number);let M=D+30,Ve=Q+Math.floor(M/60);if(M=M%60,f=`${String(Ve).padStart(2,"0")}:${String(M).padStart(2,"0")}`,f>q)break}return a},{}),u=d.reduce((a,r)=>{var B;const P=r.court_id,K=r.lesson_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"lesson",lessonName:r.name,coachName:((B=r.coaches)==null?void 0:B.name)||r.coach,lessonType:r.lesson_type,maxParticipants:r.max_participants,currentParticipants:r.players?r.players.length:0,id:r.id,price:r.price};const[H,Q]=f.split(":").map(Number);let D=Q+30,M=H+Math.floor(D/60);if(D=D%60,f=`${String(M).padStart(2,"0")}:${String(D).padStart(2,"0")}`,f>q)break}return a},{}),x=e.reduce((a,r)=>{const P=r.court_id,K=r.start_time.slice(0,5),q=r.end_time.slice(0,5);let f=K;for(;f<q;){a[P]||(a[P]={}),a[P][f]={type:"block",isBlock:!0,reason:r.reason,id:r.id};const[B,H]=f.split(":").map(Number);let Q=H+30,D=B+Math.floor(Q/60);if(Q=Q%60,f=`${String(D).padStart(2,"0")}:${String(Q).padStart(2,"0")}`,f>q)break}return a},{});v.value={},v.value=Object.assign({},s,u,x)}catch(o){console.error("Unexpected error:",o.message)}},_e=async()=>{try{const o=await Oe(T),e=o.reduce((s,u)=>u.opening_time<s?u.opening_time:s,o[0].opening_time),d=o.reduce((s,u)=>u.closing_time>s?u.closing_time:s,o[0].closing_time);R.value=Ae(e,d)}catch(o){console.error("Unexpected error:",o.message)}},ke=async()=>{try{const o=await al(T);g.value=o}catch(o){console.error("Unexpected error:",o.message)}};return Pe(()=>{J()}),Se(()=>{ke(),_e(),J()}),(o,e)=>{const d=xe("q-textarea");return i(),U(Be,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:b(()=>[t(we,{elevated:"",class:"text-white"},{default:b(()=>[l("div",tl,[e[17]||(e[17]=l("div",{class:"greeting"},[l("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})],-1)),l("div",sl,[t(Xe),t(We)])]),t(Je)]),_:1}),t(Ue,null,{default:b(()=>[t(Ee,{class:"q-pa-md schedule-desktop"},{default:b(()=>[l("div",rl,[t(N,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),type:"date",label:"Selecciona una fecha",outlined:"",dense:"",color:"white","bg-color":"grey",onChange:J},null,8,["modelValue"])]),e[19]||(e[19]=l("div",{class:"color-legend q-mb-md"},[l("div",{class:"legend-title text-h6 text-center q-mb-sm"},"Leyenda"),l("div",{class:"legend-items"},[l("div",{class:"legend-item"},[l("div",{class:"legend-color available"}),l("span",null,"Disponible")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color occupied"}),l("span",null,"Reserva")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color lesson"}),l("span",null,"Clase")]),l("div",{class:"legend-item"},[l("div",{class:"legend-color blocked"}),l("span",null,"Bloqueo")])])],-1)),l("div",nl,[l("table",il,[l("thead",null,[l("tr",null,[e[18]||(e[18]=l("th",null,"Hora",-1)),(i(!0),p(I,null,le(g.value,s=>(i(),p("th",{key:s.id},_(s.name),1))),128))])]),l("tbody",null,[(i(!0),p(I,null,le(R.value,s=>(i(),p("tr",{key:s},[l("td",null,_(s),1),(i(!0),p(I,null,le(g.value,u=>{var x;return i(),p("td",{key:u.id,class:Qe(ye(u.id,s)),onClick:a=>be(u.id,s)},[(x=v.value[u.id])!=null&&x[s]?(i(),p("div",dl,[v.value[u.id][s].type==="reservation"?(i(),p(I,{key:0},[l("strong",null,_(v.value[u.id][s].playerName),1),v.value[u.id][s].isPaid?(i(),U(W,{key:0,name:"o_paid",color:"green",size:"sm",class:"q-ml-sm"})):(i(),U(W,{key:1,name:"money_off",color:"red",size:"sm",class:"q-ml-sm"}))],64)):v.value[u.id][s].type==="lesson"?(i(),p(I,{key:1},[l("strong",null,_(v.value[u.id][s].lessonName),1),t(W,{name:"school",color:"blue",size:"sm",class:"q-ml-sm"}),t(ie,null,{default:b(()=>[k("Instructor: "+_(v.value[u.id][s].coachName),1)]),_:2},1024)],64)):v.value[u.id][s].type==="block"?(i(),p(I,{key:2},[t(ie,null,{default:b(()=>[k(_(v.value[u.id][s].reason),1)]),_:2},1024),t(W,{name:"block",color:"red",size:"xs"})],64)):S("",!0)])):(i(),p("div",cl,[t(W,{name:"add",color:"black",size:"xs"})]))],10,ul)}),128))]))),128))])])])]),_:1})]),_:1}),t(qe,{modelValue:$.value,"onUpdate:modelValue":e[16]||(e[16]=s=>$.value=s)},{default:b(()=>[t(Ne,{class:"bg-black"},{default:b(()=>[t(Te,null,{default:b(()=>{var s,u,x;return[Y.value?(i(),p("div",ml,[e[20]||(e[20]=l("h6",null,"Crear Evento",-1)),t(X,{modelValue:C.value,"onUpdate:modelValue":[e[1]||(e[1]=a=>C.value=a),ne],options:ce.value,label:"Tipo de evento"},null,8,["modelValue","options"]),((s=C.value)==null?void 0:s.value)==="reservation"?(i(),p("div",pl,[t(X,{modelValue:z.value,"onUpdate:modelValue":e[2]||(e[2]=a=>z.value=a),"use-input":"","fill-input":"","input-debounce":"300",label:"Buscar jugador",options:F.value,"option-label":"full_name","option-value":"user_id",onFilter:me},null,8,["modelValue","options"]),t(X,{modelValue:y.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>y.value=a),fe],options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"]),t(N,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),label:"Precio",disable:""},null,8,["modelValue"])])):S("",!0),((u=C.value)==null?void 0:u.value)==="lesson"?(i(),p("div",vl,[t(N,{modelValue:O.value,"onUpdate:modelValue":e[5]||(e[5]=a=>O.value=a),label:"Nombre de la clase"},null,8,["modelValue"]),t(N,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=a=>A.value=a),label:"Instructor"},null,8,["modelValue"]),t(X,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=a=>y.value=a),options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"]),t(N,{modelValue:G.value,"onUpdate:modelValue":e[8]||(e[8]=a=>G.value=a),type:"number",label:"M\xE1ximo participantes"},null,8,["modelValue"]),t(N,{modelValue:Z.value,"onUpdate:modelValue":e[9]||(e[9]=a=>Z.value=a),type:"number",label:"Precio por persona"},null,8,["modelValue"]),t(d,{modelValue:ee.value,"onUpdate:modelValue":e[10]||(e[10]=a=>ee.value=a),label:"Descripci\xF3n (opcional)"},null,8,["modelValue"])])):S("",!0),((x=C.value)==null?void 0:x.value)==="block"?(i(),p("div",fl,[t(N,{modelValue:j.value,"onUpdate:modelValue":e[11]||(e[11]=a=>j.value=a),label:"Raz\xF3n del bloqueo"},null,8,["modelValue"]),t(X,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=a=>y.value=a),options:te.value,label:"Duraci\xF3n"},null,8,["modelValue","options"])])):S("",!0),t(N,{modelValue:c.value,"onUpdate:modelValue":e[13]||(e[13]=a=>c.value=a),label:"Fecha",disable:""},null,8,["modelValue"]),t(N,{modelValue:L.value,"onUpdate:modelValue":e[14]||(e[14]=a=>L.value=a),label:"Hora de inicio",disable:""},null,8,["modelValue"])])):(i(),p("div",bl,[e[34]||(e[34]=l("h6",null,"Detalles del Evento",-1)),n.value.type==="reservation"?(i(),p("div",gl,[e[24]||(e[24]=l("p",null,[l("strong",null,"Tipo:"),k(" Reserva")],-1)),l("p",null,[e[21]||(e[21]=l("strong",null,"Jugador:",-1)),k(" "+_(n.value.playerName),1)]),l("p",null,[e[22]||(e[22]=l("strong",null,"Cancha:",-1)),k(" "+_(n.value.courtName),1)]),l("p",null,[e[23]||(e[23]=l("strong",null,"Estado de pago:",-1)),t(oe,{color:n.value.isPaid?"green":"red","text-color":"white",icon:n.value.isPaid?"check_circle":"pending",label:n.value.isPaid?"Pagado":"Pendiente"},null,8,["color","icon","label"])])])):n.value.type==="lesson"?(i(),p("div",yl,[e[31]||(e[31]=l("p",null,[l("strong",null,"Tipo:"),k(" Clase")],-1)),l("p",null,[e[25]||(e[25]=l("strong",null,"Nombre:",-1)),k(" "+_(n.value.lessonName),1)]),l("p",null,[e[26]||(e[26]=l("strong",null,"Instructor:",-1)),k(" "+_(n.value.coachName),1)]),l("p",null,[e[27]||(e[27]=l("strong",null,"Tipo de clase:",-1)),t(oe,{color:n.value.lessonType==="private"?"purple":"blue","text-color":"white",label:n.value.lessonType==="private"?"Privada":"Grupal"},null,8,["color","label"])]),l("p",null,[e[28]||(e[28]=l("strong",null,"Participantes:",-1)),t(oe,{color:"blue","text-color":"white",label:`${n.value.currentParticipants}/${n.value.maxParticipants||"\u221E"}`},null,8,["label"])]),n.value.price?(i(),p("p",_l,[e[29]||(e[29]=l("strong",null,"Precio:",-1)),k(" $"+_(n.value.price),1)])):S("",!0),n.value.lessonType==="public"&&n.value.currentParticipants>0?(i(),p("div",kl,[e[30]||(e[30]=l("p",null,[l("strong",null,"Participantes inscritos:")],-1)),t(He,{dense:""},{default:b(()=>[(i(!0),p(I,null,le(n.value.currentParticipants,a=>(i(),U(Ie,{key:a,dense:""},{default:b(()=>[t(ue,{avatar:""},{default:b(()=>[t(De,{size:"sm",color:"blue","text-color":"white"},{default:b(()=>[k(_(a),1)]),_:2},1024)]),_:2},1024),t(ue,null,{default:b(()=>[t($e,{caption:""},{default:b(()=>[k("Participante "+_(a),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):S("",!0)])):n.value.type==="block"?(i(),p("div",Vl,[e[33]||(e[33]=l("p",null,[l("strong",null,"Tipo:"),k(" Bloqueo")],-1)),l("p",null,[e[32]||(e[32]=l("strong",null,"Raz\xF3n:",-1)),k(" "+_(n.value.reason),1)]),t(oe,{color:"red","text-color":"white",icon:"block",label:"Cancha bloqueada"})])):S("",!0),l("div",wl,[n.value.type!=="block"?(i(),U(ae,{key:0,flat:"",color:"primary",label:"Ver m\xE1s detalles",onClick:pe})):S("",!0),n.value.type==="block"?(i(),U(ae,{key:1,flat:"",color:"negative",label:"Eliminar bloqueo",onClick:ve})):S("",!0)])]))]}),_:1}),t(he,{align:"right"},{default:b(()=>[Y.value?(i(),U(ae,{key:0,label:"Guardar",color:"green",disable:!C.value,onClick:ge},null,8,["disable"])):S("",!0),t(ae,{label:"Cerrar",color:"negative",onClick:e[15]||(e[15]=s=>$.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ke)]),_:1})}}};var na=Ye(Cl,[["__scopeId","data-v-fd19fb20"]]);export{na as default};
