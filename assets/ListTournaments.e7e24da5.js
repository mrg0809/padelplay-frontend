import{F as H,r as c,B as R,aa as J,q as n,G as u,H as l,v as o,I as s,ad as C,J as i,s as w,ag as G,af as O,ae as W,ai as y,aj as I,ab as E,ac as V,ah as q,x as _,y as T}from"./index.176a017b.js";import{Q as K}from"./QHeader.dfbc1a35.js";import{Q as X}from"./QBadge.874fcfaa.js";import{Q as Y}from"./QPage.68138b8a.js";import{Q as B,a as N}from"./QItem.e6dc7461.js";import{Q as Z}from"./QList.e1aa2b6b.js";import{Q as $}from"./QMenu.18f36bc3.js";import{Q as ee,a as ae}from"./QLayout.312f4ce9.js";import{C as Q}from"./ClosePopup.0a456d0c.js";import{s as h}from"./supabase.05dee304.js";import{n as oe}from"./navigationUtils.2c4b9dee.js";import{u as te}from"./use-quasar.e1e20012.js";import"./api.2af71db3.js";import{C as le}from"./ClubNavigationMenu.059aabe6.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.45ffe2df.js";import"./selection.540057b6.js";import"./QTabs.82771dda.js";import"./rtl.276c3f1b.js";import"./QFooter.804a099a.js";const se={name:"ListTournaments",components:{ClubNavigationMenu:le},setup(){const m=H(),e=te(),g=c([]),r=c(null),k=c(!1),f=c(!1),p=c(null),a=c(null),v=async()=>{try{if(!r.value){console.error("Club ID no encontrado.");return}const{data:t,error:b}=await h.from("tournaments").select("id, name, start_date, min_pairs, status").eq("club_id",r.value).order("start_date",{ascending:!1});if(b){console.error("Error fetching tournaments:",b.message);return}const x=await Promise.all(t.map(async d=>{const{data:D,error:fe}=await h.from("tournament_teams").select("id",{count:"exact"}).eq("tournament_id",d.id).eq("status","confirmed");return{id:d.id,name:d.name,start_date:d.start_date,min_pairs:d.min_pairs,registered_teams:(D==null?void 0:D.length)||0,status:d.status||"open"}}));g.value=x}catch(t){console.error("Unexpected error fetching tournaments:",t.message)}},M=t=>{m.push({name:"EditTournament",params:{tournamentId:t}})},L=t=>{p.value=t,k.value=!0},P=async()=>{try{const{error:t}=await h.from("tournaments").delete().eq("id",p.value);if(t)throw t;g.value=g.value.filter(b=>b.id!==p.value),k.value=!1,e.notify({type:"positive",message:"Torneo eliminado exitosamente."})}catch(t){console.error("Error al eliminar el torneo:",t.message),e.notify({type:"negative",message:"Error al eliminar torneo."})}},z=t=>{a.value=t,f.value=!0},S=async()=>{try{if(console.log("Cerrando torneo:",a.value.id),a.value.registered_teams<a.value.min_pairs){e.notify({type:"negative",message:"El torneo no tiene suficientes parejas inscritas para cerrarlo."}),f.value=!1;return}m.push({name:"PreviewTournament",params:{tournamentId:a.value.id}}),f.value=!1}catch(t){console.error("Error navigating to preview:",t),e.notify({type:"negative",message:"Error al navegar a la vista previa del torneo."})}},U=t=>{m.push("/club/creartorneos")},j=t=>{m.push({name:"ManageTournament",params:{tournamentId:t}})},F=()=>{m.back()},A=()=>{oe(m,userStore)};return R(()=>{const t=localStorage.getItem("token");if(t){const x=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),d=JSON.parse(atob(x));r.value=d.club_id||null}v()}),{tournaments:g,goBack:F,editTournament:M,openDeleteDialog:L,openCloseDialog:z,deleteDialogVisible:k,closeDialogVisible:f,deleteTournament:P,closeTournament:S,openCreateTournament:U,manageTournament:j,goToDashboard:A}}},ne={class:"header-content"},ie={class:"greeting"},de={class:"header-icons"},ue={key:0,class:"text-center q-mt-md"},me={key:1,class:"tournaments-list"},ce={class:"actions"};function ge(m,e,g,r,k,f){const p=J("ClubNavigationMenu");return n(),u(ee,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[o(K,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[s("div",ne,[s("div",ie,[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...a)=>r.goToDashboard&&r.goToDashboard(...a))}),e[3]||(e[3]=C(" Mis Torneos "))]),s("div",de,[o(i,{flat:"",round:"",icon:"arrow_back",onClick:r.goBack},null,8,["onClick"])])])]),_:1}),o(ae,null,{default:l(()=>[o(Y,{class:"q-pa-md"},{default:l(()=>[r.tournaments.length===0?(n(),w("div",ue,[o(G,{name:"event_busy",size:"64px"}),e[4]||(e[4]=s("p",null,"No has creado torneos todav\xEDa.",-1))])):(n(),w("div",me,[(n(!0),w(O,null,W(r.tournaments,a=>(n(),u(E,{key:a.id,class:"q-mb-md transparent-card"},{default:l(()=>[o(V,null,{default:l(()=>[s("h4",null,_(a.name),1),s("p",null,[e[5]||(e[5]=s("strong",null,"Fecha:",-1)),C(" "+_(a.start_date)+" ",1),e[6]||(e[6]=s("br",null,null,-1)),e[7]||(e[7]=s("strong",null,"M\xEDnimo de Parejas:",-1)),C(" "+_(a.min_pairs)+" ",1),e[8]||(e[8]=s("br",null,null,-1)),e[9]||(e[9]=s("strong",null,"Parejas Inscritas:",-1)),C(" "+_(a.registered_teams)+" ",1),e[10]||(e[10]=s("br",null,null,-1)),e[11]||(e[11]=s("strong",null,"Estado:",-1)),o(X,{color:a.status==="closed"?"green":"orange"},{default:l(()=>[C(_(a.status==="closed"?"Cerrado":"Abierto"),1)]),_:2},1032,["color"])]),s("div",ce,[a.status!=="closed"?(n(),u(i,{key:0,icon:"edit",label:"Editar",color:"primary",size:"sm",onClick:v=>r.editTournament(a.id)},null,8,["onClick"])):T("",!0),a.status!=="closed"?(n(),u(i,{key:1,icon:"delete",label:"Eliminar",color:"negative",size:"sm",disable:a.registered_teams>0,onClick:v=>r.openDeleteDialog(a.id)},null,8,["disable","onClick"])):T("",!0),a.status!=="closed"?(n(),u(i,{key:2,icon:"preview",label:"Cerrar Torneo",color:"orange",size:"sm",onClick:v=>r.openCloseDialog(a)},null,8,["onClick"])):T("",!0),a.status==="closed"?(n(),u(i,{key:3,icon:"dashboard",label:"Administrar",color:"green",size:"sm",onClick:v=>r.manageTournament(a.id)},null,8,["onClick"])):T("",!0)])]),_:2},1024)]),_:2},1024))),128))]))]),_:1}),o(i,{glossy:"",round:"",size:"lg",color:"black",icon:"add",class:"fixed-bottom-right q-mb-xl"},{default:l(()=>[o($,{anchor:"top end",self:"bottom end"},{default:l(()=>[o(Z,{style:{"min-width":"150px"}},{default:l(()=>[y((n(),u(B,{clickable:"",onClick:r.openCreateTournament},{default:l(()=>[o(N,null,{default:l(()=>e[12]||(e[12]=[s("strong",null,"Retas",-1)])),_:1})]),_:1},8,["onClick"])),[[Q]]),y((n(),u(B,{clickable:"",onClick:r.openCreateTournament},{default:l(()=>[o(N,null,{default:l(()=>e[13]||(e[13]=[s("strong",null,"Torneo",-1)])),_:1})]),_:1},8,["onClick"])),[[Q]])]),_:1})]),_:1})]),_:1}),o(I,{modelValue:r.deleteDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=a=>r.deleteDialogVisible=a)},{default:l(()=>[o(E,{class:"bg-black text-white"},{default:l(()=>[o(V,null,{default:l(()=>e[14]||(e[14]=[s("div",{class:"text-h6"},"Confirmar eliminaci\xF3n",-1),s("div",null,"\xBFEst\xE1s seguro de que deseas eliminar este torneo?",-1)])),_:1}),o(q,{align:"right"},{default:l(()=>[y(o(i,{flat:"",label:"Cancelar",color:"primary"},null,512),[[Q]]),o(i,{flat:"",label:"Eliminar",color:"negative",onClick:r.deleteTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(I,{modelValue:r.closeDialogVisible,"onUpdate:modelValue":e[2]||(e[2]=a=>r.closeDialogVisible=a)},{default:l(()=>[o(E,{class:"bg-black text-white"},{default:l(()=>[o(V,null,{default:l(()=>e[15]||(e[15]=[s("div",{class:"text-h6"},"Confirmar cierre",-1),s("div",null," \xBFEst\xE1s seguro de que deseas cerrar este torneo? Esto generar\xE1 el fixture autom\xE1ticamente. ",-1)])),_:1}),o(q,{align:"right"},{default:l(()=>[y(o(i,{flat:"",label:"Cancelar",color:"red"},null,512),[[Q]]),o(i,{flat:"",label:"Cerrar Torneo",color:"green",onClick:r.closeTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(p)]),_:1})}var Le=re(se,[["render",ge],["__scopeId","data-v-29bf9dcc"]]);export{Le as default};
