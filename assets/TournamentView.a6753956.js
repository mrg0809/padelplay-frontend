import{a7 as G,F as L,r as _,j as H,B as U,a8 as T,q as d,G as p,H as l,v as o,I as t,J as O,s as c,a9 as Q,aa as w,x as n,ab as m,aM as A,ad as S,ac as N,ae as f,y as h,aQ as C}from"./index.44ff7f36.js";import{Q as K}from"./QHeader.1d41df4b.js";import{Q as W}from"./QSpinnerDots.52063b1d.js";import{Q as X,a as B}from"./QTabs.b7b4d746.js";import{Q as x}from"./QBadge.dc626f3f.js";import{a as Y,Q as V}from"./QTabPanel.653cb778.js";import{Q as D}from"./QMarkupTable.5dba5809.js";import{Q as Z}from"./QPage.01f0db4e.js";import{Q as $,a as tt}from"./QLayout.36e57c24.js";import{u as et}from"./use-quasar.5b0bf7b9.js";import{u as st}from"./userStore.c05073cd.js";import{s as z}from"./supabase.62935925.js";import{a as E}from"./api.2af71db3.js";import{P as at}from"./PlayerNavigationMenu.073d5db4.js";import{N as ot}from"./NotificationBell.d889e136.js";import{B as nt}from"./BannerPromoScrolling.38e1cc22.js";import{D as rt}from"./DesktopNavigation.70841f70.js";import{g as lt}from"./tournamentUtils.cfdf57cc.js";import{_ as it}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.98380815.js";import"./use-render-cache.770e5fe8.js";import"./selection.fc24a828.js";import"./pinia.75ba5c8c.js";import"./QFooter.f84d141a.js";import"./admin.c99b9bfe.js";import"./QTooltip.81e13844.js";import"./position-engine.6138d72b.js";const dt={name:"TournamentView",components:{PlayerNavigationMenu:at,NotificationBell:ot,BannerPromoScrolling:nt,DesktopNavigation:rt},setup(){const g=G(),e=L(),b=et(),a=st(),I=_(null),q=_([]),k=_([]),P=_(null),y=_(!1),M=_("my-matches"),s=_(!1),v=H(()=>a.userId?q.value.filter(r=>r.team1_players.includes(a.userId)||r.team2_players.includes(a.userId)):[]);U(async()=>{await F(),await R(),await j(),await J()});const F=async()=>{y.value=!0;try{const r=g.params.tournamentId,{data:i,error:u}=await z.from("tournaments").select("*").eq("id",r).single();if(u)throw u;I.value=i}catch(r){console.error("Error loading tournament:",r),b.notify({type:"negative",message:"Error al cargar el torneo"})}finally{y.value=!1}},R=async()=>{try{const r=g.params.tournamentId,{data:i,error:u}=await z.from("tournament_teams").select("id").eq("tournament_id",r).or(`player1_id.eq.${a.userId},player2_id.eq.${a.userId}`).single();!u&&i&&(P.value=i.id)}catch(r){console.error("Error loading my team:",r)}},j=async()=>{try{const r=g.params.tournamentId,i=await E.get(`/tournaments/${r}/matches`);q.value=i.data.matches}catch(r){console.error("Error loading matches:",r),b.notify({type:"negative",message:"Error al cargar los partidos"})}},J=async()=>{try{const r=g.params.tournamentId,i=await E.get(`/tournaments/${r}/standings`);k.value=i.data.standings,s.value=i.data.is_retas||!1}catch(r){console.error("Error loading standings:",r),b.notify({type:"negative",message:"Error al cargar las posiciones"})}};return{tournament:I,matches:q,myMatches:v,standings:k,loading:y,activeTab:M,isRetasTournament:s,getSystemName:r=>lt(r),formatDate:r=>{const i=new Date(r),u={year:"numeric",month:"long",day:"numeric"};return i.toLocaleDateString("es-ES",u)},formatScore:r=>{if(!r)return"Sin resultado";try{const i=typeof r=="string"?JSON.parse(r):r;let u=[];return i.set1&&u.push(`${i.set1.team1}-${i.set1.team2}`),i.set2&&u.push(`${i.set2.team1}-${i.set2.team2}`),i.set3&&u.push(`${i.set3.team1}-${i.set3.team2}`),u.join(", ")}catch{return"Error en formato"}},isMyTeam:r=>r===P.value,goBack:()=>{e.back()}}}},mt={class:"header-content"},ct={class:"header-icons"},ut={key:0,class:"text-center q-mt-md"},_t={key:1},ft={class:"q-mt-none"},pt={class:"row q-gutter-md"},gt={class:"col"},yt={class:"col"},vt={class:"matches-list"},ht={class:"match-header"},xt={class:"q-my-none"},bt={class:"text-caption q-mb-none"},qt={class:"text-caption q-mb-none"},kt={key:0,class:"q-mt-md result-section"},Pt={key:1,class:"q-mt-md"},Tt={key:0,class:"text-center q-pa-xl"},Qt={class:"matches-list"},wt={class:"match-header"},St={class:"q-my-none"},Nt={class:"text-caption q-mb-none"},It={class:"text-caption q-mb-none"},Mt={key:0,class:"q-mt-md result-section"},Bt={key:1,class:"q-mt-md"},Vt={key:0,class:"text-center q-pa-xl"},Ct={class:"text-left"},Dt={class:"text-left"},zt={class:"text-center"},Et={class:"text-center"},Ft={class:"text-center"},Rt={class:"text-center"},jt={class:"text-left"},Jt={class:"text-left"},Gt={class:"text-center"},Lt={class:"text-center"},Ht={class:"text-center"},Ut={class:"text-center"},Ot={key:2,class:"text-center q-pa-xl"};function At(g,e,b,a,I,q){const k=T("NotificationBell"),P=T("BannerPromoScrolling"),y=T("DesktopNavigation"),M=T("PlayerNavigationMenu");return d(),p($,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:l(()=>[o(K,{elevated:"",class:"text-white"},{default:l(()=>[t("div",mt,[e[2]||(e[2]=t("div",{class:"greeting"},[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})],-1)),t("div",ct,[o(k),o(O,{flat:"",round:"",icon:"arrow_back",onClick:a.goBack},null,8,["onClick"])])]),o(P)]),_:1}),o(y),o(tt,null,{default:l(()=>[o(Z,{class:"q-pa-md"},{default:l(()=>[a.loading?(d(),c("div",ut,[o(W,{color:"primary",size:"xl"}),e[3]||(e[3]=t("p",null,"Cargando informaci\xF3n del torneo...",-1))])):a.tournament?(d(),c("div",_t,[o(Q,{class:"q-mb-md transparent-card"},{default:l(()=>[o(w,null,{default:l(()=>[t("h4",ft,n(a.tournament.name),1),t("div",pt,[t("div",gt,[t("p",null,[e[4]||(e[4]=t("strong",null,"Sistema:",-1)),m(" "+n(a.getSystemName(a.tournament.system)),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"Categor\xEDa:",-1)),m(" "+n(a.tournament.category),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"G\xE9nero:",-1)),m(" "+n(a.tournament.gender),1)])]),t("div",yt,[t("p",null,[e[7]||(e[7]=t("strong",null,"Fecha Inicio:",-1)),m(" "+n(a.tournament.start_date),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Fecha Fin:",-1)),m(" "+n(a.tournament.end_date),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Premio:",-1)),m(" "+n(a.tournament.prize),1)])])])]),_:1})]),_:1}),o(X,{modelValue:a.activeTab,"onUpdate:modelValue":e[0]||(e[0]=s=>a.activeTab=s),dense:"",class:"text-white","active-color":"primary","indicator-color":"primary",align:"justify"},{default:l(()=>[o(B,{name:"my-matches",label:"Mis Partidos",icon:"calendar_today"}),o(B,{name:"all-matches",label:"Todos los Partidos",icon:"sports_tennis"}),o(B,{name:"standings",label:"Posiciones",icon:"emoji_events"})]),_:1},8,["modelValue"]),o(A),o(Y,{modelValue:a.activeTab,"onUpdate:modelValue":e[1]||(e[1]=s=>a.activeTab=s),animated:"",class:"transparent-bg"},{default:l(()=>[o(V,{name:"my-matches"},{default:l(()=>[t("div",vt,[(d(!0),c(S,null,N(a.myMatches,s=>(d(),p(Q,{key:s.id,class:"q-mb-md transparent-card"},{default:l(()=>[o(w,null,{default:l(()=>[t("div",ht,[t("h6",xt,n(s.team1)+" vs "+n(s.team2),1),t("p",bt,[o(f,{name:"event",size:"xs"}),m(" "+n(a.formatDate(s.match_date))+" - "+n(s.match_time.substring(0,5)),1)]),t("p",qt,[o(f,{name:"place",size:"xs"}),m(" Cancha: "+n(s.court_name),1)])]),s.has_result?(d(),c("div",kt,[o(x,{color:"green",class:"q-mb-sm"},{default:l(()=>e[10]||(e[10]=[m("Finalizado")])),_:1}),t("p",null,[e[11]||(e[11]=t("strong",null,"Resultado:",-1)),m(" "+n(a.formatScore(s.score)),1)])])):(d(),c("div",Pt,[o(x,{color:"orange"},{default:l(()=>e[12]||(e[12]=[m("Pendiente")])),_:1})]))]),_:2},1024)]),_:2},1024))),128)),a.myMatches.length===0?(d(),c("div",Tt,[o(f,{name:"info",size:"3em",color:"grey"}),e[13]||(e[13]=t("p",null,"No tienes partidos programados",-1))])):h("",!0)])]),_:1}),o(V,{name:"all-matches"},{default:l(()=>[t("div",Qt,[(d(!0),c(S,null,N(a.matches,s=>(d(),p(Q,{key:s.id,class:"q-mb-md transparent-card"},{default:l(()=>[o(w,null,{default:l(()=>[t("div",wt,[t("h6",St,n(s.team1)+" vs "+n(s.team2),1),t("p",Nt,[o(f,{name:"event",size:"xs"}),m(" "+n(a.formatDate(s.match_date))+" - "+n(s.match_time.substring(0,5)),1)]),t("p",It,[o(f,{name:"place",size:"xs"}),m(" Cancha: "+n(s.court_name),1)])]),s.has_result?(d(),c("div",Mt,[o(x,{color:"green",class:"q-mb-sm"},{default:l(()=>e[14]||(e[14]=[m("Finalizado")])),_:1}),t("p",null,[e[15]||(e[15]=t("strong",null,"Resultado:",-1)),m(" "+n(a.formatScore(s.score)),1)])])):(d(),c("div",Bt,[o(x,{color:"orange"},{default:l(()=>e[16]||(e[16]=[m("Pendiente")])),_:1})]))]),_:2},1024)]),_:2},1024))),128)),a.matches.length===0?(d(),c("div",Vt,[o(f,{name:"info",size:"3em",color:"grey"}),e[17]||(e[17]=t("p",null,"No hay partidos programados",-1))])):h("",!0)])]),_:1}),o(V,{name:"standings"},{default:l(()=>[o(Q,{class:"transparent-card"},{default:l(()=>[o(w,null,{default:l(()=>[e[22]||(e[22]=t("h6",{class:"q-mt-none"},"Tabla de Posiciones",-1)),a.isRetasTournament?(d(),p(D,{key:0,flat:"",bordered:"",class:"standings-table"},{default:l(()=>[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Jugador"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"% Victorias")])],-1)),t("tbody",null,[(d(!0),c(S,null,N(a.standings,(s,v)=>(d(),c("tr",{key:s.team_id,class:C({"my-team":a.isMyTeam(s.team_id)})},[t("td",Ct,n(v+1),1),t("td",Dt,n(s.team_name),1),t("td",zt,n(s.matches_played),1),t("td",Et,n(s.wins),1),t("td",Ft,n(s.losses),1),t("td",Rt,[t("strong",null,n(s.win_percentage)+"%",1)])],2))),128))])]),_:1})):(d(),p(D,{key:1,flat:"",bordered:"",class:"standings-table"},{default:l(()=>[e[20]||(e[20]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Equipo"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"Total Pts")])],-1)),t("tbody",null,[(d(!0),c(S,null,N(a.standings,(s,v)=>(d(),c("tr",{key:s.team_id,class:C({"my-team":a.isMyTeam(s.team_id)})},[t("td",jt,n(v+1),1),t("td",Jt,[m(n(s.team_name)+" ",1),a.isMyTeam(s.team_id)?(d(),p(x,{key:0,color:"primary",class:"q-ml-sm"},{default:l(()=>e[19]||(e[19]=[m(" Mi equipo ")])),_:1})):h("",!0)]),t("td",Gt,n(s.matches_played),1),t("td",Lt,n(s.wins),1),t("td",Ht,n(s.losses),1),t("td",Ut,[t("strong",null,n(s.total_points),1)])],2))),128))])]),_:1})),a.standings.length===0?(d(),c("div",Ot,[o(f,{name:"info",size:"3em",color:"grey"}),e[21]||(e[21]=t("p",null,"No hay resultados registrados a\xFAn",-1))])):h("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):h("",!0)]),_:1})]),_:1}),o(M)]),_:1})}var we=it(dt,[["render",At],["__scopeId","data-v-53d97fa4"]]);export{we as default};
