import{r as S,f as F,l as me,b6 as be,I as fe,aB as _e,j as U,g as ye,bM as he,b0 as we,aX as Ce,aZ as xe,b1 as Fe,bN as ke,b2 as ne,bd as De,aY as Ve,az as Se,x as Pe,y as Qe,h as Ie,a6 as Ne,o as h,z as T,A as r,d as l,B as x,a9 as j,D as K,a as A,ac as se,aa as Z,ab as J,a7 as qe,a8 as ie,E as Ee,ad as ze,ae as ue,af as Te,bG as de,t as E,e as je}from"./index.39adb644.js";import{Q as Ae}from"./QHeader.3330d6d5.js";import{Q as Ue,a as ae}from"./QTabs.de2e2033.js";import{Q as le,a as L}from"./QItem.87198ca3.js";import{Q as R}from"./QItemLabel.24f30c08.js";import{Q as oe}from"./QList.aedeb71d.js";import{a as Be,Q as re}from"./QTabPanel.0e986986.js";import{Q as pe}from"./QChip.4e1820bf.js";import{Q as Me}from"./QPage.28b7989a.js";import{Q as Oe,a as Le}from"./QLayout.136fc703.js";import{h as Re}from"./format.de7e9769.js";import{C as ce}from"./ClosePopup.51e688f1.js";import{s as z}from"./supabase.6e6ca5a2.js";import{n as We}from"./navigationUtils.2c4b9dee.js";import{a as $}from"./api.65c10df7.js";import{C as Xe}from"./ClubNavigationMenu.0f9de636.js";import{_ as Ye}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.5ef3e782.js";import"./touch.9135741d.js";import"./selection.365c2d2e.js";import"./use-render-cache.3aae9b27.js";import"./QFooter.c2826d80.js";function W(t,o,P,s){const m=[];return t.forEach(f=>{s(f)===!0?m.push(f):o.push({failedPropValidation:P,file:f})}),m}function ee(t){t!=null&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),fe(t)}const He={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ke=["rejected"];function Ge({editable:t,dnd:o,getFileInput:P,addFilesToQueue:s}){const{props:m,emit:f,proxy:w}=me(),a=S(null),Q=F(()=>m.accept!==void 0?m.accept.split(",").map(e=>(e=e.trim(),e==="*"?"*/":(e.endsWith("/*")&&(e=e.slice(0,e.length-1)),e.toUpperCase()))):null),I=F(()=>parseInt(m.maxFiles,10)),B=F(()=>parseInt(m.maxTotalSize,10));function M(e){var c;if(t.value)if(e!==Object(e)&&(e={target:null}),((c=e.target)==null?void 0:c.matches('input[type="file"]'))===!0)e.clientX===0&&e.clientY===0&&be(e);else{const v=P();v!==e.target&&(v==null||v.click(e))}}function O(e){t.value&&e&&s(null,e)}function X(e,c,v,_){let n=Array.from(c||e.target.files);const b=[],y=()=>{b.length!==0&&f("rejected",b)};if(m.accept!==void 0&&Q.value.indexOf("*/")===-1&&(n=W(n,b,"accept",u=>Q.value.some(g=>u.type.toUpperCase().startsWith(g)||u.name.toUpperCase().endsWith(g))),n.length===0))return y();if(m.maxFileSize!==void 0){const u=parseInt(m.maxFileSize,10);if(n=W(n,b,"max-file-size",g=>g.size<=u),n.length===0)return y()}if(m.multiple!==!0&&n.length!==0&&(n=[n[0]]),n.forEach(u=>{u.__key=u.webkitRelativePath+u.lastModified+u.name+u.size}),_===!0){const u=v.map(g=>g.__key);n=W(n,b,"duplicate",g=>u.includes(g.__key)===!1)}if(n.length===0)return y();if(m.maxTotalSize!==void 0){let u=_===!0?v.reduce((g,N)=>g+N.size,0):0;if(n=W(n,b,"max-total-size",g=>(u+=g.size,u<=B.value)),n.length===0)return y()}if(typeof m.filter=="function"){const u=m.filter(n);n=W(n,b,"filter",g=>u.includes(g))}if(m.maxFiles!==void 0){let u=_===!0?v.length:0;if(n=W(n,b,"max-files",()=>(u++,u<=I.value)),n.length===0)return y()}if(y(),n.length!==0)return n}function Y(e){ee(e),o.value!==!0&&(o.value=!0)}function p(e){fe(e),(e.relatedTarget!==null||_e.is.safari!==!0?e.relatedTarget!==a.value:document.elementsFromPoint(e.clientX,e.clientY).includes(a.value)===!1)===!0&&(o.value=!1)}function H(e){ee(e);const c=e.dataTransfer.files;c.length!==0&&s(null,c),o.value=!1}function G(e){if(o.value===!0)return U("div",{ref:a,class:`q-${e}__dnd absolute-full`,onDragenter:ee,onDragover:ee,onDragleave:p,onDrop:H})}return Object.assign(w,{pickFiles:M,addFiles:O}),{pickFiles:M,addFiles:O,onDragover:Y,onDragleave:p,processFiles:X,getDndNode:G,maxFilesNumber:I,maxTotalSizeNumber:B}}var Ze=ye({name:"QFile",inheritAttrs:!1,props:{...he,...we,...He,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Ce,...Ke],setup(t,{slots:o,emit:P,attrs:s}){const{proxy:m}=me(),f=xe(),w=S(null),a=S(!1),Q=Fe(t),{pickFiles:I,onDragover:B,onDragleave:M,processFiles:O,getDndNode:X}=Ge({editable:f.editable,dnd:a,getFileInput:d,addFilesToQueue:D}),Y=ke(t),p=F(()=>Object(t.modelValue)===t.modelValue?"length"in t.modelValue?Array.from(t.modelValue):[t.modelValue]:[]),H=F(()=>ne(p.value)),G=F(()=>p.value.map(i=>i.name).join(", ")),e=F(()=>Re(p.value.reduce((i,C)=>i+C.size,0))),c=F(()=>({totalSize:e.value,filesNumber:p.value.length,maxFiles:t.maxFiles})),v=F(()=>({tabindex:-1,type:"file",title:"",accept:t.accept,capture:t.capture,name:Q.value,...s,id:f.targetUid.value,disabled:f.editable.value!==!0})),_=F(()=>"q-file q-field--auto-height"+(a.value===!0?" q-file--dnd":"")),n=F(()=>t.multiple===!0&&t.append===!0);function b(i){const C=p.value.slice();C.splice(i,1),u(C)}function y(i){const C=p.value.indexOf(i);C!==-1&&b(C)}function u(i){P("update:modelValue",t.multiple===!0?i:i[0])}function g(i){i.keyCode===13&&Se(i)}function N(i){(i.keyCode===13||i.keyCode===32)&&I(i)}function d(){return w.value}function D(i,C){const V=O(i,C,p.value,n.value),te=d();te!=null&&(te.value=""),V!==void 0&&((t.multiple===!0?t.modelValue&&V.every(ve=>p.value.includes(ve)):t.modelValue===V[0])||u(n.value===!0?p.value.concat(V):V))}function k(){return[U("input",{class:[t.inputClass,"q-file__filler"],style:t.inputStyle})]}function q(){if(o.file!==void 0)return p.value.length===0?k():p.value.map((C,V)=>o.file({index:V,file:C,ref:this}));if(o.selected!==void 0)return p.value.length===0?k():o.selected({files:p.value,ref:this});if(t.useChips===!0)return p.value.length===0?k():p.value.map((C,V)=>U(pe,{key:"file-"+V,removable:f.editable.value,dense:!0,textColor:t.color,tabindex:t.tabindex,onRemove:()=>{b(V)}},()=>U("span",{class:"ellipsis",textContent:C.name})));const i=t.displayValue!==void 0?t.displayValue:G.value;return i.length!==0?[U("div",{class:t.inputClass,style:t.inputStyle,textContent:i})]:k()}function ge(){const i={ref:w,...v.value,...Y.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:D};return t.multiple===!0&&(i.multiple=!0),U("input",i)}return Object.assign(f,{fieldClass:_,emitValue:u,hasValue:H,inputRef:w,innerValue:p,floatingLabel:F(()=>H.value===!0||ne(t.displayValue)),computedCounter:F(()=>{if(t.counterLabel!==void 0)return t.counterLabel(c.value);const i=t.maxFiles;return`${p.value.length}${i!==void 0?" / "+i:""} (${e.value})`}),getControlChild:()=>X("file"),getControl:()=>{const i={ref:f.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:t.tabindex};return f.editable.value===!0&&Object.assign(i,{onDragover:B,onDragleave:M,onKeydown:g,onKeyup:N}),U("div",i,[ge()].concat(q()))}}),Object.assign(m,{removeAtIndex:b,removeFile:y,getNativeElement:()=>w.value}),De(m,"nativeEl",()=>w.value),Ve(f)}});const Je={name:"ClubCommunity",components:{ClubNavigationMenu:Xe},setup(){const t=Pe(),o=S("followed"),P=S([]),s=S([]),m=S([]),f=Qe(),w=S(""),a=S(null),Q=S(!1),I={like:"\u{1F44D}",love:"\u2764\uFE0F",laugh:"\u{1F602}",wow:"\u{1F62E}",sad:"\u{1F622}",angry:"\u{1F621}"},B=async()=>{try{const{data:e,error:c}=await z.from("follows").select("followed_id").eq("follower_id",f.userId);if(c)throw c;const v=e.map(d=>d.followed_id),{data:_,error:n}=await z.from("profiles").select("id, full_name, user_type, club_id").in("id",v);if(n)throw n;const{data:b,error:y}=await z.from("players").select("user_id, photo_url").in("user_id",v);if(y)throw y;const u=_.filter(d=>d.user_type==="club").map(d=>d.club_id),{data:g,error:N}=await z.from("clubs").select("id, logo_url").in("id",u);if(N)throw N;P.value=_.map(d=>{const D=b.find(q=>q.user_id===d.id),k=g.find(q=>q.id===d.club_id);return{id:d.id,name:d.full_name,photo_url:d.user_type==="player"?D==null?void 0:D.photo_url:(k==null?void 0:k.logo_url)||"default-avatar.png",type:d.user_type}})}catch(e){console.error("Error al obtener usuarios seguidos:",e)}},M=async()=>{try{const{data:e,error:c}=await z.from("follows").select("follower_id").eq("followed_id",f.userId);if(c)throw c;const v=e.map(d=>d.follower_id),{data:_,error:n}=await z.from("profiles").select("id, full_name, user_type, club_id").in("id",v);if(n)throw n;const{data:b,error:y}=await z.from("players").select("user_id, photo_url").in("user_id",v);if(y)throw y;const u=_.filter(d=>d.user_type==="club").map(d=>d.club_id),{data:g,error:N}=await z.from("clubs").select("id, logo_url").in("id",u);if(N)throw N;s.value=_.map(d=>{const D=b.find(q=>q.user_id===d.id),k=g.find(q=>q.id===d.club_id);return{id:d.id,name:d.full_name,photo_url:d.user_type==="player"?D==null?void 0:D.photo_url:(k==null?void 0:k.logo_url)||"default-avatar.png",type:d.user_type}})}catch(e){console.error("Error al obtener seguidores:",e)}},O=async()=>{try{const e=await $.get(`community/posts/club/${f.clubId}`);console.log("Datos recibidos:",e.data),m.value=e.data.posts}catch(e){console.error("Error al obtener posts:",e)}},X=async()=>{try{let e=null;const c=await $.post("/community/posts",{club_id:f.clubId,content:w.value});console.log(c.data.data[0].id);const v=c.data.data[0].id;if(a.value){const _=new FormData;_.append("file",a.value);const n=await $.post(`/community/posts/upload-media?post_id=${v}`,_,{headers:{"Content-Type":"multipart/form-data"}})}m.value.unshift(c.data),w.value="",a.value=null}catch(e){console.error("Error al crear post:",e)}},Y=async e=>{try{await $.delete(`community/posts/${e}`,{data:{club_id:f.clubId}}),m.value=m.value.filter(c=>c.id!==e)}catch(c){console.error("Error al eliminar post:",c)}},p=e=>{if(!e)return"Fecha no disponible";const c=new Date(e);return isNaN(c.getTime())?"Fecha no disponible":c.toLocaleString()};return Ie(()=>{B(),M(),O()}),{tab:o,followedUsers:P,followers:s,posts:m,newPostContent:w,showCreatePostDialog:Q,createPost:X,deletePost:Y,formatDate:p,goBack:()=>{t.back()},reactionEmojis:I,newPostMedia:a,goToDashboard:()=>{We(t,f)}}}},$e={class:"header-content"},et={class:"greeting"},tt={class:"header-icons"},at={key:0,class:"text-center q-pa-md"},lt=["src"],ot={key:0,class:"text-center q-pa-md"},rt=["src"],nt={class:"text-center q-pa-md"},st={key:0,class:"q-mt-sm"},it=["src"],ut={class:"q-mt-sm"};function dt(t,o,P,s,m,f){const w=Ne("ClubNavigationMenu");return h(),T(Oe,{view:"hHh lpR fFf",class:"body text-white"},{default:r(()=>[l(Ae,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[x("div",$e,[x("div",et,[x("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:o[0]||(o[0]=(...a)=>s.goToDashboard&&s.goToDashboard(...a))}),o[7]||(o[7]=j(" Comunidad del Club ",-1))]),x("div",tt,[l(K,{flat:"",round:"",icon:"arrow_back",onClick:s.goBack},null,8,["onClick"])])])]),_:1}),l(Le,null,{default:r(()=>[l(Me,{class:"q-pa-md"},{default:r(()=>[l(Ue,{modelValue:s.tab,"onUpdate:modelValue":o[1]||(o[1]=a=>s.tab=a),align:"justify",class:"text-white"},{default:r(()=>[l(ae,{name:"followed",label:"Seguidos"}),l(ae,{name:"followers",label:"Seguidores"}),l(ae,{name:"wall",label:"Wall"})]),_:1},8,["modelValue"]),l(Be,{modelValue:s.tab,"onUpdate:modelValue":o[3]||(o[3]=a=>s.tab=a),animated:"",class:"transparent-card q-mt-md"},{default:r(()=>[l(re,{name:"followed"},{default:r(()=>[s.followedUsers.length===0?(h(),A("div",at,[l(se,{name:"people",size:"2em"}),o[8]||(o[8]=x("p",{class:"q-mt-sm"},"No sigues a ning\xFAn usuario todav\xEDa.",-1))])):(h(),T(oe,{key:1,bordered:""},{default:r(()=>[(h(!0),A(J,null,Z(s.followedUsers,a=>(h(),T(le,{key:a.id,class:"q-mb-sm"},{default:r(()=>[l(L,{avatar:""},{default:r(()=>[l(de,null,{default:r(()=>[x("img",{src:a.photo_url||"default-avatar.png"},null,8,lt)]),_:2},1024)]),_:2},1024),l(L,null,{default:r(()=>[l(R,null,{default:r(()=>[j(E(a.name),1)]),_:2},1024),l(R,{caption:""},{default:r(()=>[j(E(a.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),l(re,{name:"followers"},{default:r(()=>[s.followers.length===0?(h(),A("div",ot,[l(se,{name:"people",size:"2em"}),o[9]||(o[9]=x("p",{class:"q-mt-sm"},"No tienes seguidores todav\xEDa.",-1))])):(h(),T(oe,{key:1,bordered:""},{default:r(()=>[(h(!0),A(J,null,Z(s.followers,a=>(h(),T(le,{key:a.id,class:"q-mb-sm"},{default:r(()=>[l(L,{avatar:""},{default:r(()=>[l(de,null,{default:r(()=>[x("img",{src:a.photo_url||"default-avatar.png"},null,8,rt)]),_:2},1024)]),_:2},1024),l(L,null,{default:r(()=>[l(R,null,{default:r(()=>[j(E(a.name),1)]),_:2},1024),l(R,{caption:""},{default:r(()=>[j(E(a.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),l(re,{name:"wall"},{default:r(()=>[x("div",nt,[l(K,{icon:"add",color:"black",class:"q-mb-xl fixed-bottom-right",size:"lg",glossy:"",round:"",onClick:o[2]||(o[2]=a=>s.showCreatePostDialog=!0)})]),l(oe,{bordered:"",class:"q-mt-md"},{default:r(()=>[(h(!0),A(J,null,Z(s.posts,a=>(h(),T(le,{key:a.id,class:"q-mb-sm"},{default:r(()=>[l(L,null,{default:r(()=>[l(R,null,{default:r(()=>[j(E(a.content),1)]),_:2},1024),l(R,{caption:""},{default:r(()=>[j(E(s.formatDate(a.created_at)),1)]),_:2},1024),a.media_url?(h(),A("div",st,[x("img",{src:a.media_url,style:{"max-width":"100%","border-radius":"8px"},alt:"Imagen del post"},null,8,it)])):je("",!0),x("div",ut,[(h(!0),A(J,null,Z(a.reactions,(Q,I)=>(h(),T(pe,{color:"transparent",key:I},{default:r(()=>[x("span",null,E(s.reactionEmojis[I])+" "+E(Q),1)]),_:2},1024))),128))])]),_:2},1024),l(L,{side:""},{default:r(()=>[l(K,{flat:"",icon:"delete",color:"negative",onClick:Q=>s.deletePost(a.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(Te,{modelValue:s.showCreatePostDialog,"onUpdate:modelValue":o[6]||(o[6]=a=>s.showCreatePostDialog=a)},{default:r(()=>[l(qe,{class:"q-pa-md bg-black",style:{"min-width":"300px"}},{default:r(()=>[l(ie,null,{default:r(()=>[...o[10]||(o[10]=[x("div",{class:"text-h6"},"Nuevo Post",-1)])]),_:1}),l(ie,null,{default:r(()=>[l(Ee,{modelValue:s.newPostContent,"onUpdate:modelValue":o[4]||(o[4]=a=>s.newPostContent=a),type:"textarea",label:"Escribe tu post",autogrow:""},null,8,["modelValue"]),l(Ze,{modelValue:s.newPostMedia,"onUpdate:modelValue":o[5]||(o[5]=a=>s.newPostMedia=a),label:"Subir imagen o video",accept:"image/*, video/*",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),l(ze,{align:"right"},{default:r(()=>[ue(l(K,{flat:"",label:"Cancelar",color:"negative"},null,512),[[ce]]),ue(l(K,{flat:"",label:"Publicar",color:"green",onClick:s.createPost},null,8,["onClick"]),[[ce]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(w)]),_:1})}var Et=Ye(Je,[["render",dt],["__scopeId","data-v-5303ab14"]]);export{Et as default};
