import{Q as L}from"./QHeader.22bc8748.js";import{Q as B}from"./QSpinnerCube.c0d1e0b0.js";import{a7 as E,F as A,r as _,B as F,j as R,q as r,G as b,H as c,v as l,I as s,a9 as $,aa as H,s as n,x as i,aM as V,ae as u,ab as o,y as d,ad as z,ac as M,J as k,bC as T,bM as U}from"./index.cf1ae381.js";import{Q as j}from"./QPage.3d29d4c0.js";import{Q as Y,a as G}from"./QLayout.3b12d370.js";import{u as J}from"./use-quasar.fa8835f9.js";import{u as O}from"./summaryStore.3ee9c4fd.js";import{u as K}from"./userStore.f5a1e81d.js";import{g as W,a as X}from"./lessons.2f99326b.js";import{N as Z}from"./NotificationBell.0da2f78e.js";import{B as ee}from"./BannerPromoScrolling.6426d6e1.js";import{P as ae}from"./PlayerNavigationMenu.dd810e15.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.063153d6.js";import"./supabase.ad40cb04.js";import"./QBadge.ceb3bab5.js";import"./api.f1a1189d.js";import"./admin.5ab62d8c.js";import"./QTabs.2d6a2a07.js";import"./rtl.276c3f1b.js";import"./QFooter.b33a1995.js";const le={class:"header-content"},te={class:"header-icons"},oe={key:0,class:"q-pa-xl text-center"},re={key:1,class:"q-pa-md q-gutter-sm"},ne={key:0},ie={key:1,class:"q-mt-md"},ue={class:"q-gutter-xs row items-center"},ce=["src","alt"],de={key:1},me={key:2},pe={class:"q-mt-lg text-center"},ve={key:1,class:"text-negative text-caption q-mt-xs"},ge={key:2,class:"text-positive text-caption q-mt-xs"},fe={key:2,class:"q-pa-md text-center text-negative"},ye={__name:"LessonDetails",setup(_e){const f=E(),C=A(),D=O(),p=J(),y=K(),x=f.params.lessonId,I=f.query.clubId,P=f.query.clubName||"Club no especificado",a=_(null),v=_(!0),g=_([]),Q=async()=>{if(v.value=!0,a.value=null,g.value=[],!x){console.error("ID de la lecci\xF3n no encontrado en los par\xE1metros de la ruta."),p.notify({type:"negative",message:"No se pudo identificar la clase."}),v.value=!1;return}try{const t=await W(x);if(a.value=t[0],!a.value||typeof a.value!="object")throw new Error("Respuesta inv\xE1lida del API al cargar detalles de clase.");if(a.value.players&&a.value.players.length>0)try{const e=await X(a.value.players);g.value=e}catch(e){console.error("Error al cargar datos de los jugadores:",e)}}catch(t){console.error("Error al cargar detalles de la lecci\xF3n:",t),a.value=null,p.notify({type:"negative",message:"Error al cargar la informaci\xF3n de la clase."})}finally{v.value=!1}},S=()=>{if(!a.value){console.error("Detalles de la lecci\xF3n no est\xE1n cargados para ir al resumen."),p.notify({type:"negative",message:"No se pueden obtener los detalles de la clase."});return}if(a.value.available_slots<=0){p.notify({type:"warning",message:"Ya no hay cupos disponibles para esta clase."});return}const t=a.value,e={summaryTitle:"Resumen de Inscripci\xF3n",itemDetails:[{label:"Club",value:P},{label:"Clase",value:t.name||"No especificado"},{label:"Fecha",value:t.lesson_date||"No especificada"},{label:"Hora",value:`${t.lesson_time||"--:--"} hrs.`},{label:"Duraci\xF3n",value:`${t.duration||60} minutos`}],baseData:{clubId:I,price:t.price||0,participants:1,type:"public_lesson",id:t.id},allowPaymentSplit:!1,showPublicToggle:!1,commissionRate:4,extraData:{coachName:t.coach_name,lessonDescription:t.description}};D.setSummaryDetails(e),console.log("Datos del resumen de CLASE P\xDABLICA guardados en Pinia:",e),C.push({name:"OrderSummary"})};F(()=>{Q()});const h=R(()=>!a.value||!a.value.players||!y.userId?!1:a.value.players.includes(y.userId)),w=t=>{if(!t)return"??";const e=t.split("-");return e.length>0?e[0].substring(0,2).toUpperCase():userId.substring(0,2).toUpperCase()};return(t,e)=>(r(),b(Y,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:c(()=>[l(L,{elevated:"",class:"text-white"},{default:c(()=>[s("div",le,[e[1]||(e[1]=s("div",{class:"greeting"},[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})],-1)),s("div",te,[l(Z)])]),l(ee)]),_:1}),l(G,{class:"home"},{default:c(()=>[l(j,{class:"q-pa-md"},{default:c(()=>[l($,null,{default:c(()=>[l(H,null,{default:c(()=>{var q,N;return[v.value?(r(),n("div",oe,[l(B,{color:"primary",size:"xl"}),e[2]||(e[2]=s("p",{class:"q-mt-md"},"Cargando detalles de la clase...",-1))])):a.value?(r(),n("div",re,[s("h3",null,i(a.value.name||"Clase sin Nombre"),1),l(V,{dark:"",spaced:"md"}),a.value.description?(r(),n("p",ne,[s("strong",null,[l(u,{name:"mdi-information-outline",class:"q-mr-xs"}),e[3]||(e[3]=o("Descripci\xF3n:"))]),o(" "+i(a.value.description),1)])):d("",!0),s("p",null,[s("strong",null,[l(u,{name:"mdi-calendar",class:"q-mr-xs"}),e[4]||(e[4]=o("Fecha:"))]),o(" "+i(a.value.lesson_date||"No especificada"),1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-clock-outline",class:"q-mr-xs"}),e[5]||(e[5]=o("Hora:"))]),o(" "+i(a.value.lesson_time||"No especificada")+" hrs. ",1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-timer-sand",class:"q-mr-xs"}),e[6]||(e[6]=o("Duraci\xF3n:"))]),o(" "+i(a.value.duration||"60")+" minutos ",1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-account-supervisor-circle-outline",class:"q-mr-xs"}),e[7]||(e[7]=o("Coach:"))]),o(" "+i(a.value.coaches.name||"No asignado"),1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-cash",class:"q-mr-xs"}),e[8]||(e[8]=o("Precio Inscripci\xF3n:"))]),o(" $"+i(((q=a.value.price)==null?void 0:q.toFixed(2))||"N/A"),1)]),g.value.length>0?(r(),n("div",ie,[s("p",null,[s("strong",null,[l(u,{name:"mdi-account-check",class:"q-mr-xs"}),e[9]||(e[9]=o("Participantes:"))])]),s("div",ue,[(r(!0),n(z,null,M(g.value,m=>(r(),b(T,{key:m.user_id,size:"48px",color:"white","text-color":"black",class:"overlapping"},{default:c(()=>[m.photo_url?(r(),n("img",{key:0,src:m.photo_url,alt:m.user_id},null,8,ce)):(r(),n("span",de,i(w(U(y).fullName)),1))]),_:2},1024))),128))])])):d("",!0),a.value.max_participants!=null?(r(),n("p",me,[s("strong",null,[l(u,{name:"mdi-account-group-outline",class:"q-mr-xs"}),e[10]||(e[10]=o("Cupo:"))]),o(" "+i((N=a.value.available_slots)!=null?N:"N/A")+" / "+i(a.value.max_participants)+" disponibles ",1)])):d("",!0),s("div",pe,[h.value?d("",!0):(r(),b(k,{key:0,color:"green",label:"Inscribirme","icon-right":"mdi-pencil-plus-outline",onClick:S,class:"full-width",size:"lg",push:"",disable:!a.value||a.value.available_slots<=0,title:!a.value||a.value.available_slots<=0?"No hay cupos disponibles o la clase no se carg\xF3":"Inscribirse a esta clase"},null,8,["disable","title"])),!a.value||a.value.available_slots<=0?(r(),n("div",ve,i(a.value?"No hay cupos disponibles":"Error al cargar la clase"),1)):d("",!0),h.value?(r(),n("div",ge," Ya est\xE1s inscrito en esta clase. ")):d("",!0)])])):(r(),n("div",fe,[l(u,{name:"mdi-alert-circle-outline",size:"lg"}),e[11]||(e[11]=s("p",{class:"q-mt-md"},"No se pudieron cargar los detalles de la clase.",-1)),l(k,{flat:"",label:"Volver",onClick:e[0]||(e[0]=m=>t.$router.go(-1))})]))]}),_:1})]),_:1})]),_:1}),l(ae)]),_:1})]),_:1}))}};var Ve=se(ye,[["__scopeId","data-v-18d737ce"]]);export{Ve as default};
