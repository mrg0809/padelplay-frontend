import{a7 as ae,F as le,r as _,j as oe,B as se,a8 as ne,q as c,G as R,H as r,v as l,I as t,ab as b,J as h,s as p,a9 as w,aa as V,x as i,aM as re,ad as M,ac as U,ae as J,y as C,ah as L,K as k,af as A,ag as K}from"./index.e023fc86.js";import{Q as ie}from"./QHeader.56feab89.js";import{Q as de}from"./QSpinnerPuff.c50ff542.js";import{Q as W}from"./QBadge.8ff69d7d.js";import{Q as ue,a as I}from"./QTabs.5da5ba79.js";import{a as me,Q as B}from"./QTabPanel.b8b736db.js";import{Q as ce}from"./QMarkupTable.82668ccd.js";import{Q as X}from"./QSelect.e71dbd52.js";import{Q as ge}from"./QPage.9f755cb5.js";import{Q as _e,a as ve}from"./QLayout.5de9f2c5.js";import{C as Y}from"./ClosePopup.1e64f2e8.js";import{u as pe}from"./use-quasar.116c74f8.js";import{s as Z}from"./supabase.a7ca61c0.js";import{a as E}from"./api.2af71db3.js";import{C as fe}from"./ClubNavigationMenu.1df79f28.js";import{g as ye}from"./tournamentUtils.cfdf57cc.js";import{_ as be}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.009d0490.js";import"./use-render-cache.770e5fe8.js";import"./selection.709b2df1.js";import"./QChip.72fe66c5.js";import"./QItem.67c7d6d6.js";import"./QItemLabel.c5b968dc.js";import"./QMenu.25ad741b.js";import"./position-engine.28b0865b.js";import"./format.de7e9769.js";import"./QFooter.1e0bb873.js";const he={name:"ManageTournament",components:{ClubNavigationMenu:fe},setup(){const q=ae(),e=le(),f=pe(),a=_(null),S=_([]),T=_([]),F=_(!1),o=_("matches"),m=_(!1),d=_(!1),v=_(null),D=_(!1),N=_(!1),g=_({set1_team1:null,set1_team2:null,set2_team1:null,set2_team2:null,set3_team1:null,set3_team2:null,winner:null}),Q=_({match_date:null,match_time:null,court_id:null}),O=_([]),$=oe(()=>v.value?[{label:v.value.team1,value:v.value.team1_players[0]},{label:v.value.team2,value:v.value.team2_players[0]}]:[]);se(async()=>{await ee(),await P(),await j(),await te()});const ee=async()=>{F.value=!0;try{const s=q.params.tournamentId,{data:n,error:u}=await Z.from("tournaments").select("*").eq("id",s).single();if(u)throw u;a.value=n}catch(s){console.error("Error loading tournament:",s),f.notify({type:"negative",message:"Error al cargar el torneo"})}finally{F.value=!1}},P=async()=>{try{const s=q.params.tournamentId,n=await E.get(`/tournaments/${s}/matches`);S.value=n.data.matches}catch(s){console.error("Error loading matches:",s),f.notify({type:"negative",message:"Error al cargar los partidos"})}},j=async()=>{try{const s=q.params.tournamentId,n=await E.get(`/tournaments/${s}/standings`);T.value=n.data.standings}catch(s){console.error("Error loading standings:",s),f.notify({type:"negative",message:"Error al cargar las posiciones"})}},te=async()=>{var s;try{if((s=a.value)!=null&&s.courts_used){const{data:n,error:u}=await Z.from("courts").select("id, name").in("id",a.value.courts_used);!u&&n&&(O.value=n.map(x=>({label:x.name,value:x.id})))}}catch(n){console.error("Error loading courts:",n)}};return{tournament:a,matches:S,standings:T,loading:F,activeTab:o,resultDialogVisible:m,rescheduleDialogVisible:d,selectedMatch:v,resultForm:g,rescheduleForm:Q,courtOptions:O,winnerOptions:$,savingResult:D,savingReschedule:N,getSystemName:s=>ye(s),formatScore:s=>{if(!s)return"Sin resultado";try{const n=typeof s=="string"?JSON.parse(s):s;let u=[];return n.set1&&u.push(`${n.set1.team1}-${n.set1.team2}`),n.set2&&u.push(`${n.set2.team1}-${n.set2.team2}`),n.set3&&u.push(`${n.set3.team1}-${n.set3.team2}`),u.join(", ")}catch{return"Error en formato"}},openResultDialog:s=>{var n,u,x,z,G,H;if(v.value=s,s.score)try{const y=typeof s.score=="string"?JSON.parse(s.score):s.score;g.value={set1_team1:((n=y.set1)==null?void 0:n.team1)||null,set1_team2:((u=y.set1)==null?void 0:u.team2)||null,set2_team1:((x=y.set2)==null?void 0:x.team1)||null,set2_team2:((z=y.set2)==null?void 0:z.team2)||null,set3_team1:((G=y.set3)==null?void 0:G.team1)||null,set3_team2:((H=y.set3)==null?void 0:H.team2)||null,winner:s.winner}}catch(y){console.error("Error parsing score:",y)}else g.value={set1_team1:null,set1_team2:null,set2_team1:null,set2_team2:null,set3_team1:null,set3_team2:null,winner:null};m.value=!0},openRescheduleDialog:s=>{v.value=s,Q.value={match_date:s.match_date,match_time:s.match_time,court_id:s.court_id},d.value=!0},saveResult:async()=>{var s,n;if(!!v.value){if(!g.value.winner){f.notify({type:"negative",message:"Debes seleccionar un ganador"});return}D.value=!0;try{const u={set1:{team1:g.value.set1_team1,team2:g.value.set1_team2},set2:{team1:g.value.set2_team1,team2:g.value.set2_team2}};g.value.set3_team1!==null&&g.value.set3_team2!==null&&(u.set3={team1:g.value.set3_team1,team2:g.value.set3_team2});const x=await E.put(`/tournaments/${a.value.id}/matches/${v.value.id}/result`,{score:u,winner:g.value.winner});f.notify({type:"positive",message:"Resultado guardado exitosamente"}),m.value=!1,await P(),await j()}catch(u){console.error("Error saving result:",u),f.notify({type:"negative",message:((n=(s=u.response)==null?void 0:s.data)==null?void 0:n.detail)||"Error al guardar el resultado"})}finally{D.value=!1}}},saveReschedule:async()=>{var s,n;if(!!v.value){N.value=!0;try{const u=await E.put(`/tournaments/${a.value.id}/matches/${v.value.id}/reschedule`,{match_date:Q.value.match_date,match_time:Q.value.match_time+":00",court_id:Q.value.court_id});f.notify({type:"positive",message:"Partido reagendado exitosamente"}),d.value=!1,await P()}catch(u){console.error("Error rescheduling match:",u),f.notify({type:"negative",message:((n=(s=u.response)==null?void 0:s.data)==null?void 0:n.detail)||"Error al reagendar el partido"})}finally{N.value=!1}}},goBack:()=>{e.back()}}}},Ve={class:"header-content"},ke={class:"header-icons"},xe={key:0,class:"text-center q-mt-md"},we={key:1},Ce={class:"q-mt-none"},Fe={class:"row q-gutter-md"},Qe={class:"col"},qe={class:"col"},Re={class:"matches-list"},Ee={class:"match-header row items-center justify-between"},Se={class:"col"},Te={class:"q-my-none"},De={class:"text-caption q-mb-none"},Ne={class:"col-auto"},Pe={key:0,class:"q-mt-md"},Me={class:"q-mt-md row q-gutter-sm"},Ue={key:0,class:"text-center q-pa-xl"},Ie={class:"text-left"},Be={class:"text-left"},Oe={class:"text-center"},je={class:"text-center"},ze={class:"text-center"},Ge={class:"text-center"},He={key:0,class:"text-center q-pa-xl"},Je={class:"bracket-view q-mt-md"},Le={class:"bracket-match-content"},Ae={class:"bracket-team"},Ke={class:"bracket-team"},We={class:"bracket-details text-caption"},Xe={class:"q-gutter-md"},Ye={class:"q-gutter-md"};function Ze(q,e,f,a,S,T){const F=ne("ClubNavigationMenu");return c(),R(_e,{view:"hHh lpR fFf",class:"body text-white"},{default:r(()=>[l(ie,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[t("div",Ve,[e[14]||(e[14]=t("div",{class:"greeting"},[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),b(" Administrar Torneo ")],-1)),t("div",ke,[l(h,{flat:"",round:"",icon:"arrow_back",onClick:a.goBack},null,8,["onClick"])])])]),_:1}),l(ve,null,{default:r(()=>[l(ge,{class:"q-pa-md"},{default:r(()=>[a.loading?(c(),p("div",xe,[l(de,{color:"primary",size:"3em"}),e[15]||(e[15]=t("p",null,"Cargando informaci\xF3n del torneo...",-1))])):a.tournament?(c(),p("div",we,[l(w,{class:"q-mb-md transparent-card"},{default:r(()=>[l(V,null,{default:r(()=>[t("h4",Ce,i(a.tournament.name),1),t("div",Fe,[t("div",Qe,[t("p",null,[e[16]||(e[16]=t("strong",null,"Sistema:",-1)),b(" "+i(a.getSystemName(a.tournament.system)),1)]),t("p",null,[e[17]||(e[17]=t("strong",null,"Categor\xEDa:",-1)),b(" "+i(a.tournament.category),1)]),t("p",null,[e[18]||(e[18]=t("strong",null,"G\xE9nero:",-1)),b(" "+i(a.tournament.gender),1)])]),t("div",qe,[t("p",null,[e[19]||(e[19]=t("strong",null,"Fecha Inicio:",-1)),b(" "+i(a.tournament.start_date),1)]),t("p",null,[e[20]||(e[20]=t("strong",null,"Fecha Fin:",-1)),b(" "+i(a.tournament.end_date),1)]),t("p",null,[e[22]||(e[22]=t("strong",null,"Estado:",-1)),l(W,{color:"green"},{default:r(()=>e[21]||(e[21]=[b("Cerrado")])),_:1})])])])]),_:1})]),_:1}),l(ue,{modelValue:a.activeTab,"onUpdate:modelValue":e[0]||(e[0]=o=>a.activeTab=o),dense:"",class:"text-white","active-color":"primary","indicator-color":"primary",align:"justify"},{default:r(()=>[l(I,{name:"matches",label:"Partidos",icon:"sports_tennis"}),l(I,{name:"standings",label:"Posiciones",icon:"emoji_events"}),l(I,{name:"bracket",label:"Cuadro",icon:"grid_on"})]),_:1},8,["modelValue"]),l(re),l(me,{modelValue:a.activeTab,"onUpdate:modelValue":e[1]||(e[1]=o=>a.activeTab=o),animated:"",class:"transparent-bg"},{default:r(()=>[l(B,{name:"matches"},{default:r(()=>[t("div",Re,[(c(!0),p(M,null,U(a.matches,o=>(c(),R(w,{key:o.id,class:"q-mb-md transparent-card"},{default:r(()=>[l(V,null,{default:r(()=>[t("div",Ee,[t("div",Se,[t("h6",Te,i(o.team1)+" vs "+i(o.team2),1),t("p",De,i(o.match_date)+" - "+i(o.match_time.substring(0,5))+" | Cancha: "+i(o.court_name),1)]),t("div",Ne,[l(W,{color:o.has_result?"green":"orange",label:o.has_result?"Finalizado":"Pendiente"},null,8,["color","label"])])]),o.has_result?(c(),p("div",Pe,[t("p",null,[e[23]||(e[23]=t("strong",null,"Resultado:",-1)),b(" "+i(a.formatScore(o.score)),1)])])):C("",!0),t("div",Me,[o.has_result?C("",!0):(c(),R(h,{key:0,label:"Registrar Resultado",color:"green",size:"sm",icon:"edit_note",onClick:m=>a.openResultDialog(o)},null,8,["onClick"])),o.has_result?(c(),R(h,{key:1,label:"Editar Resultado",color:"primary",size:"sm",icon:"edit",onClick:m=>a.openResultDialog(o)},null,8,["onClick"])):C("",!0),l(h,{label:"Reagendar",color:"orange",size:"sm",icon:"schedule",onClick:m=>a.openRescheduleDialog(o)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),a.matches.length===0?(c(),p("div",Ue,[l(J,{name:"info",size:"3em",color:"grey"}),e[24]||(e[24]=t("p",null,"No hay partidos programados",-1))])):C("",!0)])]),_:1}),l(B,{name:"standings"},{default:r(()=>[l(w,{class:"transparent-card"},{default:r(()=>[l(V,null,{default:r(()=>[e[27]||(e[27]=t("h6",{class:"q-mt-none"},"Tabla de Posiciones",-1)),l(ce,{flat:"",bordered:"",class:"standings-table"},{default:r(()=>[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Equipo"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"Pts")])],-1)),t("tbody",null,[(c(!0),p(M,null,U(a.standings,(o,m)=>(c(),p("tr",{key:o.team_id},[t("td",Ie,i(m+1),1),t("td",Be,i(o.team_name),1),t("td",Oe,i(o.matches_played),1),t("td",je,i(o.wins),1),t("td",ze,i(o.losses),1),t("td",Ge,[t("strong",null,i(o.points),1)])]))),128))])]),_:1}),a.standings.length===0?(c(),p("div",He,[l(J,{name:"info",size:"3em",color:"grey"}),e[26]||(e[26]=t("p",null,"No hay resultados registrados a\xFAn",-1))])):C("",!0)]),_:1})]),_:1})]),_:1}),l(B,{name:"bracket"},{default:r(()=>[l(w,{class:"transparent-card"},{default:r(()=>[l(V,null,{default:r(()=>[e[29]||(e[29]=t("h6",{class:"q-mt-none"},"Cuadro del Torneo",-1)),e[30]||(e[30]=t("p",{class:"text-caption"},"Vista del cuadro completo del torneo",-1)),t("div",Je,[(c(!0),p(M,null,U(a.matches,o=>(c(),p("div",{key:o.id,class:"bracket-match q-mb-sm"},[t("div",Le,[t("div",Ae,i(o.team1),1),e[28]||(e[28]=t("div",{class:"bracket-vs"},"vs",-1)),t("div",Ke,i(o.team2),1)]),t("div",We,i(o.match_date)+" - "+i(o.match_time.substring(0,5)),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):C("",!0),l(L,{modelValue:a.resultDialogVisible,"onUpdate:modelValue":e[9]||(e[9]=o=>a.resultDialogVisible=o)},{default:r(()=>[l(w,{class:"bg-dark text-white",style:{"min-width":"350px"}},{default:r(()=>[l(V,null,{default:r(()=>e[31]||(e[31]=[t("div",{class:"text-h6"},"Registrar Resultado",-1)])),_:1}),l(V,null,{default:r(()=>{var o,m;return[t("p",null,[t("strong",null,i((o=a.selectedMatch)==null?void 0:o.team1)+" vs "+i((m=a.selectedMatch)==null?void 0:m.team2),1)]),t("div",Xe,[l(k,{modelValue:a.resultForm.set1_team1,"onUpdate:modelValue":e[2]||(e[2]=d=>a.resultForm.set1_team1=d),type:"number",label:"Set 1 - Equipo 1",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(k,{modelValue:a.resultForm.set1_team2,"onUpdate:modelValue":e[3]||(e[3]=d=>a.resultForm.set1_team2=d),type:"number",label:"Set 1 - Equipo 2",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(k,{modelValue:a.resultForm.set2_team1,"onUpdate:modelValue":e[4]||(e[4]=d=>a.resultForm.set2_team1=d),type:"number",label:"Set 2 - Equipo 1",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(k,{modelValue:a.resultForm.set2_team2,"onUpdate:modelValue":e[5]||(e[5]=d=>a.resultForm.set2_team2=d),type:"number",label:"Set 2 - Equipo 2",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(k,{modelValue:a.resultForm.set3_team1,"onUpdate:modelValue":e[6]||(e[6]=d=>a.resultForm.set3_team1=d),type:"number",label:"Set 3 - Equipo 1 (Opcional)",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(k,{modelValue:a.resultForm.set3_team2,"onUpdate:modelValue":e[7]||(e[7]=d=>a.resultForm.set3_team2=d),type:"number",label:"Set 3 - Equipo 2 (Opcional)",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(X,{modelValue:a.resultForm.winner,"onUpdate:modelValue":e[8]||(e[8]=d=>a.resultForm.winner=d),options:a.winnerOptions,label:"Ganador",outlined:"",dark:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]}),_:1}),l(A,{align:"right"},{default:r(()=>[K(l(h,{flat:"",label:"Cancelar",color:"red"},null,512),[[Y]]),l(h,{flat:"",label:"Guardar",color:"green",onClick:a.saveResult,loading:a.savingResult},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(L,{modelValue:a.rescheduleDialogVisible,"onUpdate:modelValue":e[13]||(e[13]=o=>a.rescheduleDialogVisible=o)},{default:r(()=>[l(w,{class:"bg-dark text-white",style:{"min-width":"350px"}},{default:r(()=>[l(V,null,{default:r(()=>e[32]||(e[32]=[t("div",{class:"text-h6"},"Reagendar Partido",-1)])),_:1}),l(V,null,{default:r(()=>{var o,m;return[t("p",null,[t("strong",null,i((o=a.selectedMatch)==null?void 0:o.team1)+" vs "+i((m=a.selectedMatch)==null?void 0:m.team2),1)]),t("div",Ye,[l(k,{modelValue:a.rescheduleForm.match_date,"onUpdate:modelValue":e[10]||(e[10]=d=>a.rescheduleForm.match_date=d),type:"date",label:"Nueva Fecha",outlined:"",dark:""},null,8,["modelValue"]),l(k,{modelValue:a.rescheduleForm.match_time,"onUpdate:modelValue":e[11]||(e[11]=d=>a.rescheduleForm.match_time=d),type:"time",label:"Nueva Hora",outlined:"",dark:""},null,8,["modelValue"]),l(X,{modelValue:a.rescheduleForm.court_id,"onUpdate:modelValue":e[12]||(e[12]=d=>a.rescheduleForm.court_id=d),options:a.courtOptions,label:"Nueva Cancha",outlined:"",dark:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]}),_:1}),l(A,{align:"right"},{default:r(()=>[K(l(h,{flat:"",label:"Cancelar",color:"red"},null,512),[[Y]]),l(h,{flat:"",label:"Guardar",color:"green",onClick:a.saveReschedule,loading:a.savingReschedule},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(F)]),_:1})}var Nt=be(he,[["render",Ze],["__scopeId","data-v-54f0191e"]]);export{Nt as default};
