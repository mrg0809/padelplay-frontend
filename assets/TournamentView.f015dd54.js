import{a9 as X,F as Y,r as y,j as V,B as Z,aa as E,q as l,G as f,H as i,v as n,I as t,J as $,s as c,ab as x,ac as q,x as o,ad as m,y as g,aO as J,af as v,ae as b,ag as h,aS as B}from"./index.3f1076a3.js";import{Q as tt}from"./QHeader.435fe33d.js";import{Q as et}from"./QSpinnerDots.a8988b39.js";import{Q as st,a as S}from"./QTabs.a46b14bb.js";import{Q as T}from"./QBadge.7d912cff.js";import{a as at,Q as N}from"./QTabPanel.5c424fc4.js";import{Q as G}from"./QMarkupTable.0b2ea1f1.js";import{Q as ot}from"./QPage.76b9f650.js";import{Q as nt,a as rt}from"./QLayout.fe9d4509.js";import{u as lt}from"./use-quasar.0801e5c5.js";import{u as it}from"./userStore.83e3996f.js";import{n as dt}from"./navigationUtils.2c4b9dee.js";import{s as j}from"./supabase.1a50364d.js";import{a as z}from"./api.2af71db3.js";import{P as ct}from"./PlayerNavigationMenu.993558b5.js";import{N as mt}from"./NotificationBell.10a15500.js";import{B as ut}from"./BannerPromoScrolling.500b6c87.js";import{D as _t}from"./DesktopNavigation.1b20adb9.js";import{g as gt}from"./tournamentUtils.e8e65a8c.js";import{_ as ft}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.b4019dbb.js";import"./touch.9135741d.js";import"./selection.499e7988.js";import"./use-render-cache.3aae9b27.js";import"./pinia.79532550.js";import"./QFooter.1bfeb9e5.js";import"./admin.c99b9bfe.js";import"./QTooltip.eeb15206.js";import"./position-engine.56b90783.js";const pt={name:"TournamentView",components:{PlayerNavigationMenu:ct,NotificationBell:mt,BannerPromoScrolling:ut,DesktopNavigation:_t},setup(){const k=X(),e=Y(),I=lt(),s=it(),w=y(null),D=y([]),M=y([]),P=y([]),Q=y(null),C=y(null),a=y(!1),_=y("my-matches"),u=y(!1),L=V(()=>s.userId?D.value.filter(r=>r.team1_players.includes(s.userId)||r.team2_players.includes(s.userId)):[]),F=V(()=>{var r;return((r=w.value)==null?void 0:r.system)==="combinado"}),R=V(()=>{var d;const r=(d=w.value)==null?void 0:d.system;return r==="eliminacion directa"||r==="combinado"});Z(async()=>{await H(),await O(),await U(),await A(),F.value&&await K(),R.value&&await W()});const H=async()=>{a.value=!0;try{const r=k.params.tournamentId,{data:d,error:p}=await j.from("tournaments").select("*").eq("id",r).single();if(p)throw p;w.value=d}catch(r){console.error("Error loading tournament:",r),I.notify({type:"negative",message:"Error al cargar el torneo"})}finally{a.value=!1}},O=async()=>{try{const r=k.params.tournamentId,{data:d,error:p}=await j.from("tournament_teams").select("id").eq("tournament_id",r).or(`player1_id.eq.${s.userId},player2_id.eq.${s.userId}`).single();!p&&d&&(C.value=d.id)}catch(r){console.error("Error loading my team:",r)}},U=async()=>{try{const r=k.params.tournamentId,d=await z.get(`/tournaments/${r}/matches`);D.value=d.data.matches}catch(r){console.error("Error loading matches:",r),I.notify({type:"negative",message:"Error al cargar los partidos"})}},A=async()=>{try{const r=k.params.tournamentId,d=await z.get(`/tournaments/${r}/standings`);M.value=d.data.standings,u.value=d.data.is_retas||!1}catch(r){console.error("Error loading standings:",r),I.notify({type:"negative",message:"Error al cargar las posiciones"})}},K=async()=>{try{const r=k.params.tournamentId,d=await z.get(`/tournaments/${r}/groups`);P.value=d.data.groups||[]}catch(r){console.error("Error loading groups:",r),P.value=[]}},W=async()=>{try{const r=k.params.tournamentId,d=await z.get(`/tournaments/${r}/bracket`);Q.value=d.data.bracket||null}catch(r){console.error("Error loading bracket:",r),Q.value=null}};return{tournament:w,matches:D,myMatches:L,standings:M,groups:P,bracket:Q,loading:a,activeTab:_,isRetasTournament:u,hasGroups:F,hasBracket:R,getSystemName:r=>gt(r),formatDate:r=>{const d=new Date(r),p={year:"numeric",month:"long",day:"numeric"};return d.toLocaleDateString("es-ES",p)},formatScore:r=>{if(!r)return"Sin resultado";try{const d=typeof r=="string"?JSON.parse(r):r;let p=[];return d.set1&&p.push(`${d.set1.team1}-${d.set1.team2}`),d.set2&&p.push(`${d.set2.team1}-${d.set2.team2}`),d.set3&&p.push(`${d.set3.team1}-${d.set3.team2}`),p.join(", ")}catch{return"Error en formato"}},isMyTeam:r=>r===C.value,goBack:()=>{e.back()},goToDashboard:()=>{dt(e,s)}}}},yt={class:"header-content"},ht={class:"greeting"},vt={class:"header-icons"},bt={key:0,class:"text-center q-mt-md"},kt={key:1},xt={class:"q-mt-none"},qt={class:"row q-gutter-md"},Tt={class:"col"},wt={class:"col"},Pt={class:"matches-list"},Qt={class:"match-header"},Bt={class:"q-my-none"},St={class:"text-caption q-mb-none"},Nt={class:"text-caption q-mb-none"},It={key:0,class:"q-mt-md result-section"},Dt={key:1,class:"q-mt-md"},Mt={key:0,class:"text-center q-pa-xl"},Ct={class:"matches-list"},Et={class:"match-header"},zt={class:"q-my-none"},Vt={class:"text-caption q-mb-none"},Gt={class:"text-caption q-mb-none"},Ft={key:0,class:"q-mt-md result-section"},Rt={key:1,class:"q-mt-md"},Jt={key:0,class:"text-center q-pa-xl"},jt={class:"groups-view"},Lt={class:"q-mt-none"},Ht={class:"text-left"},Ot={class:"text-left"},Ut={class:"text-center"},At={class:"text-center"},Kt={class:"text-center"},Wt={class:"text-center"},Xt={key:0,class:"text-center q-pa-xl"},Yt={class:"bracket-view"},Zt={key:0,class:"bracket-container"},$t={class:"text-center"},te={key:0,class:"bracket-score"},ee={key:0,class:"bracket-score"},se={key:0,class:"text-caption text-grey q-mt-xs"},ae={key:1,class:"text-center q-pa-xl"},oe={class:"text-left"},ne={class:"text-left"},re={class:"text-center"},le={class:"text-center"},ie={class:"text-center"},de={class:"text-center"},ce={class:"text-left"},me={class:"text-left"},ue={class:"text-center"},_e={class:"text-center"},ge={class:"text-center"},fe={class:"text-center"},pe={key:2,class:"text-center q-pa-xl"};function ye(k,e,I,s,w,D){const M=E("NotificationBell"),P=E("BannerPromoScrolling"),Q=E("DesktopNavigation"),C=E("PlayerNavigationMenu");return l(),f(nt,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:i(()=>[n(tt,{elevated:"",class:"text-white"},{default:i(()=>[t("div",yt,[t("div",ht,[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...a)=>s.goToDashboard&&s.goToDashboard(...a))})]),t("div",vt,[n(M),n($,{flat:"",round:"",icon:"arrow_back",onClick:s.goBack},null,8,["onClick"])])]),n(P)]),_:1}),n(Q),n(rt,null,{default:i(()=>[n(ot,{class:"q-pa-md"},{default:i(()=>[s.loading?(l(),c("div",bt,[n(et,{color:"primary",size:"xl"}),e[3]||(e[3]=t("p",null,"Cargando informaci\xF3n del torneo...",-1))])):s.tournament?(l(),c("div",kt,[n(x,{class:"q-mb-md transparent-card"},{default:i(()=>[n(q,null,{default:i(()=>[t("h4",xt,o(s.tournament.name),1),t("div",qt,[t("div",Tt,[t("p",null,[e[4]||(e[4]=t("strong",null,"Sistema:",-1)),m(" "+o(s.getSystemName(s.tournament.system)),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"Categor\xEDa:",-1)),m(" "+o(s.tournament.category),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"G\xE9nero:",-1)),m(" "+o(s.tournament.gender),1)])]),t("div",wt,[t("p",null,[e[7]||(e[7]=t("strong",null,"Fecha Inicio:",-1)),m(" "+o(s.tournament.start_date),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Fecha Fin:",-1)),m(" "+o(s.tournament.end_date),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Premio:",-1)),m(" "+o(s.tournament.prize),1)])])])]),_:1})]),_:1}),n(st,{modelValue:s.activeTab,"onUpdate:modelValue":e[1]||(e[1]=a=>s.activeTab=a),dense:"",class:"text-white","active-color":"primary","indicator-color":"primary",align:"justify"},{default:i(()=>[n(S,{name:"my-matches",label:"Mis Partidos",icon:"calendar_today"}),n(S,{name:"all-matches",label:"Calendario",icon:"sports_tennis"}),s.hasGroups?(l(),f(S,{key:0,name:"groups",label:"Grupos",icon:"group_work"})):g("",!0),s.hasBracket?(l(),f(S,{key:1,name:"bracket",label:"Bracket",icon:"account_tree"})):g("",!0),n(S,{name:"standings",label:"Posiciones",icon:"emoji_events"})]),_:1},8,["modelValue"]),n(J),n(at,{modelValue:s.activeTab,"onUpdate:modelValue":e[2]||(e[2]=a=>s.activeTab=a),animated:"",class:"transparent-bg"},{default:i(()=>[n(N,{name:"my-matches"},{default:i(()=>[t("div",Pt,[(l(!0),c(v,null,b(s.myMatches,a=>(l(),f(x,{key:a.id,class:"q-mb-md transparent-card"},{default:i(()=>[n(q,null,{default:i(()=>[t("div",Qt,[t("h6",Bt,o(a.team1)+" vs "+o(a.team2),1),t("p",St,[n(h,{name:"event",size:"xs"}),m(" "+o(s.formatDate(a.match_date))+" - "+o(a.match_time.substring(0,5)),1)]),t("p",Nt,[n(h,{name:"place",size:"xs"}),m(" Cancha: "+o(a.court_name),1)])]),a.has_result?(l(),c("div",It,[n(T,{color:"green",class:"q-mb-sm"},{default:i(()=>e[10]||(e[10]=[m("Finalizado")])),_:1}),t("p",null,[e[11]||(e[11]=t("strong",null,"Resultado:",-1)),m(" "+o(s.formatScore(a.score)),1)])])):(l(),c("div",Dt,[n(T,{color:"orange"},{default:i(()=>e[12]||(e[12]=[m("Pendiente")])),_:1})]))]),_:2},1024)]),_:2},1024))),128)),s.myMatches.length===0?(l(),c("div",Mt,[n(h,{name:"info",size:"3em",color:"grey"}),e[13]||(e[13]=t("p",null,"No tienes partidos programados",-1))])):g("",!0)])]),_:1}),n(N,{name:"all-matches"},{default:i(()=>[t("div",Ct,[(l(!0),c(v,null,b(s.matches,a=>(l(),f(x,{key:a.id,class:"q-mb-md transparent-card"},{default:i(()=>[n(q,null,{default:i(()=>[t("div",Et,[t("h6",zt,o(a.team1)+" vs "+o(a.team2),1),t("p",Vt,[n(h,{name:"event",size:"xs"}),m(" "+o(s.formatDate(a.match_date))+" - "+o(a.match_time.substring(0,5)),1)]),t("p",Gt,[n(h,{name:"place",size:"xs"}),m(" Cancha: "+o(a.court_name),1)])]),a.has_result?(l(),c("div",Ft,[n(T,{color:"green",class:"q-mb-sm"},{default:i(()=>e[14]||(e[14]=[m("Finalizado")])),_:1}),t("p",null,[e[15]||(e[15]=t("strong",null,"Resultado:",-1)),m(" "+o(s.formatScore(a.score)),1)])])):(l(),c("div",Rt,[n(T,{color:"orange"},{default:i(()=>e[16]||(e[16]=[m("Pendiente")])),_:1})]))]),_:2},1024)]),_:2},1024))),128)),s.matches.length===0?(l(),c("div",Jt,[n(h,{name:"info",size:"3em",color:"grey"}),e[17]||(e[17]=t("p",null,"No hay partidos programados",-1))])):g("",!0)])]),_:1}),s.hasGroups?(l(),f(N,{key:0,name:"groups"},{default:i(()=>[t("div",jt,[(l(!0),c(v,null,b(s.groups,a=>(l(),f(x,{key:a.name,class:"q-mb-md transparent-card"},{default:i(()=>[n(q,null,{default:i(()=>[t("h6",Lt,"Grupo "+o(a.name),1),n(G,{flat:"",bordered:"",class:"standings-table"},{default:i(()=>[e[19]||(e[19]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Equipo"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"Pts")])],-1)),t("tbody",null,[(l(!0),c(v,null,b(a.teams,(_,u)=>(l(),c("tr",{key:_.team_id,class:B({"my-team":s.isMyTeam(_.team_id)})},[t("td",Ht,o(u+1),1),t("td",Ot,[m(o(_.team_name)+" ",1),s.isMyTeam(_.team_id)?(l(),f(T,{key:0,color:"primary",class:"q-ml-sm"},{default:i(()=>e[18]||(e[18]=[m(" Mi equipo ")])),_:1})):g("",!0)]),t("td",Ut,o(_.matches_played),1),t("td",At,o(_.wins),1),t("td",Kt,o(_.losses),1),t("td",Wt,[t("strong",null,o(_.total_points),1)])],2))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),s.groups.length===0?(l(),c("div",Xt,[n(h,{name:"info",size:"3em",color:"grey"}),e[20]||(e[20]=t("p",null,"No hay grupos configurados a\xFAn",-1))])):g("",!0)])]),_:1})):g("",!0),s.hasBracket?(l(),f(N,{key:1,name:"bracket"},{default:i(()=>[t("div",Yt,[n(x,{class:"transparent-card"},{default:i(()=>[n(q,null,{default:i(()=>[e[22]||(e[22]=t("h6",{class:"q-mt-none"},"Cuadro de Eliminaci\xF3n",-1)),s.bracket&&s.bracket.rounds&&s.bracket.rounds.length>0?(l(),c("div",Zt,[(l(!0),c(v,null,b(s.bracket.rounds,(a,_)=>(l(),c("div",{key:_,class:"bracket-round"},[t("h6",$t,o(a.name),1),(l(!0),c(v,null,b(a.matches,u=>(l(),c("div",{key:u.id,class:"bracket-match q-mb-md"},[n(x,{flat:"",bordered:""},{default:i(()=>[n(q,{class:"q-pa-sm"},{default:i(()=>[t("div",{class:B(["bracket-team",{winner:u.winner===1}])},[t("span",null,o(u.team1||"TBD"),1),u.score?(l(),c("span",te,o(u.score1),1)):g("",!0)],2),n(J),t("div",{class:B(["bracket-team",{winner:u.winner===2}])},[t("span",null,o(u.team2||"TBD"),1),u.score?(l(),c("span",ee,o(u.score2),1)):g("",!0)],2),u.match_date?(l(),c("div",se,o(s.formatDate(u.match_date))+" - "+o(u.match_time),1)):g("",!0)]),_:2},1024)]),_:2},1024)]))),128))]))),128))])):(l(),c("div",ae,[n(h,{name:"info",size:"3em",color:"grey"}),e[21]||(e[21]=t("p",null,"El cuadro de eliminaci\xF3n no est\xE1 disponible a\xFAn",-1))]))]),_:1})]),_:1})])]),_:1})):g("",!0),n(N,{name:"standings"},{default:i(()=>[n(x,{class:"transparent-card"},{default:i(()=>[n(q,null,{default:i(()=>[e[27]||(e[27]=t("h6",{class:"q-mt-none"},"Tabla de Posiciones",-1)),s.isRetasTournament?(l(),f(G,{key:0,flat:"",bordered:"",class:"standings-table"},{default:i(()=>[e[23]||(e[23]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Jugador"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"% Victorias")])],-1)),t("tbody",null,[(l(!0),c(v,null,b(s.standings,(a,_)=>(l(),c("tr",{key:a.team_id,class:B({"my-team":s.isMyTeam(a.team_id)})},[t("td",oe,o(_+1),1),t("td",ne,o(a.team_name),1),t("td",re,o(a.matches_played),1),t("td",le,o(a.wins),1),t("td",ie,o(a.losses),1),t("td",de,[t("strong",null,o(a.win_percentage)+"%",1)])],2))),128))])]),_:1})):(l(),f(G,{key:1,flat:"",bordered:"",class:"standings-table"},{default:i(()=>[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Equipo"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"Total Pts")])],-1)),t("tbody",null,[(l(!0),c(v,null,b(s.standings,(a,_)=>(l(),c("tr",{key:a.team_id,class:B({"my-team":s.isMyTeam(a.team_id)})},[t("td",ce,o(_+1),1),t("td",me,[m(o(a.team_name)+" ",1),s.isMyTeam(a.team_id)?(l(),f(T,{key:0,color:"primary",class:"q-ml-sm"},{default:i(()=>e[24]||(e[24]=[m(" Mi equipo ")])),_:1})):g("",!0)]),t("td",ue,o(a.matches_played),1),t("td",_e,o(a.wins),1),t("td",ge,o(a.losses),1),t("td",fe,[t("strong",null,o(a.total_points),1)])],2))),128))])]),_:1})),s.standings.length===0?(l(),c("div",pe,[n(h,{name:"info",size:"3em",color:"grey"}),e[26]||(e[26]=t("p",null,"No hay resultados registrados a\xFAn",-1))])):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):g("",!0)]),_:1})]),_:1}),n(C)]),_:1})}var ts=ft(pt,[["render",ye],["__scopeId","data-v-75f92b02"]]);export{ts as default};
