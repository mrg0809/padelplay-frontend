import{Q as oe}from"./QHeader.8e557618.js";import{F as ae,r as p,w as se,B as le,q as r,G as u,H as s,v as l,I as a,ae as w,ab as k,s as d,ac as re,ad as ne,a9 as ie,aa as U,x as n,bC as C,y as ce,J as q,aU as M}from"./index.584acf07.js";import{Q as I,a as P}from"./QItem.b12511a1.js";import{Q as $}from"./QSelect.91a94070.js";import{Q as de}from"./QList.c5a8907d.js";import{Q as ue}from"./QSpinnerDots.243b178e.js";import{Q as pe}from"./QPage.764a7077.js";import{Q as me,a as _e}from"./QLayout.b710bb90.js";import{s as G}from"./supabase.161424d9.js";import{f as ye}from"./commun.0a2689ea.js";import{u as ve}from"./summaryStore.2775dce3.js";import{u as fe}from"./use-quasar.c44f5730.js";import{P as be}from"./PlayerNavigationMenu.f62eec82.js";import{N as he}from"./NotificationBell.a467fcae.js";import{B as ke}from"./BannerPromoScrolling.2492a512.js";import{D as ge}from"./DesktopNavigation.95a12db6.js";import"./QChip.5485a9ca.js";import"./QItemLabel.6f29d409.js";import"./QMenu.f258a5f1.js";import"./position-engine.c3e1b9af.js";import"./selection.216c03ca.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./pinia.1c5897a4.js";import"./QTabs.6a6666b4.js";import"./QFooter.c5b1de81.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QBadge.2e8f5c62.js";import"./api.2af71db3.js";import"./admin.c99b9bfe.js";import"./QTooltip.7f160014.js";const xe={class:"header-content"},De={class:"header-icons"},Se={class:"row q-col-gutter-md q-mb-lg"},we={class:"col-12 col-sm-4"},Ce={class:"col-12 col-sm-4"},Qe={class:"col-12 col-sm-4"},Ne={class:"games-list"},Te={class:"court-container"},Oe={class:"court"},qe={class:"player team1-player1"},Me={key:0},Ie=["src"],Pe={key:1},$e={class:"text-caption"},je={class:"player team1-player2"},Fe={key:0},Ve=["src"],Le={key:1},Ee={class:"text-caption"},He={class:"player team2-player1"},Be={key:0},Je=["src"],Ue={key:1},Ge={class:"text-caption"},ze={class:"player team2-player2"},Ae={key:0},Xe=["src"],Re={key:1},We={class:"text-caption"},Ke={class:"club-info"},Ye=["src"],Ze={class:"club-name"},et={class:"price-duration"},tt={class:"total-price"},ot={class:"duration"},at={key:1,class:"text-center"},st={key:2,class:"text-center text-black"},Ft={__name:"ListOpenGames",setup(lt){const z=ae(),A=ve(),j=fe(),x=p([]),D=p([]),X=p(["Hoy","Ma\xF1ana","Esta Semana","Pr\xF3ximos 7 d\xEDas"]),R=p(["femenil","varonil","mixto"]),v=p(null),g=p(null),f=p(null),b=p([]),Q=p(!1),F=o=>new Date(o).toLocaleDateString("es-MX",{day:"numeric",month:"long",year:"numeric"}),W=(o,e)=>{const[t,i]=o.split(":").map(Number),[_,m]=e.split(":").map(Number);let y=_*60+m-(t*60+i);return y<0&&(y+=24*60),y},K=async()=>{try{const o=await ye();x.value=o.map(e=>typeof e=="string"?e:e.value||e.label||e),D.value=x.value}catch{}},Y=(o,e)=>{if(o===""){e(()=>{D.value=x.value});return}e(()=>{const t=o.toLowerCase();D.value=x.value.filter(i=>i.toLowerCase().indexOf(t)>-1)})},V=async()=>{Q.value=!0,b.value=[];try{let o=G.from("matches").select(`
                id, match_date, match_time, category, gender, is_open, team1_players, team2_players,
                club:clubs!inner ( id, name, city, logo_url ),
                reservation:reservations ( total_price, start_time, end_time )
            `).eq("is_open",!0);const e=g.value,t=new Date;t.setHours(0,0,0,0);const i=new Date(t);i.setDate(t.getDate()+1);const _=new Date(t);_.setDate(t.getDate()+2);const m=new Date(t);m.setDate(t.getDate()+(7-t.getDay())),m.setHours(23,59,59,999);const y=new Date(t);y.setDate(t.getDate()+7),y.setHours(23,59,59,999);const S=t.toISOString().split("T")[0],L=i.toISOString().split("T")[0],Z=_.toISOString().split("T")[0],ee=m.toISOString().split("T")[0],te=y.toISOString().split("T")[0];e==="Hoy"?o=o.gte("match_date",S).lt("match_date",L):e==="Ma\xF1ana"?o=o.gte("match_date",L).lt("match_date",Z):e==="Esta Semana"?o=o.gte("match_date",S).lte("match_date",ee):e==="Pr\xF3ximos 7 d\xEDas"?o=o.gte("match_date",S).lte("match_date",te):o=o.gte("match_date",S),v.value&&(o=o.eq("club.city",v.value)),f.value&&(o=o.eq("gender",f.value));const{data:T,error:E}=await o.order("match_date").order("match_time");if(E)throw E;if(!T){b.value=[];return}const H=T.flatMap(c=>[...c.team1_players||[],...c.team2_players||[]]).filter(c=>c!=null);let O={};if(H.length>0){const{data:c,error:h}=await G.from("players").select("user_id, first_name, photo_url, category").in("user_id",[...new Set(H)]);if(h)throw h;O=(c||[]).reduce((B,J)=>(B[J.user_id]=J,B),{})}b.value=T.map(c=>({...c,club:c.club||{name:"N/A",city:"N/A",id:null},reservation:c.reservation||{total_price:0,start_time:"00:00",end_time:"00:00"},team1_players:(c.team1_players||[null,null]).map(h=>O[h]||null),team2_players:(c.team2_players||[null,null]).map(h=>O[h]||null)}))}catch(o){console.error("Error fetching matches:",o),b.value=[],j.notify({type:"negative",message:"Error al buscar juegos."})}finally{Q.value=!1}},N=(o,e,t)=>{var m;if(console.log(`Intentando unirse a juego ${o.id}, equipo ${e}, slot ${t}`),!o||!o.reservation||o.reservation.total_price===void 0||o.reservation.total_price===null||!((m=o.club)!=null&&m.id)){console.error("Datos incompletos del juego para proceder al pago:",o),j.notify({type:"negative",message:"Informaci\xF3n del juego incompleta para unirse."});return}const i=(o.reservation.total_price||0)/4;i<=0&&console.warn("El precio por jugador es cero o inv\xE1lido.");const _={summaryTitle:"Confirmar Uni\xF3n a Juego",itemDetails:[{label:"Club",value:o.club.name||"No especificado"},{label:"Fecha",value:F(o.match_date)},{label:"Hora",value:`${new Date(o.match_date+"T"+o.match_time).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})} hrs.`},{label:"Categor\xEDa",value:o.category||"N/A"},{label:"Precio (Tu parte)",value:`$${i.toFixed(2)}`}],baseData:{clubId:o.club.id,price:i,participants:1,type:"open_match_join",id:o.id},allowPaymentSplit:!1,showPublicToggle:!1,commissionRate:4,extraData:{matchId:o.id,teamToJoin:e,slotIndex:t,matchCategory:o.category,matchGender:o.gender,matchDate:o.match_date,matchTime:o.match_time,clubName:o.club.name}};A.setSummaryDetails(_),console.log("Datos para unirse a juego guardados en Pinia:",_),z.push({name:"OrderSummary"})};return se([v,g,f],V,{deep:!0}),le(()=>{K(),V()}),(o,e)=>(r(),u(me,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:s(()=>[l(oe,{elevated:"",class:"text-white"},{default:s(()=>[a("div",xe,[e[6]||(e[6]=a("div",{class:"greeting"},[a("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})],-1)),a("div",De,[l(he)])]),l(ke)]),_:1}),l(_e,{class:"home"},{default:s(()=>[l(pe,{class:"q-pa-md"},{default:s(()=>[a("div",Se,[a("div",we,[l($,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),options:D.value,label:"Ciudad",outlined:"",dense:"","options-dense":"",clearable:"","hide-selected":"","input-debounce":"300",onFilter:Y,onClear:e[1]||(e[1]=t=>v.value=null),dark:"",color:"black","label-color":"black","popup-content-class":"bg-black text-black"},{prepend:s(()=>[l(w,{name:"location_on",color:"black"})]),"no-option":s(()=>[l(I,null,{default:s(()=>[l(P,{class:"text-black"},{default:s(()=>e[7]||(e[7]=[k("No hay ciudades")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),a("div",Ce,[l($,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),options:X.value,label:"Fecha",outlined:"",dense:"","options-dense":"",clearable:"",dark:"",color:"black","label-color":"black","popup-content-class":"bg-black text-black",onClear:e[3]||(e[3]=t=>g.value=null)},{prepend:s(()=>[l(w,{name:"calendar_month",color:"black"})]),"no-option":s(()=>[l(I,null,{default:s(()=>[l(P,{class:"text-black"},{default:s(()=>e[8]||(e[8]=[k("No hay opciones")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),a("div",Qe,[l($,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=t=>f.value=t),options:R.value,label:"G\xE9nero",outlined:"",dense:"","options-dense":"",clearable:"",dark:"",color:"black","label-color":"black","popup-content-class":"bg-black text-black",onClear:e[5]||(e[5]=t=>f.value=null)},{prepend:s(()=>[l(w,{name:"wc",color:"black"})]),"no-option":s(()=>[l(I,null,{default:s(()=>[l(P,{class:"text-grey-8"},{default:s(()=>e[9]||(e[9]=[k("No hay opciones")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])])]),a("div",Ne,[b.value.length>0?(r(),u(de,{key:0,class:"q-mt-md"},{default:s(()=>[(r(!0),d(ne,null,re(b.value,t=>(r(),u(ie,{key:t.id,clickable:"",class:"match-card"},{default:s(()=>[l(U,{class:"q-mt-md"},{default:s(()=>[a("strong",null,n(F(t.match_date))+" | "+n(new Date(t.match_date+"T"+t.match_time).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})),1),e[14]||(e[14]=a("br",null,null,-1)),e[15]||(e[15]=k(" Categor\xEDa")),l(w,{name:"o_sports_tennis"}),k(" "+n(t.category)+" ",1),a("div",Te,[a("div",Oe,[a("div",qe,[t.team1_players[0]?(r(),d("div",Me,[t.team1_players[0].photo_url?(r(),u(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:t.team1_players[0].photo_url,alt:"Foto del jugador"},null,8,Ie)]),_:2},1024)):(r(),d("span",Pe,n(t.team1_players[0].first_name||"Jugador 1 Equipo 1"),1)),a("div",$e,n(t.team1_players[0].category),1)])):ce("",!0)]),a("div",je,[t.team1_players[1]?(r(),d("div",Fe,[t.team1_players[1].photo_url?(r(),u(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:t.team1_players[1].photo_url,alt:"Foto del jugador"},null,8,Ve)]),_:2},1024)):(r(),d("span",Le,n(t.team1_players[1].first_name||"Jugador 1 Equipo 1"),1)),a("div",Ee,n(t.team1_players[1].category),1)])):(r(),u(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>N(t,1,1),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),a("div",He,[t.team2_players[0]?(r(),d("div",Be,[t.team2_players[0].photo_url?(r(),u(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:t.team2_players[0].photo_url,alt:"Foto del jugador"},null,8,Je)]),_:2},1024)):(r(),d("span",Ue,n(t.team2_players[0].first_name||"Jugador 1 Equipo 2"),1)),a("div",Ge,n(t.team2_players[0].category),1)])):(r(),u(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>N(t,2,0),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),a("div",ze,[t.team2_players[1]?(r(),d("div",Ae,[t.team2_players[1].photo_url?(r(),u(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:t.team2_players[1].photo_url,alt:"Foto del jugador"},null,8,Xe)]),_:2},1024)):(r(),d("span",Re,n(t.team2_players[1].first_name||"Jugador 2 Equipo 2"),1)),a("div",We,n(t.team2_players[1].category),1)])):(r(),u(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>N(t,2,1),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),e[10]||(e[10]=a("div",{class:"line1"},null,-1)),e[11]||(e[11]=a("div",{class:"net"},null,-1)),e[12]||(e[12]=a("div",{class:"line2"},null,-1)),e[13]||(e[13]=a("div",{class:"horizontal-line"},null,-1))])])]),_:2},1024),l(U,{class:"club-info-section"},{default:s(()=>[a("div",Ke,[a("img",{src:t.club.logo_url||"/logo.jpeg",alt:"Club Logo",class:"club-logo"},null,8,Ye),a("span",Ze,n(t.club.name),1)]),e[17]||(e[17]=a("div",{class:"vertical-divider"},null,-1)),a("div",et,[a("span",tt,"$"+n(t.reservation.total_price/4)+" MXN",1),e[16]||(e[16]=a("br",null,null,-1)),a("span",ot,n(W(t.reservation.start_time,t.reservation.end_time))+" minutos",1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})):Q.value?(r(),d("div",at,[e[18]||(e[18]=k("Buscando...")),e[19]||(e[19]=a("br",null,null,-1)),l(ue,{color:"black",size:"xl"})])):(r(),d("div",st,e[20]||(e[20]=[a("p",null,"No se encontraron juegos.",-1)])))])]),_:1})]),_:1}),l(be),l(ge)]),_:1}))}};export{Ft as default};
