import{x as eo,r as g,y as ao,h as to,a6 as lo,o as d,z as y,A as a,d as o,B as i,a9 as v,D as V,a as h,ac as H,aa as N,ab as T,a7 as ro,a8 as W,E as so,ad as no,ae as G,af as io,bE as J,t as c,e as uo}from"./index.687b44e8.js";import{Q as co}from"./QHeader.289f0645.js";import{Q as mo,a as z}from"./QTabs.979bee57.js";import{Q as R,a as k}from"./QItem.eb9291fb.js";import{Q as D}from"./QItemLabel.bbebea39.js";import{Q as j}from"./QList.1288e946.js";import{a as fo,Q as A}from"./QTabPanel.d4470d6c.js";import{Q as _o}from"./QChip.c9b5cbc6.js";import{Q as po}from"./QPage.fcc9aae1.js";import{Q as bo,a as wo}from"./QLayout.30990248.js";import{Q as go}from"./QFile.29c4fdcc.js";import{C as K}from"./ClosePopup.89fae5e1.js";import{s as m}from"./supabase.66aa98e2.js";import{n as yo}from"./navigationUtils.2c4b9dee.js";import{a as U}from"./api.1c42dce4.js";import{C as vo}from"./ClubNavigationMenu.44af5278.js";import{_ as ho}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.33109fa4.js";import"./touch.9135741d.js";import"./selection.0f785986.js";import"./use-render-cache.3aae9b27.js";import"./format.de7e9769.js";import"./QFooter.b7b22f15.js";const Co={name:"ClubCommunity",components:{ClubNavigationMenu:vo},setup(){const B=eo(),r=g("followed"),F=g([]),t=g([]),C=g([]),f=ao(),P=g(""),e=g(null),q=g(!1),I={like:"\u{1F44D}",love:"\u2764\uFE0F",laugh:"\u{1F602}",wow:"\u{1F62E}",sad:"\u{1F622}",angry:"\u{1F621}"},O=async()=>{try{const{data:s,error:n}=await m.from("follows").select("followed_id").eq("follower_id",f.userId);if(n)throw n;const _=s.map(l=>l.followed_id),{data:u,error:Q}=await m.from("profiles").select("id, full_name, user_type, club_id").in("id",_);if(Q)throw Q;const{data:S,error:x}=await m.from("players").select("user_id, photo_url").in("user_id",_);if(x)throw x;const M=u.filter(l=>l.user_type==="club").map(l=>l.club_id),{data:L,error:E}=await m.from("clubs").select("id, logo_url").in("id",M);if(E)throw E;F.value=u.map(l=>{const p=S.find(w=>w.user_id===l.id),b=L.find(w=>w.id===l.club_id);return{id:l.id,name:l.full_name,photo_url:l.user_type==="player"?p==null?void 0:p.photo_url:(b==null?void 0:b.logo_url)||"default-avatar.png",type:l.user_type}})}catch(s){console.error("Error al obtener usuarios seguidos:",s)}},X=async()=>{try{const{data:s,error:n}=await m.from("follows").select("follower_id").eq("followed_id",f.userId);if(n)throw n;const _=s.map(l=>l.follower_id),{data:u,error:Q}=await m.from("profiles").select("id, full_name, user_type, club_id").in("id",_);if(Q)throw Q;const{data:S,error:x}=await m.from("players").select("user_id, photo_url").in("user_id",_);if(x)throw x;const M=u.filter(l=>l.user_type==="club").map(l=>l.club_id),{data:L,error:E}=await m.from("clubs").select("id, logo_url").in("id",M);if(E)throw E;t.value=u.map(l=>{const p=S.find(w=>w.user_id===l.id),b=L.find(w=>w.id===l.club_id);return{id:l.id,name:l.full_name,photo_url:l.user_type==="player"?p==null?void 0:p.photo_url:(b==null?void 0:b.logo_url)||"default-avatar.png",type:l.user_type}})}catch(s){console.error("Error al obtener seguidores:",s)}},Y=async()=>{try{const s=await U.get(`community/posts/club/${f.clubId}`);console.log("Datos recibidos:",s.data),C.value=s.data.posts}catch(s){console.error("Error al obtener posts:",s)}},Z=async()=>{try{let s=null;const n=await U.post("/community/posts",{club_id:f.clubId,content:P.value});console.log(n.data.data[0].id);const _=n.data.data[0].id;if(e.value){const u=new FormData;u.append("file",e.value);const Q=await U.post(`/community/posts/upload-media?post_id=${_}`,u,{headers:{"Content-Type":"multipart/form-data"}})}C.value.unshift(n.data),P.value="",e.value=null}catch(s){console.error("Error al crear post:",s)}},$=async s=>{try{await U.delete(`community/posts/${s}`,{data:{club_id:f.clubId}}),C.value=C.value.filter(n=>n.id!==s)}catch(n){console.error("Error al eliminar post:",n)}},oo=s=>{if(!s)return"Fecha no disponible";const n=new Date(s);return isNaN(n.getTime())?"Fecha no disponible":n.toLocaleString()};return to(()=>{O(),X(),Y()}),{tab:r,followedUsers:F,followers:t,posts:C,newPostContent:P,showCreatePostDialog:q,createPost:Z,deletePost:$,formatDate:oo,goBack:()=>{B.back()},reactionEmojis:I,newPostMedia:e,goToDashboard:()=>{yo(B,f)}}}},Qo={class:"header-content"},ko={class:"greeting"},Do={class:"header-icons"},Po={key:0,class:"text-center q-pa-md"},xo=["src"],Eo={key:0,class:"text-center q-pa-md"},Vo=["src"],qo={class:"text-center q-pa-md"},Io={key:0,class:"q-mt-sm"},No=["src"],To={class:"q-mt-sm"};function Uo(B,r,F,t,C,f){const P=lo("ClubNavigationMenu");return d(),y(bo,{view:"hHh lpR fFf",class:"body text-white"},{default:a(()=>[o(co,{elevated:"",class:"bg-primary text-white"},{default:a(()=>[i("div",Qo,[i("div",ko,[i("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:r[0]||(r[0]=(...e)=>t.goToDashboard&&t.goToDashboard(...e))}),r[7]||(r[7]=v(" Comunidad del Club ",-1))]),i("div",Do,[o(V,{flat:"",round:"",icon:"arrow_back",onClick:t.goBack},null,8,["onClick"])])])]),_:1}),o(wo,null,{default:a(()=>[o(po,{class:"q-pa-md"},{default:a(()=>[o(mo,{modelValue:t.tab,"onUpdate:modelValue":r[1]||(r[1]=e=>t.tab=e),align:"justify",class:"text-white"},{default:a(()=>[o(z,{name:"followed",label:"Seguidos"}),o(z,{name:"followers",label:"Seguidores"}),o(z,{name:"wall",label:"Wall"})]),_:1},8,["modelValue"]),o(fo,{modelValue:t.tab,"onUpdate:modelValue":r[3]||(r[3]=e=>t.tab=e),animated:"",class:"transparent-card q-mt-md"},{default:a(()=>[o(A,{name:"followed"},{default:a(()=>[t.followedUsers.length===0?(d(),h("div",Po,[o(H,{name:"people",size:"2em"}),r[8]||(r[8]=i("p",{class:"q-mt-sm"},"No sigues a ning\xFAn usuario todav\xEDa.",-1))])):(d(),y(j,{key:1,bordered:""},{default:a(()=>[(d(!0),h(T,null,N(t.followedUsers,e=>(d(),y(R,{key:e.id,class:"q-mb-sm"},{default:a(()=>[o(k,{avatar:""},{default:a(()=>[o(J,null,{default:a(()=>[i("img",{src:e.photo_url||"default-avatar.png"},null,8,xo)]),_:2},1024)]),_:2},1024),o(k,null,{default:a(()=>[o(D,null,{default:a(()=>[v(c(e.name),1)]),_:2},1024),o(D,{caption:""},{default:a(()=>[v(c(e.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),o(A,{name:"followers"},{default:a(()=>[t.followers.length===0?(d(),h("div",Eo,[o(H,{name:"people",size:"2em"}),r[9]||(r[9]=i("p",{class:"q-mt-sm"},"No tienes seguidores todav\xEDa.",-1))])):(d(),y(j,{key:1,bordered:""},{default:a(()=>[(d(!0),h(T,null,N(t.followers,e=>(d(),y(R,{key:e.id,class:"q-mb-sm"},{default:a(()=>[o(k,{avatar:""},{default:a(()=>[o(J,null,{default:a(()=>[i("img",{src:e.photo_url||"default-avatar.png"},null,8,Vo)]),_:2},1024)]),_:2},1024),o(k,null,{default:a(()=>[o(D,null,{default:a(()=>[v(c(e.name),1)]),_:2},1024),o(D,{caption:""},{default:a(()=>[v(c(e.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),o(A,{name:"wall"},{default:a(()=>[i("div",qo,[o(V,{icon:"add",color:"black",class:"q-mb-xl fixed-bottom-right",size:"lg",glossy:"",round:"",onClick:r[2]||(r[2]=e=>t.showCreatePostDialog=!0)})]),o(j,{bordered:"",class:"q-mt-md"},{default:a(()=>[(d(!0),h(T,null,N(t.posts,e=>(d(),y(R,{key:e.id,class:"q-mb-sm"},{default:a(()=>[o(k,null,{default:a(()=>[o(D,null,{default:a(()=>[v(c(e.content),1)]),_:2},1024),o(D,{caption:""},{default:a(()=>[v(c(t.formatDate(e.created_at)),1)]),_:2},1024),e.media_url?(d(),h("div",Io,[i("img",{src:e.media_url,style:{"max-width":"100%","border-radius":"8px"},alt:"Imagen del post"},null,8,No)])):uo("",!0),i("div",To,[(d(!0),h(T,null,N(e.reactions,(q,I)=>(d(),y(_o,{color:"transparent",key:I},{default:a(()=>[i("span",null,c(t.reactionEmojis[I])+" "+c(q),1)]),_:2},1024))),128))])]),_:2},1024),o(k,{side:""},{default:a(()=>[o(V,{flat:"",icon:"delete",color:"negative",onClick:q=>t.deletePost(e.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(io,{modelValue:t.showCreatePostDialog,"onUpdate:modelValue":r[6]||(r[6]=e=>t.showCreatePostDialog=e)},{default:a(()=>[o(ro,{class:"q-pa-md bg-black",style:{"min-width":"300px"}},{default:a(()=>[o(W,null,{default:a(()=>[...r[10]||(r[10]=[i("div",{class:"text-h6"},"Nuevo Post",-1)])]),_:1}),o(W,null,{default:a(()=>[o(so,{modelValue:t.newPostContent,"onUpdate:modelValue":r[4]||(r[4]=e=>t.newPostContent=e),type:"textarea",label:"Escribe tu post",autogrow:""},null,8,["modelValue"]),o(go,{modelValue:t.newPostMedia,"onUpdate:modelValue":r[5]||(r[5]=e=>t.newPostMedia=e),label:"Subir imagen o video",accept:"image/*, video/*",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),o(no,{align:"right"},{default:a(()=>[G(o(V,{flat:"",label:"Cancelar",color:"negative"},null,512),[[K]]),G(o(V,{flat:"",label:"Publicar",color:"green",onClick:t.createPost},null,8,["onClick"]),[[K]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(P)]),_:1})}var ne=ho(Co,[["render",Uo],["__scopeId","data-v-5303ab14"]]);export{ne as default};
