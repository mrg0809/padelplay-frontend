import{Q as oe}from"./QHeader.8e557618.js";import{F as ie,r as p,B as le,q as i,G as q,H as r,v as s,I as o,J as v,s as l,a9 as z,aa as B,ab as _,K as V,y as $,ae as w,ad as E,ac as j,bC as L,x as c}from"./index.584acf07.js";import{Q as ne}from"./QSpinnerDots.243b178e.js";import{Q as ce}from"./QTooltip.7f160014.js";import{Q as G,a as y}from"./QItem.b12511a1.js";import{Q as f}from"./QItemLabel.6f29d409.js";import{Q as R}from"./QChip.5485a9ca.js";import{Q as M}from"./QList.c5a8907d.js";import{Q as de}from"./QPage.764a7077.js";import{Q as ue,a as me}from"./QLayout.b710bb90.js";import{u as pe}from"./userStore.e4b54bb6.js";import{s as S}from"./supabase.161424d9.js";import{c as _e}from"./dateUtils.d59637e9.js";import{P as ve}from"./PlayerNavigationMenu.f62eec82.js";import{P as ye}from"./PlayerTopMenu.c48d9a03.js";import{N as fe}from"./NotificationBell.a467fcae.js";import{B as ge}from"./BannerPromoScrolling.2492a512.js";import{_ as he}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.c3e1b9af.js";import"./selection.216c03ca.js";import"./pinia.1c5897a4.js";import"./QTabs.6a6666b4.js";import"./rtl.276c3f1b.js";import"./QFooter.c5b1de81.js";import"./QBtnDropdown.56b29c58.js";import"./QMenu.f258a5f1.js";import"./QBadge.2e8f5c62.js";import"./api.2af71db3.js";import"./admin.c99b9bfe.js";const xe={class:"header-content"},be={class:"header-icons"},we={class:"player-container"},ke={class:"row items-center q-mb-md history-header"},Ce={key:0,class:"text-center q-pa-xl"},Qe={key:1,class:"history-content"},Pe={class:"history-tabs q-mb-md"},De={class:"history-layout"},qe={key:0,class:"history-section"},$e={class:"section-header"},Se={key:0,class:"date-filter-section q-mb-md"},He={class:"row q-gutter-sm"},Fe={class:"col"},Ie={class:"col"},Ne={class:"row q-gutter-sm q-mt-sm"},Te={key:1,class:"empty-state"},ze={key:2,class:"payment-list"},Be={class:"text-right"},Ve={class:"text-weight-bold amount"},Ee={key:1,class:"history-section"},je={key:0,class:"empty-state"},Le={key:1,class:"games-list"},Ge={class:"text-right"},Re={class:"q-mt-xs text-caption text-grey"},Me={__name:"PlayerHistory",setup(Ae){const g=ie(),k=pe().userId,h=p(!0),n=p("payments"),Q=p([]),P=p([]),x=p(""),b=p(""),C=p(!0),H=()=>{const e=new Date,t=new Date;t.setDate(e.getDate()-15),b.value=e.toISOString().split("T")[0],x.value=t.toISOString().split("T")[0]},F=async()=>{try{let e=S.from("payment_orders").select("*").eq("user_id",k);x.value&&(e=e.gte("order_date",x.value)),b.value&&(e=e.lte("order_date",b.value));const{data:t,error:a}=await e.order("order_date",{ascending:!1});if(a){console.error("Error loading payment history:",a);return}Q.value=t||[]}catch(e){console.error("Error loading payment history:",e)}},I=async()=>{h.value=!0,await F(),h.value=!1},A=async()=>{H(),await I()},U=async()=>{try{const{data:e,error:t}=await S.from("reservations").select(`
        *,
        courts(id, name, club_id, clubs(name)),
        matches(id, gender, category, team1_players, team2_players)
      `).eq("player_id",k).order("reservation_date",{ascending:!1}).limit(50);if(t){console.error("Error loading games history:",t);return}const{data:a,error:d}=await S.from("matches").select(`
        id, gender, category, team1_players, team2_players,
        reservations(id, reservation_date, start_time, end_time, status, courts(id, name, clubs(name)))
      `).or(`team1_players.cs.{${k}},team2_players.cs.{${k}}`).order("created_at",{ascending:!1}).limit(50);d&&console.error("Error loading match reservations:",d);const u=[...e||[]];a&&a.forEach(m=>{m.reservations&&!u.some(D=>D.id===m.reservations.id)&&u.push({id:m.reservations.id,...m.reservations,matches:m})}),u.sort((m,D)=>new Date(D.reservation_date)-new Date(m.reservation_date)),P.value=u}catch(e){console.error("Error loading games history:",e)}},N=e=>{switch(e){case"succeeded":case"approved":return"positive";case"pending":return"warning";case"failed":case"rejected":return"negative";default:return"grey"}},J=e=>{switch(e){case"succeeded":case"approved":return"Exitoso";case"pending":return"Pendiente";case"failed":case"rejected":return"Fallido";default:return e}},O=e=>{switch(e){case"court":case"reservation":return"sports_tennis";case"tournament":return"emoji_events";case"lesson":return"school";case"open_match_join":return"group_add";default:return"payment"}},K=e=>{switch(e.event_type){case"court":case"reservation":return"Reserva de cancha";case"tournament":return"Inscripci\xF3n a torneo";case"lesson":return"Clase de p\xE1del";case"open_match_join":return"Uni\xF3n a partido abierto";default:return e.event_type||"Pago"}},X=e=>{switch(e){case"completed":return"positive";case"active":case"confirmed":return"primary";case"cancelled":return"negative";default:return"grey"}},W=e=>{switch(e){case"completed":return"Completado";case"active":case"confirmed":return"Confirmado";case"cancelled":return"Cancelado";default:return e||"Programado"}},Y=e=>{if(e.matches){const t=e.matches;let a="Partido";return t.gender&&(a+=` ${t.gender}`),t.category&&(a+=` - ${t.category}`),a}return"Reserva de cancha"},Z=e=>{var t,a;if(e.courts){const d=e.courts.name||"Cancha sin nombre",u=((t=e.courts.clubs)==null?void 0:t.name)||((a=e.courts.club)==null?void 0:a.name);return u?`${d} - ${u}`:d}return"Cancha sin nombre"},T=e=>e?_e(e):"",ee=e=>e?e.substring(0,5):"",te=e=>e?Number(e).toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",se=()=>{g.go(-1)},ae=e=>{var t;(t=e.matches)!=null&&t.id?g.push(`/player/match/${e.matches.id}`):e.id&&console.log("Reservation details:",e)},re=e=>{switch(e.event_type){case"court":case"reservation":case"open_match_join":e.event_id&&g.push(`/player/match/${e.event_id}`);break;case"tournament":e.event_id&&g.push(`/player/tournaments/${e.event_id}`);break;case"lesson":case"private-lesson":case"public-lesson":e.event_id&&g.push(`/player/classes/${e.event_id}`);break;default:console.log("Payment details:",e)}};return le(async()=>{h.value=!0,H(),await Promise.all([F(),U()]),h.value=!1}),(e,t)=>(i(),q(ue,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:r(()=>[s(oe,{elevated:"",class:"text-white"},{default:r(()=>[o("div",xe,[t[5]||(t[5]=o("div",{class:"greeting"},[o("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})],-1)),o("div",be,[s(fe),s(ye)])]),s(ge)]),_:1}),s(me,null,{default:r(()=>[s(de,{class:"q-pa-md"},{default:r(()=>[o("div",we,[o("div",ke,[s(v,{flat:"",round:"",dense:"",icon:"arrow_back",class:"text-white",onClick:se}),t[6]||(t[6]=o("h5",{class:"text-white q-ma-none q-ml-md"},"Historial",-1))]),h.value?(i(),l("div",Ce,[s(ne,{size:"50px",color:"white"}),t[7]||(t[7]=o("div",{class:"q-mt-md text-white"},"Cargando historial...",-1))])):(i(),l("div",Qe,[o("div",Pe,[s(v,{color:n.value==="payments"?"primary":"grey",outline:n.value!=="payments",label:"Pagos",onClick:t[0]||(t[0]=a=>n.value="payments"),class:"tab-btn"},null,8,["color","outline"]),s(v,{color:n.value==="games"?"primary":"grey",outline:n.value!=="games",label:"Juegos",onClick:t[1]||(t[1]=a=>n.value="games"),class:"tab-btn"},null,8,["color","outline"])]),o("div",De,[n.value==="payments"?(i(),l("div",qe,[s(z,{flat:"",bordered:"",class:"text-white history-card"},{default:r(()=>[s(B,null,{default:r(()=>[o("div",$e,[t[9]||(t[9]=o("div",{class:"text-h6"},"\u{1F4CB} Historial de Pagos",-1)),s(v,{flat:"",round:"",dense:"",icon:C.value?"expand_less":"tune",onClick:t[2]||(t[2]=a=>C.value=!C.value),color:"primary",class:"q-ml-sm"},{default:r(()=>[s(ce,null,{default:r(()=>t[8]||(t[8]=[_("Filtrar por fechas")])),_:1})]),_:1},8,["icon"])]),C.value?(i(),l("div",Se,[o("div",He,[o("div",Fe,[s(V,{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=a=>x.value=a),type:"date",label:"Desde",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),o("div",Ie,[s(V,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=a=>b.value=a),type:"date",label:"Hasta",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])])]),o("div",Ne,[s(v,{label:"Aplicar",color:"primary",onClick:I,size:"sm"}),s(v,{label:"\xDAltimos 15 d\xEDas",color:"secondary",outline:"",onClick:A,size:"sm"})])])):$("",!0),Q.value.length===0?(i(),l("div",Te,[s(w,{name:"payment",size:"50px",color:"grey"}),t[10]||(t[10]=o("div",{class:"q-mt-md text-grey"},"No tienes pagos registrados",-1))])):(i(),l("div",ze,[s(M,{separator:"",class:"text-white"},{default:r(()=>[(i(!0),l(E,null,j(Q.value,a=>(i(),q(G,{key:a.id,class:"payment-item",clickable:"",onClick:d=>re(a)},{default:r(()=>[s(y,{avatar:""},{default:r(()=>[s(L,{color:N(a.payment_status),"text-color":"white",size:"40px"},{default:r(()=>[s(w,{name:O(a.event_type)},null,8,["name"])]),_:2},1032,["color"])]),_:2},1024),s(y,{class:"payment-details"},{default:r(()=>[s(f,{class:"text-weight-bold payment-title"},{default:r(()=>[_(c(K(a)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey payment-date"},{default:r(()=>[_(c(T(a.order_date)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey payment-method"},{default:r(()=>[_(c(a.payment_method),1)]),_:2},1024)]),_:2},1024),s(y,{side:"",class:"payment-amount"},{default:r(()=>[o("div",Be,[o("div",Ve," $"+c(te(a.total_amount)),1),s(R,{color:N(a.payment_status),"text-color":"white",size:"sm",label:J(a.payment_status)},null,8,["color","label"])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]))]),_:1})]),_:1})])):$("",!0),n.value==="games"?(i(),l("div",Ee,[s(z,{flat:"",bordered:"",class:"text-white history-card"},{default:r(()=>[s(B,null,{default:r(()=>[t[12]||(t[12]=o("div",{class:"section-header"},[o("div",{class:"text-h6"},"\u{1F3D3} Historial de Juegos")],-1)),P.value.length===0?(i(),l("div",je,[s(w,{name:"sports_tennis",size:"50px",color:"grey"}),t[11]||(t[11]=o("div",{class:"q-mt-md text-grey"},"No tienes juegos registrados",-1))])):(i(),l("div",Le,[s(M,{separator:"",class:"text-white"},{default:r(()=>[(i(!0),l(E,null,j(P.value,a=>(i(),q(G,{key:a.id,class:"game-item",clickable:"",onClick:d=>ae(a)},{default:r(()=>[s(y,{avatar:""},{default:r(()=>[s(L,{color:"primary","text-color":"white",size:"40px"},{default:r(()=>[s(w,{name:"sports_tennis"})]),_:1})]),_:1}),s(y,{class:"game-details"},{default:r(()=>[s(f,{class:"text-weight-bold game-title"},{default:r(()=>[_(c(Z(a)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey game-date"},{default:r(()=>[_(c(T(a.reservation_date))+" - "+c(ee(a.start_time)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey game-type"},{default:r(()=>[_(c(Y(a)),1)]),_:2},1024)]),_:2},1024),s(y,{side:"",class:"game-status"},{default:r(()=>[o("div",Ge,[s(R,{color:X(a.status),"text-color":"white",size:"sm",label:W(a.status)},null,8,["color","label"]),o("div",Re,[s(w,{name:"chevron_right"})])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]))]),_:1})]),_:1})])):$("",!0)])]))])]),_:1})]),_:1}),s(ve)]),_:1}))}};var wt=he(Me,[["__scopeId","data-v-c7ec3308"]]);export{wt as default};
