import{Q as J}from"./QHeader.bad00686.js";import{Q as L}from"./QSpinnerDots.39d2155b.js";import{a9 as O,F as H,r as h,j as M,B as Y,q as o,G as g,H as p,v as s,I as t,s as r,ab as K,ac as W,x as u,ag as c,ad as n,y,af as N,ae as E,J as k,ah as X,bE as S}from"./index.188957e1.js";import{Q as Z}from"./QBadge.b27da0c4.js";import{Q as ee}from"./QPage.d6b4f804.js";import{Q as ae,a as le}from"./QLayout.841981cf.js";import{u as oe}from"./use-quasar.51ce0ad1.js";import{u as se}from"./summaryStore.cb29faab.js";import{u as te}from"./userStore.551ce0f9.js";import{a as re,b as ne}from"./tournaments.d9fd276f.js";import{P as ie}from"./PlayerNavigationMenu.5400ec1d.js";import{B as ue}from"./BannerPromoScrolling.6ad8f16b.js";import{N as de}from"./NotificationBell.b24bce23.js";import{_ as ce}from"./PlayerSearch.9a37bc1d.js";import{D as me}from"./DesktopNavigation.c284328f.js";import{_ as pe}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.db3bcbf1.js";import"./supabase.beb006d9.js";import"./QTabs.8d68553c.js";import"./rtl.276c3f1b.js";import"./QFooter.716e353a.js";import"./admin.c99b9bfe.js";import"./api.2af71db3.js";import"./QItem.11f55c39.js";import"./QItemLabel.c3c7305b.js";import"./QList.7c68295a.js";import"./ClosePopup.7afa72db.js";import"./players.705eaa86.js";import"./QTooltip.9f2ef863.js";import"./position-engine.41ccacd1.js";import"./selection.b10b4da7.js";const ve={class:"header-content"},ge={class:"header-icons"},ye={key:0,class:"text-center q-pa-xl"},_e={key:1},fe={class:"q-mt-none q-mb-md"},be={key:0},he={key:1},ke={key:2,class:"q-mt-md q-pa-md bg-black rounded-borders"},xe={class:"q-mb-none text-body2"},Pe={key:3,class:"q-mt-md"},De={key:0},qe={key:1},Ne={key:2,class:"q-gutter-xs row items-center"},Ie=["src","alt"],we={key:1},Ce={key:3,class:"q-gutter-xs row items-center"},Se=["src","alt"],Re={key:1},Te=["src","alt"],je={key:1},Qe={key:4,class:"q-mt-md"},Ee={key:0},$e={key:0,class:"q-mt-sm"},ze={key:1},Be={class:"text-center q-mb-md text-body2"},Ve={key:5,class:"q-mt-md"},Fe={key:2,class:"q-pa-md text-center text-negative"},Ae={__name:"TournamentDetails",setup(Ue){const $=O(),x=H(),f=oe(),R=se(),l=h(null),P=h(!1),I=te(),D=$.params.tournamentId,q=h(!1),d=h(null),v=h([]),z=async()=>{if(!D){console.error("ID del torneo no encontrado en los par\xE1metros de la ruta."),f.notify({type:"negative",message:"No se pudo identificar el torneo."}),P.value=!1;return}P.value=!0,l.value=null,v.value=[];try{const e=await re(D);if(!e||typeof e!="object")throw console.warn(`No se encontraron datos para el torneo ID ${D} o el formato es incorrecto.`),new Error("Torneo no encontrado o datos inv\xE1lidos.");l.value=e[0],console.log("Detalles del torneo cargados:",l.value);const a=await ne(D);v.value=a,console.log("Jugadores inscritos:",v.value)}catch(e){console.error("Error al cargar detalles del torneo (desde loadData):",e),l.value=null,f.notify({type:"negative",message:(e==null?void 0:e.message)||"Error al cargar la informaci\xF3n del torneo."})}finally{P.value=!1}},B=()=>{var m;if(console.log("handleEnrollment called"),console.log("selectedPartner.value:",d.value),console.log("selectedPartner.value.email:",(m=d.value)==null?void 0:m.email),!l.value||!l.value.price_per_pair||!d.value){console.error("Datos del torneo incompletos o precio/pareja no disponible o pareja no seleccionada",l.value,d.value),f.notify({type:"negative",message:"No se puede procesar la inscripci\xF3n, falta informaci\xF3n del torneo o la pareja."});return}if(!d.value.email){console.error("El jugador seleccionado no tiene un email v\xE1lido:",d.value),f.notify({type:"negative",message:"El jugador seleccionado no tiene un email v\xE1lido. Por favor, selecciona otro jugador."});return}const e=l.value,a={summaryTitle:"Resumen de Inscripci\xF3n a Torneo",itemDetails:[{label:"Torneo",value:e.name||"No especificado"},{label:"Club",value:e.clubName||"No especificado"},{label:"Fecha Inicio",value:e.start_date||"No especificada"},{label:"Categor\xEDa",value:_(e.category)||"No especificada"},{label:"G\xE9nero",value:_(e.gender)||"No especificado"},{label:"Precio por Pareja",value:`$${e.price_per_pair.toFixed(2)}`},{label:"Pareja",value:`${d.value.first_name} ${d.value.last_name}`}],baseData:{clubId:e.clubId,price:e.price_per_pair,participants:2,type:"tournament",id:e.id,recipient_user_id:e.club_user_id||null,player2_email:d.value.email},allowPaymentSplit:!0,showPublicToggle:!1,commissionRate:4,extraData:{tournamentName:e.name,tournament_name:e.name,prize:e.prize,pricePerPair:e.price_per_pair,partnerId:d.value.user_id,player2_email:d.value.email}};console.log("summaryProps before storing:",a),console.log("baseData.player2_email:",a.baseData.player2_email),console.log("extraData.player2_email:",a.extraData.player2_email),R.setSummaryDetails(a),console.log("Datos del resumen de TORNEO guardados en Pinia:",a),x.push({name:"OrderSummary"})},V=()=>{x.back()},F=e=>{console.log("Partner selected:",e),console.log("Partner email:",e==null?void 0:e.email),d.value=e,q.value=!1},w=M(()=>!v.value||!I.userId?!1:v.value.some(e=>{var a,m;return((a=e.player1)==null?void 0:a.user_id)===I.userId||((m=e.player2)==null?void 0:m.user_id)===I.userId})),C=e=>{if(!e)return"??";const a=e.split("-");return a.length>0?a[0].substring(0,2).toUpperCase():e.substring(0,2).toUpperCase()},A=e=>({"round-robin":"Round Robin","eliminacion directa":"Eliminaci\xF3n Directa",combinado:"Combinado (Grupos + Playoffs)",liga:"Liga (Todos vs Todos)",retas:"Retas (Rotaci\xF3n de Parejas)"})[e]||e,_=e=>e&&e.charAt(0).toUpperCase()+e.slice(1),U=()=>!l.value||l.value.system!=="retas"?0:v.value.filter(e=>e.player1).length,G=async()=>{if(!l.value){f.notify({type:"negative",message:"No se pudo encontrar la informaci\xF3n del torneo."});return}const e=l.value,a=(e.price_per_pair||0)/2,m={summaryTitle:"Resumen de Inscripci\xF3n a Retas",itemDetails:[{label:"Evento",value:e.name||"No especificado"},{label:"Club",value:e.clubName||"No especificado"},{label:"Fecha Inicio",value:e.start_date||"No especificada"},{label:"Categor\xEDa",value:_(e.category)||"No especificada"},{label:"G\xE9nero",value:_(e.gender)||"No especificado"},{label:"Sistema",value:"Retas (Rotaci\xF3n de Parejas)"},{label:"Precio Individual",value:`$${a.toFixed(2)}`}],baseData:{clubId:e.clubId,price:a,participants:1,type:"tournament",id:e.id,recipient_user_id:e.club_user_id||null},extraData:{partnerId:null,isRetas:!0},successRedirect:"/dashboard/player",errorRedirect:`/tournament/${e.id}`};R.setSummaryDetails(m),x.push({name:"OrderSummary"})},T=()=>{x.push({name:"TournamentView",params:{tournamentId:l.value.id}})};return Y(async()=>{var e;await z(),w.value&&((e=l.value)==null?void 0:e.status)==="closed"&&T()}),(e,a)=>(o(),g(ae,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:p(()=>[s(J,{elevated:"",class:"text-white"},{default:p(()=>[t("div",ve,[a[2]||(a[2]=t("div",{class:"greeting"},[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})],-1)),t("div",ge,[s(de)])]),s(ue)]),_:1}),s(me),s(le,null,{default:p(()=>[s(ee,{class:"q-pa-md"},{default:p(()=>[P.value?(o(),r("div",ye,[s(L,{color:"primary",size:"xl"}),a[3]||(a[3]=t("p",{class:"q-mt-md"},"Cargando detalles del torneo...",-1))])):l.value?(o(),r("div",_e,[s(K,null,{default:p(()=>[s(W,null,{default:p(()=>{var m,j;return[t("h4",fe,u(l.value.name),1),t("p",null,[t("strong",null,[s(c,{name:"mdi-calendar-start",class:"q-mr-xs"}),a[4]||(a[4]=n("Inicio:"))]),n(" "+u(l.value.start_date)+" - "+u(l.value.start_time)+" hrs. ",1)]),t("p",null,[t("strong",null,[s(c,{name:"mdi-domain",class:"q-mr-xs"}),a[5]||(a[5]=n("Club:"))]),n(" "+u((m=l.value.clubs)==null?void 0:m.name),1)]),t("p",null,[t("strong",null,[s(c,{name:"mdi-trophy-variant-outline",class:"q-mr-xs"}),a[6]||(a[6]=n("Categor\xEDa:"))]),n(" "+u(_(l.value.category)),1)]),t("p",null,[t("strong",null,[s(c,{name:"mdi-gender-male-female",class:"q-mr-xs"}),a[7]||(a[7]=n("G\xE9nero:"))]),n(" "+u(_(l.value.gender)),1)]),t("p",null,[t("strong",null,[s(c,{name:"mdi-cogs",class:"q-mr-xs"}),a[8]||(a[8]=n("Sistema:"))]),n(" "+u(A(l.value.system)),1)]),l.value.system==="retas"?(o(),r("p",be,[t("strong",null,[s(c,{name:"mdi-cash-multiple",class:"q-mr-xs"}),a[9]||(a[9]=n("Precio por Jugador:"))]),n(" $"+u((l.value.price_per_pair/2).toFixed(2)||"N/A"),1)])):(o(),r("p",he,[t("strong",null,[s(c,{name:"mdi-cash-multiple",class:"q-mr-xs"}),a[10]||(a[10]=n("Precio por Pareja:"))]),n(" $"+u(((j=l.value.price_per_pair)==null?void 0:j.toFixed(2))||"N/A"),1)])),t("p",null,[t("strong",null,[s(c,{name:"mdi-gift-outline",class:"q-mr-xs"}),a[11]||(a[11]=n("Premios (Valor):"))]),n(" $"+u(l.value.prize||"N/A"),1)]),l.value.details?(o(),r("div",ke,[t("p",null,[t("strong",null,[s(c,{name:"mdi-information-outline",class:"q-mr-xs"}),a[12]||(a[12]=n("Detalles del Torneo:"))])]),t("p",xe,u(l.value.details),1)])):y("",!0),v.value.length>0?(o(),r("div",Pe,[l.value.system==="retas"?(o(),r("p",De,[t("strong",null,[s(c,{name:"mdi-account-multiple",class:"q-mr-xs"}),n("Jugadores Inscritos ("+u(U())+"):",1)])])):(o(),r("p",qe,[t("strong",null,[s(c,{name:"account-group-outline",class:"q-mr-xs"}),a[13]||(a[13]=n("Jugadores Inscritos:"))])])),l.value.system==="retas"?(o(),r("div",Ne,[(o(!0),r(N,null,E(v.value,i=>{var b;return o(),r(N,{key:(b=i.player1)==null?void 0:b.user_id},[i.player1?(o(),g(S,{key:0,size:"48px",color:"orange","text-color":"white"},{default:p(()=>[i.player1.photo_url?(o(),r("img",{key:0,src:i.player1.photo_url,alt:i.player1.user_id},null,8,Ie)):(o(),r("span",we,u(C(i.player1.user_id)),1))]),_:2},1024)):y("",!0)],64)}),128))])):(o(),r("div",Ce,[(o(!0),r(N,null,E(v.value,i=>{var b,Q;return o(),r(N,{key:((b=i.player1)==null?void 0:b.user_id)+"-"+((Q=i.player2)==null?void 0:Q.user_id)},[i.player1?(o(),g(S,{key:0,size:"48px",color:"white","text-color":"black",class:"overlapping"},{default:p(()=>[i.player1.photo_url?(o(),r("img",{key:0,src:i.player1.photo_url,alt:i.player1.user_id},null,8,Se)):(o(),r("span",Re,u(C(i.player1.user_id)),1))]),_:2},1024)):y("",!0),i.player2?(o(),g(S,{key:1,size:"48px",color:"white","text-color":"black",class:"overlapping"},{default:p(()=>[i.player2.photo_url?(o(),r("img",{key:0,src:i.player2.photo_url,alt:i.player2.user_id},null,8,Te)):(o(),r("span",je,u(C(i.player2.user_id)),1))]),_:2},1024)):y("",!0)],64)}),128))]))])):y("",!0),w.value?(o(),r("div",Ve,[l.value.status==="closed"?(o(),g(k,{key:0,label:"Ver Torneo",color:"green",icon:"visibility",class:"full-width",size:"lg",push:"",onClick:T})):(o(),g(Z,{key:1,color:"positive",class:"full-width q-pa-md"},{default:p(()=>a[15]||(a[15]=[n(" Ya est\xE1s inscrito en este torneo ")])),_:1}))])):(o(),r("div",Qe,[l.value.system!=="retas"?(o(),r("div",Ee,[s(k,{color:"primary",label:"Elige tu Pareja","icon-right":"mdi-account-search",onClick:a[0]||(a[0]=i=>q.value=!0),class:"full-width",size:"md",push:""}),d.value?(o(),r("p",$e," Pareja Seleccionada: "+u(d.value.first_name)+" "+u(d.value.last_name),1)):y("",!0)])):(o(),r("div",ze,[t("p",Be,[s(c,{name:"mdi-rotate-3d-variant",class:"q-mr-xs"}),a[14]||(a[14]=n(" En las retas juegas con diferentes parejas en cada ronda "))]),s(k,{label:"Inscribirme a las Retas",color:"orange","icon-right":"mdi-account-plus",class:"full-width",size:"lg",push:"",onClick:G,disable:!l.value,title:"Inscribirse individualmente a las retas"},null,8,["disable"])]))]))]}),_:1}),s(X,{align:"center",class:"q-pa-md"},{default:p(()=>[!w.value&&d.value&&l.value.system!=="retas"?(o(),g(k,{key:0,label:"Inscribir Pareja",color:"green","icon-right":"mdi-pencil-plus-outline",class:"full-width",size:"lg",push:"",onClick:B,disable:!l.value,title:"Inscribirse al torneo pagando la mitad del costo de pareja"},null,8,["disable"])):y("",!0)]),_:1})]),_:1})])):(o(),r("div",Fe,[s(c,{name:"mdi-alert-circle-outline",size:"lg"}),a[16]||(a[16]=t("p",{class:"q-mt-md"},"No se pudieron cargar los detalles del torneo.",-1)),s(k,{flat:"",label:"Volver",onClick:V})]))]),_:1})]),_:1}),s(ie),s(ce,{modelValue:q.value,"onUpdate:modelValue":a[1]||(a[1]=m=>q.value=m),onPlayerSelected:F},null,8,["modelValue"])]),_:1}))}};var ha=pe(Ae,[["__scopeId","data-v-895f2886"]]);export{ha as default};
