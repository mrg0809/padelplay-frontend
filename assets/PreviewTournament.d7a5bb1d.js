import{a7 as E,F as z,r as U,B as I,q as l,G as g,H as n,v as a,I as e,ab as T,J as C,s as d,ae as q,x as c,a9 as _,aa as m,ad as p,ac as h,y as k,K as y,aQ as B}from"./index.98c82dee.js";import{Q as O}from"./QHeader.907a1956.js";import{Q as j}from"./QSpinnerPuff.22863cdc.js";import{Q as P}from"./QChip.195aca38.js";import{Q as w}from"./QSelect.5653c301.js";import{Q as G}from"./QPage.ce31240f.js";import{Q as R,a as L}from"./QLayout.d8f1103d.js";import{s as S}from"./supabase.5d178e3a.js";import{a as H}from"./api.2af71db3.js";import{u as M}from"./use-quasar.4bd5d9ce.js";import{g as A,f as J}from"./tournamentUtils.cfdf57cc.js";import{_ as K}from"./plugin-vue_export-helper.21dcd24c.js";import"./QItem.ea82eb28.js";import"./QItemLabel.4f226cee.js";import"./QMenu.3d5ce795.js";import"./position-engine.79c72190.js";import"./selection.8cc9a7a2.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const W={name:"PreviewTournament",setup(){const N=E(),u=z(),Q=M(),t=U(null),D=U(!1),x=U(!1),r=U(null),s=U([]);I(async()=>{await o(),await i()});const o=async()=>{var b,V;D.value=!0,r.value=null;try{const v=N.params.tournamentId;if(!v)throw new Error("ID del torneo no encontrado");const f=await H.get(`/tournaments/${v}/preview`);t.value=f.data,console.log("Tournament preview loaded:",t.value)}catch(v){console.error("Error loading tournament preview:",v),r.value=((V=(b=v.response)==null?void 0:b.data)==null?void 0:V.detail)||v.message||"Error al cargar el preview del torneo"}finally{D.value=!1}},i=async()=>{var b,V;try{if((b=t.value)!=null&&b.tournament_id){const v=await S.from("tournaments").select("courts_used, club_id").eq("id",t.value.tournament_id).single();if((V=v.data)!=null&&V.courts_used){const f=await S.from("courts").select("id, name").in("id",v.data.courts_used);f.data&&(s.value=f.data.map(F=>({label:F.name,value:F.id})))}}}catch(v){console.error("Error loading courts:",v)}};return{tournamentData:t,loading:D,saving:x,error:r,courtOptions:s,getSystemName:b=>A(b),getTeamName:b=>J(b),saveMatches:async()=>{var b,V,v;x.value=!0;try{if(!((b=t.value)!=null&&b.matches))throw new Error("No hay partidos para guardar");const f=await H.post(`/tournaments/${t.value.tournament_id}/save-matches`,t.value.matches);Q.notify({type:"positive",message:`${f.data.matches_saved} partidos guardados exitosamente. Torneo cerrado.`,timeout:3e3}),setTimeout(()=>{u.push("/club/torneos")},1500)}catch(f){console.error("Error saving matches:",f),Q.notify({type:"negative",message:((v=(V=f.response)==null?void 0:V.data)==null?void 0:v.detail)||"Error al guardar los partidos",timeout:3e3})}finally{x.value=!1}},cancelPreview:()=>{u.back()},goBack:()=>{u.back()}}}},X={class:"header-content"},Y={class:"header-icons"},Z={key:0,class:"text-center q-mt-md"},$={key:1,class:"text-center q-mt-md"},ee={class:"text-negative"},ae={key:2},te={class:"row items-center q-gutter-md"},se={class:"col"},oe={class:"q-my-none"},le={class:"q-mb-none text-subtitle2"},ne={class:"col-auto"},de={key:0,class:"tournament-structure"},re={key:0,class:"groups-container"},ce={class:"q-my-none"},ie={class:"teams-list"},ue={key:0,class:"group-matches"},me={class:"match-details"},_e={class:"match-teams"},pe={class:"team-name"},he={class:"team-name"},ve={class:"match-schedule q-mt-sm"},be={class:"schedule-inputs row q-gutter-sm"},ye={key:1,class:"tournament-structure"},fe={class:"bracket-container"},ge={class:"q-my-none"},Ve={class:"round-matches"},qe={class:"match-details"},ke={class:"match-teams"},we={class:"match-schedule q-mt-sm"},Ue={class:"schedule-inputs row q-gutter-sm"},De={key:2,class:"tournament-structure"},xe={key:0,class:"groups-container q-mb-xl"},Ce={class:"q-my-none"},Qe={class:"teams-list"},Te={key:0,class:"group-matches"},Pe={class:"match-details"},Ne={class:"match-teams"},Fe={class:"team-name"},Be={class:"team-name"},Se={class:"match-schedule q-mt-sm"},He={class:"schedule-inputs row q-gutter-sm"},Ee={key:1,class:"playoffs-container"},ze={class:"q-my-none"},Ie={class:"round-matches"},Oe={class:"match-details"},je={class:"match-teams"},Ge={class:"team-name tbd-team"},Re={class:"team-name tbd-team"},Le={class:"match-schedule q-mt-sm"},Me={class:"schedule-inputs row q-gutter-sm"},Ae={key:3,class:"tournament-structure"},Je={class:"q-mb-none"},Ke={class:"liga-matches"},We={class:"match-details"},Xe={class:"match-teams"},Ye={class:"team-name"},Ze={class:"team-name"},$e={class:"match-schedule q-mt-sm"},ea={class:"schedule-inputs row q-gutter-sm"},aa={key:4,class:"tournament-structure"},ta={class:"q-mb-none"},sa={class:"retas-rounds"},oa={class:"q-my-none"},la={class:"retas-matches"},na={class:"match-details"},da={class:"match-teams-retas"},ra={class:"team-players"},ca={class:"players"},ia={class:"team-players"},ua={class:"players"},ma={class:"match-schedule q-mt-sm"},_a={class:"schedule-inputs row q-gutter-sm"},pa={class:"actions-section q-mt-xl"},ha={class:"row q-gutter-md justify-center"};function va(N,u,Q,t,D,x){return l(),g(R,{view:"hHh lpR fFf",class:"body text-white"},{default:n(()=>[a(O,{elevated:"",class:"bg-primary text-white"},{default:n(()=>[e("div",X,[u[0]||(u[0]=e("div",{class:"greeting"},[e("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),T(" Cuadro Propuesto del Torneo ")],-1)),e("div",Y,[a(C,{flat:"",round:"",icon:"arrow_back",onClick:t.goBack},null,8,["onClick"])])])]),_:1}),a(L,null,{default:n(()=>[a(G,{class:"q-pa-md"},{default:n(()=>[t.loading?(l(),d("div",Z,[a(j,{color:"primary",size:"3em"}),u[1]||(u[1]=e("p",null,"Generando cuadro del torneo...",-1))])):t.error?(l(),d("div",$,[a(q,{name:"warning",color:"negative",size:"3em"}),e("p",ee,c(t.error),1),a(C,{label:"Volver",color:"primary",onClick:t.goBack},null,8,["onClick"])])):t.tournamentData?(l(),d("div",ae,[a(_,{class:"q-mb-md tournament-info-card"},{default:n(()=>[a(m,null,{default:n(()=>{var r,s;return[e("div",te,[e("div",se,[e("h4",oe,c(((r=t.tournamentData.tournament)==null?void 0:r.name)||"Torneo"),1),e("p",le," Sistema: "+c(t.getSystemName(t.tournamentData.system))+" | Total de Partidos: "+c(((s=t.tournamentData.matches)==null?void 0:s.length)||0),1)]),e("div",ne,[a(P,{color:t.tournamentData.system==="eliminacion directa"?"red":t.tournamentData.system==="round-robin"?"blue":t.tournamentData.system==="combinado"?"purple":t.tournamentData.system==="retas"?"orange":"green","text-color":"white",label:t.getSystemName(t.tournamentData.system),icon:"emoji_events"},null,8,["color","label"])])])]}),_:1})]),_:1}),t.tournamentData.system==="round-robin"?(l(),d("div",de,[t.tournamentData.structure.groups?(l(),d("div",re,[(l(!0),d(p,null,h(t.tournamentData.structure.groups,r=>(l(),d("div",{key:r.name,class:"group-section q-mb-lg"},[a(_,{class:"group-card"},{default:n(()=>[a(m,{class:"bg-blue-8 text-white"},{default:n(()=>[e("h6",ce,c(r.name),1),e("div",ie,[(l(!0),d(p,null,h(r.teams,s=>(l(),g(P,{key:s.id,color:"white","text-color":"blue-8",size:"sm",class:"q-ma-xs"},{default:n(()=>[T(c(t.getTeamName(s)),1)]),_:2},1024))),128))])]),_:2},1024),a(m,{class:"matches-section"},{default:n(()=>[u[2]||(u[2]=e("h6",{class:"q-mt-none q-mb-md"},"Partidos del Grupo",-1)),t.tournamentData.structure.group_matches[r.name]?(l(),d("div",ue,[(l(!0),d(p,null,h(t.tournamentData.structure.group_matches[r.name],s=>(l(),g(_,{key:s.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(m,{class:"q-pa-sm"},{default:n(()=>[e("div",me,[e("div",_e,[e("span",pe,c(s.team1.name),1),a(q,{name:"sports",class:"vs-icon"}),e("span",he,c(s.team2.name),1)]),e("div",ve,[e("div",be,[a(y,{modelValue:s.match_date,"onUpdate:modelValue":o=>s.match_date=o,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:s.match_time,"onUpdate:modelValue":o=>s.match_time=o,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:s.court_id,"onUpdate:modelValue":o=>s.court_id=o,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])):k("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):k("",!0)])):t.tournamentData.system==="eliminacion directa"?(l(),d("div",ye,[e("div",fe,[(l(!0),d(p,null,h(t.tournamentData.structure.bracket,(r,s)=>(l(),d("div",{key:s,class:"bracket-round"},[a(_,{class:"round-card q-mb-lg"},{default:n(()=>[a(m,{class:"bg-red-8 text-white"},{default:n(()=>[e("h6",ge,c(s),1)]),_:2},1024),a(m,null,{default:n(()=>[e("div",Ve,[(l(!0),d(p,null,h(r,o=>(l(),g(_,{key:o.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(m,{class:"q-pa-sm"},{default:n(()=>[e("div",qe,[e("div",ke,[e("span",{class:B(["team-name",{"tbd-team":!o.team1.player1}])},c(o.team1.name),3),a(q,{name:"sports",class:"vs-icon"}),e("span",{class:B(["team-name",{"tbd-team":!o.team2.player1}])},c(o.team2.name),3)]),e("div",we,[e("div",Ue,[a(y,{modelValue:o.match_date,"onUpdate:modelValue":i=>o.match_date=i,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:o.match_time,"onUpdate:modelValue":i=>o.match_time=i,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:o.court_id,"onUpdate:modelValue":i=>o.court_id=i,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])])):t.tournamentData.system==="combinado"?(l(),d("div",De,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(m,{class:"bg-purple-8 text-white"},{default:n(()=>u[3]||(u[3]=[e("h5",{class:"q-my-none"},"Fase de Grupos",-1)])),_:1})]),_:1}),t.tournamentData.structure.groups?(l(),d("div",xe,[(l(!0),d(p,null,h(t.tournamentData.structure.groups,r=>(l(),d("div",{key:r.name,class:"group-section q-mb-lg"},[a(_,{class:"group-card"},{default:n(()=>[a(m,{class:"bg-blue-6 text-white"},{default:n(()=>[e("h6",Ce,c(r.name),1),e("div",Qe,[(l(!0),d(p,null,h(r.teams,s=>(l(),g(P,{key:s.id,color:"white","text-color":"blue-8",size:"sm",class:"q-ma-xs"},{default:n(()=>[T(c(t.getTeamName(s)),1)]),_:2},1024))),128))])]),_:2},1024),a(m,{class:"matches-section"},{default:n(()=>[t.tournamentData.structure.group_matches[r.name]?(l(),d("div",Te,[(l(!0),d(p,null,h(t.tournamentData.structure.group_matches[r.name],s=>(l(),g(_,{key:s.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(m,{class:"q-pa-sm"},{default:n(()=>[e("div",Pe,[e("div",Ne,[e("span",Fe,c(s.team1.name),1),a(q,{name:"sports",class:"vs-icon"}),e("span",Be,c(s.team2.name),1)]),e("div",Se,[e("div",He,[a(y,{modelValue:s.match_date,"onUpdate:modelValue":o=>s.match_date=o,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:s.match_time,"onUpdate:modelValue":o=>s.match_time=o,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:s.court_id,"onUpdate:modelValue":o=>s.court_id=o,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])):k("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):k("",!0),a(_,{class:"q-mb-lg"},{default:n(()=>[a(m,{class:"bg-purple-8 text-white"},{default:n(()=>u[4]||(u[4]=[e("h5",{class:"q-my-none"},"Fase de Playoffs",-1)])),_:1})]),_:1}),t.tournamentData.structure.playoffs?(l(),d("div",Ee,[(l(!0),d(p,null,h(t.tournamentData.structure.playoffs,(r,s)=>(l(),d("div",{key:s,class:"bracket-round"},[a(_,{class:"round-card q-mb-lg"},{default:n(()=>[a(m,{class:"bg-red-6 text-white"},{default:n(()=>[e("h6",ze,c(s),1)]),_:2},1024),a(m,null,{default:n(()=>[e("div",Ie,[(l(!0),d(p,null,h(r,o=>(l(),g(_,{key:o.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(m,{class:"q-pa-sm"},{default:n(()=>[e("div",Oe,[e("div",je,[e("span",Ge,c(o.team1.name),1),a(q,{name:"sports",class:"vs-icon"}),e("span",Re,c(o.team2.name),1)]),e("div",Le,[e("div",Me,[a(y,{modelValue:o.match_date,"onUpdate:modelValue":i=>o.match_date=i,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:o.match_time,"onUpdate:modelValue":i=>o.match_time=i,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:o.court_id,"onUpdate:modelValue":i=>o.court_id=i,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])):k("",!0)])):t.tournamentData.system==="liga"?(l(),d("div",Ae,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(m,{class:"bg-green-8 text-white"},{default:n(()=>[u[5]||(u[5]=e("h5",{class:"q-my-none"},"Liga - Todos contra Todos",-1)),e("p",Je,c(t.tournamentData.structure.total_matches)+" partidos programados",1)]),_:1})]),_:1}),e("div",Ke,[(l(!0),d(p,null,h(t.tournamentData.matches,r=>(l(),g(_,{key:r.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(m,{class:"q-pa-sm"},{default:n(()=>[e("div",We,[e("div",Xe,[e("span",Ye,c(r.team1.name),1),a(q,{name:"sports",class:"vs-icon"}),e("span",Ze,c(r.team2.name),1)]),e("div",$e,[e("div",ea,[a(y,{modelValue:r.match_date,"onUpdate:modelValue":s=>r.match_date=s,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:r.match_time,"onUpdate:modelValue":s=>r.match_time=s,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:r.court_id,"onUpdate:modelValue":s=>r.court_id=s,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])])):t.tournamentData.system==="retas"?(l(),d("div",aa,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(m,{class:"bg-black text-white"},{default:n(()=>[u[6]||(u[6]=e("h5",{class:"q-my-none"},"Retas - Rotaci\xF3n de Parejas",-1)),e("p",ta,c(t.tournamentData.structure.num_rounds)+" rondas con "+c(t.tournamentData.structure.total_players)+" jugadores",1)]),_:1})]),_:1}),e("div",sa,[(l(!0),d(p,null,h(t.tournamentData.structure.rounds,(r,s)=>(l(),d("div",{key:s,class:"round-section q-mb-lg"},[a(_,{flat:"",bordered:"",class:"round-card"},{default:n(()=>[a(m,{class:"bg-black text-white round-header"},{default:n(()=>[e("h6",oa,c(s),1)]),_:2},1024),a(m,{class:"q-pa-none"},{default:n(()=>[e("div",la,[(l(!0),d(p,null,h(r,o=>(l(),g(_,{key:o.id,class:"match-card q-mb-sm q-ma-sm",flat:"",bordered:""},{default:n(()=>[a(m,{class:"q-pa-sm"},{default:n(()=>[e("div",na,[e("div",da,[e("div",ra,[u[7]||(u[7]=e("div",{class:"team-label"},"Pareja 1:",-1)),e("div",ca,[(l(!0),d(p,null,h(o.team1.players,i=>(l(),d("span",{key:i.id,class:"player-name"},c(i.name),1))),128))])]),a(q,{name:"sports",class:"vs-icon"}),e("div",ia,[u[8]||(u[8]=e("div",{class:"team-label"},"Pareja 2:",-1)),e("div",ua,[(l(!0),d(p,null,h(o.team2.players,i=>(l(),d("span",{key:i.id,class:"player-name"},c(i.name),1))),128))])])]),e("div",ma,[e("div",_a,[a(y,{modelValue:o.date,"onUpdate:modelValue":i=>o.date=i,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:o.time,"onUpdate:modelValue":i=>o.time=i,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:o.court_id,"onUpdate:modelValue":i=>o.court_id=i,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])])):k("",!0),e("div",pa,[e("div",ha,[a(C,{label:"Guardar Cuadro",color:"green",size:"lg",icon:"save",onClick:t.saveMatches,loading:t.saving,class:"save-btn"},null,8,["onClick","loading"]),a(C,{label:"Cancelar",color:"red",size:"lg",icon:"cancel",onClick:t.cancelPreview,outline:"",class:"cancel-btn"},null,8,["onClick"])]),u[9]||(u[9]=e("p",{class:"text-center q-mt-sm text-caption"}," Al guardar el cuadro, se cerrar\xE1n las inscripciones y se bloquear\xE1n las canchas para los horarios programados ",-1))])])):k("",!0)]),_:1})]),_:1})]),_:1})}var ja=K(W,[["render",va],["__scopeId","data-v-7bbc849e"]]);export{ja as default};
