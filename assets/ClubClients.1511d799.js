import{y as S,a6 as Q,o as u,z as y,A as l,d as a,B as d,a9 as _,D as w,a as m,aa as E,ab as x,bE as B,aW as I,t as p,aT as F}from"./index.687b44e8.js";import{Q as D}from"./QHeader.289f0645.js";import{Q as T,a as h}from"./QItem.eb9291fb.js";import{Q as b}from"./QItemLabel.bbebea39.js";import{Q as N}from"./QList.1288e946.js";import{Q as j,a as L}from"./QLayout.30990248.js";import{n as M}from"./navigationUtils.2c4b9dee.js";import{s as g}from"./supabase.66aa98e2.js";import{a as k}from"./api.1c42dce4.js";import{C as U}from"./ClubNavigationMenu.44af5278.js";import{_ as V}from"./plugin-vue_export-helper.21dcd24c.js";import"./QTabs.979bee57.js";import"./rtl.276c3f1b.js";import"./QFooter.b7b22f15.js";const q={components:{ClubNavigationMenu:U},data(){return{clients:[],userStore:S()}},methods:{getInitials(t){if(!t||t==="Unknown")return"?";const o=String(t).trim().split(/\s+/).filter(Boolean);return o.length===0?"?":o.length===1?o[0].slice(0,2).toUpperCase():(o[0][0]+o[o.length-1][0]).toUpperCase()},avatarStyle(t){return t.photo_url?{}:{backgroundColor:`hsl(${this.getInitials(t.player_name).split("").reduce((s,i)=>s+i.charCodeAt(0),0)%360}, 55%, 45%)`,color:"#fff"}},goBack(){this.$router.back()},goToDashboard(){M(this.$router,this.userStore)},async toggleFollow(t){const o=this.userStore.userId;if(o)try{t.is_following?await k.delete("community/unfollow",{data:{follower_id:o,followed_id:t.player_id}}):await k.post("community/follow",{follower_id:o,followed_id:t.player_id}),t.is_following=!t.is_following}catch(s){console.error("Error toggling follow:",s)}},async fetchClients(){if(this.userStore.userId){const o=this.userStore.clubId;try{const{data:s,error:i}=await g.from("matches").select("team1_players, team2_players").eq("club_id",o);if(i)throw i;const n={};s.forEach(e=>{e.team1_players.forEach(r=>{n[r]=(n[r]||0)+1}),e.team2_players.forEach(r=>{n[r]=(n[r]||0)+1})});const{data:c,error:f}=await g.from("players").select("user_id, first_name, last_name, photo_url").in("user_id",Object.keys(n));if(f)throw f;this.clients=await Promise.all(Object.keys(n).map(async e=>{const r=c.find(C=>C.user_id===e),v=await this.checkIfFollowing(e);return{player_id:e,player_name:r?`${r.first_name} ${r.last_name}`:"Unknown",photo_url:r?r.photo_url:null,visits:n[e],is_following:v}})),this.clients.sort((e,r)=>r.visits-e.visits)}catch(s){console.error("Error fetching clients:",s)}}},async checkIfFollowing(t){const o=this.userStore.userId;if(o)try{const{data:s,error:i}=await g.from("follows").select("id").eq("follower_id",o).eq("followed_id",t).single();if(i&&i.code!=="PGRST116")throw i;return!!s}catch(s){return console.error("Error checking follow status:",s),!1}return!1}},mounted(){this.fetchClients()}},$={class:"header-content"},A={class:"greeting"},P={class:"header-icons"},z=["src"],H={key:1,class:"avatar-initials"};function O(t,o,s,i,n,c){const f=Q("ClubNavigationMenu");return u(),y(j,{view:"hHh lpR fFf",class:"body"},{default:l(()=>[a(D,{elevated:"",class:"text-white"},{default:l(()=>[d("div",$,[d("div",A,[d("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:o[0]||(o[0]=(...e)=>c.goToDashboard&&c.goToDashboard(...e))}),o[1]||(o[1]=_(" Mejores clientes ",-1))]),d("div",P,[a(w,{flat:"",round:"",icon:"close",onClick:c.goBack},null,8,["onClick"])])])]),_:1}),a(L,null,{default:l(()=>[o[2]||(o[2]=d("div",{class:"q-mt-xl"},null,-1)),a(N,{class:"court-list"},{default:l(()=>[(u(!0),m(x,null,E(n.clients,e=>(u(),y(T,{key:e.player_id,clickable:"",onClick:r=>t.editClient(e),class:"text-black court-item"},{default:l(()=>[a(h,{avatar:""},{default:l(()=>[a(B,{style:I(c.avatarStyle(e))},{default:l(()=>[e.photo_url?(u(),m("img",{key:0,src:e.photo_url,alt:"Foto del jugador"},null,8,z)):(u(),m("span",H,p(c.getInitials(e.player_name)),1))]),_:2},1032,["style"])]),_:2},1024),a(h,null,{default:l(()=>[a(b,null,{default:l(()=>[_(p(e.player_name),1)]),_:2},1024),a(b,{caption:"",class:"text-black"},{default:l(()=>[_(p(e.visits)+" Visitas a tu club ",1)]),_:2},1024)]),_:2},1024),a(h,{side:""},{default:l(()=>[a(w,{color:e.is_following?"secondary":"primary",icon:e.is_following?"o_remove_circle":"o_add_circle",label:e.is_following?"Dejar de seguir":"Seguir",onClick:F(r=>c.toggleFollow(e),["stop"])},null,8,["color","icon","label","onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),a(f)]),_:1})}var le=V(q,[["render",O],["__scopeId","data-v-51eaea1e"]]);export{le as default};
