import{F as A,r as c,B as H,a8 as R,q as n,G as u,H as l,v as o,I as r,ab as C,J as i,s as E,ae as J,ad as G,ac as O,ag as y,ah as h,a9 as D,aa as V,af as q,x as _,y as T}from"./index.44ff7f36.js";import{Q as W}from"./QHeader.1d41df4b.js";import{Q as K}from"./QBadge.dc626f3f.js";import{Q as X}from"./QPage.01f0db4e.js";import{Q as B,a as N}from"./QItem.ca93871c.js";import{Q as Y}from"./QList.843a2d7e.js";import{Q as Z}from"./QMenu.75efc905.js";import{Q as $,a as ee}from"./QLayout.36e57c24.js";import{C as Q}from"./ClosePopup.8af65d55.js";import{s as I}from"./supabase.62935925.js";import{u as ae}from"./use-quasar.5b0bf7b9.js";import"./api.2af71db3.js";import{C as oe}from"./ClubNavigationMenu.8b6e6cad.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.6138d72b.js";import"./selection.fc24a828.js";import"./QTabs.b7b4d746.js";import"./rtl.276c3f1b.js";import"./QFooter.f84d141a.js";const le={name:"ListTournaments",components:{ClubNavigationMenu:oe},setup(){const m=A(),e=ae(),g=c([]),s=c(null),k=c(!1),f=c(!1),p=c(null),a=c(null),v=async()=>{try{if(!s.value){console.error("Club ID no encontrado.");return}const{data:t,error:b}=await I.from("tournaments").select("id, name, start_date, min_pairs, status").eq("club_id",s.value).order("start_date",{ascending:!1});if(b){console.error("Error fetching tournaments:",b.message);return}const x=await Promise.all(t.map(async d=>{const{data:w,error:me}=await I.from("tournament_teams").select("id",{count:"exact"}).eq("tournament_id",d.id).eq("status","confirmed");return{id:d.id,name:d.name,start_date:d.start_date,min_pairs:d.min_pairs,registered_teams:(w==null?void 0:w.length)||0,status:d.status||"open"}}));g.value=x}catch(t){console.error("Unexpected error fetching tournaments:",t.message)}},M=t=>{m.push({name:"EditTournament",params:{tournamentId:t}})},L=t=>{p.value=t,k.value=!0},P=async()=>{try{const{error:t}=await I.from("tournaments").delete().eq("id",p.value);if(t)throw t;g.value=g.value.filter(b=>b.id!==p.value),k.value=!1,e.notify({type:"positive",message:"Torneo eliminado exitosamente."})}catch(t){console.error("Error al eliminar el torneo:",t.message),e.notify({type:"negative",message:"Error al eliminar torneo."})}},z=t=>{a.value=t,f.value=!0},S=async()=>{try{if(console.log("Cerrando torneo:",a.value.id),a.value.registered_teams<a.value.min_pairs){e.notify({type:"negative",message:"El torneo no tiene suficientes parejas inscritas para cerrarlo."}),f.value=!1;return}m.push({name:"PreviewTournament",params:{tournamentId:a.value.id}}),f.value=!1}catch(t){console.error("Error navigating to preview:",t),e.notify({type:"negative",message:"Error al navegar a la vista previa del torneo."})}},U=t=>{m.push("/club/creartorneos")},F=t=>{m.push({name:"ManageTournament",params:{tournamentId:t}})},j=()=>{m.back()};return H(()=>{const t=localStorage.getItem("token");if(t){const x=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),d=JSON.parse(atob(x));s.value=d.club_id||null}v()}),{tournaments:g,goBack:j,editTournament:M,openDeleteDialog:L,openCloseDialog:z,deleteDialogVisible:k,closeDialogVisible:f,deleteTournament:P,closeTournament:S,openCreateTournament:U,manageTournament:F}}},re={class:"header-content"},se={class:"header-icons"},ne={key:0,class:"text-center q-mt-md"},ie={key:1,class:"tournaments-list"},de={class:"actions"};function ue(m,e,g,s,k,f){const p=R("ClubNavigationMenu");return n(),u($,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[o(W,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[r("div",re,[e[2]||(e[2]=r("div",{class:"greeting"},[r("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),C(" Mis Torneos ")],-1)),r("div",se,[o(i,{flat:"",round:"",icon:"arrow_back",onClick:s.goBack},null,8,["onClick"])])])]),_:1}),o(ee,null,{default:l(()=>[o(X,{class:"q-pa-md"},{default:l(()=>[s.tournaments.length===0?(n(),E("div",ne,[o(J,{name:"event_busy",size:"64px"}),e[3]||(e[3]=r("p",null,"No has creado torneos todav\xEDa.",-1))])):(n(),E("div",ie,[(n(!0),E(G,null,O(s.tournaments,a=>(n(),u(D,{key:a.id,class:"q-mb-md transparent-card"},{default:l(()=>[o(V,null,{default:l(()=>[r("h4",null,_(a.name),1),r("p",null,[e[4]||(e[4]=r("strong",null,"Fecha:",-1)),C(" "+_(a.start_date)+" ",1),e[5]||(e[5]=r("br",null,null,-1)),e[6]||(e[6]=r("strong",null,"M\xEDnimo de Parejas:",-1)),C(" "+_(a.min_pairs)+" ",1),e[7]||(e[7]=r("br",null,null,-1)),e[8]||(e[8]=r("strong",null,"Parejas Inscritas:",-1)),C(" "+_(a.registered_teams)+" ",1),e[9]||(e[9]=r("br",null,null,-1)),e[10]||(e[10]=r("strong",null,"Estado:",-1)),o(K,{color:a.status==="closed"?"green":"orange"},{default:l(()=>[C(_(a.status==="closed"?"Cerrado":"Abierto"),1)]),_:2},1032,["color"])]),r("div",de,[a.status!=="closed"?(n(),u(i,{key:0,icon:"edit",label:"Editar",color:"primary",size:"sm",onClick:v=>s.editTournament(a.id)},null,8,["onClick"])):T("",!0),a.status!=="closed"?(n(),u(i,{key:1,icon:"delete",label:"Eliminar",color:"negative",size:"sm",disable:a.registered_teams>0,onClick:v=>s.openDeleteDialog(a.id)},null,8,["disable","onClick"])):T("",!0),a.status!=="closed"?(n(),u(i,{key:2,icon:"preview",label:"Cerrar Torneo",color:"orange",size:"sm",onClick:v=>s.openCloseDialog(a)},null,8,["onClick"])):T("",!0),a.status==="closed"?(n(),u(i,{key:3,icon:"dashboard",label:"Administrar",color:"green",size:"sm",onClick:v=>s.manageTournament(a.id)},null,8,["onClick"])):T("",!0)])]),_:2},1024)]),_:2},1024))),128))]))]),_:1}),o(i,{glossy:"",round:"",size:"lg",color:"black",icon:"add",class:"fixed-bottom-right q-mb-xl"},{default:l(()=>[o(Z,{anchor:"top end",self:"bottom end"},{default:l(()=>[o(Y,{style:{"min-width":"150px"}},{default:l(()=>[y((n(),u(B,{clickable:"",onClick:s.openCreateTournament},{default:l(()=>[o(N,null,{default:l(()=>e[11]||(e[11]=[r("strong",null,"Retas",-1)])),_:1})]),_:1},8,["onClick"])),[[Q]]),y((n(),u(B,{clickable:"",onClick:s.openCreateTournament},{default:l(()=>[o(N,null,{default:l(()=>e[12]||(e[12]=[r("strong",null,"Torneo",-1)])),_:1})]),_:1},8,["onClick"])),[[Q]])]),_:1})]),_:1})]),_:1}),o(h,{modelValue:s.deleteDialogVisible,"onUpdate:modelValue":e[0]||(e[0]=a=>s.deleteDialogVisible=a)},{default:l(()=>[o(D,{class:"bg-black text-white"},{default:l(()=>[o(V,null,{default:l(()=>e[13]||(e[13]=[r("div",{class:"text-h6"},"Confirmar eliminaci\xF3n",-1),r("div",null,"\xBFEst\xE1s seguro de que deseas eliminar este torneo?",-1)])),_:1}),o(q,{align:"right"},{default:l(()=>[y(o(i,{flat:"",label:"Cancelar",color:"primary"},null,512),[[Q]]),o(i,{flat:"",label:"Eliminar",color:"negative",onClick:s.deleteTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(h,{modelValue:s.closeDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=a=>s.closeDialogVisible=a)},{default:l(()=>[o(D,{class:"bg-black text-white"},{default:l(()=>[o(V,null,{default:l(()=>e[14]||(e[14]=[r("div",{class:"text-h6"},"Confirmar cierre",-1),r("div",null," \xBFEst\xE1s seguro de que deseas cerrar este torneo? Esto generar\xE1 el fixture autom\xE1ticamente. ",-1)])),_:1}),o(q,{align:"right"},{default:l(()=>[y(o(i,{flat:"",label:"Cancelar",color:"red"},null,512),[[Q]]),o(i,{flat:"",label:"Cerrar Torneo",color:"green",onClick:s.closeTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(p)]),_:1})}var qe=te(le,[["render",ue],["__scopeId","data-v-f6877bca"]]);export{qe as default};
