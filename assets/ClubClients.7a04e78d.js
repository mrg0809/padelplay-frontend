import{aa as C,q as f,G as h,H as s,v as r,I as u,ad as _,J as g,s as Q,ae as S,af as x,bG as E,x as w,aW as F}from"./index.cabb238b.js";import{Q as B}from"./QHeader.325e6f8a.js";import{Q as I,a as m}from"./QItem.54c8e8ba.js";import{Q as y}from"./QItemLabel.8ddeeb8d.js";import{Q as D}from"./QList.e00fe6ed.js";import{Q as N,a as T}from"./QLayout.6d8de49a.js";import{n as j}from"./navigationUtils.2c4b9dee.js";import{s as p}from"./supabase.48b89bac.js";import{a as v}from"./api.2af71db3.js";import{u as q}from"./userStore.b62a8549.js";import{C as L}from"./ClubNavigationMenu.21f0d62a.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.490ff4c4.js";import"./QTabs.a62af68f.js";import"./rtl.276c3f1b.js";import"./QFooter.55965c1d.js";const V={components:{ClubNavigationMenu:L},data(){return{clients:[],userStore:q()}},methods:{goBack(){this.$router.back()},goToDashboard(){j(this.$router,this.userStore)},async toggleFollow(a){const e=this.userStore.userId;if(e)try{a.is_following?await v.delete("community/unfollow",{data:{follower_id:e,followed_id:a.player_id}}):await v.post("community/follow",{follower_id:e,followed_id:a.player_id}),a.is_following=!a.is_following}catch(l){console.error("Error toggling follow:",l)}},async fetchClients(){if(this.userStore.userId){const e=this.userStore.clubId;try{const{data:l,error:n}=await p.from("matches").select("team1_players, team2_players").eq("club_id",e);if(n)throw n;const i={};l.forEach(o=>{o.team1_players.forEach(t=>{i[t]=(i[t]||0)+1}),o.team2_players.forEach(t=>{i[t]=(i[t]||0)+1})});const{data:c,error:d}=await p.from("players").select("user_id, first_name, last_name, photo_url").in("user_id",Object.keys(i));if(d)throw d;this.clients=await Promise.all(Object.keys(i).map(async o=>{const t=c.find(k=>k.user_id===o),b=await this.checkIfFollowing(o);return{player_id:o,player_name:t?`${t.first_name} ${t.last_name}`:"Unknown",photo_url:t?t.photo_url:null,visits:i[o],is_following:b}})),this.clients.sort((o,t)=>t.visits-o.visits)}catch(l){console.error("Error fetching clients:",l)}}},async checkIfFollowing(a){const e=this.userStore.userId;if(e)try{const{data:l,error:n}=await p.from("follows").select("id").eq("follower_id",e).eq("followed_id",a).single();if(n&&n.code!=="PGRST116")throw n;return!!l}catch(l){return console.error("Error checking follow status:",l),!1}return!1}},mounted(){this.fetchClients()}},$={class:"header-content"},G={class:"greeting"},H={class:"header-icons"},P=["src"];function O(a,e,l,n,i,c){const d=C("ClubNavigationMenu");return f(),h(N,{view:"hHh lpR fFf",class:"body"},{default:s(()=>[r(B,{elevated:"",class:"text-white"},{default:s(()=>[u("div",$,[u("div",G,[u("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...o)=>c.goToDashboard&&c.goToDashboard(...o))}),e[1]||(e[1]=_(" Mejores clientes "))]),u("div",H,[r(g,{flat:"",round:"",icon:"close",onClick:c.goBack},null,8,["onClick"])])])]),_:1}),r(T,null,{default:s(()=>[e[2]||(e[2]=u("div",{class:"q-mt-xl"},null,-1)),r(D,{class:"court-list"},{default:s(()=>[(f(!0),Q(x,null,S(i.clients,o=>(f(),h(I,{key:o.player_id,clickable:"",onClick:t=>a.editClient(o),class:"text-black court-item"},{default:s(()=>[r(m,{avatar:""},{default:s(()=>[r(E,null,{default:s(()=>[u("img",{src:o.photo_url||"https://via.placeholder.com/150",alt:"Foto del jugador"},null,8,P)]),_:2},1024)]),_:2},1024),r(m,null,{default:s(()=>[r(y,null,{default:s(()=>[_(w(o.player_name),1)]),_:2},1024),r(y,{caption:"",class:"text-black"},{default:s(()=>[_(w(o.visits)+" Visitas a tu club ",1)]),_:2},1024)]),_:2},1024),r(m,{side:""},{default:s(()=>[r(g,{color:o.is_following?"secondary":"primary",icon:o.is_following?"o_remove_circle":"o_add_circle",label:o.is_following?"Dejar de seguir":"Seguir",onClick:F(t=>c.toggleFollow(o),["stop"])},null,8,["color","icon","label","onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),r(d)]),_:1})}var lo=M(V,[["render",O],["__scopeId","data-v-93409cf2"]]);export{lo as default};
