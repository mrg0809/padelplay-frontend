import{a7 as E,F as z,r as D,B as I,q as l,G as f,H as n,v as a,I as e,ab as Q,J as C,s as r,ae as q,x as i,a9 as _,aa as u,ad as p,ac as h,y as k,K as y,aQ as S}from"./index.f52eeb23.js";import{Q as O}from"./QHeader.9b837285.js";import{Q as j}from"./QSpinnerPuff.576b1f55.js";import{Q as P}from"./QChip.14b42392.js";import{Q as w}from"./QSelect.fcd8d5c3.js";import{Q as G}from"./QPage.e3b227e5.js";import{Q as R,a as L}from"./QLayout.cb0005f9.js";import{s as B}from"./supabase.577864c8.js";import{n as M}from"./navigationUtils.2c4b9dee.js";import{a as H}from"./api.2af71db3.js";import{u as A}from"./use-quasar.181232a6.js";import{g as J,f as K}from"./tournamentUtils.cfdf57cc.js";import{_ as W}from"./plugin-vue_export-helper.21dcd24c.js";import"./QItem.5db8a12f.js";import"./QItemLabel.c940b1f9.js";import"./QMenu.62944bb3.js";import"./position-engine.3d6fe0c3.js";import"./selection.8b3fabd2.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const X={name:"PreviewTournament",setup(){const N=E(),c=z(),T=A(),t=D(null),U=D(!1),x=D(!1),d=D(null),s=D([]);I(async()=>{await o(),await m()});const o=async()=>{var b,V;U.value=!0,d.value=null;try{const v=N.params.tournamentId;if(!v)throw new Error("ID del torneo no encontrado");const g=await H.get(`/tournaments/${v}/preview`);t.value=g.data,console.log("Tournament preview loaded:",t.value)}catch(v){console.error("Error loading tournament preview:",v),d.value=((V=(b=v.response)==null?void 0:b.data)==null?void 0:V.detail)||v.message||"Error al cargar el preview del torneo"}finally{U.value=!1}},m=async()=>{var b,V;try{if((b=t.value)!=null&&b.tournament_id){const v=await B.from("tournaments").select("courts_used, club_id").eq("id",t.value.tournament_id).single();if((V=v.data)!=null&&V.courts_used){const g=await B.from("courts").select("id, name").in("id",v.data.courts_used);g.data&&(s.value=g.data.map(F=>({label:F.name,value:F.id})))}}}catch(v){console.error("Error loading courts:",v)}};return{tournamentData:t,loading:U,saving:x,error:d,courtOptions:s,getSystemName:b=>J(b),getTeamName:b=>K(b),saveMatches:async()=>{var b,V,v;x.value=!0;try{if(!((b=t.value)!=null&&b.matches))throw new Error("No hay partidos para guardar");const g=await H.post(`/tournaments/${t.value.tournament_id}/save-matches`,t.value.matches);T.notify({type:"positive",message:`${g.data.matches_saved} partidos guardados exitosamente. Torneo cerrado.`,timeout:3e3}),setTimeout(()=>{c.push("/club/torneos")},1500)}catch(g){console.error("Error saving matches:",g),T.notify({type:"negative",message:((v=(V=g.response)==null?void 0:V.data)==null?void 0:v.detail)||"Error al guardar los partidos",timeout:3e3})}finally{x.value=!1}},cancelPreview:()=>{c.back()},goBack:()=>{c.back()},goToDashboard:()=>{M(c,userStore)}}}},Y={class:"header-content"},Z={class:"greeting"},$={class:"header-icons"},ee={key:0,class:"text-center q-mt-md"},ae={key:1,class:"text-center q-mt-md"},te={class:"text-negative"},se={key:2},oe={class:"row items-center q-gutter-md"},le={class:"col"},ne={class:"q-my-none"},de={class:"q-mb-none text-subtitle2"},re={class:"col-auto"},ce={key:0,class:"tournament-structure"},ie={key:0,class:"groups-container"},me={class:"q-my-none"},ue={class:"teams-list"},_e={key:0,class:"group-matches"},pe={class:"match-details"},he={class:"match-teams"},ve={class:"team-name"},be={class:"team-name"},ye={class:"match-schedule q-mt-sm"},ge={class:"schedule-inputs row q-gutter-sm"},fe={key:1,class:"tournament-structure"},Ve={class:"bracket-container"},qe={class:"q-my-none"},ke={class:"round-matches"},we={class:"match-details"},De={class:"match-teams"},Ue={class:"match-schedule q-mt-sm"},xe={class:"schedule-inputs row q-gutter-sm"},Ce={key:2,class:"tournament-structure"},Te={key:0,class:"groups-container q-mb-xl"},Qe={class:"q-my-none"},Pe={class:"teams-list"},Ne={key:0,class:"group-matches"},Fe={class:"match-details"},Se={class:"match-teams"},Be={class:"team-name"},He={class:"team-name"},Ee={class:"match-schedule q-mt-sm"},ze={class:"schedule-inputs row q-gutter-sm"},Ie={key:1,class:"playoffs-container"},Oe={class:"q-my-none"},je={class:"round-matches"},Ge={class:"match-details"},Re={class:"match-teams"},Le={class:"team-name tbd-team"},Me={class:"team-name tbd-team"},Ae={class:"match-schedule q-mt-sm"},Je={class:"schedule-inputs row q-gutter-sm"},Ke={key:3,class:"tournament-structure"},We={class:"q-mb-none"},Xe={class:"liga-matches"},Ye={class:"match-details"},Ze={class:"match-teams"},$e={class:"team-name"},ea={class:"team-name"},aa={class:"match-schedule q-mt-sm"},ta={class:"schedule-inputs row q-gutter-sm"},sa={key:4,class:"tournament-structure"},oa={class:"q-mb-none"},la={class:"retas-rounds"},na={class:"q-my-none"},da={class:"retas-matches"},ra={class:"match-details"},ca={class:"match-teams-retas"},ia={class:"team-players"},ma={class:"players"},ua={class:"team-players"},_a={class:"players"},pa={class:"match-schedule q-mt-sm"},ha={class:"schedule-inputs row q-gutter-sm"},va={class:"actions-section q-mt-xl"},ba={class:"row q-gutter-md justify-center"};function ya(N,c,T,t,U,x){return l(),f(R,{view:"hHh lpR fFf",class:"body text-white"},{default:n(()=>[a(O,{elevated:"",class:"bg-primary text-white"},{default:n(()=>[e("div",Y,[e("div",Z,[e("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:c[0]||(c[0]=(...d)=>t.goToDashboard&&t.goToDashboard(...d))}),c[1]||(c[1]=Q(" Cuadro Propuesto del Torneo "))]),e("div",$,[a(C,{flat:"",round:"",icon:"arrow_back",onClick:t.goBack},null,8,["onClick"])])])]),_:1}),a(L,null,{default:n(()=>[a(G,{class:"q-pa-md"},{default:n(()=>[t.loading?(l(),r("div",ee,[a(j,{color:"primary",size:"3em"}),c[2]||(c[2]=e("p",null,"Generando cuadro del torneo...",-1))])):t.error?(l(),r("div",ae,[a(q,{name:"warning",color:"negative",size:"3em"}),e("p",te,i(t.error),1),a(C,{label:"Volver",color:"primary",onClick:t.goBack},null,8,["onClick"])])):t.tournamentData?(l(),r("div",se,[a(_,{class:"q-mb-md tournament-info-card"},{default:n(()=>[a(u,null,{default:n(()=>{var d,s;return[e("div",oe,[e("div",le,[e("h4",ne,i(((d=t.tournamentData.tournament)==null?void 0:d.name)||"Torneo"),1),e("p",de," Sistema: "+i(t.getSystemName(t.tournamentData.system))+" | Total de Partidos: "+i(((s=t.tournamentData.matches)==null?void 0:s.length)||0),1)]),e("div",re,[a(P,{color:t.tournamentData.system==="eliminacion directa"?"red":t.tournamentData.system==="round-robin"?"blue":t.tournamentData.system==="combinado"?"purple":t.tournamentData.system==="retas"?"orange":"green","text-color":"white",label:t.getSystemName(t.tournamentData.system),icon:"emoji_events"},null,8,["color","label"])])])]}),_:1})]),_:1}),t.tournamentData.system==="round-robin"?(l(),r("div",ce,[t.tournamentData.structure.groups?(l(),r("div",ie,[(l(!0),r(p,null,h(t.tournamentData.structure.groups,d=>(l(),r("div",{key:d.name,class:"group-section q-mb-lg"},[a(_,{class:"group-card"},{default:n(()=>[a(u,{class:"bg-blue-8 text-white"},{default:n(()=>[e("h6",me,i(d.name),1),e("div",ue,[(l(!0),r(p,null,h(d.teams,s=>(l(),f(P,{key:s.id,color:"white","text-color":"blue-8",size:"sm",class:"q-ma-xs"},{default:n(()=>[Q(i(t.getTeamName(s)),1)]),_:2},1024))),128))])]),_:2},1024),a(u,{class:"matches-section"},{default:n(()=>[c[3]||(c[3]=e("h6",{class:"q-mt-none q-mb-md"},"Partidos del Grupo",-1)),t.tournamentData.structure.group_matches[d.name]?(l(),r("div",_e,[(l(!0),r(p,null,h(t.tournamentData.structure.group_matches[d.name],s=>(l(),f(_,{key:s.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",pe,[e("div",he,[e("span",ve,i(s.team1.name),1),a(q,{name:"sports",class:"vs-icon"}),e("span",be,i(s.team2.name),1)]),e("div",ye,[e("div",ge,[a(y,{modelValue:s.match_date,"onUpdate:modelValue":o=>s.match_date=o,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:s.match_time,"onUpdate:modelValue":o=>s.match_time=o,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:s.court_id,"onUpdate:modelValue":o=>s.court_id=o,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])):k("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):k("",!0)])):t.tournamentData.system==="eliminacion directa"?(l(),r("div",fe,[e("div",Ve,[(l(!0),r(p,null,h(t.tournamentData.structure.bracket,(d,s)=>(l(),r("div",{key:s,class:"bracket-round"},[a(_,{class:"round-card q-mb-lg"},{default:n(()=>[a(u,{class:"bg-red-8 text-white"},{default:n(()=>[e("h6",qe,i(s),1)]),_:2},1024),a(u,null,{default:n(()=>[e("div",ke,[(l(!0),r(p,null,h(d,o=>(l(),f(_,{key:o.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",we,[e("div",De,[e("span",{class:S(["team-name",{"tbd-team":!o.team1.player1}])},i(o.team1.name),3),a(q,{name:"sports",class:"vs-icon"}),e("span",{class:S(["team-name",{"tbd-team":!o.team2.player1}])},i(o.team2.name),3)]),e("div",Ue,[e("div",xe,[a(y,{modelValue:o.match_date,"onUpdate:modelValue":m=>o.match_date=m,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:o.match_time,"onUpdate:modelValue":m=>o.match_time=m,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:o.court_id,"onUpdate:modelValue":m=>o.court_id=m,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])])):t.tournamentData.system==="combinado"?(l(),r("div",Ce,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(u,{class:"bg-purple-8 text-white"},{default:n(()=>c[4]||(c[4]=[e("h5",{class:"q-my-none"},"Fase de Grupos",-1)])),_:1})]),_:1}),t.tournamentData.structure.groups?(l(),r("div",Te,[(l(!0),r(p,null,h(t.tournamentData.structure.groups,d=>(l(),r("div",{key:d.name,class:"group-section q-mb-lg"},[a(_,{class:"group-card"},{default:n(()=>[a(u,{class:"bg-blue-6 text-white"},{default:n(()=>[e("h6",Qe,i(d.name),1),e("div",Pe,[(l(!0),r(p,null,h(d.teams,s=>(l(),f(P,{key:s.id,color:"white","text-color":"blue-8",size:"sm",class:"q-ma-xs"},{default:n(()=>[Q(i(t.getTeamName(s)),1)]),_:2},1024))),128))])]),_:2},1024),a(u,{class:"matches-section"},{default:n(()=>[t.tournamentData.structure.group_matches[d.name]?(l(),r("div",Ne,[(l(!0),r(p,null,h(t.tournamentData.structure.group_matches[d.name],s=>(l(),f(_,{key:s.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",Fe,[e("div",Se,[e("span",Be,i(s.team1.name),1),a(q,{name:"sports",class:"vs-icon"}),e("span",He,i(s.team2.name),1)]),e("div",Ee,[e("div",ze,[a(y,{modelValue:s.match_date,"onUpdate:modelValue":o=>s.match_date=o,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:s.match_time,"onUpdate:modelValue":o=>s.match_time=o,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:s.court_id,"onUpdate:modelValue":o=>s.court_id=o,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])):k("",!0)]),_:2},1024)]),_:2},1024)]))),128))])):k("",!0),a(_,{class:"q-mb-lg"},{default:n(()=>[a(u,{class:"bg-purple-8 text-white"},{default:n(()=>c[5]||(c[5]=[e("h5",{class:"q-my-none"},"Fase de Playoffs",-1)])),_:1})]),_:1}),t.tournamentData.structure.playoffs?(l(),r("div",Ie,[(l(!0),r(p,null,h(t.tournamentData.structure.playoffs,(d,s)=>(l(),r("div",{key:s,class:"bracket-round"},[a(_,{class:"round-card q-mb-lg"},{default:n(()=>[a(u,{class:"bg-red-6 text-white"},{default:n(()=>[e("h6",Oe,i(s),1)]),_:2},1024),a(u,null,{default:n(()=>[e("div",je,[(l(!0),r(p,null,h(d,o=>(l(),f(_,{key:o.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",Ge,[e("div",Re,[e("span",Le,i(o.team1.name),1),a(q,{name:"sports",class:"vs-icon"}),e("span",Me,i(o.team2.name),1)]),e("div",Ae,[e("div",Je,[a(y,{modelValue:o.match_date,"onUpdate:modelValue":m=>o.match_date=m,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:o.match_time,"onUpdate:modelValue":m=>o.match_time=m,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:o.court_id,"onUpdate:modelValue":m=>o.court_id=m,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])):k("",!0)])):t.tournamentData.system==="liga"?(l(),r("div",Ke,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(u,{class:"bg-green-8 text-white"},{default:n(()=>[c[6]||(c[6]=e("h5",{class:"q-my-none"},"Liga - Todos contra Todos",-1)),e("p",We,i(t.tournamentData.structure.total_matches)+" partidos programados",1)]),_:1})]),_:1}),e("div",Xe,[(l(!0),r(p,null,h(t.tournamentData.matches,d=>(l(),f(_,{key:d.id,class:"match-card q-mb-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",Ye,[e("div",Ze,[e("span",$e,i(d.team1.name),1),a(q,{name:"sports",class:"vs-icon"}),e("span",ea,i(d.team2.name),1)]),e("div",aa,[e("div",ta,[a(y,{modelValue:d.match_date,"onUpdate:modelValue":s=>d.match_date=s,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:d.match_time,"onUpdate:modelValue":s=>d.match_time=s,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:d.court_id,"onUpdate:modelValue":s=>d.court_id=s,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])])):t.tournamentData.system==="retas"?(l(),r("div",sa,[a(_,{class:"q-mb-lg"},{default:n(()=>[a(u,{class:"bg-black text-white"},{default:n(()=>[c[7]||(c[7]=e("h5",{class:"q-my-none"},"Retas - Rotaci\xF3n de Parejas",-1)),e("p",oa,i(t.tournamentData.structure.num_rounds)+" rondas con "+i(t.tournamentData.structure.total_players)+" jugadores",1)]),_:1})]),_:1}),e("div",la,[(l(!0),r(p,null,h(t.tournamentData.structure.rounds,(d,s)=>(l(),r("div",{key:s,class:"round-section q-mb-lg"},[a(_,{flat:"",bordered:"",class:"round-card"},{default:n(()=>[a(u,{class:"bg-black text-white round-header"},{default:n(()=>[e("h6",na,i(s),1)]),_:2},1024),a(u,{class:"q-pa-none"},{default:n(()=>[e("div",da,[(l(!0),r(p,null,h(d,o=>(l(),f(_,{key:o.id,class:"match-card q-mb-sm q-ma-sm",flat:"",bordered:""},{default:n(()=>[a(u,{class:"q-pa-sm"},{default:n(()=>[e("div",ra,[e("div",ca,[e("div",ia,[c[8]||(c[8]=e("div",{class:"team-label"},"Pareja 1:",-1)),e("div",ma,[(l(!0),r(p,null,h(o.team1.players,m=>(l(),r("span",{key:m.id,class:"player-name"},i(m.name),1))),128))])]),a(q,{name:"sports",class:"vs-icon"}),e("div",ua,[c[9]||(c[9]=e("div",{class:"team-label"},"Pareja 2:",-1)),e("div",_a,[(l(!0),r(p,null,h(o.team2.players,m=>(l(),r("span",{key:m.id,class:"player-name"},i(m.name),1))),128))])])]),e("div",pa,[e("div",ha,[a(y,{modelValue:o.date,"onUpdate:modelValue":m=>o.date=m,type:"date",dense:"",outlined:"",label:"Fecha",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(y,{modelValue:o.time,"onUpdate:modelValue":m=>o.time=m,type:"time",dense:"",outlined:"",label:"Hora",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),a(w,{modelValue:o.court_id,"onUpdate:modelValue":m=>o.court_id=m,options:t.courtOptions,"option-value":"value","option-label":"label",dense:"",outlined:"",label:"Cancha",class:"col","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue","options"])])])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]))),128))])])):k("",!0),e("div",va,[e("div",ba,[a(C,{label:"Guardar Cuadro",color:"green",size:"lg",icon:"save",onClick:t.saveMatches,loading:t.saving,class:"save-btn"},null,8,["onClick","loading"]),a(C,{label:"Cancelar",color:"red",size:"lg",icon:"cancel",onClick:t.cancelPreview,outline:"",class:"cancel-btn"},null,8,["onClick"])]),c[10]||(c[10]=e("p",{class:"text-center q-mt-sm text-caption"}," Al guardar el cuadro, se cerrar\xE1n las inscripciones y se bloquear\xE1n las canchas para los horarios programados ",-1))])])):k("",!0)]),_:1})]),_:1})]),_:1})}var Ma=W(X,[["render",ya],["__scopeId","data-v-5913fe09"]]);export{Ma as default};
