import{Q as se}from"./QHeader.8ed599dc.js";import{x as le,r as p,w as re,h as ne,o as r,z as c,A as s,d as l,B as a,bN as J,ac as S,a9 as g,a as u,aa as ie,ab as de,a7 as ue,a8 as U,t as n,bE as C,e as ce,D as q,aT as M}from"./index.44d6004f.js";import{Q as P,a as $}from"./QItem.cafd0d6f.js";import{Q as j}from"./QSelect.22e7e4d3.js";import{Q as pe}from"./QList.8f6ea51c.js";import{Q as me}from"./QSpinnerDots.6f1bdbed.js";import{Q as _e}from"./QPage.069cc100.js";import{Q as ye,a as ve}from"./QLayout.bdadfe99.js";import{s as G}from"./supabase.3e81c9a1.js";import{f as fe}from"./commun.e04124f1.js";import{u as he}from"./useDashboardNavigation.f7fd3751.js";import{u as be}from"./summaryStore.1c9b9558.js";import{u as ge}from"./use-quasar.00fa2d0c.js";import{P as we}from"./PlayerNavigationMenu.2ea5455a.js";import{N as ke}from"./NotificationBell.03dce8ef.js";import{B as De}from"./BannerPromoScrolling.0ad337b6.js";import{D as xe}from"./DesktopNavigation.886a6566.js";import"./QChip.d99417f0.js";import"./QItemLabel.30a3dfed.js";import"./QMenu.aa52843c.js";import"./position-engine.d7eef48c.js";import"./selection.ab0d7921.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QTabs.02ad9b81.js";import"./QFooter.dec25843.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QBadge.182a08f3.js";import"./api.dcb17b1f.js";import"./QTooltip.c172b4a3.js";const Se={class:"header-content"},Ce={class:"greeting"},Ne={class:"header-icons"},Qe={class:"row q-col-gutter-md q-mb-lg"},Te={class:"col-12 col-sm-4"},Oe={class:"col-12 col-sm-4"},qe={class:"col-12 col-sm-4"},Me={class:"games-list"},Pe={class:"court-container"},$e={class:"court"},je={class:"player team1-player1"},Ie={key:0},Ve=["src"],Ee={key:1},Fe={class:"text-caption"},Le={class:"player team1-player2"},Be={key:0},He=["src"],ze={key:1},Ae={class:"text-caption"},Je={class:"player team2-player1"},Ue={key:0},Ge=["src"],Xe={key:1},Re={class:"text-caption"},We={class:"player team2-player2"},Ke={key:0},Ye=["src"],Ze={key:1},et={class:"text-caption"},tt={class:"club-info"},ot=["src"],at={class:"club-name"},st={class:"price-duration"},lt={class:"total-price"},rt={class:"duration"},nt={key:1,class:"text-center"},it={key:2,class:"text-center text-white"},Lt={__name:"ListOpenGames",setup(dt){const X=le(),{goToDashboard:I}=he(),R=be(),V=ge(),k=p([]),D=p([]),W=p(["Hoy","Ma\xF1ana","Esta Semana","Pr\xF3ximos 7 d\xEDas"]),K=p(["femenil","varonil","mixto"]),v=p(null),w=p(null),f=p(null),h=p([]),N=p(!1),E=o=>new Date(o).toLocaleDateString("es-MX",{day:"numeric",month:"long",year:"numeric"}),Y=(o,t)=>{const[e,i]=o.split(":").map(Number),[_,m]=t.split(":").map(Number);let y=_*60+m-(e*60+i);return y<0&&(y+=24*60),y},Z=async()=>{try{const o=await fe();k.value=o.map(t=>typeof t=="string"?t:t.value||t.label||t),D.value=k.value}catch{}},ee=(o,t)=>{if(o===""){t(()=>{D.value=k.value});return}t(()=>{const e=o.toLowerCase();D.value=k.value.filter(i=>i.toLowerCase().indexOf(e)>-1)})},F=async()=>{N.value=!0,h.value=[];try{let o=G.from("matches").select(`
                id, match_date, match_time, category, gender, is_open, team1_players, team2_players,
                club:clubs!inner ( id, name, city, logo_url ),
                reservation:reservations ( total_price, start_time, end_time )
            `).eq("is_open",!0);const t=w.value,e=new Date;e.setHours(0,0,0,0);const i=new Date(e);i.setDate(e.getDate()+1);const _=new Date(e);_.setDate(e.getDate()+2);const m=new Date(e);m.setDate(e.getDate()+(7-e.getDay())),m.setHours(23,59,59,999);const y=new Date(e);y.setDate(e.getDate()+7),y.setHours(23,59,59,999);const x=e.toISOString().split("T")[0],L=i.toISOString().split("T")[0],te=_.toISOString().split("T")[0],oe=m.toISOString().split("T")[0],ae=y.toISOString().split("T")[0];t==="Hoy"?o=o.gte("match_date",x).lt("match_date",L):t==="Ma\xF1ana"?o=o.gte("match_date",L).lt("match_date",te):t==="Esta Semana"?o=o.gte("match_date",x).lte("match_date",oe):t==="Pr\xF3ximos 7 d\xEDas"?o=o.gte("match_date",x).lte("match_date",ae):o=o.gte("match_date",x),v.value&&(o=o.eq("club.city",v.value)),f.value&&(o=o.eq("gender",f.value));const{data:T,error:B}=await o.order("match_date").order("match_time");if(B)throw B;if(!T){h.value=[];return}const H=T.flatMap(d=>[...d.team1_players||[],...d.team2_players||[]]).filter(d=>d!=null);let O={};if(H.length>0){const{data:d,error:b}=await G.from("players").select("user_id, first_name, photo_url, category").in("user_id",[...new Set(H)]);if(b)throw b;O=(d||[]).reduce((z,A)=>(z[A.user_id]=A,z),{})}h.value=T.map(d=>({...d,club:d.club||{name:"N/A",city:"N/A",id:null},reservation:d.reservation||{total_price:0,start_time:"00:00",end_time:"00:00"},team1_players:(d.team1_players||[null,null]).map(b=>O[b]||null),team2_players:(d.team2_players||[null,null]).map(b=>O[b]||null)}))}catch(o){console.error("Error fetching matches:",o),h.value=[],V.notify({type:"negative",message:"Error al buscar juegos."})}finally{N.value=!1}},Q=(o,t,e)=>{var m;if(console.log(`Intentando unirse a juego ${o.id}, equipo ${t}, slot ${e}`),!o||!o.reservation||o.reservation.total_price===void 0||o.reservation.total_price===null||!((m=o.club)!=null&&m.id)){console.error("Datos incompletos del juego para proceder al pago:",o),V.notify({type:"negative",message:"Informaci\xF3n del juego incompleta para unirse."});return}const i=(o.reservation.total_price||0)/4;i<=0&&console.warn("El precio por jugador es cero o inv\xE1lido.");const _={summaryTitle:"Confirmar Uni\xF3n a Juego",itemDetails:[{label:"Club",value:o.club.name||"No especificado"},{label:"Fecha",value:E(o.match_date)},{label:"Hora",value:`${new Date(o.match_date+"T"+o.match_time).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})} hrs.`},{label:"Categor\xEDa",value:o.category||"N/A"},{label:"Precio (Tu parte)",value:`$${i.toFixed(2)}`}],baseData:{clubId:o.club.id,price:i,participants:1,type:"open_match_join",id:o.id},allowPaymentSplit:!1,showPublicToggle:!1,commissionRate:4,extraData:{matchId:o.id,teamToJoin:t,slotIndex:e,matchCategory:o.category,matchGender:o.gender,matchDate:o.match_date,matchTime:o.match_time,clubName:o.club.name}};R.setSummaryDetails(_),console.log("Datos para unirse a juego guardados en Pinia:",_),X.push({name:"OrderSummary"})};return re([v,w,f],F,{deep:!0}),ne(()=>{Z(),F()}),(o,t)=>(r(),c(ye,{view:"hHh lpR fFf",class:"text-white"},{default:s(()=>[l(se,{elevated:"",class:"text-white"},{default:s(()=>[a("div",Se,[a("div",Ce,[a("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...e)=>J(I)&&J(I)(...e))})]),a("div",Ne,[l(ke)])]),l(De)]),_:1}),l(ve,{class:"home"},{default:s(()=>[l(_e,{class:"q-pa-md"},{default:s(()=>[a("div",Qe,[a("div",Te,[l(j,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e),options:D.value,label:"Ciudad",outlined:"",dense:"","options-dense":"",clearable:"","hide-selected":"","input-debounce":"300",onFilter:ee,onClear:t[2]||(t[2]=e=>v.value=null),dark:"",color:"white","label-color":"white","popup-content-class":"text-white"},{prepend:s(()=>[l(S,{name:"location_on",color:"white"})]),"no-option":s(()=>[l(P,null,{default:s(()=>[l($,{class:"text-white"},{default:s(()=>[...t[7]||(t[7]=[g("No hay ciudades",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),a("div",Oe,[l(j,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e),options:W.value,label:"Fecha",outlined:"",dense:"","options-dense":"",clearable:"",dark:"",color:"white","label-color":"white","popup-content-class":"text-white",onClear:t[4]||(t[4]=e=>w.value=null)},{prepend:s(()=>[l(S,{name:"calendar_month",color:"white"})]),"no-option":s(()=>[l(P,null,{default:s(()=>[l($,{class:"text-white"},{default:s(()=>[...t[8]||(t[8]=[g("No hay opciones",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),a("div",qe,[l(j,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=e=>f.value=e),options:K.value,label:"G\xE9nero",outlined:"",dense:"","options-dense":"",clearable:"",dark:"",color:"white","label-color":"white","popup-content-class":"text-white",onClear:t[6]||(t[6]=e=>f.value=null)},{prepend:s(()=>[l(S,{name:"wc",color:"white"})]),"no-option":s(()=>[l(P,null,{default:s(()=>[l($,{class:"text-grey-8"},{default:s(()=>[...t[9]||(t[9]=[g("No hay opciones",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options"])])]),a("div",Me,[h.value.length>0?(r(),c(pe,{key:0,class:"q-mt-md"},{default:s(()=>[(r(!0),u(de,null,ie(h.value,e=>(r(),c(ue,{key:e.id,clickable:"",class:"match-card"},{default:s(()=>[l(U,{class:"q-mt-md"},{default:s(()=>[a("strong",null,n(E(e.match_date))+" | "+n(new Date(e.match_date+"T"+e.match_time).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})),1),t[14]||(t[14]=a("br",null,null,-1)),t[15]||(t[15]=g(" Categor\xEDa",-1)),l(S,{name:"o_sports_tennis"}),g(" "+n(e.category)+" ",1),a("div",Pe,[a("div",$e,[a("div",je,[e.team1_players[0]?(r(),u("div",Ie,[e.team1_players[0].photo_url?(r(),c(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team1_players[0].photo_url,alt:"Foto del jugador"},null,8,Ve)]),_:2},1024)):(r(),u("span",Ee,n(e.team1_players[0].first_name||"Jugador 1 Equipo 1"),1)),a("div",Fe,n(e.team1_players[0].category),1)])):ce("",!0)]),a("div",Le,[e.team1_players[1]?(r(),u("div",Be,[e.team1_players[1].photo_url?(r(),c(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team1_players[1].photo_url,alt:"Foto del jugador"},null,8,He)]),_:2},1024)):(r(),u("span",ze,n(e.team1_players[1].first_name||"Jugador 1 Equipo 1"),1)),a("div",Ae,n(e.team1_players[1].category),1)])):(r(),c(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>Q(e,1,1),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),a("div",Je,[e.team2_players[0]?(r(),u("div",Ue,[e.team2_players[0].photo_url?(r(),c(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team2_players[0].photo_url,alt:"Foto del jugador"},null,8,Ge)]),_:2},1024)):(r(),u("span",Xe,n(e.team2_players[0].first_name||"Jugador 1 Equipo 2"),1)),a("div",Re,n(e.team2_players[0].category),1)])):(r(),c(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>Q(e,2,0),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),a("div",We,[e.team2_players[1]?(r(),u("div",Ke,[e.team2_players[1].photo_url?(r(),c(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team2_players[1].photo_url,alt:"Foto del jugador"},null,8,Ye)]),_:2},1024)):(r(),u("span",Ze,n(e.team2_players[1].first_name||"Jugador 2 Equipo 2"),1)),a("div",et,n(e.team2_players[1].category),1)])):(r(),c(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>Q(e,2,1),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),t[10]||(t[10]=a("div",{class:"line1"},null,-1)),t[11]||(t[11]=a("div",{class:"net"},null,-1)),t[12]||(t[12]=a("div",{class:"line2"},null,-1)),t[13]||(t[13]=a("div",{class:"horizontal-line"},null,-1))])])]),_:2},1024),l(U,{class:"club-info-section"},{default:s(()=>[a("div",tt,[a("img",{src:e.club.logo_url||"/logo.jpeg",alt:"Club Logo",class:"club-logo"},null,8,ot),a("span",at,n(e.club.name),1)]),t[17]||(t[17]=a("div",{class:"vertical-divider"},null,-1)),a("div",st,[a("span",lt,"$"+n(e.reservation.total_price/4)+" MXN",1),t[16]||(t[16]=a("br",null,null,-1)),a("span",rt,n(Y(e.reservation.start_time,e.reservation.end_time))+" minutos",1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})):N.value?(r(),u("div",nt,[t[18]||(t[18]=g("Buscando...",-1)),t[19]||(t[19]=a("br",null,null,-1)),l(me,{color:"black",size:"xl"})])):(r(),u("div",it,[...t[20]||(t[20]=[a("p",null,"No se encontraron juegos.",-1)])]))])]),_:1})]),_:1}),l(we),l(xe)]),_:1}))}};export{Lt as default};
