import{Q as E}from"./QHeader.289f0645.js";import{Q as A}from"./QSpinnerCube.58ab00ba.js";import{a5 as R,x as $,y as z,r as b,h as F,f as T,o as r,z as x,A as c,d as l,B as s,bN as h,a7 as V,a8 as H,a as n,t as i,aK as U,ac as u,a9 as o,e as d,ab as j,aa as M,D as C,bE as Y}from"./index.687b44e8.js";import{Q as K}from"./QPage.fcc9aae1.js";import{Q as O,a as G}from"./QLayout.30990248.js";import{u as J}from"./use-quasar.ba375293.js";import{u as W}from"./summaryStore.ade2e05f.js";import{u as X}from"./useDashboardNavigation.a26a0a3f.js";import{g as Z,a as ee}from"./lessons.8de2e3a3.js";import{N as ae}from"./NotificationBell.9fdba392.js";import{B as se}from"./BannerPromoScrolling.1700e538.js";import{P as le}from"./PlayerNavigationMenu.1a7d2e68.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import"./supabase.66aa98e2.js";import"./QBadge.0c3a126f.js";import"./api.1c42dce4.js";import"./QTabs.979bee57.js";import"./rtl.276c3f1b.js";import"./QFooter.b7b22f15.js";const oe={class:"header-content"},re={class:"greeting"},ne={class:"header-icons"},ie={key:0,class:"q-pa-xl text-center"},ue={key:1,class:"q-pa-md q-gutter-sm"},ce={key:0},de={key:1,class:"q-mt-md"},me={class:"q-gutter-xs row items-center"},pe=["src","alt"],ve={key:1},ge={key:2},fe={class:"q-mt-lg text-center"},ye={key:1,class:"text-negative text-caption q-mt-xs"},_e={key:2,class:"text-positive text-caption q-mt-xs"},be={key:2,class:"q-pa-md text-center text-negative"},xe={__name:"LessonDetails",setup(he){const y=R(),I=$(),{goToDashboard:N}=X(),P=W(),p=J(),_=z(),k=y.params.lessonId,Q=y.query.clubId,S=y.query.clubName||"Club no especificado",a=b(null),v=b(!0),g=b([]),w=async()=>{if(v.value=!0,a.value=null,g.value=[],!k){console.error("ID de la lecci\xF3n no encontrado en los par\xE1metros de la ruta."),p.notify({type:"negative",message:"No se pudo identificar la clase."}),v.value=!1;return}try{const t=await Z(k);if(a.value=t[0],!a.value||typeof a.value!="object")throw new Error("Respuesta inv\xE1lida del API al cargar detalles de clase.");if(a.value.players&&a.value.players.length>0)try{const e=await ee(a.value.players);g.value=e}catch(e){console.error("Error al cargar datos de los jugadores:",e)}}catch(t){console.error("Error al cargar detalles de la lecci\xF3n:",t),a.value=null,p.notify({type:"negative",message:"Error al cargar la informaci\xF3n de la clase."})}finally{v.value=!1}},L=()=>{if(!a.value){console.error("Detalles de la lecci\xF3n no est\xE1n cargados para ir al resumen."),p.notify({type:"negative",message:"No se pueden obtener los detalles de la clase."});return}if(a.value.available_slots<=0){p.notify({type:"warning",message:"Ya no hay cupos disponibles para esta clase."});return}const t=a.value,e={summaryTitle:"Resumen de Inscripci\xF3n",itemDetails:[{label:"Club",value:S},{label:"Clase",value:t.name||"No especificado"},{label:"Fecha",value:t.lesson_date||"No especificada"},{label:"Hora",value:`${t.lesson_time||"--:--"} hrs.`},{label:"Duraci\xF3n",value:`${t.duration||60} minutos`}],baseData:{clubId:Q,price:t.price||0,participants:1,type:"public_lesson",id:t.id},allowPaymentSplit:!1,showPublicToggle:!1,commissionRate:4,extraData:{coachName:t.coach_name,lessonDescription:t.description}};P.setSummaryDetails(e),console.log("Datos del resumen de CLASE P\xDABLICA guardados en Pinia:",e),I.push({name:"OrderSummary"})};F(()=>{w()});const q=T(()=>!a.value||!a.value.players||!_.userId?!1:a.value.players.includes(_.userId)),B=t=>{if(!t)return"??";const e=t.split("-");return e.length>0?e[0].substring(0,2).toUpperCase():userId.substring(0,2).toUpperCase()};return(t,e)=>(r(),x(O,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:c(()=>[l(E,{elevated:"",class:"text-white"},{default:c(()=>[s("div",oe,[s("div",re,[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...f)=>h(N)&&h(N)(...f))})]),s("div",ne,[l(ae)])]),l(se)]),_:1}),l(G,{class:"home"},{default:c(()=>[l(K,{class:"q-pa-md"},{default:c(()=>[l(V,null,{default:c(()=>[l(H,null,{default:c(()=>{var f,D;return[v.value?(r(),n("div",ie,[l(A,{color:"primary",size:"xl"}),e[2]||(e[2]=s("p",{class:"q-mt-md"},"Cargando detalles de la clase...",-1))])):a.value?(r(),n("div",ue,[s("h3",null,i(a.value.name||"Clase sin Nombre"),1),l(U,{dark:"",spaced:"md"}),a.value.description?(r(),n("p",ce,[s("strong",null,[l(u,{name:"mdi-information-outline",class:"q-mr-xs"}),e[3]||(e[3]=o("Descripci\xF3n:",-1))]),o(" "+i(a.value.description),1)])):d("",!0),s("p",null,[s("strong",null,[l(u,{name:"mdi-calendar",class:"q-mr-xs"}),e[4]||(e[4]=o("Fecha:",-1))]),o(" "+i(a.value.lesson_date||"No especificada"),1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-clock-outline",class:"q-mr-xs"}),e[5]||(e[5]=o("Hora:",-1))]),o(" "+i(a.value.lesson_time||"No especificada")+" hrs. ",1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-timer-sand",class:"q-mr-xs"}),e[6]||(e[6]=o("Duraci\xF3n:",-1))]),o(" "+i(a.value.duration||"60")+" minutos ",1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-account-supervisor-circle-outline",class:"q-mr-xs"}),e[7]||(e[7]=o("Coach:",-1))]),o(" "+i(a.value.coaches.name||"No asignado"),1)]),s("p",null,[s("strong",null,[l(u,{name:"mdi-cash",class:"q-mr-xs"}),e[8]||(e[8]=o("Precio Inscripci\xF3n:",-1))]),o(" $"+i(((f=a.value.price)==null?void 0:f.toFixed(2))||"N/A"),1)]),g.value.length>0?(r(),n("div",de,[s("p",null,[s("strong",null,[l(u,{name:"mdi-account-check",class:"q-mr-xs"}),e[9]||(e[9]=o("Participantes:",-1))])]),s("div",me,[(r(!0),n(j,null,M(g.value,m=>(r(),x(Y,{key:m.user_id,size:"48px",color:"white","text-color":"black",class:"overlapping"},{default:c(()=>[m.photo_url?(r(),n("img",{key:0,src:m.photo_url,alt:m.user_id},null,8,pe)):(r(),n("span",ve,i(B(h(_).fullName)),1))]),_:2},1024))),128))])])):d("",!0),a.value.max_participants!=null?(r(),n("p",ge,[s("strong",null,[l(u,{name:"mdi-account-group-outline",class:"q-mr-xs"}),e[10]||(e[10]=o("Cupo:",-1))]),o(" "+i((D=a.value.available_slots)!=null?D:"N/A")+" / "+i(a.value.max_participants)+" disponibles ",1)])):d("",!0),s("div",fe,[q.value?d("",!0):(r(),x(C,{key:0,color:"green",label:"Inscribirme","icon-right":"mdi-pencil-plus-outline",onClick:L,class:"full-width",size:"lg",push:"",disable:!a.value||a.value.available_slots<=0,title:!a.value||a.value.available_slots<=0?"No hay cupos disponibles o la clase no se carg\xF3":"Inscribirse a esta clase"},null,8,["disable","title"])),!a.value||a.value.available_slots<=0?(r(),n("div",ye,i(a.value?"No hay cupos disponibles":"Error al cargar la clase"),1)):d("",!0),q.value?(r(),n("div",_e," Ya est\xE1s inscrito en esta clase. ")):d("",!0)])])):(r(),n("div",be,[l(u,{name:"mdi-alert-circle-outline",size:"lg"}),e[11]||(e[11]=s("p",{class:"q-mt-md"},"No se pudieron cargar los detalles de la clase.",-1)),l(C,{flat:"",label:"Volver",onClick:e[1]||(e[1]=m=>t.$router.go(-1))})]))]}),_:1})]),_:1})]),_:1}),l(le)]),_:1})]),_:1}))}};var Ve=te(xe,[["__scopeId","data-v-7e48244e"]]);export{Ve as default};
