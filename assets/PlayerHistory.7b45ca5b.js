import{Q as W}from"./QHeader.1d41df4b.js";import{F as Y,r as g,B as Z,q as i,G as Q,H as r,v as t,I as o,J as k,s as n,a9 as N,aa as $,ae as f,ad as S,ac as B,y as D,bC as I,ab as _,x as c}from"./index.44ff7f36.js";import{Q as ee}from"./QSpinnerDots.52063b1d.js";import{Q as E,a as y}from"./QItem.ca93871c.js";import{Q as v}from"./QItemLabel.07b36e9b.js";import{Q as T}from"./QChip.aa5330d4.js";import{Q as z}from"./QList.843a2d7e.js";import{Q as te}from"./QPage.01f0db4e.js";import{Q as ae,a as se}from"./QLayout.36e57c24.js";import{u as re}from"./userStore.c05073cd.js";import{s as C}from"./supabase.62935925.js";import{c as oe}from"./dateUtils.e60c23a4.js";import{P as ie}from"./PlayerNavigationMenu.073d5db4.js";import{P as ne}from"./PlayerTopMenu.0772c7da.js";import{N as le}from"./NotificationBell.d889e136.js";import{B as ce}from"./BannerPromoScrolling.38e1cc22.js";import{_ as de}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.75ba5c8c.js";import"./QTabs.b7b4d746.js";import"./rtl.276c3f1b.js";import"./QFooter.f84d141a.js";import"./QBtnDropdown.7d36efe6.js";import"./QMenu.75efc905.js";import"./position-engine.6138d72b.js";import"./selection.fc24a828.js";import"./QBadge.dc626f3f.js";import"./api.2af71db3.js";import"./admin.c99b9bfe.js";const ue={class:"header-content"},me={class:"header-icons"},pe={class:"player-container"},_e={class:"row items-center q-mb-md history-header"},ye={key:0,class:"text-center q-pa-xl"},ve={key:1,class:"history-content"},fe={class:"history-tabs q-mb-md"},ge={class:"history-layout"},he={key:0,class:"history-section"},xe={key:0,class:"empty-state"},be={key:1,class:"payment-list"},we={class:"text-right"},Qe={class:"text-weight-bold amount"},ke={key:1,class:"history-section"},Ce={key:0,class:"empty-state"},Pe={key:1,class:"games-list"},qe={class:"text-right"},He={class:"q-mt-xs text-caption text-grey"},Ne={__name:"PlayerHistory",setup($e){const P=Y(),m=re().userId,h=g(!0),l=g("payments"),x=g([]),b=g([]),L=async()=>{try{const{data:e,error:a}=await C.from("payment_orders").select("*").eq("user_id",m).order("order_date",{ascending:!1});if(a){console.error("Error loading payment history:",a);return}x.value=e||[]}catch(e){console.error("Error loading payment history:",e)}},j=async()=>{try{const{data:e,error:a}=await C.from("reservations").select(`
        *,
        courts(id, name, club_id, clubs(name)),
        matches(id, event_type, gender, category, status, player1_id, player2_id, player3_id, player4_id)
      `).eq("player_id",m).order("reservation_date",{ascending:!1}).limit(50);if(a){console.error("Error loading games history:",a);return}const{data:s,error:p}=await C.from("matches").select(`
        id, event_type, gender, category, status, player1_id, player2_id, player3_id, player4_id,
        reservations(id, reservation_date, start_time, end_time, courts(id, name, clubs(name)))
      `).or(`player1_id.eq.${m},player2_id.eq.${m},player3_id.eq.${m},player4_id.eq.${m}`).order("created_at",{ascending:!1}).limit(50);p&&console.error("Error loading match reservations:",p);const d=[...e||[]];s&&s.forEach(u=>{u.reservations&&!d.some(w=>w.id===u.reservations.id)&&d.push({id:u.reservations.id,...u.reservations,matches:u})}),d.sort((u,w)=>new Date(w.reservation_date)-new Date(u.reservation_date)),b.value=d}catch(e){console.error("Error loading games history:",e)}},q=e=>{switch(e){case"succeeded":case"approved":return"positive";case"pending":return"warning";case"failed":case"rejected":return"negative";default:return"grey"}},F=e=>{switch(e){case"succeeded":case"approved":return"Exitoso";case"pending":return"Pendiente";case"failed":case"rejected":return"Fallido";default:return e}},G=e=>{switch(e){case"court":case"reservation":return"sports_tennis";case"tournament":return"emoji_events";case"lesson":return"school";case"open_match_join":return"group_add";default:return"payment"}},R=e=>{switch(e.event_type){case"court":case"reservation":return"Reserva de cancha";case"tournament":return"Inscripci\xF3n a torneo";case"lesson":return"Clase de p\xE1del";case"open_match_join":return"Uni\xF3n a partido abierto";default:return e.event_type||"Pago"}},M=e=>{switch(e){case"completed":return"positive";case"active":case"confirmed":return"primary";case"cancelled":return"negative";default:return"grey"}},V=e=>{switch(e){case"completed":return"Completado";case"active":case"confirmed":return"Confirmado";case"cancelled":return"Cancelado";default:return e||"Programado"}},J=e=>{if(e.matches){const a=e.matches;let s=a.event_type||"Partido";return a.gender&&(s+=` ${a.gender}`),a.category&&(s+=` - ${a.category}`),s}return"Reserva de cancha"},A=e=>{var a,s;if(e.courts){const p=e.courts.name||"Cancha sin nombre",d=((a=e.courts.clubs)==null?void 0:a.name)||((s=e.courts.club)==null?void 0:s.name);return d?`${p} - ${d}`:p}return"Cancha sin nombre"},H=e=>e?oe(e):"",U=e=>e?e.substring(0,5):"",X=e=>e?Number(e).toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",K=()=>{P.go(-1)},O=e=>{var a;(a=e.matches)!=null&&a.id?P.push(`/player/match/${e.matches.id}`):e.id&&console.log("Reservation details:",e)};return Z(async()=>{h.value=!0,await Promise.all([L(),j()]),h.value=!1}),(e,a)=>(i(),Q(ae,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:r(()=>[t(W,{elevated:"",class:"text-white"},{default:r(()=>[o("div",ue,[a[2]||(a[2]=o("div",{class:"greeting"},[o("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})],-1)),o("div",me,[t(le),t(ne)])]),t(ce)]),_:1}),t(se,null,{default:r(()=>[t(te,{class:"q-pa-md"},{default:r(()=>[o("div",pe,[o("div",_e,[t(k,{flat:"",round:"",dense:"",icon:"arrow_back",class:"text-white",onClick:K}),a[3]||(a[3]=o("h5",{class:"text-white q-ma-none q-ml-md"},"Historial",-1))]),h.value?(i(),n("div",ye,[t(ee,{size:"50px",color:"white"}),a[4]||(a[4]=o("div",{class:"q-mt-md text-white"},"Cargando historial...",-1))])):(i(),n("div",ve,[o("div",fe,[t(k,{color:l.value==="payments"?"primary":"grey",outline:l.value!=="payments",label:"Pagos",onClick:a[0]||(a[0]=s=>l.value="payments"),class:"tab-btn"},null,8,["color","outline"]),t(k,{color:l.value==="games"?"primary":"grey",outline:l.value!=="games",label:"Juegos",onClick:a[1]||(a[1]=s=>l.value="games"),class:"tab-btn"},null,8,["color","outline"])]),o("div",ge,[l.value==="payments"?(i(),n("div",he,[t(N,{flat:"",bordered:"",class:"text-white history-card"},{default:r(()=>[t($,null,{default:r(()=>[a[6]||(a[6]=o("div",{class:"section-header"},[o("div",{class:"text-h6"},"\u{1F4CB} Historial de Pagos")],-1)),x.value.length===0?(i(),n("div",xe,[t(f,{name:"payment",size:"50px",color:"grey"}),a[5]||(a[5]=o("div",{class:"q-mt-md text-grey"},"No tienes pagos registrados",-1))])):(i(),n("div",be,[t(z,{separator:"",class:"text-white"},{default:r(()=>[(i(!0),n(S,null,B(x.value,s=>(i(),Q(E,{key:s.id,class:"payment-item"},{default:r(()=>[t(y,{avatar:""},{default:r(()=>[t(I,{color:q(s.payment_status),"text-color":"white",size:"40px"},{default:r(()=>[t(f,{name:G(s.event_type)},null,8,["name"])]),_:2},1032,["color"])]),_:2},1024),t(y,{class:"payment-details"},{default:r(()=>[t(v,{class:"text-weight-bold payment-title"},{default:r(()=>[_(c(R(s)),1)]),_:2},1024),t(v,{caption:"",class:"text-grey payment-date"},{default:r(()=>[_(c(H(s.order_date)),1)]),_:2},1024),t(v,{caption:"",class:"text-grey payment-method"},{default:r(()=>[_(c(s.payment_method),1)]),_:2},1024)]),_:2},1024),t(y,{side:"",class:"payment-amount"},{default:r(()=>[o("div",we,[o("div",Qe," $"+c(X(s.total_amount)),1),t(T,{color:q(s.payment_status),"text-color":"white",size:"sm",label:F(s.payment_status)},null,8,["color","label"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1})])):D("",!0),l.value==="games"?(i(),n("div",ke,[t(N,{flat:"",bordered:"",class:"text-white history-card"},{default:r(()=>[t($,null,{default:r(()=>[a[8]||(a[8]=o("div",{class:"section-header"},[o("div",{class:"text-h6"},"\u{1F3D3} Historial de Juegos")],-1)),b.value.length===0?(i(),n("div",Ce,[t(f,{name:"sports_tennis",size:"50px",color:"grey"}),a[7]||(a[7]=o("div",{class:"q-mt-md text-grey"},"No tienes juegos registrados",-1))])):(i(),n("div",Pe,[t(z,{separator:"",class:"text-white"},{default:r(()=>[(i(!0),n(S,null,B(b.value,s=>(i(),Q(E,{key:s.id,class:"game-item",clickable:"",onClick:p=>O(s)},{default:r(()=>[t(y,{avatar:""},{default:r(()=>[t(I,{color:"primary","text-color":"white",size:"40px"},{default:r(()=>[t(f,{name:"sports_tennis"})]),_:1})]),_:1}),t(y,{class:"game-details"},{default:r(()=>[t(v,{class:"text-weight-bold game-title"},{default:r(()=>[_(c(A(s)),1)]),_:2},1024),t(v,{caption:"",class:"text-grey game-date"},{default:r(()=>[_(c(H(s.reservation_date))+" - "+c(U(s.start_time)),1)]),_:2},1024),t(v,{caption:"",class:"text-grey game-type"},{default:r(()=>[_(c(J(s)),1)]),_:2},1024)]),_:2},1024),t(y,{side:"",class:"game-status"},{default:r(()=>[o("div",qe,[t(T,{color:M(s.status),"text-color":"white",size:"sm",label:V(s.status)},null,8,["color","label"]),o("div",He,[t(f,{name:"chevron_right"})])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]))]),_:1})]),_:1})])):D("",!0)])]))])]),_:1})]),_:1}),t(ie)]),_:1}))}};var it=de(Ne,[["__scopeId","data-v-27d38a8c"]]);export{it as default};
