import{r as d,F as S,q as m,G as T,H as b,v as s,I as g,J as t,s as k,y as f,K as C,x as P}from"./index.b86c8e6e.js";import{Q as A}from"./QForm.dedc54a1.js";import{Q as x}from"./QPage.b77a8772.js";import{Q as R,a as U}from"./QLayout.af46a9b3.js";import{a as Q}from"./api.e96a150b.js";import{u as V}from"./userStore.80f0bb99.js";import{o as I}from"./auth.50e96c74.js";import{u as F}from"./useMeta.e956e4ee.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.c98ef0da.js";import"./pinia.65a0a7d6.js";import"./supabase.4d10d376.js";import"./googleAuth.bf078361.js";const W={name:"LoginPage",setup(){F({title:"Iniciar Sesi\xF3n"});const y=d(""),a=d(""),r=d(null),o=d(!1),h=d(!1),_=d(!1),e=S(),v=V();return{email:y,password:a,error:r,googleLoading:o,appleLoading:h,showTraditionalLogin:_,login:async()=>{var l,i;r.value=null;try{const n=await Q.post("/auth/login",{email:y.value,password:a.value}),{access_token:u}=n.data;localStorage.setItem("token",u);const L=u.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),p=JSON.parse(atob(L));v.setUserDataFromToken(u),console.log("User type from token:",p.user_type);const w=localStorage.getItem("redirectAfterLogin");if(w){localStorage.removeItem("redirectAfterLogin"),e.push(w);return}p.user_type==="superuser"?(console.log("Redirecting to superuser dashboard"),e.push("/dashboard/superuser")):p.user_type==="admin"?(console.log("Redirecting to admin dashboard"),e.push("/dashboard/admin")):p.user_type==="club"?(console.log("Redirecting to club dashboard"),e.push("/dashboard/club")):p.user_type==="association"?(console.log("Redirecting to association dashboard"),e.push("/association/dashboard")):(console.log("Redirecting to player dashboard"),e.push("/dashboard/player"))}catch(n){n.response&&n.response.data&&n.response.data.detail?r.value=n.response.data.detail:r.value="Ocurri\xF3 un error inesperado. Intenta de nuevo m\xE1s tarde.",console.error("Error al iniciar sesi\xF3n:",((i=(l=n.response)==null?void 0:l.data)==null?void 0:i.detail)||n.message)}},signInWithGoogle:async()=>{o.value=!0,r.value=null;try{const l=await I.signInWithGoogle();if(l&&l.access_token){const{access_token:i}=l;localStorage.setItem("token",i);const u=i.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),c=JSON.parse(atob(u));v.setUserDataFromToken(i),console.log("User type from token:",c.user_type),c.user_type==="superuser"?(console.log("Redirecting to superuser dashboard"),e.push("/dashboard/superuser")):c.user_type==="admin"?(console.log("Redirecting to admin dashboard"),e.push("/dashboard/admin")):c.user_type==="club"?(console.log("Redirecting to club dashboard"),e.push("/dashboard/club")):c.user_type==="association"?(console.log("Redirecting to association dashboard"),e.push("/association/dashboard")):(console.log("Redirecting to player dashboard"),e.push("/dashboard/player"))}}catch(l){r.value="Error al iniciar sesi\xF3n con Google",console.error("Google OAuth error:",l)}finally{o.value=!1}},signInWithApple:async()=>{h.value=!0,r.value=null;try{await I.signInWithApple()}catch(l){r.value="Apple OAuth no est\xE1 disponible a\xFAn. Pronto estar\xE1 habilitado.",console.error("Apple OAuth error:",l)}finally{h.value=!1}},goToSignup:()=>{e.push("/signup")},goToForgotPassword:()=>{e.push("/forgot-password")},goToTerms:()=>{e.push("/terms")},goToPrivacy:()=>{e.push("/privacy")}}}},O={class:"login-container"},B={class:"oauth-buttons"},N={key:0,class:"traditional-login-toggle"},q={key:1,class:"divider"},D={key:0,class:"error-message"},E={class:"login-links"},J={class:"legal-links"};function H(y,a,r,o,h,_){return m(),T(R,{view:"lHh Lpr lFf"},{default:b(()=>[s(U,null,{default:b(()=>[s(x,{class:"login-page"},{default:b(()=>[g("div",O,[a[4]||(a[4]=g("img",{src:"/logo.jpeg",alt:"Logo",class:"login-logo"},null,-1)),g("div",B,[s(t,{onClick:o.signInWithGoogle,loading:o.googleLoading,class:"google-btn",icon:"img:/google-icon.svg",label:"Continuar con Google",color:"white","text-color":"black","no-caps":"",style:{"margin-bottom":"12px"}},null,8,["onClick","loading"]),s(t,{onClick:o.signInWithApple,loading:o.appleLoading,class:"apple-btn",icon:"img:/apple-icon.svg",label:"Continuar con Apple",color:"dark","text-color":"white","no-caps":"",style:{"margin-bottom":"20px"}},null,8,["onClick","loading"])]),o.showTraditionalLogin?f("",!0):(m(),k("div",N,[s(t,{flat:"",label:"Ingresar con email y contrase\xF1a",color:"white",class:"toggle-link",onClick:a[0]||(a[0]=e=>o.showTraditionalLogin=!0),"no-caps":""})])),o.showTraditionalLogin?(m(),k("div",q,a[3]||(a[3]=[g("span",{class:"divider-text"},"o",-1)]))):f("",!0),o.showTraditionalLogin?(m(),T(A,{key:2,onSubmit:o.login,class:"login-form"},{default:b(()=>[s(C,{outlined:"",dark:"",modelValue:o.email,"onUpdate:modelValue":a[1]||(a[1]=e=>o.email=e),label:"Correo electr\xF3nico",type:"email",class:"q-mb-md input-dark"},null,8,["modelValue"]),s(C,{outlined:"",dark:"",modelValue:o.password,"onUpdate:modelValue":a[2]||(a[2]=e=>o.password=e),label:"Contrase\xF1a",type:"password",class:"q-mb-md input-dark"},null,8,["modelValue"]),s(t,{label:"Iniciar sesi\xF3n",color:"white","text-color":"black",type:"submit",class:"login-btn"}),o.error?(m(),k("div",D,P(o.error),1)):f("",!0)]),_:1},8,["onSubmit"])):f("",!0),g("div",E,[s(t,{flat:"",label:"Crear una cuenta",color:"white",class:"login-link",onClick:o.goToSignup},null,8,["onClick"]),s(t,{flat:"",label:"Olvid\xE9 mi contrase\xF1a",color:"white",class:"login-link",onClick:o.goToForgotPassword},null,8,["onClick"]),g("div",J,[s(t,{flat:"",label:"T\xE9rminos y Condiciones",color:"white",class:"legal-link",onClick:o.goToTerms},null,8,["onClick"]),s(t,{flat:"",label:"Aviso de Privacidad",color:"white",class:"legal-link",onClick:o.goToPrivacy},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})}var po=G(W,[["render",H],["__scopeId","data-v-7d5c984a"]]);export{po as default};
