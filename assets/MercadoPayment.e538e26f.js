import{Q as Se}from"./QHeader.54948f97.js";import{r as i,f as _e,h as Pe,w as ze,o as v,z as w,A as s,d as r,B as o,a8 as k,Q as ye,e as R,a as te,aa as Ce,ab as Ie,aK as Ee,D as Q,ac as O,t as z,E as ge,aR as Ve,a9 as Ae,aS as De,aT as be,a7 as B,aP as Te,x as Re,a5 as Qe,a6 as xe,af as we,ad as ke}from"./index.284c5517.js";import{Q as Ne}from"./QBanner.8d204a25.js";import{Q as Oe}from"./QPage.dfd00166.js";import{Q as je,a as $e}from"./QLayout.c9dda368.js";import{u as qe}from"./use-quasar.58056b10.js";import{Q as Be}from"./QForm.c0077694.js";import{_ as Ue}from"./MP_RGB_horizontal.ee11db59.js";import{a as _}from"./api.9de4aea7.js";import{i as Fe,o as Le}from"./capacitorPaymentUtils.73f5d06c.js";import{_ as Me}from"./plugin-vue_export-helper.21dcd24c.js";import{P as Ke}from"./PlayerNavigationMenu.3819ea2c.js";import{d as Je,e as He,g as Ze,h as Ye,i as Ge}from"./finalizeUtils.f306d73e.js";import"./QTabs.b10b01c4.js";import"./rtl.276c3f1b.js";import"./QFooter.d2ce5627.js";import"./hourUtils.51636ade.js";const We={class:"text-center"},Xe={class:"row q-col-gutter-sm"},ea={class:"col"},aa={class:"text-body2"},ta={class:"text-caption"},oa={class:"text-caption"},ra={class:"text-center"},sa={class:"text-center text-white"},la={key:0,class:"q-mb-md"},na={class:"row items-center q-py-md"},ia=["src","alt"],da={class:"text-white text-h6"},ca=["src","alt"],ua={class:"row q-col-gutter-md"},ma={class:"col-6"},pa={class:"col-6"},va={class:"text-center"},ga={class:"q-mb-md"},fa={__name:"CheckoutAPI",props:{cartItems:{type:Array,required:!0},userInfo:{type:Object,required:!0},totalAmount:{type:Number,required:!0},externalReference:{type:String,required:!0},metadata:{type:Object,default:()=>({})}},emits:["payment-success","payment-error"],setup(T,{emit:d}){const m=T,l=d,P=qe(),q=i(!0),V=i(!1),A=i(!1),g=i(null),C=i(!1),p=i(""),j=i([]),D=i(null),y=i([]),M=i(null),S=i([]),I=i(null),n=i({number:"",holderName:"",expiry:"",cvv:""}),c=i(1),h=i(!1),b=i(!1),E=i({supports_tokenization:!0,supports_deferred_capture:!0,payment_method_id:null,issuer_id:null,card_type:null,message:""});_e(()=>[{label:"1 pago",value:1}]);const F=_e(()=>I.value&&!C.value?!0:p.value&&p.value!==null&&p.value!==""&&K(n.value.number)&&n.value.holderName&&n.value.holderName.trim()!==""&&J(n.value.expiry)&&H(n.value.cvv)),oe=a=>{const e={visa:"credit_card",master:"credit_card",amex:"credit_card",naranja:"credit_card",cabal:"credit_card",default:"credit_card"};return e[a]||e.default},U=a=>({visa:"VISA",master:"Mastercard",amex:"American Express",naranja:"Naranja",cabal:"Cabal"})[a]||(a==null?void 0:a.toUpperCase()),re=a=>({visa:"visa",master:"mastercard",amex:"amex"})[a]||a,L=a=>`/icons/${re(a)}.svg`,K=a=>{if(!a)return!1;const e=a.replace(/\s/g,"");return e.length>=13&&e.length<=19&&/^\d+$/.test(e)},J=a=>{if(!a||a.length!==5)return!1;const[e,t]=a.split("/"),x=parseInt(e),f=parseInt("20"+t),u=new Date,N=u.getFullYear(),$=u.getMonth()+1;return x>=1&&x<=12&&f>=N&&(f>N||x>=$)},H=a=>a?a.length>=3&&a.length<=4&&/^\d+$/.test(a):!1,se=()=>{let a=n.value.number.replace(/\s/g,"");a=a.replace(/(.{4})/g,"$1 ").trim(),n.value.number=a;const e=a.replace(/\s/g,"");Y(e)},Z=()=>{let a=n.value.expiry.replace(/\D/g,"");a.length>=2&&(a=a.substring(0,2)+"/"+a.substring(2,4)),n.value.expiry=a},le=async a=>{try{if(!a){y.value=[],M.value=null;return}const e=await _.get(`/payments/card_issuers/${a}`);e.data&&e.data.issuers?(y.value=e.data.issuers,y.value.length>0?(M.value=y.value[0].id,console.log(`Auto-selected issuer for Mexico compatibility: ${y.value[0].id} (${y.value[0].name})`)):(M.value=null,console.warn(`No issuers found for payment method: ${a}`))):(y.value=[],M.value=null)}catch(e){console.error("Error loading card issuers:",e),y.value=[],M.value=null}},ne=async a=>{try{if(!a||a.length<6){b.value=!1,E.value={supports_tokenization:!0,supports_deferred_capture:!0,payment_method_id:null,issuer_id:null,card_type:null,message:""};return}console.log(`Checking BIN capabilities for: ${a.substring(0,6)}`);const e=await _.get(`/payments/check_bin_capabilities/${a.substring(0,6)}`);e.data&&(E.value=e.data,b.value=!0,console.log("BIN check result:",{supports_tokenization:e.data.supports_tokenization,card_type:e.data.card_type,message:e.data.message}))}catch(e){console.error("Error checking BIN capabilities:",e),b.value=!0,E.value={supports_tokenization:!1,supports_deferred_capture:!1,payment_method_id:null,issuer_id:null,card_type:null,message:"No se pudo verificar la tarjeta. Se usar\xE1 pago directo."}}},Y=async a=>{if(!a){p.value="",D.value=null,y.value=[],M.value=null,b.value=!1;return}const e={visa:/^4/,master:/^5[1-5]/,amex:/^3[47]/};for(const[t,x]of Object.entries(e))if(x.test(a)){const u=p.value!==t;p.value=t,D.value=t,u&&y.value.length===0&&await le(t),a.length===6&&!b.value&&await ne(a);return}p.value="",D.value=null,y.value=[],M.value=null,b.value=!1},G=a=>{},W=a=>{},X=async()=>{try{A.value=!0;const a=await _.get("/payments/payment_methods");if(a.data&&a.data.payment_methods){const e=["visa","master","amex","pse","efecty","bancolombia","banco_agrario","banco_av_villas","banco_bogota","banco_davivienda","banco_falabella","banco_gnb_sudameris","banco_itau","banco_occidente","banco_popular","banco_santander_colombia","bbva_colombia"];j.value=a.data.payment_methods.filter(t=>e.includes(t.id)||t.payment_type_id==="credit_card"&&["visa","master","amex"].includes(t.id)||t.payment_type_id==="bank_transfer"),D.value=null}else throw new Error("Invalid response format")}catch(a){console.error("Error loading payment methods:",a),j.value=[],D.value=null,P.notify({type:"negative",message:"Error al cargar m\xE9todos de pago"})}finally{A.value=!1}},ie=async()=>{try{const a=await _.get("/payments/saved_payment_methods");a.data&&a.data.saved_payment_methods?S.value=a.data.saved_payment_methods:S.value=[]}catch(a){console.error("Error loading saved payment methods:",a),S.value=[]}},de=a=>{I.value=a,C.value=!1},ce=async a=>{var e;try{g.value=a.id,await _.delete(`/payments/saved_payment_methods/${a.id}`),S.value=S.value.filter(t=>t.id!==a.id),((e=I.value)==null?void 0:e.id)===a.id&&(I.value=null),P.notify({type:"positive",message:"M\xE9todo de pago eliminado"})}catch(t){console.error("Error deleting saved method:",t),P.notify({type:"negative",message:"Error al eliminar m\xE9todo de pago"})}finally{g.value=null}},ue=async()=>{var a,e,t,x,f,u;try{V.value=!0;const N=b.value&&!E.value.supports_tokenization;console.log(`Payment flow: ${N?"CHECKOUT PRO (BIN exclusion fallback)":"TOKENIZATION"}`),console.log("BIN capabilities:",E.value);const[$,he]=n.value.expiry.split("/");let pe,ee;if(N){ee="/payments/create_checkout_pro_fallback",pe={transaction_amount:m.totalAmount,description:`Pago por ${m.cartItems.length} items`,external_reference:m.externalReference,payer:{email:m.userInfo.email,first_name:((a=m.userInfo.name)==null?void 0:a.split(" ")[0])||"",last_name:((e=m.userInfo.name)==null?void 0:e.split(" ").slice(1).join(" "))||""},metadata:m.metadata},console.log("Using CHECKOUT PRO fallback for BIN exclusion");const ve=await _.post(ee,pe),{init_point:ae,preference_id:qa}=ve.data;console.log("Received init_point:",ae),Fe()?(console.log("Opening Checkout Pro in native browser"),await Le(ae),P.notify({type:"info",message:"Abriendo pasarela de pago...",timeout:2e3})):(console.log("Redirecting to Checkout Pro in web browser"),window.location.href=ae);return}else{ee="/payments/process_payment";const ae=(await _.post("/payments/tokenize_card",{card_number:n.value.number.replace(/\s/g,""),expiration_month:$,expiration_year:"20"+he,security_code:n.value.cvv,card_holder_name:n.value.holderName})).data.token;pe={transaction_amount:m.totalAmount,description:`Pago por ${m.cartItems.length} items`,payment_method_id:D.value,payer:{email:m.userInfo.email,first_name:((t=m.userInfo.name)==null?void 0:t.split(" ")[0])||"",last_name:((x=m.userInfo.name)==null?void 0:x.split(" ").slice(1).join(" "))||""},payment_method:{token:ae,installments:c.value||1,card_holder_name:n.value.holderName,issuer_id:M.value},external_reference:m.externalReference,metadata:m.metadata},console.log("Using TOKENIZATION flow with pre-generated token")}console.log(`Calling endpoint: ${ee}`);const fe=(await _.post(ee,pe)).data;if(h.value&&fe.status==="approved"&&E.value.supports_tokenization&&!useDirectPayment)try{await _.post("/payments/save_payment_method",{payment_method_id:D.value,last_four_digits:n.value.number.replace(/\s/g,"").slice(-4),card_holder_name:n.value.holderName,expiration_month:$,expiration_year:"20"+he,issuer_name:fe.issuer_name}),P.notify({type:"positive",message:"M\xE9todo de pago guardado exitosamente",timeout:2e3})}catch(ve){console.error("Error saving payment method:",ve)}l("payment-success",fe)}catch(N){console.error("Payment error:",N);const $=((u=(f=N.response)==null?void 0:f.data)==null?void 0:u.detail)||"Error al procesar el pago";l("payment-error",$),P.notify({type:"negative",message:$})}finally{V.value=!1}},me=async()=>{try{V.value=!0,P.notify({type:"negative",message:"Los m\xE9todos guardados requieren una implementaci\xF3n avanzada. Por favor, usa una nueva tarjeta."}),C.value=!0,I.value=null}catch(a){console.error("Saved method payment error:",a),l("payment-error","Error al procesar pago con m\xE9todo guardado")}finally{V.value=!1}};return Pe(async()=>{try{await Promise.all([X(),ie()]),S.value.length===0&&(C.value=!0)}catch(a){console.error("Error during component initialization:",a),P.notify({type:"negative",message:"Error al inicializar el formulario de pago"})}finally{q.value=!1}}),ze(()=>n.value.number,a=>{if(a){const e=a.replace(/\s/g,"");Y(e)}else p.value="",D.value=null,y.value=[],M.value=null,b.value=!1,E.value={supports_tokenization:!0,supports_deferred_capture:!0,payment_method_id:null,issuer_id:null,card_type:null,message:""}},{immediate:!0}),(a,e)=>(v(),w(B,{class:"text-white"},{default:s(()=>[r(k,null,{default:s(()=>[...e[6]||(e[6]=[o("img",{src:Ue,alt:"Logo",style:{height:"150px",width:"auto"},class:"q-mb-md"},null,-1),o("p",{class:"text-caption"},"Ingresa los datos de tu tarjeta de manera segura",-1)])]),_:1}),q.value?(v(),w(k,{key:0},{default:s(()=>[o("div",We,[r(ye,{color:"primary",size:"3rem"}),e[7]||(e[7]=o("p",{class:"q-mt-md"},"Cargando m\xE9todos de pago...",-1))])]),_:1})):R("",!0),!q.value&&S.value.length>0?(v(),w(k,{key:1},{default:s(()=>[e[8]||(e[8]=o("h5",{class:"q-mb-md"},"M\xE9todos de pago guardados",-1)),o("div",Xe,[(v(!0),te(Ie,null,Ce(S.value,t=>{var x;return v(),te("div",{key:t.id,class:"col-12"},[r(B,{flat:"",bordered:"",class:Te(((x=I.value)==null?void 0:x.id)===t.id?"bg-primary text-white":"bg-grey-8 text-white"),clickable:"",onClick:f=>de(t)},{default:s(()=>[r(k,{class:"row items-center"},{default:s(()=>[r(O,{name:oe(t.payment_method_id),size:"sm",class:"q-mr-sm"},null,8,["name"]),o("div",ea,[o("div",aa,"**** **** **** "+z(t.last_four_digits),1),o("div",ta,z(t.card_holder_name),1),o("div",oa,z(t.expiration_month)+"/"+z(t.expiration_year),1)]),r(Q,{flat:"",icon:"delete",size:"sm",onClick:be(f=>ce(t),["stop"]),loading:g.value===t.id},null,8,["onClick","loading"])]),_:2},1024)]),_:2},1032,["class","onClick"])])}),128))]),r(Ee,{class:"q-my-md"}),r(Q,{flat:"",label:C.value?"Usar m\xE9todo guardado":"Usar nueva tarjeta",onClick:e[0]||(e[0]=t=>C.value=!C.value),class:"full-width q-mb-md"},null,8,["label"])]),_:1})):R("",!0),!q.value&&A.value?(v(),w(k,{key:2},{default:s(()=>[o("div",ra,[r(ye,{color:"primary",size:"2rem"}),e[9]||(e[9]=o("p",{class:"q-mt-md text-white"},"Cargando m\xE9todos de pago...",-1))])]),_:1})):R("",!0),!q.value&&!A.value&&j.value.length===0&&(S.value.length===0||C.value)?(v(),w(k,{key:3},{default:s(()=>[o("div",sa,[r(O,{name:"error",size:"3rem",color:"negative"}),e[10]||(e[10]=o("p",{class:"q-mt-md"},"No se pudieron cargar los m\xE9todos de pago disponibles.",-1)),r(Q,{color:"primary",label:"Reintentar",onClick:X,class:"q-mt-md"})])]),_:1})):R("",!0),!q.value&&!A.value&&j.value.length>0&&(S.value.length===0||C.value)?(v(),w(k,{key:4},{default:s(()=>[r(Be,{onSubmit:be(ue,["prevent"])},{default:s(()=>[p.value?(v(),te("div",la,[e[11]||(e[11]=o("div",{class:"text-body2 q-mb-sm text-white"},"Tipo de tarjeta detectado",-1)),o("div",na,[o("img",{src:L(p.value),alt:U(p.value),style:{height:"32px",width:"auto",filter:"brightness(1.2)"},class:"q-mr-md",onError:G,onLoad:W},null,40,ia),o("span",da,z(U(p.value)),1)])])):R("",!0),r(ge,{modelValue:n.value.number,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.number=t),label:"N\xFAmero de tarjeta",placeholder:"1234 5678 9012 3456",filled:"",dark:"",maxlength:"19",rules:[t=>K(t)||"N\xFAmero de tarjeta inv\xE1lido"],onInput:se,class:"q-mb-md"},Ve({_:2},[p.value?{name:"prepend",fn:s(()=>[o("img",{src:L(p.value),alt:U(p.value),style:{height:"24px",width:"auto"},onError:G,onLoad:W},null,40,ca)]),key:"0"}:{name:"prepend",fn:s(()=>[r(O,{name:"credit_card",color:"grey"})]),key:"1"}]),1032,["modelValue","rules"]),r(ge,{modelValue:n.value.holderName,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.holderName=t),label:"Nombre del titular",placeholder:"JUAN P\xC9REZ",filled:"",dark:"",rules:[t=>!!t||"El nombre es requerido"],class:"q-mb-md"},null,8,["modelValue","rules"]),o("div",ua,[o("div",ma,[r(ge,{modelValue:n.value.expiry,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.expiry=t),label:"MM/AA",placeholder:"12/28",filled:"",dark:"",maxlength:"5",rules:[t=>J(t)||"Fecha inv\xE1lida (MM/AA)"],onInput:Z,onKeyup:Z},null,8,["modelValue","rules"])]),o("div",pa,[r(ge,{modelValue:n.value.cvv,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.cvv=t),label:"CVV",placeholder:"123",filled:"",dark:"",maxlength:"4",type:"password",rules:[t=>H(t)||"CVV inv\xE1lido"]},null,8,["modelValue","rules"])])]),b.value&&!E.value.supports_tokenization?(v(),w(Ne,{key:1,class:"bg-secondary text-white q-mb-md",rounded:""},{avatar:s(()=>[r(O,{name:"info",color:"white"})]),default:s(()=>[e[12]||(e[12]=o("div",null,[o("strong",null,"Pago seguro alternativo"),o("br"),Ae(" Para esta tarjeta, completar\xE1s el pago en el portal seguro de MercadoPago. Esto es requerido por tu banco para mayor seguridad. ")],-1))]),_:1})):R("",!0),b.value&&E.value.supports_tokenization?(v(),w(De,{key:2,modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=t=>h.value=t),label:"Guardar m\xE9todo de pago para futuras compras",color:"primary",dark:"",class:"q-mb-md"},null,8,["modelValue"])):R("",!0),r(Q,{type:"submit",color:F.value?"positive":"primary",size:"lg",label:b.value&&!E.value.supports_tokenization?"Continuar a pago seguro":`Pagar $${T.totalAmount}`,class:"full-width text black",loading:V.value,disable:!F.value},null,8,["color","label","loading","disable"])]),_:1})]),_:1})):R("",!0),!q.value&&!A.value&&I.value&&!C.value?(v(),w(k,{key:5},{default:s(()=>[o("div",va,[o("p",ga," Pagar con: **** **** **** "+z(I.value.last_four_digits),1),r(Q,{color:"positive",size:"lg",label:`Pagar $${T.totalAmount}`,class:"full-width",loading:V.value,onClick:me},null,8,["label","loading"])])]),_:1})):R("",!0)]),_:1}))}};var _a=Me(fa,[["__scopeId","data-v-24c04a4c"]]);const ya={name:"MercadoPayment",components:{CheckoutAPI:_a,PlayerNavigationMenu:Ke},setup(){const T=Re(),d=Qe(),m=qe(),l=i(!0),P=i(null),q=i([]),V=i({}),A=i(null),g=i(null),C=i(!1),p=i(!1),j=i(!1),D=i(""),y=_e(()=>q.value.reduce((c,h)=>c+h.unit_price*h.quantity,0).toFixed(2)),M=async()=>{l.value=!0,P.value=null;try{try{const h=await _.get("/payments/demo-status");C.value=h.data.demo_mode}catch(h){console.warn("Could not check demo status:",h)}const c=d.params.paymentData||JSON.parse(localStorage.getItem("mercadoPaymentData")||"{}");if(!c.cartItems||!c.userInfo)throw new Error("Datos de pago incompletos");q.value=c.cartItems,V.value=c.userInfo,A.value=c.externalReference,g.value=c.metadata,l.value=!1}catch{P.value="Error al cargar los datos de pago. Por favor, int\xE9ntalo nuevamente.",l.value=!1}},S=async c=>{var b,E,F,oe,U,re,L,K,J,H,se,Z,le,ne,Y,G,W,X,ie,de,ce,ue,me,a;console.log("Payment successful:",c);const h=localStorage.getItem("mercadoPaymentData");if(localStorage.removeItem("mercadoPaymentData"),c.status==="approved"){let e={};try{e=JSON.parse(h||"{}")}catch(f){console.error("Error parsing payment data:",f)}const t=(b=e.metadata)==null?void 0:b.item_type,x=(E=e.metadata)==null?void 0:E.payment_order_id;if(console.log("Processing finalization for item type:",t),console.log("Payment metadata:",e.metadata),t&&x){const f={baseData:{clubId:(F=e.metadata)==null?void 0:F.club_id,id:(oe=e.metadata)==null?void 0:oe.item_id,participants:((U=e.metadata)==null?void 0:U.participants)||1},extraData:{date:(re=e.metadata)==null?void 0:re.date,time:(L=e.metadata)==null?void 0:L.time,duration:((K=e.metadata)==null?void 0:K.duration)||60,paymentOption:((J=e.metadata)==null?void 0:J.payment_option)||"total",isPublicMatch:((H=e.metadata)==null?void 0:H.is_public_match)||!1,partnerId:(se=e.metadata)==null?void 0:se.partner_id,isRetas:(Z=e.metadata)==null?void 0:Z.is_retas,matchId:(le=e.metadata)==null?void 0:le.match_id,slotIndex:(ne=e.metadata)==null?void 0:ne.slot_index,teamToJoin:(Y=e.metadata)==null?void 0:Y.team_to_join},selectedProducts:((G=e.metadata)==null?void 0:G.additional_items)||[],paymentOrderId:x,totalAmount:((W=e.metadata)==null?void 0:W.total_amount)||((ie=(X=e.cartItems)==null?void 0:X[0])==null?void 0:ie.unit_price)||0,amountToPay:((de=e.metadata)==null?void 0:de.amount_to_pay)||((ue=(ce=e.cartItems)==null?void 0:ce[0])==null?void 0:ue.unit_price)||0,itemDetails:((me=e.metadata)==null?void 0:me.item_details)||[],paymentOption:((a=e.metadata)==null?void 0:a.payment_option)||"total"};try{let u={success:!1},N="/player/dashboard";t==="court"?(u=await Je(c,f,_,m),u.success&&u.matchId&&(N=`/player/match/${u.matchId}`)):t==="class"||t==="private_lesson"?(u=await He(c,f,_,m),u.success&&u.path&&(N=u.path)):t==="public_lesson"?u=await Ze(c,f,_,m):t==="match"||t==="match_join"||t==="open_match_join"?(u=await Ye(c,f,_,m),u.success&&u.matchId&&(N=`/player/match/${u.matchId}`)):t==="tournament"?u=await Ge(c,f,_,m):(console.warn("Unknown item type:",t),m.notify({type:"warning",message:"Tipo de compra no reconocido, pero el pago fue exitoso.",timeout:3e3}),u={success:!0}),u.success?(localStorage.setItem("mercadoPagoSuccessRedirect",N),p.value=!0):I("El pago fue exitoso, pero hubo un problema al completar la operaci\xF3n. Contacta al soporte.")}catch(u){console.error("Error during finalization:",u),I("El pago fue exitoso, pero hubo un problema al completar la operaci\xF3n. Contacta al soporte.")}}else console.warn("Could not determine item type or payment order ID"),p.value=!0}else c.status==="pending"?(m.notify({type:"info",message:"Tu pago est\xE1 siendo procesado. Te notificaremos cuando se complete.",timeout:5e3}),setTimeout(()=>{T.push("/player/dashboard")},2e3)):I("El pago no fue aprobado. Por favor, intenta con otro m\xE9todo de pago.")},I=c=>{console.error("Payment error:",c),D.value=c,j.value=!0},n=()=>{p.value=!1;const c=localStorage.getItem("mercadoPagoSuccessRedirect");localStorage.removeItem("mercadoPagoSuccessRedirect"),c?T.push(c).catch(h=>{console.error("Error navigating to stored path:",h),T.push("/player/dashboard")}):T.push("/player/dashboard").catch(()=>{T.push("/")})};return Pe(()=>{M()}),{loading:l,error:P,cartItems:q,userInfo:V,externalReference:A,metadata:g,demoModeActive:C,totalAmount:y,showSuccessDialog:p,showErrorDialog:j,paymentErrorMessage:D,initPayment:M,handlePaymentSuccess:S,handlePaymentError:I,navigateToSuccess:n}}},ha={class:"row q-col-gutter-md"},ba={class:"col-12 col-md-6"},xa={class:"row justify-between"},wa={class:"row justify-between text-h6"},ka={class:"col-12 col-md-6"},Pa={class:"text-center"},Ca={class:"text-center text-negative"},Ia={class:"q-mt-md"};function Ea(T,d,m,l,P,q){const V=xe("CheckoutAPI"),A=xe("PlayerNavigationMenu");return v(),w(je,{view:"hHh lpR fFf",class:"text-white"},{default:s(()=>[r(Se,{elevated:"",class:"text-white"},{default:s(()=>[...d[3]||(d[3]=[o("div",{class:"header-content"},[o("div",{class:"greeting"},[o("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})]),o("div",{class:"header-icons"})],-1)])]),_:1}),r($e,{class:"home"},{default:s(()=>[r(Oe,{class:"q-pa-md"},{default:s(()=>[l.demoModeActive?(v(),w(Ne,{key:0,class:"bg-secondary text-white q-mb-md"},{avatar:s(()=>[r(O,{name:"info",color:"white"})]),default:s(()=>[d[4]||(d[4]=o("strong",null,"MODO DEMOSTRACI\xD3N ACTIVO",-1)),d[5]||(d[5]=o("div",{class:"text-caption"}," Todos los pagos se aprueban autom\xE1ticamente para prop\xF3sitos de demostraci\xF3n. ",-1))]),_:1})):R("",!0),o("div",ha,[o("div",ba,[r(B,{class:"text-white"},{default:s(()=>[r(k,null,{default:s(()=>[...d[6]||(d[6]=[o("h4",{class:"text-white q-my-none"},"Resumen de la compra",-1)])]),_:1}),r(k,null,{default:s(()=>[(v(!0),te(Ie,null,Ce(l.cartItems,g=>(v(),te("div",{key:g.id,class:"q-mb-sm"},[o("div",xa,[o("span",null,z(g.title)+" (x"+z(g.quantity)+")",1),o("span",null,"$"+z((g.unit_price*g.quantity).toFixed(2)),1)])]))),128)),r(Ee,{class:"q-my-md"}),o("div",wa,[o("strong",null,"Total: $"+z(l.totalAmount),1)])]),_:1})]),_:1})]),o("div",ka,[l.loading?(v(),w(B,{key:0,class:"text-white"},{default:s(()=>[r(k,null,{default:s(()=>[o("div",Pa,[r(ye,{color:"primary",size:"3rem"}),d[7]||(d[7]=o("p",{class:"q-mt-md"},"Cargando formulario de pago...",-1))])]),_:1})]),_:1})):l.error?(v(),w(B,{key:1,class:"text-white"},{default:s(()=>[r(k,null,{default:s(()=>[o("div",Ca,[r(O,{name:"error",size:"3rem"}),o("p",Ia,z(l.error),1),r(Q,{color:"primary",label:"Reintentar",onClick:l.initPayment,class:"q-mt-md"},null,8,["onClick"])])]),_:1})]),_:1})):(v(),w(V,{key:2,"cart-items":l.cartItems,"user-info":l.userInfo,"total-amount":parseFloat(l.totalAmount),"external-reference":l.externalReference,metadata:l.metadata,onPaymentSuccess:l.handlePaymentSuccess,onPaymentError:l.handlePaymentError},null,8,["cart-items","user-info","total-amount","external-reference","metadata","onPaymentSuccess","onPaymentError"]))])]),r(we,{modelValue:l.showSuccessDialog,"onUpdate:modelValue":d[0]||(d[0]=g=>l.showSuccessDialog=g),persistent:""},{default:s(()=>[r(B,{class:"text-center"},{default:s(()=>[r(k,null,{default:s(()=>[r(O,{name:"check_circle",color:"positive",size:"4rem"}),d[8]||(d[8]=o("h4",{class:"q-my-md"},"\xA1Pago exitoso!",-1)),d[9]||(d[9]=o("p",null,"Tu pago ha sido procesado correctamente.",-1))]),_:1}),r(ke,{align:"center"},{default:s(()=>[r(Q,{color:"primary",label:"Continuar",onClick:l.navigateToSuccess},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(we,{modelValue:l.showErrorDialog,"onUpdate:modelValue":d[2]||(d[2]=g=>l.showErrorDialog=g)},{default:s(()=>[r(B,{class:"text-center"},{default:s(()=>[r(k,null,{default:s(()=>[r(O,{name:"error",color:"negative",size:"4rem"}),d[10]||(d[10]=o("h4",{class:"q-my-md"},"Error en el pago",-1)),o("p",null,z(l.paymentErrorMessage),1)]),_:1}),r(ke,{align:"center"},{default:s(()=>[r(Q,{color:"primary",label:"Intentar nuevamente",onClick:d[1]||(d[1]=g=>l.showErrorDialog=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),r(A)]),_:1})}var Ja=Me(ya,[["render",Ea],["__scopeId","data-v-3a7d9f6e"]]);export{Ja as default};
