import{s as u}from"./supabase.a8148869.js";import{a as p}from"./api.e96a150b.js";import{s as b}from"./googleAuth.343dbd18.js";import{C as k}from"./index.c98ef0da.js";const f=()=>{if(window.location.hostname==="localhost"){const o=window.location.protocol,a=window.location.port,r=`${o}//${window.location.hostname}:${a}/auth/callback`;return console.log("OAuth Redirect URL (development):",r),console.log("Current location:",window.location),r}const e="https://padelplay.mx/auth/callback";return console.log("OAuth Redirect URL (production):",e),e},C={validateOAuthConfig(){console.log("\u{1F50D} Validating OAuth Configuration..."),window.location.hostname==="localhost"&&(console.warn("\u26A0\uFE0F  Development Mode OAuth Checklist:"),console.warn("   \u2713 Ensure localhost redirect URLs are added to Supabase"),console.warn("   \u2713 Google Console should include both Supabase and app callback URLs"),console.warn("   \u2713 Client ID/Secret must match exactly between Google Console and Supabase"));const e="https://ytfwprdrnvgujxdmvvnr.supabase.co";console.log("\u2713 Supabase URL:",e),console.log("\u2713 Expected callback URL:",`${e}/auth/v1/callback`);const o=window.location.origin;return console.log("\u2713 Current app URL:",o),console.log("\u2713 Expected app callback:",`${o}/auth/callback`),{supabaseCallbackUrl:`${e}/auth/v1/callback`,appCallbackUrl:`${o}/auth/callback`,isLocalhost:window.location.hostname==="localhost"}},debugOAuthState(){console.log("=== OAuth Debug Information ==="),console.log("Current URL:",window.location.href),console.log("URL pathname:",window.location.pathname),console.log("URL search:",window.location.search),console.log("URL hash:",window.location.hash);const e=new URLSearchParams(window.location.search),o=new URLSearchParams(window.location.hash.substring(1));console.log("URL Parameters:");for(const[t,s]of e.entries())console.log(`  ${t}: ${s}`);console.log("Hash Parameters:");for(const[t,s]of o.entries())console.log(`  ${t}: ${s}`);const a=["code","state","error","error_code","error_description","access_token","refresh_token"];console.log("OAuth-related parameters found:"),a.forEach(t=>{const s=e.get(t),l=o.get(t);s&&console.log(`  ${t} (URL): ${s}`),l&&console.log(`  ${t} (hash): ${l}`)});const r=e.get("error_description")||o.get("error_description");r&&r.includes("Unable to exchange external code")&&(console.log("\u{1F6A8} OAuth Configuration Issue Detected:"),console.log('   The "Unable to exchange external code" error typically means:'),console.log("   1. Google OAuth Client ID/Secret mismatch between Google Console and Supabase"),console.log("   2. Redirect URL mismatch between Google Console and Supabase"),console.log("   3. Google Console project settings don't allow this domain"),console.log(""),console.log("\u{1F527} To fix this:"),console.log("   1. Go to https://console.cloud.google.com/apis/credentials"),console.log("   2. Find your OAuth 2.0 Client ID"),console.log("   3. Verify the redirect URI includes: https://padelplay.mx/auth/callback"),console.log("   4. Copy the Client ID and Client Secret to your Supabase project"),console.log("   5. In Supabase: Authentication \u2192 Providers \u2192 Google"),console.log("   6. Make sure the credentials match exactly")),console.log("=== End OAuth Debug Information ===")},async signInWithGoogle(){var e;try{if(k.isNativePlatform()){console.log("Using native Google Sign In for mobile...");const s=await b();if(!s)throw new Error("Failed to get Google user info");console.log("Native Google sign in successful, authenticating with Supabase...");const{data:l,error:n}=await u.auth.signInWithIdToken({provider:"google",token:s.idToken});if(n)throw console.error("Supabase sign in error:",n),n;console.log("Supabase authentication successful");const{data:{session:h}}=await u.auth.getSession();if(!h)throw new Error("No session after authentication");const c=h.user;console.log("Creating JWT token via backend for user:",c.email);const d=await p.post("/auth/oauth-login",{supabase_user_id:c.id,email:c.email,full_name:((e=c.user_metadata)==null?void 0:e.full_name)||c.email.split("@")[0],provider:"google"});return console.log("JWT token created successfully"),{access_token:d.data.access_token,user:c}}const o=this.validateOAuthConfig(),a=f();console.log("Attempting Google OAuth with redirect URL:",a),window.location.hostname==="localhost"&&(console.warn("\u{1F527} OAuth Development Setup Required:"),console.warn("If OAuth redirects to padelplay.mx instead of localhost, you need to:"),console.warn("1. Go to your Supabase dashboard \u2192 Authentication \u2192 URL Configuration"),console.warn("2. Add this URL to Redirect URLs:",a),console.warn("3. See OAUTH_SETUP.md for detailed instructions")),console.log("\u{1F4CB} OAuth URLs that should be configured in Google Console:"),console.log("   \u2022 Supabase callback:",o.supabaseCallbackUrl),console.log("   \u2022 App callback:",o.appCallbackUrl);const{data:r,error:t}=await u.auth.signInWithOAuth({provider:"google",options:{redirectTo:a}});if(t)throw console.error("Google OAuth error:",t),t;return console.log("Google OAuth initiation successful:",r),r}catch(o){throw console.error("Error signing in with Google:",o),o}},async signInWithApple(){try{const{data:e,error:o}=await u.auth.signInWithOAuth({provider:"apple",options:{redirectTo:f()}});if(o)throw console.error("Apple OAuth error:",o),o;return e}catch(e){throw console.error("Error signing in with Apple:",e),e}},async handleOAuthCallback(){var e,o,a,r,t;try{console.log("Attempting to retrieve Supabase session...");const{data:{session:s},error:l}=await u.auth.getSession();if(l)throw console.error("Supabase session error:",l),console.error("Error details:",{message:l.message,status:l.status,statusText:l.statusText}),l;if(!s){console.error("No active Supabase session found"),console.log("Current URL for debugging:",window.location.href);const c=new URLSearchParams(window.location.hash.substring(1)),d=c.get("access_token"),m=c.get("refresh_token");if(d){console.log("Found access token in hash parameters, attempting to set session...");const{data:w,error:g}=await u.auth.setSession({access_token:d,refresh_token:m});if(g)throw console.error("Error setting session from hash params:",g),g;if(w.session){console.log("Successfully set session from hash parameters");const i=w.session.user;return await this.ensureUserProfile(i),{access_token:(await p.post("/auth/oauth-login",{supabase_user_id:i.id,email:i.email,full_name:((e=i.user_metadata)==null?void 0:e.full_name)||i.email.split("@")[0],provider:((o=i.app_metadata)==null?void 0:o.provider)||"google"})).data.access_token,user:i}}}throw new Error("No active session found")}console.log("Successfully retrieved Supabase session"),console.log("Session user:",{id:s.user.id,email:s.user.email,provider:(a=s.user.app_metadata)==null?void 0:a.provider});const n=s.user;await this.ensureUserProfile(n),console.log("Creating JWT token via backend...");const h=await p.post("/auth/oauth-login",{supabase_user_id:n.id,email:n.email,full_name:((r=n.user_metadata)==null?void 0:r.full_name)||n.email.split("@")[0],provider:((t=n.app_metadata)==null?void 0:t.provider)||"google"});return console.log("Successfully created JWT token"),{access_token:h.data.access_token,user:n}}catch(s){throw console.error("Error handling OAuth callback:",s),s.response&&console.error("Backend API error:",{status:s.response.status,statusText:s.response.statusText,data:s.response.data}),s}},async ensureUserProfile(e){try{const{data:o,error:a}=await u.from("profiles").select("*").eq("id",e.id).single();if(a&&a.code!=="PGRST116")throw a;return o||console.log("Profile will be created by backend"),o}catch(o){throw console.error("Error ensuring user profile:",o),o}}};export{C as o};
