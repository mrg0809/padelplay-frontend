import{r as h,x as S,y as E,h as O,aV as U,o as i,z as y,A as m,d as c,B as e,a as f,Q as L,e as u,ac as V,t as G,D as k,a9 as _}from"./index.44d6004f.js";import{Q as N}from"./QPage.069cc100.js";import{Q,a as R}from"./QLayout.bdadfe99.js";import{o as C}from"./auth.2bd99c66.js";import{h as w}from"./haptics.bd260566.js";import{_ as D}from"./plugin-vue_export-helper.21dcd24c.js";import"./supabase.3e81c9a1.js";import"./api.dcb17b1f.js";import"./googleAuth.bf725d38.js";const T={class:"callback-container"},B={key:0,class:"loading-container"},I={key:1,class:"error-container"},z={class:"error-text",style:{"white-space":"pre-line"}},q={class:"error-actions"},F={key:0,class:"troubleshooting-panel"},H={__name:"AuthCallbackPage",setup(j){const b=h(!0),r=h(null),d=h(!1),s=S(),A=E();O(async()=>{try{console.log("OAuth callback page loaded"),C.debugOAuthState();const a=new URLSearchParams(window.location.search),o=new URLSearchParams(window.location.hash.substring(1)),t=a.get("error")||o.get("error"),v=a.get("error_code")||o.get("error_code"),p=a.get("error_description")||o.get("error_description");if(t){console.error("OAuth error from URL parameters:",{error:t,error_code:v,error_description:p});let n="Error durante la autenticaci\xF3n con Google.";throw t==="server_error"&&v==="unexpected_failure"?p&&p.includes("Unable to exchange external code")?n=`Error de configuraci\xF3n OAuth: No se pudo intercambiar el c\xF3digo de autorizaci\xF3n de Google.

Posibles causas:
\u2022 El Client ID o Client Secret de Google en Supabase no coinciden con los de Google Console
\u2022 Las URLs de redirecci\xF3n no est\xE1n configuradas correctamente
\u2022 El proyecto de Google Console no est\xE1 configurado para este dominio

Revisa la configuraci\xF3n OAuth en tu panel de Supabase y Google Console.`:n="Error del servidor durante la autenticaci\xF3n. Por favor, intenta de nuevo.":t==="access_denied"?n="Acceso denegado. Has cancelado la autenticaci\xF3n con Google.":t==="invalid_request"&&(n="Solicitud de autenticaci\xF3n inv\xE1lida. Por favor, intenta de nuevo."),new Error(n)}const{access_token:g}=await C.handleOAuthCallback();await U(g),await w.success(),A.setUserDataFromToken(g);const x=g.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),l=JSON.parse(atob(x));console.log("OAuth login successful, user type:",l.user_type),l.user_type==="superuser"?s.push("/dashboard/superuser"):l.user_type==="admin"?s.push("/dashboard/admin"):l.user_type==="club"?s.push("/dashboard/club"):l.user_type==="padelite"?s.push("/padelite/dashboard"):l.user_type==="association"?s.push("/dashboard/association"):s.push("/dashboard/player")}catch(a){console.error("OAuth callback error:",a),await w.error(),a.message&&a.message.includes("No active session found")?r.value="No se encontr\xF3 una sesi\xF3n activa. Esto puede suceder si la configuraci\xF3n de OAuth no est\xE1 completa. Revisa OAUTH_SETUP.md para m\xE1s informaci\xF3n.":a.response&&a.response.status===503?r.value="Error de configuraci\xF3n de la base de datos. Contacta al administrador.":a.message&&a.message.includes("Error de configuraci\xF3n OAuth")?r.value=a.message:r.value="Error durante la autenticaci\xF3n. Por favor, intenta de nuevo.",b.value=!1}});const P=()=>{s.push("/")};return(a,o)=>(i(),y(Q,{view:"lHh Lpr lFf"},{default:m(()=>[c(R,null,{default:m(()=>[c(N,{class:"auth-callback-page"},{default:m(()=>[e("div",T,[o[3]||(o[3]=e("img",{src:"/logo.jpeg",alt:"Logo",class:"callback-logo"},null,-1)),b.value?(i(),f("div",B,[c(L,{size:"lg",color:"white"}),o[1]||(o[1]=e("p",{class:"loading-text"},"Procesando autenticaci\xF3n...",-1))])):u("",!0),r.value?(i(),f("div",I,[c(V,{name:"error",size:"lg",color:"red"}),e("p",z,G(r.value),1),e("div",q,[c(k,{label:"Volver al inicio",color:"white","text-color":"black",onClick:P,class:"q-mb-sm"}),r.value.includes("configuraci\xF3n OAuth")?(i(),y(k,{key:0,label:"Ver soluci\xF3n",color:"amber","text-color":"black",onClick:o[0]||(o[0]=t=>d.value=!d.value)})):u("",!0)]),d.value?(i(),f("div",F,[...o[2]||(o[2]=[e("h3",null,"Pasos para solucionar:",-1),e("ol",null,[e("li",null,[_("Ve a "),e("a",{href:"https://console.cloud.google.com/apis/credentials",target:"_blank"},"Google Console")]),e("li",null,"Encuentra tu OAuth 2.0 Client ID"),e("li",null,"Verifica que las URL de redirecci\xF3n incluyan:"),e("ul",null,[e("li",null,[e("code",null,"https://ytfwprdrnvgujxdmvvnr.supabase.co/auth/v1/callback")]),e("li",null,[e("code",null,"https://padelplay.mx/auth/callback")])]),e("li",null,"Copia el Client ID y Client Secret exactos"),e("li",null,[_("Ve a tu "),e("a",{href:"https://supabase.com/dashboard",target:"_blank"},"panel de Supabase")]),e("li",null,"Authentication \u2192 Providers \u2192 Google"),e("li",null,"Pega las credenciales exactas y guarda")],-1),e("p",null,[e("strong",null,"Nota:"),_(" Los cambios poden tardar 5-10 minutos en propagarse.")],-1)])])):u("",!0)])):u("",!0)])]),_:1})]),_:1})]),_:1}))}};var oe=D(H,[["__scopeId","data-v-f6ede442"]]);export{oe as default};
