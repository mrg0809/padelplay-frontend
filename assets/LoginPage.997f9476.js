import{r as t,F as L,q as g,G as _,H as p,v as l,I as c,J as n,s as b,y as m,K as w,x as P}from"./index.0dae1473.js";import{Q as S}from"./QForm.b0ccd6d3.js";import{Q as A}from"./QPage.93249297.js";import{Q as x,a as Q}from"./QLayout.c8e0bf98.js";import{a as V}from"./api.2af71db3.js";import{u as G}from"./userStore.3198d202.js";import{o as C}from"./auth.0f16b1ef.js";import{u as W}from"./useMeta.2d1bd146.js";import{_ as F}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.8dcdf680.js";import"./supabase.25da9554.js";const U={name:"LoginPage",setup(){W({title:"Iniciar Sesi\xF3n"});const h=t(""),a=t(""),s=t(null),o=t(!1),u=t(!1),v=t(!1),e=L(),T=G();return{email:h,password:a,error:s,googleLoading:o,appleLoading:u,showTraditionalLogin:v,login:async()=>{var i,k;s.value=null;try{const r=await V.post("/auth/login",{email:h.value,password:a.value}),{access_token:f}=r.data;localStorage.setItem("token",f);const I=f.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),d=JSON.parse(atob(I));T.setUserDataFromToken(f),console.log("User type from token:",d.user_type);const y=localStorage.getItem("redirectAfterLogin");if(y){localStorage.removeItem("redirectAfterLogin"),e.push(y);return}d.user_type==="superuser"?(console.log("Redirecting to superuser dashboard"),e.push("/dashboard/superuser")):d.user_type==="admin"?(console.log("Redirecting to admin dashboard"),e.push("/dashboard/admin")):d.user_type==="club"?(console.log("Redirecting to club dashboard"),e.push("/dashboard/club")):d.user_type==="association"?(console.log("Redirecting to association dashboard"),e.push("/association/dashboard")):(console.log("Redirecting to player dashboard"),e.push("/dashboard/player"))}catch(r){r.response&&r.response.data&&r.response.data.detail?s.value=r.response.data.detail:s.value="Ocurri\xF3 un error inesperado. Intenta de nuevo m\xE1s tarde.",console.error("Error al iniciar sesi\xF3n:",((k=(i=r.response)==null?void 0:i.data)==null?void 0:k.detail)||r.message)}},signInWithGoogle:async()=>{o.value=!0,s.value=null;try{await C.signInWithGoogle()}catch(i){s.value="Error al iniciar sesi\xF3n con Google",console.error("Google OAuth error:",i)}finally{o.value=!1}},signInWithApple:async()=>{u.value=!0,s.value=null;try{await C.signInWithApple()}catch(i){s.value="Apple OAuth no est\xE1 disponible a\xFAn. Pronto estar\xE1 habilitado.",console.error("Apple OAuth error:",i)}finally{u.value=!1}},goToSignup:()=>{e.push("/signup")},goToForgotPassword:()=>{e.push("/forgot-password")},goToTerms:()=>{e.push("/terms")},goToPrivacy:()=>{e.push("/privacy")}}}},O={class:"login-container"},R={class:"oauth-buttons"},B={key:0,class:"traditional-login-toggle"},N={key:1,class:"divider"},q={key:0,class:"error-message"},E={class:"login-links"},D={class:"legal-links"};function H(h,a,s,o,u,v){return g(),_(x,{view:"lHh Lpr lFf"},{default:p(()=>[l(Q,null,{default:p(()=>[l(A,{class:"login-page"},{default:p(()=>[c("div",O,[a[4]||(a[4]=c("img",{src:"/logo.jpeg",alt:"Logo",class:"login-logo"},null,-1)),c("div",R,[l(n,{onClick:o.signInWithGoogle,loading:o.googleLoading,class:"google-btn",icon:"img:/google-icon.svg",label:"Continuar con Google",color:"white","text-color":"black","no-caps":"",style:{"margin-bottom":"12px"}},null,8,["onClick","loading"]),l(n,{onClick:o.signInWithApple,loading:o.appleLoading,class:"apple-btn",icon:"img:/apple-icon.svg",label:"Continuar con Apple",color:"dark","text-color":"white","no-caps":"",style:{"margin-bottom":"20px"}},null,8,["onClick","loading"])]),o.showTraditionalLogin?m("",!0):(g(),b("div",B,[l(n,{flat:"",label:"Ingresar con email y contrase\xF1a",color:"white",class:"toggle-link",onClick:a[0]||(a[0]=e=>o.showTraditionalLogin=!0),"no-caps":""})])),o.showTraditionalLogin?(g(),b("div",N,a[3]||(a[3]=[c("span",{class:"divider-text"},"o",-1)]))):m("",!0),o.showTraditionalLogin?(g(),_(S,{key:2,onSubmit:o.login,class:"login-form"},{default:p(()=>[l(w,{outlined:"",dark:"",modelValue:o.email,"onUpdate:modelValue":a[1]||(a[1]=e=>o.email=e),label:"Correo electr\xF3nico",type:"email",class:"q-mb-md input-dark"},null,8,["modelValue"]),l(w,{outlined:"",dark:"",modelValue:o.password,"onUpdate:modelValue":a[2]||(a[2]=e=>o.password=e),label:"Contrase\xF1a",type:"password",class:"q-mb-md input-dark"},null,8,["modelValue"]),l(n,{label:"Iniciar sesi\xF3n",color:"white","text-color":"black",type:"submit",class:"login-btn"}),o.error?(g(),b("div",q,P(o.error),1)):m("",!0)]),_:1},8,["onSubmit"])):m("",!0),c("div",E,[l(n,{flat:"",label:"Crear una cuenta",color:"white",class:"login-link",onClick:o.goToSignup},null,8,["onClick"]),l(n,{flat:"",label:"Olvid\xE9 mi contrase\xF1a",color:"white",class:"login-link",onClick:o.goToForgotPassword},null,8,["onClick"]),c("div",D,[l(n,{flat:"",label:"T\xE9rminos y Condiciones",color:"white",class:"legal-link",onClick:o.goToTerms},null,8,["onClick"]),l(n,{flat:"",label:"Aviso de Privacidad",color:"white",class:"legal-link",onClick:o.goToPrivacy},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})}var go=F(U,[["render",H],["__scopeId","data-v-ae7048d0"]]);export{go as default};
