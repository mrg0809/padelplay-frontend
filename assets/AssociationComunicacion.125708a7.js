import{Q as K}from"./QHeader.289f0645.js";import{x as W,r,h as Y,a6 as Q,o as u,z as p,A as s,d as e,B as d,D as g,a7 as N,a8 as k,Q as Z,ac as $,a9 as b,a as q,aa as z,ab as L,E as ee,ad as U,af as j,ae,t as D,e as te}from"./index.687b44e8.js";import{Q as A}from"./QItemLabel.bbebea39.js";import{Q as F,a as E}from"./QItem.eb9291fb.js";import{Q as H}from"./QList.1288e946.js";import{Q as oe}from"./QChip.c9b5cbc6.js";import{Q as se}from"./QPage.fcc9aae1.js";import{Q as le,a as ie}from"./QLayout.30990248.js";import{Q as ne}from"./QFile.29c4fdcc.js";import{C as re}from"./ClosePopup.89fae5e1.js";import{u as de}from"./use-quasar.ba375293.js";import{A as ce,a as ue}from"./AssociationTopMenu.c2c9d0dc.js";import{N as me}from"./NotificationBell.9fdba392.js";import{B as fe}from"./BannerPromoScrolling.1700e538.js";import{g as pe}from"./association.b92d73c6.js";import{f as ge,c as ve,u as ye,d as _e}from"./community.c8cb8a35.js";import{_ as be}from"./plugin-vue_export-helper.21dcd24c.js";import"./format.de7e9769.js";import"./QTabs.979bee57.js";import"./rtl.276c3f1b.js";import"./QFooter.b7b22f15.js";import"./QBtnDropdown.17175f2e.js";import"./QBtnGroup.6b9d07ee.js";import"./QMenu.df8dfc7c.js";import"./position-engine.46674690.js";import"./selection.0f785986.js";import"./haptics.57409bd0.js";import"./QBadge.0c3a126f.js";import"./api.1c42dce4.js";const Ce={name:"AssociationComunicacion",components:{AssociationNavigationMenu:ce,AssociationTopMenu:ue,NotificationBell:me,BannerPromoScrolling:fe},setup(){const n=de(),t=W(),f=r(!0),o=r(!1),C=r(!1),w=r([]),c=r(null),x=r(!1),v=r(!1),y=r(""),a=r(null),m=r(null),P={like:"\u{1F44D}",love:"\u2764\uFE0F",laugh:"\u{1F602}",wow:"\u{1F62E}",sad:"\u{1F622}",angry:"\u{1F621}"},R=()=>t.push("/dashboard/association"),O=l=>l?new Date(l).toLocaleString("es-MX",{dateStyle:"short",timeStyle:"short"}):"",V=async()=>{if(!!c.value){f.value=!0;try{const l=await ge(c.value);w.value=l||[]}catch(l){console.error("Error loading posts:",l),n.notify({type:"negative",message:"Error al cargar los posts"}),w.value=[]}finally{f.value=!1}}},X=async()=>{var i,h,B,I,S;const l=(i=y.value)==null?void 0:i.trim();if(!l){n.notify({type:"warning",message:"Escribe algo para publicar"});return}if(!c.value){n.notify({type:"negative",message:"No se pudo identificar la asociaci\xF3n"});return}o.value=!0;try{const _=await ve({association_organization_id:c.value,content:l}),T=(B=(h=_==null?void 0:_.data)==null?void 0:h[0])==null?void 0:B.id;T&&a.value&&await ye(T,a.value),n.notify({type:"positive",message:"Post publicado"}),M(),await V()}catch(_){n.notify({type:"negative",message:((S=(I=_.response)==null?void 0:I.data)==null?void 0:S.detail)||"Error al publicar"})}finally{o.value=!1}},M=()=>{x.value=!1,y.value="",a.value=null},G=l=>{m.value=l,v.value=!0},J=async()=>{var l,i;if(!(!m.value||!c.value)){C.value=!0;try{await _e(m.value.id,{association_organization_id:c.value}),n.notify({type:"positive",message:"Post eliminado"}),v.value=!1,m.value=null,await V()}catch(h){n.notify({type:"negative",message:((i=(l=h.response)==null?void 0:l.data)==null?void 0:i.detail)||"Error al eliminar"})}finally{C.value=!1}}};return Y(async()=>{var l;try{const i=await pe();(l=i==null?void 0:i.data)!=null&&l.id?(c.value=i.data.id,await V()):(f.value=!1,n.notify({type:"info",message:"Carga tu perfil de asociaci\xF3n primero"}))}catch{f.value=!1,n.notify({type:"negative",message:"Error al cargar la asociaci\xF3n"})}}),{goToDashboard:R,loading:f,publishing:o,deleting:C,posts:w,showCreatePostDialog:x,showDeleteConfirm:v,newPostContent:y,newPostMedia:a,reactionEmojis:P,formatDate:O,createPost:X,closeCreateDialog:M,confirmDeletePost:G,doDeletePost:J}}},we={class:"header-content"},xe={class:"greeting"},Pe={class:"header-icons"},he={key:0,class:"q-mt-sm"},Qe=["src"],ke={class:"q-mt-sm"};function De(n,t,f,o,C,w){const c=Q("NotificationBell"),x=Q("AssociationTopMenu"),v=Q("BannerPromoScrolling"),y=Q("AssociationNavigationMenu");return u(),p(le,{view:"hHh lpR fFf",class:"text-white"},{default:s(()=>[e(K,{elevated:"",class:"text-white"},{default:s(()=>[d("div",we,[d("div",xe,[d("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...a)=>o.goToDashboard&&o.goToDashboard(...a))}),t[6]||(t[6]=d("span",{class:"text-subtitle1"},"Comunicaci\xF3n",-1))]),d("div",Pe,[e(c),e(x)])]),e(v)]),_:1}),e(ie,null,{default:s(()=>[e(se,{class:"q-pa-md"},{default:s(()=>[t[8]||(t[8]=d("div",{class:"text-h5 q-mb-md"},"Muro de la asociaci\xF3n",-1)),t[9]||(t[9]=d("p",{class:"text-caption text-grey q-mb-md"},"Los posts que crees aqu\xED se mostrar\xE1n en el muro del perfil de tu asociaci\xF3n para que los jugadores puedan verlos y reaccionar.",-1)),e(g,{icon:"add",color:"primary",label:"Nuevo post",class:"q-mb-md","text-color":"black",onClick:t[1]||(t[1]=a=>o.showCreatePostDialog=!0)}),o.loading?(u(),p(N,{key:0,flat:"",bordered:"",class:"bg-grey-9 text-white"},{default:s(()=>[e(k,{class:"text-center"},{default:s(()=>[e(Z,{color:"primary",size:"40px"})]),_:1})]),_:1})):o.posts.length===0?(u(),p(H,{key:1,bordered:"",class:"rounded-borders bg-transparent"},{default:s(()=>[e(F,{class:"bg-grey-9 text-grey"},{default:s(()=>[e(E,{class:"text-center"},{default:s(()=>[e($,{name:"o_chat",size:"48px",class:"q-mb-sm"}),e(A,null,{default:s(()=>[...t[7]||(t[7]=[b("No hay posts a\xFAn. Crea el primero.",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):(u(),p(H,{key:2,bordered:"",class:"rounded-borders bg-transparent"},{default:s(()=>[(u(!0),q(L,null,z(o.posts,a=>(u(),p(F,{key:a.id,class:"q-mb-sm post-item bg-grey-9"},{default:s(()=>[e(E,null,{default:s(()=>[e(A,{class:"text-weight-medium"},{default:s(()=>[b(D(a.content),1)]),_:2},1024),e(A,{caption:""},{default:s(()=>[b(D(o.formatDate(a.created_at)),1)]),_:2},1024),a.media_url?(u(),q("div",he,[d("img",{src:a.media_url,style:{"max-width":"100%","border-radius":"8px"},alt:"Media del post"},null,8,Qe)])):te("",!0),d("div",ke,[(u(!0),q(L,null,z(a.reactions,(m,P)=>(u(),p(oe,{key:P,color:"transparent",class:"text-white",dense:""},{default:s(()=>[b(D(o.reactionEmojis[P])+" "+D(m),1)]),_:2},1024))),128))])]),_:2},1024),e(E,{side:""},{default:s(()=>[e(g,{flat:"",round:"",icon:"delete",color:"negative",size:"sm",onClick:m=>o.confirmDeletePost(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1}),e(j,{modelValue:o.showCreatePostDialog,"onUpdate:modelValue":t[4]||(t[4]=a=>o.showCreatePostDialog=a),persistent:""},{default:s(()=>[e(N,{class:"q-pa-md bg-grey-9 text-white",style:{"min-width":"320px"}},{default:s(()=>[e(k,null,{default:s(()=>[...t[10]||(t[10]=[d("div",{class:"text-h6"},"Nuevo post",-1)])]),_:1}),e(k,{class:"q-gutter-md"},{default:s(()=>[e(ee,{modelValue:o.newPostContent,"onUpdate:modelValue":t[2]||(t[2]=a=>o.newPostContent=a),type:"textarea",label:"Escribe tu post",outlined:"",dark:"",autogrow:"",rules:[a=>!!(a!=null&&a.trim())||"Escribe algo"]},null,8,["modelValue","rules"]),e(ne,{modelValue:o.newPostMedia,"onUpdate:modelValue":t[3]||(t[3]=a=>o.newPostMedia=a),label:"Imagen o video (opcional)",accept:"image/*, video/*",outlined:"",dark:"",dense:"",clearable:""},null,8,["modelValue"])]),_:1}),e(U,{align:"right"},{default:s(()=>[e(g,{flat:"",label:"Cancelar",onClick:o.closeCreateDialog},null,8,["onClick"]),e(g,{unelevated:"",label:"Publicar",color:"primary","text-color":"black",loading:o.publishing,onClick:o.createPost},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:o.showDeleteConfirm,"onUpdate:modelValue":t[5]||(t[5]=a=>o.showDeleteConfirm=a),persistent:""},{default:s(()=>[e(N,{class:"bg-grey-9 text-white",style:{"min-width":"280px"}},{default:s(()=>[e(k,null,{default:s(()=>[...t[11]||(t[11]=[b("\xBFEliminar este post?",-1)])]),_:1}),e(U,{align:"right"},{default:s(()=>[ae(e(g,{flat:"",label:"Cancelar"},null,512),[[re]]),e(g,{flat:"",label:"Eliminar",color:"negative",loading:o.deleting,onClick:o.doDeletePost},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(y)]),_:1})}var oa=be(Ce,[["render",De],["__scopeId","data-v-7e5261c8"]]);export{oa as default};
