import{x as oe,y as ne,r as c,h as se,o as p,z as h,A as n,d as o,B as s,a9 as g,D as d,a7 as M,a8 as C,E as S,ac as re,bN as le,t as u,e as V,a as A,ab as B,aa as ie,af as ue,ad as de,ae as me}from"./index.687b44e8.js";import{Q as ce}from"./QHeader.289f0645.js";import{Q as pe}from"./QSpinnerGears.810653c0.js";import{Q as ve}from"./QInnerLoading.ae9b64c1.js";import{Q as fe}from"./QBanner.7143372b.js";import{Q as N}from"./QItemLabel.bbebea39.js";import{Q as R,a as T}from"./QItem.eb9291fb.js";import{Q as _e}from"./QChip.c9b5cbc6.js";import{Q as ge}from"./QList.1288e946.js";import{Q as ye}from"./QPage.fcc9aae1.js";import{Q as be}from"./QSelect.8af2919e.js";import{Q as he,a as Ce}from"./QLayout.30990248.js";import{C as we}from"./ClosePopup.89fae5e1.js";import{u as $e}from"./use-quasar.ba375293.js";import{n as Qe}from"./navigationUtils.2c4b9dee.js";import{C as ke}from"./ClubNavigationMenu.44af5278.js";import{a as L}from"./api.1c42dce4.js";import{l as De}from"./courtAccounts.b741342b.js";import{_ as Me}from"./plugin-vue_export-helper.21dcd24c.js";import"./QMenu.df8dfc7c.js";import"./position-engine.46674690.js";import"./selection.0f785986.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QTabs.979bee57.js";import"./QFooter.b7b22f15.js";const Ve=async v=>{const{data:m}=await L.get("/club/corte",{params:{transaction_date:v}});return m},Fe=async v=>{const{data:m}=await L.post("/club/corte/manual",v);return m},Se=async v=>{await L.delete(`/club/corte/${v}`)};const Te={class:"header-content"},Le={class:"header-icons"},Ie={class:"text-weight-medium"},qe={class:"row q-gutter-md q-mt-sm"},Ee={class:"col"},je={class:"text-h5 text-green"},Ae={class:"col"},Be={class:"text-h5 text-blue"},Ne={class:"col"},Re={class:"text-h5"},Ue={class:"row justify-between items-center q-mb-sm"},ze={class:"row q-gutter-sm"},He={__name:"CorteDelDia",setup(v){const m=oe(),f=$e(),U=ne(),w=c(!1),l=c(null),y=c(new Date().toISOString().slice(0,10)),$=c(!1),i=c({amount:null,payment_method:"efectivo",notes:""}),Q=c(0),z=c(null);function H(t){return{reservation:"Reserva",lesson:"Clase",court_account:"Cuenta cancha",manual:"Manual"}[t]||t}function k(t){if(!t)return"";const e=String(t);return e.length>=5?e.slice(0,5):e}function P(t){if(t.type==="reservation"&&(t.reservation_start_time||t.reservation_guest_name)){const e=t.reservation_start_time&&t.reservation_end_time?` ${k(t.reservation_start_time)}-${k(t.reservation_end_time)}`:"",a=t.reservation_guest_name?` \u2013 ${t.reservation_guest_name}`:"";return`${e}${a}`}if(t.type==="lesson"&&(t.lesson_name||t.lesson_time)){const e=k(t.lesson_time)?` ${k(t.lesson_time)}`:"";return`${t.lesson_name?` ${t.lesson_name}`:""}${e}`}return""}function O(t){return t.type==="manual"&&t.notes?t.notes:t.type==="reservation"&&t.reservation_guest_name?t.reservation_guest_name:t.payment_method}function G(){m.back()}function J(){Qe(m,U)}async function I(){try{const t=await De("open");Q.value=Array.isArray(t)?t.length:0}catch{Q.value=0}}async function D(){var t,e;w.value=!0;try{const a=await Ve(y.value);l.value=a,await I()}catch(a){f.notify({type:"negative",message:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.detail)||"Error al cargar corte"}),l.value=null}finally{w.value=!1}}function K(t){const e=l.value;if(!e)return"";const a=y.value,_=(e.total_efectivo||0).toFixed(2),Z=(e.total_tarjeta||0).toFixed(2),x=(e.total||0).toFixed(2);let b=`
    <div class="corte-print">
      <h1>Corte del d\xEDa</h1>
      <p class="corte-date">Fecha: ${a}</p>
      <table class="corte-totals">
        <tr><td>Efectivo</td><td>$${_}</td></tr>
        <tr><td>Tarjeta</td><td>$${Z}</td></tr>
        <tr><td><strong>Total</strong></td><td><strong>$${x}</strong></td></tr>
      </table>
  `;if(t==="detallado"&&e.transactions&&e.transactions.length){b+='<h2>Movimientos</h2><table class="corte-tx"><thead><tr><th>Tipo</th><th>Detalle</th><th>Forma pago</th><th>Monto</th></tr></thead><tbody>';const ee={reservation:"Reserva",lesson:"Clase",court_account:"Cuenta cancha",manual:"Manual"};e.transactions.forEach(r=>{const te=ee[r.type]||r.type;let F=r.notes||"";if(r.type==="reservation"&&(r.reservation_start_time||r.reservation_guest_name)){const E=r.reservation_start_time?String(r.reservation_start_time).slice(0,5):"",j=r.reservation_end_time?String(r.reservation_end_time).slice(0,5):"";F=(E&&j?`${E}-${j}`:"")+(r.reservation_guest_name?` \u2013 ${r.reservation_guest_name}`:"")}else r.type==="lesson"&&(r.lesson_name||r.lesson_time)&&(F=(r.lesson_name||"")+(r.lesson_time?` ${String(r.lesson_time).slice(0,5)}`:""));const ae=r.payment_method==="efectivo"?"Efectivo":"Tarjeta";b+=`<tr><td>${te}</td><td>${F}</td><td>${ae}</td><td>$${parseFloat(r.amount).toFixed(2)}</td></tr>`}),b+="</tbody></table>"}return b+="</div>",b}function q(t){if(!l.value)return;const e=document.getElementById("corte-print-content");!e||(e.innerHTML=K(t),document.body.classList.add("printing-corte"),setTimeout(()=>{window.print(),document.body.classList.remove("printing-corte"),e.innerHTML=""},150))}function W(){i.value={amount:null,payment_method:"efectivo",notes:""},$.value=!0}async function X(){var e,a;const t=parseFloat(i.value.amount);if(!t||t<=0){f.notify({type:"warning",message:"Monto debe ser mayor a 0"});return}try{await Fe({transaction_date:y.value,amount:t,payment_method:i.value.payment_method,notes:i.value.notes||void 0}),f.notify({type:"positive",message:"Movimiento registrado"}),$.value=!1,D()}catch(_){f.notify({type:"negative",message:((a=(e=_.response)==null?void 0:e.data)==null?void 0:a.detail)||"Error al registrar"})}}async function Y(t){var e,a;try{await Se(t),f.notify({type:"positive",message:"Movimiento eliminado"}),D()}catch(_){f.notify({type:"negative",message:((a=(e=_.response)==null?void 0:e.data)==null?void 0:a.detail)||"Solo se pueden eliminar movimientos manuales"})}}return se(()=>{D(),I()}),(t,e)=>(p(),h(he,{view:"hHh lpR fFf",class:"body text-white"},{default:n(()=>[o(ce,{elevated:"",class:"text-white"},{default:n(()=>[s("div",Te,[s("div",{class:"greeting"},[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:J}),e[8]||(e[8]=g(" Corte del d\xEDa ",-1))]),s("div",Le,[o(d,{flat:"",round:"",icon:"arrow_back",onClick:G})])])]),_:1}),o(Ce,null,{default:n(()=>[o(ye,{class:"q-pa-md"},{default:n(()=>[o(M,{flat:"",class:"bg-grey-9 q-mb-md"},{default:n(()=>[o(C,null,{default:n(()=>[o(S,{modelValue:y.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>y.value=a),D],type:"date",label:"Fecha del corte",outlined:"",dense:"",color:"white","bg-color":"grey-8"},null,8,["modelValue"])]),_:1})]),_:1}),o(ve,{showing:w.value},{default:n(()=>[o(pe,{size:"50px",color:"primary"})]),_:1},8,["showing"]),Q.value>0?(p(),h(fe,{key:0,class:"bg-warning text-dark q-mb-md rounded-borders",dense:""},{avatar:n(()=>[o(re,{name:"warning"})]),action:n(()=>[o(d,{flat:"",label:"Ir a cuentas",onClick:e[1]||(e[1]=a=>le(m).push("/club/cuentas-cancha"))})]),default:n(()=>[s("span",Ie,"Tienes "+u(Q.value)+" cuenta(s) abierta(s).",1),e[9]||(e[9]=g(' Cierra las cuentas en "Cuentas por cancha" para poder cerrar tu d\xEDa correctamente. ',-1))]),_:1})):V("",!0),!w.value&&l.value?(p(),A(B,{key:1},[o(M,{flat:"",class:"bg-grey-9 q-mb-md"},{default:n(()=>[o(C,null,{default:n(()=>[e[13]||(e[13]=s("div",{class:"text-h6"},"Totales",-1)),s("div",qe,[s("div",Ee,[e[10]||(e[10]=s("div",{class:"text-caption text-grey-5"},"Efectivo",-1)),s("div",je,"$ "+u((l.value.total_efectivo||0).toFixed(2)),1)]),s("div",Ae,[e[11]||(e[11]=s("div",{class:"text-caption text-grey-5"},"Tarjeta",-1)),s("div",Be,"$ "+u((l.value.total_tarjeta||0).toFixed(2)),1)]),s("div",Ne,[e[12]||(e[12]=s("div",{class:"text-caption text-grey-5"},"Total",-1)),s("div",Re,"$ "+u((l.value.total||0).toFixed(2)),1)])])]),_:1})]),_:1}),s("div",Ue,[s("div",ze,[o(d,{flat:"",color:"grey-4",icon:"print",label:"Imprimir resumen",onClick:e[2]||(e[2]=a=>q("resumen"))}),o(d,{flat:"",color:"grey-4",icon:"print",label:"Imprimir detallado",onClick:e[3]||(e[3]=a=>q("detallado"))})]),o(d,{color:"primary",icon:"add",label:"Agregar movimiento manual",onClick:W})]),o(M,{flat:"",class:"bg-grey-9"},{default:n(()=>[o(C,null,{default:n(()=>[e[15]||(e[15]=s("div",{class:"text-h6"},"Movimientos",-1)),o(ge,{bordered:""},{default:n(()=>[(p(!0),A(B,null,ie(l.value.transactions,a=>(p(),h(R,{key:a.id},{default:n(()=>[o(T,null,{default:n(()=>[o(N,null,{default:n(()=>[g(u(H(a.type))+u(P(a)),1)]),_:2},1024),o(N,{caption:""},{default:n(()=>[g(u(a.notes||O(a))+" \xB7 $ "+u(parseFloat(a.amount).toFixed(2)),1)]),_:2},1024)]),_:2},1024),o(T,{side:""},{default:n(()=>[o(_e,{color:a.payment_method==="efectivo"?"green":"blue",size:"sm","text-color":"white"},{default:n(()=>[g(u(a.payment_method),1)]),_:2},1032,["color"]),a.type==="manual"?(p(),h(d,{key:0,flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:_=>Y(a.id)},null,8,["onClick"])):V("",!0)]),_:2},1024)]),_:2},1024))),128)),!l.value.transactions||!l.value.transactions.length?(p(),h(R,{key:0},{default:n(()=>[o(T,null,{default:n(()=>[...e[14]||(e[14]=[g("No hay movimientos este d\xEDa.",-1)])]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1})],64)):V("",!0)]),_:1}),s("div",{id:"corte-print-content",ref_key:"printContentRef",ref:z,class:"print-content-hidden","aria-hidden":"true"},null,512),o(ue,{modelValue:$.value,"onUpdate:modelValue":e[7]||(e[7]=a=>$.value=a)},{default:n(()=>[o(M,{class:"bg-grey-9 text-white",style:{"min-width":"320px"}},{default:n(()=>[o(C,null,{default:n(()=>[...e[16]||(e[16]=[s("div",{class:"text-h6"},"Agregar movimiento manual",-1)])]),_:1}),o(C,{class:"q-gutter-md"},{default:n(()=>[o(S,{modelValue:i.value.amount,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.amount=a),modelModifiers:{number:!0},type:"number",label:"Monto",outlined:"",dense:"",color:"white","bg-color":"grey-8",step:"0.01"},null,8,["modelValue"]),o(be,{modelValue:i.value.payment_method,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.payment_method=a),options:[{label:"Efectivo",value:"efectivo"},{label:"Tarjeta",value:"tarjeta"}],label:"Forma de pago","emit-value":"","map-options":"",outlined:"",dense:"",color:"white","bg-color":"grey-8"},null,8,["modelValue"]),o(S,{modelValue:i.value.notes,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.notes=a),label:"Concepto (opcional)",outlined:"",dense:"",color:"white","bg-color":"grey-8"},null,8,["modelValue"])]),_:1}),o(de,{align:"right"},{default:n(()=>[me(o(d,{flat:"",label:"Cancelar"},null,512),[[we]]),o(d,{color:"primary",label:"Registrar",onClick:X})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(ke)]),_:1}))}};var _t=Me(He,[["__scopeId","data-v-6863824e"]]);export{_t as default};
