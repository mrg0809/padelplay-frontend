import{r as g,x,y as S,o as h,z as I,A as f,s as y,d as s,B as u,D as i,a as v,e as k,E as L,t as R}from"./index.343c8145.js";import{Q as U}from"./QForm.4454f63e.js";import{Q}from"./QPage.c2a4954a.js";import{Q as V,a as W}from"./QLayout.cf8964e2.js";import{a as F}from"./api.c78da0f8.js";import{o as A}from"./auth.6e5020c6.js";import{u as G}from"./useMeta.e558bc2d.js";import{h as n}from"./haptics.9db298c0.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";import"./supabase.6e6ca5a2.js";import"./googleAuth.3a6adc77.js";const B={name:"LoginPage",setup(){G({title:"Iniciar Sesi\xF3n"});const _=g(""),a=g(""),r=g(null),o=g(!1),b=g(!1),w=g(!1),e=x(),T=S();return{email:_,password:a,error:r,googleLoading:o,appleLoading:b,showTraditionalLogin:w,login:async()=>{var l,c;r.value=null;try{await n.light();const t=await F.post("/auth/login",{email:_.value,password:a.value}),{access_token:p}=t.data;await y.setItem("token",p),await n.success();const P=p.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),m=JSON.parse(atob(P));T.setUserDataFromToken(p),console.log("User type from token:",m.user_type);const C=await y.getItem("redirectAfterLogin");if(C){await y.removeItem("redirectAfterLogin"),e.push(C);return}m.user_type==="superuser"?(console.log("Redirecting to superuser dashboard"),e.push("/dashboard/superuser")):m.user_type==="admin"?(console.log("Redirecting to admin dashboard"),e.push("/dashboard/admin")):m.user_type==="club"?(console.log("Redirecting to club dashboard"),e.push("/dashboard/club")):m.user_type==="association"?(console.log("Redirecting to association dashboard"),e.push("/association/dashboard")):(console.log("Redirecting to player dashboard"),e.push("/dashboard/player"))}catch(t){await n.error(),t.response&&t.response.data&&t.response.data.detail?r.value=t.response.data.detail:r.value="Ocurri\xF3 un error inesperado. Intenta de nuevo m\xE1s tarde.",console.error("Error al iniciar sesi\xF3n:",((c=(l=t.response)==null?void 0:l.data)==null?void 0:c.detail)||t.message)}},signInWithGoogle:async()=>{o.value=!0,r.value=null;try{await n.light();const l=await A.signInWithGoogle();if(l&&l.access_token){const{access_token:c}=l;await y.setItem("token",c),await n.success();const p=c.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),d=JSON.parse(atob(p));T.setUserDataFromToken(c),console.log("User type from token:",d.user_type),d.user_type==="superuser"?(console.log("Redirecting to superuser dashboard"),e.push("/dashboard/superuser")):d.user_type==="admin"?(console.log("Redirecting to admin dashboard"),e.push("/dashboard/admin")):d.user_type==="club"?(console.log("Redirecting to club dashboard"),e.push("/dashboard/club")):d.user_type==="association"?(console.log("Redirecting to association dashboard"),e.push("/association/dashboard")):(console.log("Redirecting to player dashboard"),e.push("/dashboard/player"))}}catch(l){await n.error(),r.value="Error al iniciar sesi\xF3n con Google",console.error("Google OAuth error:",l)}finally{o.value=!1}},signInWithApple:async()=>{b.value=!0,r.value=null;try{await n.light(),await A.signInWithApple()}catch(l){await n.error(),r.value="Apple OAuth no est\xE1 disponible a\xFAn. Pronto estar\xE1 habilitado.",console.error("Apple OAuth error:",l)}finally{b.value=!1}},goToSignup:()=>{e.push("/signup")},goToForgotPassword:()=>{e.push("/forgot-password")},goToTerms:()=>{e.push("/terms")},goToPrivacy:()=>{e.push("/privacy")}}}},N={class:"login-container"},D={class:"oauth-buttons"},E={key:0,class:"traditional-login-toggle"},q={key:1,class:"divider"},J={key:0,class:"error-message"},j={class:"login-links"},z={class:"legal-links"};function H(_,a,r,o,b,w){return h(),I(V,{view:"lHh Lpr lFf"},{default:f(()=>[s(W,null,{default:f(()=>[s(Q,{class:"login-page"},{default:f(()=>[u("div",N,[a[4]||(a[4]=u("img",{src:"/logo.jpeg",alt:"Logo",class:"login-logo"},null,-1)),u("div",D,[s(i,{onClick:o.signInWithGoogle,loading:o.googleLoading,class:"google-btn",icon:"img:/google-icon.svg",label:"Continuar con Google",color:"white","text-color":"black","no-caps":"",style:{"margin-bottom":"12px"}},null,8,["onClick","loading"]),s(i,{onClick:o.signInWithApple,loading:o.appleLoading,class:"apple-btn",icon:"img:/apple-icon.svg",label:"Continuar con Apple",color:"dark","text-color":"white","no-caps":"",style:{"margin-bottom":"20px"}},null,8,["onClick","loading"])]),o.showTraditionalLogin?k("",!0):(h(),v("div",E,[s(i,{flat:"",label:"Ingresar con email y contrase\xF1a",color:"white",class:"toggle-link",onClick:a[0]||(a[0]=e=>o.showTraditionalLogin=!0),"no-caps":""})])),o.showTraditionalLogin?(h(),v("div",q,[...a[3]||(a[3]=[u("span",{class:"divider-text"},"o",-1)])])):k("",!0),o.showTraditionalLogin?(h(),I(U,{key:2,onSubmit:o.login,class:"login-form"},{default:f(()=>[s(L,{outlined:"",dark:"",modelValue:o.email,"onUpdate:modelValue":a[1]||(a[1]=e=>o.email=e),label:"Correo electr\xF3nico",type:"email",class:"q-mb-md input-dark"},null,8,["modelValue"]),s(L,{outlined:"",dark:"",modelValue:o.password,"onUpdate:modelValue":a[2]||(a[2]=e=>o.password=e),label:"Contrase\xF1a",type:"password",class:"q-mb-md input-dark"},null,8,["modelValue"]),s(i,{label:"Iniciar sesi\xF3n",color:"white","text-color":"black",type:"submit",class:"login-btn"}),o.error?(h(),v("div",J,R(o.error),1)):k("",!0)]),_:1},8,["onSubmit"])):k("",!0),u("div",j,[s(i,{flat:"",label:"Crear una cuenta",color:"white",class:"login-link",onClick:o.goToSignup},null,8,["onClick"]),s(i,{flat:"",label:"Olvid\xE9 mi contrase\xF1a",color:"white",class:"login-link",onClick:o.goToForgotPassword},null,8,["onClick"]),u("div",z,[s(i,{flat:"",label:"T\xE9rminos y Condiciones",color:"white",class:"legal-link",onClick:o.goToTerms},null,8,["onClick"]),s(i,{flat:"",label:"Aviso de Privacidad",color:"white",class:"legal-link",onClick:o.goToPrivacy},null,8,["onClick"])])])])]),_:1})]),_:1})]),_:1})}var po=O(B,[["render",H],["__scopeId","data-v-be7eec4e"]]);export{po as default};
