import{r as S,j as x,E as me,b5 as be,O as fe,aD as _e,p as A,k as ye,bI as he,a$ as we,aW as Ce,aY as Fe,b0 as xe,bJ as ke,b1 as ne,bc as De,aX as Ve,aB as Se,F as Pe,B as Qe,a8 as Ie,q as y,G as T,H as r,v as l,I as F,ab as j,J as Y,s as U,ae as se,ac as G,ad as Z,a9 as qe,aa as ie,K as Ne,af as Ee,ag as ue,ah as ze,bC as de,x as E,y as Te}from"./index.58e85a5d.js";import{Q as je}from"./QHeader.8d5bfa86.js";import{Q as Ue,a as ae}from"./QTabs.f4771d80.js";import{Q as le,a as M}from"./QItem.e5e2bb84.js";import{Q as R}from"./QItemLabel.bea571b7.js";import{Q as oe}from"./QList.b81aac75.js";import{a as Ae,Q as re}from"./QTabPanel.c86571d1.js";import{Q as pe}from"./QChip.8c885d9a.js";import{Q as Be}from"./QPage.a530dec3.js";import{Q as Oe,a as Le}from"./QLayout.09e0bdd8.js";import{h as Me}from"./format.de7e9769.js";import{C as ce}from"./ClosePopup.bedc150c.js";import{s as z}from"./supabase.29bebebf.js";import{n as Re}from"./navigationUtils.2c4b9dee.js";import{u as We}from"./userStore.28068154.js";import{a as $}from"./api.2af71db3.js";import{C as He}from"./ClubNavigationMenu.98167ba1.js";import{_ as Ke}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.d672a550.js";import"./use-render-cache.770e5fe8.js";import"./selection.8f8b987b.js";import"./pinia.1bc53ecb.js";import"./QFooter.152aacf6.js";function W(t,o,P,s){const m=[];return t.forEach(f=>{s(f)===!0?m.push(f):o.push({failedPropValidation:P,file:f})}),m}function ee(t){t&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),fe(t)}const Xe={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ye=["rejected"];function Je({editable:t,dnd:o,getFileInput:P,addFilesToQueue:s}){const{props:m,emit:f,proxy:h}=me(),a=S(null),Q=x(()=>m.accept!==void 0?m.accept.split(",").map(e=>(e=e.trim(),e==="*"?"*/":(e.endsWith("/*")&&(e=e.slice(0,e.length-1)),e.toUpperCase()))):null),I=x(()=>parseInt(m.maxFiles,10)),B=x(()=>parseInt(m.maxTotalSize,10));function O(e){if(t.value)if(e!==Object(e)&&(e={target:null}),e.target!==null&&e.target.matches('input[type="file"]')===!0)e.clientX===0&&e.clientY===0&&be(e);else{const u=P();u&&u!==e.target&&u.click(e)}}function L(e){t.value&&e&&s(null,e)}function H(e,u,w,b){let n=Array.from(u||e.target.files);const v=[],_=()=>{v.length!==0&&f("rejected",v)};if(m.accept!==void 0&&Q.value.indexOf("*/")===-1&&(n=W(n,v,"accept",d=>Q.value.some(g=>d.type.toUpperCase().startsWith(g)||d.name.toUpperCase().endsWith(g))),n.length===0))return _();if(m.maxFileSize!==void 0){const d=parseInt(m.maxFileSize,10);if(n=W(n,v,"max-file-size",g=>g.size<=d),n.length===0)return _()}if(m.multiple!==!0&&n.length!==0&&(n=[n[0]]),n.forEach(d=>{d.__key=d.webkitRelativePath+d.lastModified+d.name+d.size}),b===!0){const d=w.map(g=>g.__key);n=W(n,v,"duplicate",g=>d.includes(g.__key)===!1)}if(n.length===0)return _();if(m.maxTotalSize!==void 0){let d=b===!0?w.reduce((g,q)=>g+q.size,0):0;if(n=W(n,v,"max-total-size",g=>(d+=g.size,d<=B.value)),n.length===0)return _()}if(typeof m.filter=="function"){const d=m.filter(n);n=W(n,v,"filter",g=>d.includes(g))}if(m.maxFiles!==void 0){let d=b===!0?w.length:0;if(n=W(n,v,"max-files",()=>(d++,d<=I.value)),n.length===0)return _()}if(_(),n.length!==0)return n}function K(e){ee(e),o.value!==!0&&(o.value=!0)}function p(e){fe(e),(e.relatedTarget!==null||_e.is.safari!==!0?e.relatedTarget!==a.value:document.elementsFromPoint(e.clientX,e.clientY).includes(a.value)===!1)===!0&&(o.value=!1)}function X(e){ee(e);const u=e.dataTransfer.files;u.length!==0&&s(null,u),o.value=!1}function J(e){if(o.value===!0)return A("div",{ref:a,class:`q-${e}__dnd absolute-full`,onDragenter:ee,onDragover:ee,onDragleave:p,onDrop:X})}return Object.assign(h,{pickFiles:O,addFiles:L}),{pickFiles:O,addFiles:L,onDragover:K,onDragleave:p,processFiles:H,getDndNode:J,maxFilesNumber:I,maxTotalSizeNumber:B}}var Ge=ye({name:"QFile",inheritAttrs:!1,props:{...he,...we,...Xe,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Ce,...Ye],setup(t,{slots:o,emit:P,attrs:s}){const{proxy:m}=me(),f=Fe(),h=S(null),a=S(!1),Q=xe(t),{pickFiles:I,onDragover:B,onDragleave:O,processFiles:L,getDndNode:H}=Je({editable:f.editable,dnd:a,getFileInput:c,addFilesToQueue:D}),K=ke(t),p=x(()=>Object(t.modelValue)===t.modelValue?"length"in t.modelValue?Array.from(t.modelValue):[t.modelValue]:[]),X=x(()=>ne(p.value)),J=x(()=>p.value.map(i=>i.name).join(", ")),e=x(()=>Me(p.value.reduce((i,C)=>i+C.size,0))),u=x(()=>({totalSize:e.value,filesNumber:p.value.length,maxFiles:t.maxFiles})),w=x(()=>({tabindex:-1,type:"file",title:"",accept:t.accept,capture:t.capture,name:Q.value,...s,id:f.targetUid.value,disabled:f.editable.value!==!0})),b=x(()=>"q-file q-field--auto-height"+(a.value===!0?" q-file--dnd":"")),n=x(()=>t.multiple===!0&&t.append===!0);function v(i){const C=p.value.slice();C.splice(i,1),d(C)}function _(i){const C=p.value.indexOf(i);C!==-1&&v(C)}function d(i){P("update:modelValue",t.multiple===!0?i:i[0])}function g(i){i.keyCode===13&&Se(i)}function q(i){(i.keyCode===13||i.keyCode===32)&&I(i)}function c(){return h.value}function D(i,C){const V=L(i,C,p.value,n.value),te=c();te!=null&&(te.value=""),V!==void 0&&((t.multiple===!0?t.modelValue&&V.every(ve=>p.value.includes(ve)):t.modelValue===V[0])||d(n.value===!0?p.value.concat(V):V))}function k(){return[A("input",{class:[t.inputClass,"q-file__filler"],style:t.inputStyle})]}function N(){if(o.file!==void 0)return p.value.length===0?k():p.value.map((C,V)=>o.file({index:V,file:C,ref:this}));if(o.selected!==void 0)return p.value.length===0?k():o.selected({files:p.value,ref:this});if(t.useChips===!0)return p.value.length===0?k():p.value.map((C,V)=>A(pe,{key:"file-"+V,removable:f.editable.value,dense:!0,textColor:t.color,tabindex:t.tabindex,onRemove:()=>{v(V)}},()=>A("span",{class:"ellipsis",textContent:C.name})));const i=t.displayValue!==void 0?t.displayValue:J.value;return i.length!==0?[A("div",{class:t.inputClass,style:t.inputStyle,textContent:i})]:k()}function ge(){const i={ref:h,...w.value,...K.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:D};return t.multiple===!0&&(i.multiple=!0),A("input",i)}return Object.assign(f,{fieldClass:b,emitValue:d,hasValue:X,inputRef:h,innerValue:p,floatingLabel:x(()=>X.value===!0||ne(t.displayValue)),computedCounter:x(()=>{if(t.counterLabel!==void 0)return t.counterLabel(u.value);const i=t.maxFiles;return`${p.value.length}${i!==void 0?" / "+i:""} (${e.value})`}),getControlChild:()=>H("file"),getControl:()=>{const i={ref:f.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:t.tabindex};return f.editable.value===!0&&Object.assign(i,{onDragover:B,onDragleave:O,onKeydown:g,onKeyup:q}),A("div",i,[ge()].concat(N()))}}),Object.assign(m,{removeAtIndex:v,removeFile:_,getNativeElement:()=>h.value}),De(m,"nativeEl",()=>h.value),Ve(f)}});const Ze={name:"ClubCommunity",components:{ClubNavigationMenu:He},setup(){const t=Pe(),o=S("followed"),P=S([]),s=S([]),m=S([]),f=We(),h=S(""),a=S(null),Q=S(!1),I={like:"\u{1F44D}",love:"\u2764\uFE0F",laugh:"\u{1F602}",wow:"\u{1F62E}",sad:"\u{1F622}",angry:"\u{1F621}"},B=async()=>{try{const{data:e,error:u}=await z.from("follows").select("followed_id").eq("follower_id",f.userId);if(u)throw u;const w=e.map(c=>c.followed_id),{data:b,error:n}=await z.from("profiles").select("id, full_name, user_type, club_id").in("id",w);if(n)throw n;const{data:v,error:_}=await z.from("players").select("user_id, photo_url").in("user_id",w);if(_)throw _;const d=b.filter(c=>c.user_type==="club").map(c=>c.club_id),{data:g,error:q}=await z.from("clubs").select("id, logo_url").in("id",d);if(q)throw q;P.value=b.map(c=>{const D=v.find(N=>N.user_id===c.id),k=g.find(N=>N.id===c.club_id);return{id:c.id,name:c.full_name,photo_url:c.user_type==="player"?D==null?void 0:D.photo_url:(k==null?void 0:k.logo_url)||"default-avatar.png",type:c.user_type}})}catch(e){console.error("Error al obtener usuarios seguidos:",e)}},O=async()=>{try{const{data:e,error:u}=await z.from("follows").select("follower_id").eq("followed_id",f.userId);if(u)throw u;const w=e.map(c=>c.follower_id),{data:b,error:n}=await z.from("profiles").select("id, full_name, user_type, club_id").in("id",w);if(n)throw n;const{data:v,error:_}=await z.from("players").select("user_id, photo_url").in("user_id",w);if(_)throw _;const d=b.filter(c=>c.user_type==="club").map(c=>c.club_id),{data:g,error:q}=await z.from("clubs").select("id, logo_url").in("id",d);if(q)throw q;s.value=b.map(c=>{const D=v.find(N=>N.user_id===c.id),k=g.find(N=>N.id===c.club_id);return{id:c.id,name:c.full_name,photo_url:c.user_type==="player"?D==null?void 0:D.photo_url:(k==null?void 0:k.logo_url)||"default-avatar.png",type:c.user_type}})}catch(e){console.error("Error al obtener seguidores:",e)}},L=async()=>{try{const e=await $.get(`community/posts/club/${f.clubId}`);console.log("Datos recibidos:",e.data),m.value=e.data.posts}catch(e){console.error("Error al obtener posts:",e)}},H=async()=>{try{let e=null;const u=await $.post("/community/posts",{club_id:f.clubId,content:h.value});console.log(u.data.data[0].id);const w=u.data.data[0].id;if(a.value){const b=new FormData;b.append("file",a.value);const n=await $.post(`/community/posts/upload-media?post_id=${w}`,b,{headers:{"Content-Type":"multipart/form-data"}})}m.value.unshift(u.data),h.value="",a.value=null}catch(e){console.error("Error al crear post:",e)}},K=async e=>{try{await $.delete(`community/posts/${e}`,{data:{club_id:f.clubId}}),m.value=m.value.filter(u=>u.id!==e)}catch(u){console.error("Error al eliminar post:",u)}},p=e=>{if(!e)return"Fecha no disponible";const u=new Date(e);return isNaN(u.getTime())?"Fecha no disponible":u.toLocaleString()};return Qe(()=>{B(),O(),L()}),{tab:o,followedUsers:P,followers:s,posts:m,newPostContent:h,showCreatePostDialog:Q,createPost:H,deletePost:K,formatDate:p,goBack:()=>{t.back()},reactionEmojis:I,newPostMedia:a,goToDashboard:()=>{Re(t,f)}}}},$e={class:"header-content"},et={class:"greeting"},tt={class:"header-icons"},at={key:0,class:"text-center q-pa-md"},lt=["src"],ot={key:0,class:"text-center q-pa-md"},rt=["src"],nt={class:"text-center q-pa-md"},st={key:0,class:"q-mt-sm"},it=["src"],ut={class:"q-mt-sm"};function dt(t,o,P,s,m,f){const h=Ie("ClubNavigationMenu");return y(),T(Oe,{view:"hHh lpR fFf",class:"body text-white"},{default:r(()=>[l(je,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[F("div",$e,[F("div",et,[F("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:o[0]||(o[0]=(...a)=>s.goToDashboard&&s.goToDashboard(...a))}),o[7]||(o[7]=j(" Comunidad del Club "))]),F("div",tt,[l(Y,{flat:"",round:"",icon:"arrow_back",onClick:s.goBack},null,8,["onClick"])])])]),_:1}),l(Le,null,{default:r(()=>[l(Be,{class:"q-pa-md"},{default:r(()=>[l(Ue,{modelValue:s.tab,"onUpdate:modelValue":o[1]||(o[1]=a=>s.tab=a),align:"justify",class:"text-white"},{default:r(()=>[l(ae,{name:"followed",label:"Seguidos"}),l(ae,{name:"followers",label:"Seguidores"}),l(ae,{name:"wall",label:"Wall"})]),_:1},8,["modelValue"]),l(Ae,{modelValue:s.tab,"onUpdate:modelValue":o[3]||(o[3]=a=>s.tab=a),animated:"",class:"transparent-card q-mt-md"},{default:r(()=>[l(re,{name:"followed"},{default:r(()=>[s.followedUsers.length===0?(y(),U("div",at,[l(se,{name:"people",size:"2em"}),o[8]||(o[8]=F("p",{class:"q-mt-sm"},"No sigues a ning\xFAn usuario todav\xEDa.",-1))])):(y(),T(oe,{key:1,bordered:""},{default:r(()=>[(y(!0),U(Z,null,G(s.followedUsers,a=>(y(),T(le,{key:a.id,class:"q-mb-sm"},{default:r(()=>[l(M,{avatar:""},{default:r(()=>[l(de,null,{default:r(()=>[F("img",{src:a.photo_url||"default-avatar.png"},null,8,lt)]),_:2},1024)]),_:2},1024),l(M,null,{default:r(()=>[l(R,null,{default:r(()=>[j(E(a.name),1)]),_:2},1024),l(R,{caption:""},{default:r(()=>[j(E(a.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),l(re,{name:"followers"},{default:r(()=>[s.followers.length===0?(y(),U("div",ot,[l(se,{name:"people",size:"2em"}),o[9]||(o[9]=F("p",{class:"q-mt-sm"},"No tienes seguidores todav\xEDa.",-1))])):(y(),T(oe,{key:1,bordered:""},{default:r(()=>[(y(!0),U(Z,null,G(s.followers,a=>(y(),T(le,{key:a.id,class:"q-mb-sm"},{default:r(()=>[l(M,{avatar:""},{default:r(()=>[l(de,null,{default:r(()=>[F("img",{src:a.photo_url||"default-avatar.png"},null,8,rt)]),_:2},1024)]),_:2},1024),l(M,null,{default:r(()=>[l(R,null,{default:r(()=>[j(E(a.name),1)]),_:2},1024),l(R,{caption:""},{default:r(()=>[j(E(a.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),l(re,{name:"wall"},{default:r(()=>[F("div",nt,[l(Y,{icon:"add",color:"black",class:"q-mb-xl fixed-bottom-right",size:"lg",glossy:"",round:"",onClick:o[2]||(o[2]=a=>s.showCreatePostDialog=!0)})]),l(oe,{bordered:"",class:"q-mt-md"},{default:r(()=>[(y(!0),U(Z,null,G(s.posts,a=>(y(),T(le,{key:a.id,class:"q-mb-sm"},{default:r(()=>[l(M,null,{default:r(()=>[l(R,null,{default:r(()=>[j(E(a.content),1)]),_:2},1024),l(R,{caption:""},{default:r(()=>[j(E(s.formatDate(a.created_at)),1)]),_:2},1024),a.media_url?(y(),U("div",st,[F("img",{src:a.media_url,style:{"max-width":"100%","border-radius":"8px"},alt:"Imagen del post"},null,8,it)])):Te("",!0),F("div",ut,[(y(!0),U(Z,null,G(a.reactions,(Q,I)=>(y(),T(pe,{color:"transparent",key:I},{default:r(()=>[F("span",null,E(s.reactionEmojis[I])+" "+E(Q),1)]),_:2},1024))),128))])]),_:2},1024),l(M,{side:""},{default:r(()=>[l(Y,{flat:"",icon:"delete",color:"negative",onClick:Q=>s.deletePost(a.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(ze,{modelValue:s.showCreatePostDialog,"onUpdate:modelValue":o[6]||(o[6]=a=>s.showCreatePostDialog=a)},{default:r(()=>[l(qe,{class:"q-pa-md bg-black",style:{"min-width":"300px"}},{default:r(()=>[l(ie,null,{default:r(()=>o[10]||(o[10]=[F("div",{class:"text-h6"},"Nuevo Post",-1)])),_:1}),l(ie,null,{default:r(()=>[l(Ne,{modelValue:s.newPostContent,"onUpdate:modelValue":o[4]||(o[4]=a=>s.newPostContent=a),type:"textarea",label:"Escribe tu post",autogrow:""},null,8,["modelValue"]),l(Ge,{modelValue:s.newPostMedia,"onUpdate:modelValue":o[5]||(o[5]=a=>s.newPostMedia=a),label:"Subir imagen o video",accept:"image/*, video/*",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),l(Ee,{align:"right"},{default:r(()=>[ue(l(Y,{flat:"",label:"Cancelar",color:"negative"},null,512),[[ce]]),ue(l(Y,{flat:"",label:"Publicar",color:"green",onClick:s.createPost},null,8,["onClick"]),[[ce]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(h)]),_:1})}var zt=Ke(Ze,[["render",dt],["__scopeId","data-v-5303ab14"]]);export{zt as default};
