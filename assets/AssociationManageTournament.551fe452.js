import{Q as R}from"./QHeader.289f0645.js";import{a5 as D,x as H,f as U,r as u,a0 as G,h as j,a6 as M,o as c,z as _,A as o,d as t,B as r,t as l,a7 as b,a8 as y,Q as J,a as w,e as A,ad as E,D as x,a9 as B,ab as N,aa as K,E as z,ae as O,af as W}from"./index.687b44e8.js";import{Q as S}from"./QItemLabel.bbebea39.js";import{Q as X,a as F}from"./QItem.eb9291fb.js";import{Q as Y}from"./QList.1288e946.js";import{Q as Z}from"./QPage.fcc9aae1.js";import{Q as $,a as aa}from"./QLayout.30990248.js";import{C as ta}from"./ClosePopup.89fae5e1.js";import{u as ea}from"./use-quasar.ba375293.js";import{A as oa,a as na}from"./AssociationTopMenu.c2c9d0dc.js";import{N as sa}from"./NotificationBell.9fdba392.js";import{B as ia}from"./BannerPromoScrolling.1700e538.js";import{f as la,h as ra,i as ca,j as da}from"./association.b92d73c6.js";import{_ as ma}from"./plugin-vue_export-helper.21dcd24c.js";import"./QTabs.979bee57.js";import"./rtl.276c3f1b.js";import"./QFooter.b7b22f15.js";import"./QBtnDropdown.17175f2e.js";import"./QBtnGroup.6b9d07ee.js";import"./QMenu.df8dfc7c.js";import"./position-engine.46674690.js";import"./selection.0f785986.js";import"./haptics.57409bd0.js";import"./QBadge.0c3a126f.js";import"./api.1c42dce4.js";const ua={name:"AssociationManageTournament",components:{AssociationNavigationMenu:oa,AssociationTopMenu:na,NotificationBell:sa,BannerPromoScrolling:ia},setup(){const f=ea(),n=D(),T=H(),a=U(()=>n.params.id),k=u(null),Q=u([]),h=u(!0),g=u(!1),p=u(!1),v=u(!1),e=u(null),d=G({match_date:"",match_time:""}),P=()=>T.push("/association/torneos"),C=async()=>{if(!!a.value){h.value=!0;try{const[i,m]=await Promise.all([la(a.value),ra(a.value)]);k.value=i.data,Q.value=(m.matches||[]).map(s=>{var V;return{...s,id:s.id,team1:s.team1||"\u2014",team2:s.team2||"\u2014",match_date:s.match_date,match_time:typeof s.match_time=="string"?(V=s.match_time)==null?void 0:V.slice(0,5):s.match_time}})}catch(i){console.error(i),f.notify({type:"negative",message:"Error al cargar"})}finally{h.value=!1}}},q=i=>{e.value=i.id,d.match_date=i.match_date||"",d.match_time=i.match_time||"",v.value=!0},I=async()=>{var i,m;if(!!e.value){p.value=!0;try{await ca(a.value,e.value,{match_date:d.match_date,match_time:d.match_time}),f.notify({type:"positive",message:"Partido actualizado"}),v.value=!1,C()}catch(s){f.notify({type:"negative",message:((m=(i=s.response)==null?void 0:i.data)==null?void 0:m.detail)||"Error al guardar"})}finally{p.value=!1}}},L=async()=>{var i,m;g.value=!0;try{const s=await da(a.value);f.notify({type:"positive",message:s.message||"Torneo finalizado"}),C()}catch(s){f.notify({type:"negative",message:((m=(i=s.response)==null?void 0:i.data)==null?void 0:m.detail)||"Error al finalizar"})}finally{g.value=!1}};return j(C),{tournament:k,matches:Q,loading:h,finalizing:g,savingMatch:p,showEditMatch:v,editMatchForm:d,goBack:P,openEditMatch:q,saveMatchSchedule:I,finalizeTournament:L}}},fa={class:"header-content"},_a={class:"greeting"},ha={class:"text-subtitle1"},ga={class:"header-icons"},pa={class:"text-h6"},va={class:"text-caption"},ya={key:0,class:"text-caption"},Ma={class:"text-caption"};function ba(f,n,T,a,k,Q){const h=M("NotificationBell"),g=M("AssociationTopMenu"),p=M("BannerPromoScrolling"),v=M("AssociationNavigationMenu");return c(),_($,{view:"hHh lpR fFf",class:"text-white"},{default:o(()=>[t(R,{elevated:"",class:"text-white"},{default:o(()=>{var e;return[r("div",fa,[r("div",_a,[r("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:n[0]||(n[0]=(...d)=>a.goBack&&a.goBack(...d))}),r("span",ha,l(((e=a.tournament)==null?void 0:e.name)||"Torneo"),1)]),r("div",ga,[t(h),t(g)])]),t(p)]}),_:1}),t(aa,null,{default:o(()=>[t(Z,{class:"q-pa-md"},{default:o(()=>[a.loading?(c(),_(b,{key:0,flat:"",bordered:"",class:"bg-transparent text-white"},{default:o(()=>[t(y,{class:"text-center"},{default:o(()=>[t(J,{color:"primary",size:"40px"})]),_:1})]),_:1})):a.tournament?(c(),w(N,{key:1},[t(b,{flat:"",bordered:"",class:"q-mb-md bg-grey-9 text-white"},{default:o(()=>[t(y,null,{default:o(()=>{var e;return[r("div",pa,l(a.tournament.name),1),r("div",va,l(a.tournament.start_date)+" \xB7 "+l(a.tournament.system),1),a.tournament.league?(c(),w("div",ya,"Liga: "+l((e=a.tournament.league)==null?void 0:e.name),1)):A("",!0),r("div",Ma,"Estado: "+l(a.tournament.status==="closed"?"Cerrado":"Abierto"),1)]}),_:1}),a.tournament.status!=="closed"?(c(),_(E,{key:0},{default:o(()=>[t(x,{color:"primary",label:"Finalizar torneo",onClick:a.finalizeTournament,loading:a.finalizing},null,8,["onClick","loading"])]),_:1})):A("",!0)]),_:1}),n[5]||(n[5]=r("div",{class:"text-h6 q-mb-sm"},"Calendario de partidos",-1)),a.matches.length?(c(),_(Y,{key:1,bordered:"",class:"rounded-borders bg-transparent"},{default:o(()=>[(c(!0),w(N,null,K(a.matches,e=>(c(),_(X,{key:e.id,class:"q-mb-sm bg-grey-9"},{default:o(()=>[t(F,null,{default:o(()=>[t(S,null,{default:o(()=>[B(l(e.team1)+" vs "+l(e.team2),1)]),_:2},1024),t(S,{caption:""},{default:o(()=>[B(l(e.phase)+" \xB7 "+l(e.match_date)+" "+l(e.match_time),1)]),_:2},1024)]),_:2},1024),t(F,{side:""},{default:o(()=>[t(x,{flat:"",dense:"",icon:"edit",onClick:d=>a.openEditMatch(e)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(c(),_(b,{key:0,flat:"",bordered:"",class:"bg-grey-9 text-white"},{default:o(()=>[t(y,{class:"text-center text-grey"},{default:o(()=>[...n[4]||(n[4]=[B(" No hay partidos. Genera el calendario desde la vista de preview del torneo (misma l\xF3gica que club). ",-1)])]),_:1})]),_:1}))],64)):A("",!0)]),_:1})]),_:1}),t(v),t(W,{modelValue:a.showEditMatch,"onUpdate:modelValue":n[3]||(n[3]=e=>a.showEditMatch=e),persistent:""},{default:o(()=>[t(b,{class:"bg-grey-9 text-white",style:{"min-width":"300px"}},{default:o(()=>[t(y,null,{default:o(()=>[...n[6]||(n[6]=[r("div",{class:"text-h6"},"Editar fecha y hora",-1)])]),_:1}),t(y,{class:"q-gutter-md"},{default:o(()=>[t(z,{modelValue:a.editMatchForm.match_date,"onUpdate:modelValue":n[1]||(n[1]=e=>a.editMatchForm.match_date=e),label:"Fecha",type:"date",outlined:"",dark:"",dense:""},null,8,["modelValue"]),t(z,{modelValue:a.editMatchForm.match_time,"onUpdate:modelValue":n[2]||(n[2]=e=>a.editMatchForm.match_time=e),label:"Hora",type:"time",outlined:"",dark:"",dense:""},null,8,["modelValue"])]),_:1}),t(E,{align:"right"},{default:o(()=>[O(t(x,{flat:"",label:"Cancelar"},null,512),[[ta]]),t(x,{color:"primary",label:"Guardar",onClick:a.saveMatchSchedule,loading:a.savingMatch},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ka=ma(ua,[["render",ba],["__scopeId","data-v-e44ab598"]]);export{Ka as default};
