import{a5 as $,x as tt,y as et,r as h,f as V,h as st,a6 as G,o as l,z as y,A as i,d as r,B as t,D as at,a as d,a7 as q,a8 as T,t as n,a9 as m,e as _,aK as ot,ab as b,aa as x,ac as f,aP as Q,aW as nt}from"./index.687b44e8.js";import{Q as rt}from"./QHeader.289f0645.js";import{Q as lt}from"./QSpinnerDots.ed8017b0.js";import{Q as it,a as M}from"./QTabs.979bee57.js";import{Q as P}from"./QBadge.0c3a126f.js";import{a as ct,Q as N}from"./QTabPanel.d4470d6c.js";import{Q as F}from"./QMarkupTable.41f62a4b.js";import{Q as dt}from"./QPage.fcc9aae1.js";import{Q as mt,a as ut}from"./QLayout.30990248.js";import{u as _t}from"./use-quasar.ba375293.js";import{n as gt}from"./navigationUtils.2c4b9dee.js";import{s as L}from"./supabase.66aa98e2.js";import{a as R}from"./api.1c42dce4.js";import{P as pt}from"./PlayerNavigationMenu.1a7d2e68.js";import{N as yt}from"./NotificationBell.9fdba392.js";import{B as ft}from"./BannerPromoScrolling.1700e538.js";import{D as ht}from"./DesktopNavigation.642093f4.js";import{g as vt}from"./tournamentUtils.e8e65a8c.js";import{_ as kt}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.33109fa4.js";import"./touch.9135741d.js";import"./selection.0f785986.js";import"./use-render-cache.3aae9b27.js";import"./QFooter.b7b22f15.js";import"./QTooltip.a50ac131.js";import"./position-engine.46674690.js";const bt={name:"TournamentView",components:{PlayerNavigationMenu:pt,NotificationBell:yt,BannerPromoScrolling:ft,DesktopNavigation:ht},setup(){const w=$(),e=tt(),D=_t(),s=et(),S=h(null),I=h([]),z=h([]),B=h([]),v=h(null),C=h(null),a=h(!1),u=h("my-matches"),k=h(!1),g=V(()=>s.userId?I.value.filter(o=>o.team1_players.includes(s.userId)||o.team2_players.includes(s.userId)):[]),E=V(()=>{var o;return((o=S.value)==null?void 0:o.system)==="combinado"}),j=V(()=>{var c;const o=(c=S.value)==null?void 0:c.system;return o==="eliminacion directa"||o==="combinado"}),A=V(()=>!v.value||!v.value.rounds?[]:[...v.value.rounds].reverse()),O=(o,c,p)=>{const Z=Math.pow(2,o),J=60*Z;return{marginTop:c===0?`${J/2}px`:`${J}px`}};st(async()=>{await U(),await H(),await K(),await W(),E.value&&await X(),j.value&&await Y()});const U=async()=>{a.value=!0;try{const o=w.params.tournamentId,{data:c,error:p}=await L.from("tournaments").select("*").eq("id",o).single();if(p)throw p;S.value=c}catch(o){console.error("Error loading tournament:",o),D.notify({type:"negative",message:"Error al cargar el torneo"})}finally{a.value=!1}},H=async()=>{try{const o=w.params.tournamentId,{data:c,error:p}=await L.from("tournament_teams").select("id").eq("tournament_id",o).or(`player1_id.eq.${s.userId},player2_id.eq.${s.userId}`).single();!p&&c&&(C.value=c.id)}catch(o){console.error("Error loading my team:",o)}},K=async()=>{try{const o=w.params.tournamentId,c=await R.get(`/tournaments/${o}/matches`);I.value=c.data.matches}catch(o){console.error("Error loading matches:",o),D.notify({type:"negative",message:"Error al cargar los partidos"})}},W=async()=>{try{const o=w.params.tournamentId,c=await R.get(`/tournaments/${o}/standings`);z.value=c.data.standings,k.value=c.data.is_retas||!1}catch(o){console.error("Error loading standings:",o),D.notify({type:"negative",message:"Error al cargar las posiciones"})}},X=async()=>{try{const o=w.params.tournamentId,c=await R.get(`/tournaments/${o}/groups`);B.value=c.data.groups||[]}catch(o){console.error("Error loading groups:",o),B.value=[]}},Y=async()=>{try{const o=w.params.tournamentId,c=await R.get(`/tournaments/${o}/bracket`);v.value=c.data.bracket||null}catch(o){console.error("Error loading bracket:",o),v.value=null}};return{tournament:S,matches:I,myMatches:g,standings:z,groups:B,bracket:v,reversedBracket:A,loading:a,activeTab:u,isRetasTournament:k,hasGroups:E,hasBracket:j,getMatchSpacing:O,getSystemName:o=>vt(o),formatDate:o=>{const c=new Date(o),p={year:"numeric",month:"long",day:"numeric"};return c.toLocaleDateString("es-ES",p)},formatScore:o=>{if(!o)return"Sin resultado";try{const c=typeof o=="string"?JSON.parse(o):o;let p=[];return c.set1&&p.push(`${c.set1.team1}-${c.set1.team2}`),c.set2&&p.push(`${c.set2.team1}-${c.set2.team2}`),c.set3&&p.push(`${c.set3.team1}-${c.set3.team2}`),p.join(", ")}catch{return"Error en formato"}},isMyTeam:o=>o===C.value,goBack:()=>{e.back()},goToDashboard:()=>{gt(e,s)}}}},xt={class:"header-content"},wt={class:"greeting"},qt={class:"header-icons"},Tt={key:0,class:"text-center q-mt-md"},Pt={key:1},St={class:"q-mt-none"},Bt={class:"row q-gutter-md"},Qt={class:"col"},Mt={class:"col"},Nt={class:"matches-list"},Dt={class:"match-header"},It={class:"q-my-none"},zt={class:"text-caption q-mb-none"},Ct={class:"text-caption q-mb-none"},Et={key:0,class:"q-mt-md result-section"},Vt={key:1,class:"q-mt-md"},Gt={key:0,class:"text-center q-pa-xl"},Rt={class:"matches-list"},Ft={class:"match-header"},jt={class:"q-my-none"},Jt={class:"text-caption q-mb-none"},Lt={class:"text-caption q-mb-none"},At={key:0,class:"q-mt-md result-section"},Ot={key:1,class:"q-mt-md"},Ut={key:0,class:"text-center q-pa-xl"},Ht={class:"groups-view"},Kt={class:"q-mt-none"},Wt={class:"text-left"},Xt={class:"text-left"},Yt={class:"text-center"},Zt={class:"text-center"},$t={class:"text-center"},te={class:"text-center"},ee={key:0,class:"text-center q-pa-xl"},se={class:"bracket-view"},ae={key:0,class:"tournament-bracket"},oe={class:"bracket-wrapper"},ne={class:"round-title"},re={class:"matches-container"},le={class:"match-card"},ie={class:"team-name"},ce={key:0,class:"team-score"},de={class:"team-name"},me={key:0,class:"team-score"},ue={key:0,class:"connector-line"},_e={key:0,class:"winner-section"},ge={key:1,class:"text-center q-pa-xl"},pe={class:"text-left"},ye={class:"text-left"},fe={class:"text-center"},he={class:"text-center"},ve={class:"text-center"},ke={class:"text-center"},be={class:"text-left"},xe={class:"text-left"},we={class:"text-center"},qe={class:"text-center"},Te={class:"text-center"},Pe={class:"text-center"},Se={key:2,class:"text-center q-pa-xl"};function Be(w,e,D,s,S,I){const z=G("NotificationBell"),B=G("BannerPromoScrolling"),v=G("DesktopNavigation"),C=G("PlayerNavigationMenu");return l(),y(mt,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:i(()=>[r(rt,{elevated:"",class:"text-white"},{default:i(()=>[t("div",xt,[t("div",wt,[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...a)=>s.goToDashboard&&s.goToDashboard(...a))})]),t("div",qt,[r(z),r(at,{flat:"",round:"",icon:"arrow_back",onClick:s.goBack},null,8,["onClick"])])]),r(B)]),_:1}),r(v),r(ut,null,{default:i(()=>[r(dt,{class:"q-pa-md"},{default:i(()=>[s.loading?(l(),d("div",Tt,[r(lt,{color:"primary",size:"xl"}),e[3]||(e[3]=t("p",null,"Cargando informaci\xF3n del torneo...",-1))])):s.tournament?(l(),d("div",Pt,[r(q,{class:"q-mb-md transparent-card"},{default:i(()=>[r(T,null,{default:i(()=>[t("h4",St,n(s.tournament.name),1),t("div",Bt,[t("div",Qt,[t("p",null,[e[4]||(e[4]=t("strong",null,"Sistema:",-1)),m(" "+n(s.getSystemName(s.tournament.system)),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"Categor\xEDa:",-1)),m(" "+n(s.tournament.category),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"G\xE9nero:",-1)),m(" "+n(s.tournament.gender),1)])]),t("div",Mt,[t("p",null,[e[7]||(e[7]=t("strong",null,"Fecha Inicio:",-1)),m(" "+n(s.tournament.start_date),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Fecha Fin:",-1)),m(" "+n(s.tournament.end_date),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Premio:",-1)),m(" "+n(s.tournament.prize),1)])])])]),_:1})]),_:1}),r(it,{modelValue:s.activeTab,"onUpdate:modelValue":e[1]||(e[1]=a=>s.activeTab=a),dense:"",class:"text-white","active-color":"primary","indicator-color":"primary",align:"justify"},{default:i(()=>[r(M,{name:"my-matches",label:"Mis Partidos",icon:"calendar_today"}),r(M,{name:"all-matches",label:"Calendario",icon:"sports_tennis"}),s.hasGroups?(l(),y(M,{key:0,name:"groups",label:"Grupos",icon:"group_work"})):_("",!0),s.hasBracket?(l(),y(M,{key:1,name:"bracket",label:"Bracket",icon:"account_tree"})):_("",!0),r(M,{name:"standings",label:"Posiciones",icon:"emoji_events"})]),_:1},8,["modelValue"]),r(ot),r(ct,{modelValue:s.activeTab,"onUpdate:modelValue":e[2]||(e[2]=a=>s.activeTab=a),animated:"",class:"transparent-bg"},{default:i(()=>[r(N,{name:"my-matches"},{default:i(()=>[t("div",Nt,[(l(!0),d(b,null,x(s.myMatches,a=>(l(),y(q,{key:a.id,class:"q-mb-md transparent-card"},{default:i(()=>[r(T,null,{default:i(()=>[t("div",Dt,[t("h6",It,n(a.team1)+" vs "+n(a.team2),1),t("p",zt,[r(f,{name:"event",size:"xs"}),m(" "+n(s.formatDate(a.match_date))+" - "+n(a.match_time.substring(0,5)),1)]),t("p",Ct,[r(f,{name:"place",size:"xs"}),m(" Cancha: "+n(a.court_name),1)])]),a.has_result?(l(),d("div",Et,[r(P,{color:"green",class:"q-mb-sm"},{default:i(()=>[...e[10]||(e[10]=[m("Finalizado",-1)])]),_:1}),t("p",null,[e[11]||(e[11]=t("strong",null,"Resultado:",-1)),m(" "+n(s.formatScore(a.score)),1)])])):(l(),d("div",Vt,[r(P,{color:"orange"},{default:i(()=>[...e[12]||(e[12]=[m("Pendiente",-1)])]),_:1})]))]),_:2},1024)]),_:2},1024))),128)),s.myMatches.length===0?(l(),d("div",Gt,[r(f,{name:"info",size:"3em",color:"grey"}),e[13]||(e[13]=t("p",null,"No tienes partidos programados",-1))])):_("",!0)])]),_:1}),r(N,{name:"all-matches"},{default:i(()=>[t("div",Rt,[(l(!0),d(b,null,x(s.matches,a=>(l(),y(q,{key:a.id,class:"q-mb-md transparent-card"},{default:i(()=>[r(T,null,{default:i(()=>[t("div",Ft,[t("h6",jt,n(a.team1)+" vs "+n(a.team2),1),t("p",Jt,[r(f,{name:"event",size:"xs"}),m(" "+n(s.formatDate(a.match_date))+" - "+n(a.match_time.substring(0,5)),1)]),t("p",Lt,[r(f,{name:"place",size:"xs"}),m(" Cancha: "+n(a.court_name),1)])]),a.has_result?(l(),d("div",At,[r(P,{color:"green",class:"q-mb-sm"},{default:i(()=>[...e[14]||(e[14]=[m("Finalizado",-1)])]),_:1}),t("p",null,[e[15]||(e[15]=t("strong",null,"Resultado:",-1)),m(" "+n(s.formatScore(a.score)),1)])])):(l(),d("div",Ot,[r(P,{color:"orange"},{default:i(()=>[...e[16]||(e[16]=[m("Pendiente",-1)])]),_:1})]))]),_:2},1024)]),_:2},1024))),128)),s.matches.length===0?(l(),d("div",Ut,[r(f,{name:"info",size:"3em",color:"grey"}),e[17]||(e[17]=t("p",null,"No hay partidos programados",-1))])):_("",!0)])]),_:1}),s.hasGroups?(l(),y(N,{key:0,name:"groups"},{default:i(()=>[t("div",Ht,[(l(!0),d(b,null,x(s.groups,a=>(l(),y(q,{key:a.name,class:"q-mb-md transparent-card"},{default:i(()=>[r(T,null,{default:i(()=>[t("h6",Kt,"Grupo "+n(a.name),1),r(F,{flat:"",bordered:"",class:"standings-table"},{default:i(()=>[e[19]||(e[19]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Equipo"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"Pts")])],-1)),t("tbody",null,[(l(!0),d(b,null,x(a.teams,(u,k)=>(l(),d("tr",{key:u.team_id,class:Q({"my-team":s.isMyTeam(u.team_id)})},[t("td",Wt,n(k+1),1),t("td",Xt,[m(n(u.team_name)+" ",1),s.isMyTeam(u.team_id)?(l(),y(P,{key:0,color:"primary",class:"q-ml-sm"},{default:i(()=>[...e[18]||(e[18]=[m(" Mi equipo ",-1)])]),_:1})):_("",!0)]),t("td",Yt,n(u.matches_played),1),t("td",Zt,n(u.wins),1),t("td",$t,n(u.losses),1),t("td",te,[t("strong",null,n(u.total_points),1)])],2))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),s.groups.length===0?(l(),d("div",ee,[r(f,{name:"info",size:"3em",color:"grey"}),e[20]||(e[20]=t("p",null,"No hay grupos configurados a\xFAn",-1))])):_("",!0)])]),_:1})):_("",!0),s.hasBracket?(l(),y(N,{key:1,name:"bracket"},{default:i(()=>[t("div",se,[r(q,{class:"transparent-card"},{default:i(()=>[r(T,null,{default:i(()=>{var a;return[e[23]||(e[23]=t("h6",{class:"q-mt-none"},"Cuadro de Eliminaci\xF3n",-1)),s.bracket&&s.bracket.rounds&&s.bracket.rounds.length>0?(l(),d("div",ae,[t("div",oe,[(l(!0),d(b,null,x(s.reversedBracket,(u,k)=>(l(),d("div",{key:k,class:"bracket-column"},[t("h6",ne,n(u.name),1),t("div",re,[(l(!0),d(b,null,x(u.matches,(g,E)=>(l(),d("div",{key:g.id,class:"bracket-matchup",style:nt(s.getMatchSpacing(k,E,u.matches.length))},[t("div",le,[t("div",{class:Q(["team-slot",{"winner-slot":g.winner===1,"has-score":g.score1}])},[t("span",ie,n(g.team1||"TBD"),1),g.score1?(l(),d("span",ce,n(g.score1),1)):_("",!0)],2),t("div",{class:Q(["team-slot",{"winner-slot":g.winner===2,"has-score":g.score2}])},[t("span",de,n(g.team2||"TBD"),1),g.score2?(l(),d("span",me,n(g.score2),1)):_("",!0)],2)]),k<s.reversedBracket.length-1?(l(),d("div",ue)):_("",!0)],4))),128))])]))),128))]),s.bracket.rounds.length>0&&((a=s.bracket.rounds[0].matches[0])==null?void 0:a.winner)?(l(),d("div",_e,[r(f,{name:"emoji_events",size:"4em",color:"yellow"}),e[21]||(e[21]=t("h5",{class:"winner-text"},"GANADOR",-1))])):_("",!0)])):(l(),d("div",ge,[r(f,{name:"info",size:"3em",color:"grey"}),e[22]||(e[22]=t("p",null,"El cuadro de eliminaci\xF3n no est\xE1 disponible a\xFAn",-1))]))]}),_:1})]),_:1})])]),_:1})):_("",!0),r(N,{name:"standings"},{default:i(()=>[r(q,{class:"transparent-card"},{default:i(()=>[r(T,null,{default:i(()=>[e[28]||(e[28]=t("h6",{class:"q-mt-none"},"Tabla de Posiciones",-1)),s.isRetasTournament?(l(),y(F,{key:0,flat:"",bordered:"",class:"standings-table"},{default:i(()=>[e[24]||(e[24]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Jugador"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"% Victorias")])],-1)),t("tbody",null,[(l(!0),d(b,null,x(s.standings,(a,u)=>(l(),d("tr",{key:a.team_id,class:Q({"my-team":s.isMyTeam(a.team_id)})},[t("td",pe,n(u+1),1),t("td",ye,n(a.team_name),1),t("td",fe,n(a.matches_played),1),t("td",he,n(a.wins),1),t("td",ve,n(a.losses),1),t("td",ke,[t("strong",null,n(a.win_percentage)+"%",1)])],2))),128))])]),_:1})):(l(),y(F,{key:1,flat:"",bordered:"",class:"standings-table"},{default:i(()=>[e[26]||(e[26]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Pos"),t("th",{class:"text-left"},"Equipo"),t("th",{class:"text-center"},"PJ"),t("th",{class:"text-center"},"PG"),t("th",{class:"text-center"},"PP"),t("th",{class:"text-center"},"Total Pts")])],-1)),t("tbody",null,[(l(!0),d(b,null,x(s.standings,(a,u)=>(l(),d("tr",{key:a.team_id,class:Q({"my-team":s.isMyTeam(a.team_id)})},[t("td",be,n(u+1),1),t("td",xe,[m(n(a.team_name)+" ",1),s.isMyTeam(a.team_id)?(l(),y(P,{key:0,color:"primary",class:"q-ml-sm"},{default:i(()=>[...e[25]||(e[25]=[m(" Mi equipo ",-1)])]),_:1})):_("",!0)]),t("td",we,n(a.matches_played),1),t("td",qe,n(a.wins),1),t("td",Te,n(a.losses),1),t("td",Pe,[t("strong",null,n(a.total_points),1)])],2))),128))])]),_:1})),s.standings.length===0?(l(),d("div",Se,[r(f,{name:"info",size:"3em",color:"grey"}),e[27]||(e[27]=t("p",null,"No hay resultados registrados a\xFAn",-1))])):_("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):_("",!0)]),_:1})]),_:1}),r(C)]),_:1})}var cs=kt(bt,[["render",Be],["__scopeId","data-v-f37c1a94"]]);export{cs as default};
