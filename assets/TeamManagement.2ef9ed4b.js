import{a9 as fe,F as ye,r as s,j as _e,w as he,B as be,q as r,G as c,H as l,v as e,I as n,ad as p,J as d,s as g,Q as ae,ab as Q,ac as m,bE as D,x as u,ah as N,af as M,ae as S,aj as R,K as j,ai as F,ag as ke,y as te,bF as xe,n as we,aS as Ce}from"./index.e2d2987d.js";import{Q as qe}from"./QHeader.749f252e.js";import{Q as H,a as E}from"./QItem.c17bbb38.js";import{Q as C}from"./QItemLabel.b0fb3886.js";import{Q as G}from"./QList.9a4b7eea.js";import{Q as Qe}from"./QSelect.859c1b99.js";import{Q as Ee}from"./QChip.d6f387bc.js";import{Q as Ve}from"./QSpace.c2c432dd.js";import{Q as Pe}from"./QPage.b49faddd.js";import{Q as $e,a as Te}from"./QLayout.1c0276b1.js";import{C as K}from"./ClosePopup.0806aac6.js";import{u as Me}from"./use-quasar.eb931551.js";import{a as b}from"./api.2af71db3.js";import{_ as Se}from"./plugin-vue_export-helper.21dcd24c.js";import"./QMenu.9fad4b76.js";import"./position-engine.e628ff15.js";import"./selection.17b22ee3.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const je={class:"header-content"},Ie={class:"header-icons"},Ue={key:0,class:"text-center q-pa-xl"},ze={key:1},Ae=["src"],Be={class:"col q-ml-md"},Je={class:"text-h5"},Le={class:"text-caption"},De={class:"row items-center justify-between"},Ne={class:"text-subtitle1 text-bold q-mb-sm"},Re={key:1,class:"q-mb-md"},Fe={key:1,class:"text-center text-grey q-pa-md"},He={class:"row q-gutter-sm"},Ge={key:2,class:"text-center q-pa-xl"},Ke={__name:"TeamManagement",setup(Oe){const le=fe(),oe=ye(),v=Me(),f=le.params.teamId,I=s(!1),U=s(!1),z=s(!1),A=s(!1),B=s(!1),y=s(null),O=s([]),J=s([]),k=s([]),x=s(""),q=s(""),V=s(!1),P=s(!1),$=s(!1),T=s(null),w=s({name:"",logo_url:""}),i=s({category:null,player_id:null,partner_id:null}),re=s(["tercera","cuarta","quinta","sexta","libre"]),se=_e(()=>{const o={};return O.value.forEach(a=>{const t=a.category;o[t]||(o[t]={name:t,players:[]}),o[t].players.push(a)}),Object.values(o)});he($,o=>{o&&W()}),be(async()=>{await X(),await L()});const X=async()=>{I.value=!0;try{const{data:o}=await b.get(`/padelite/teams/${f}`);y.value=o.data,w.value={name:y.value.name,logo_url:y.value.logo_url||""}}catch(o){console.error("Error fetching team:",o),v.notify({type:"negative",message:"Error al cargar equipo"})}finally{I.value=!1}},L=async()=>{U.value=!0;try{const{data:o}=await b.get(`/padelite/teams/${f}/players`);O.value=o.data||[]}catch(o){console.error("Error fetching players:",o)}finally{U.value=!1}},ne=async()=>{var o,a;z.value=!0;try{await b.put(`/padelite/teams/${f}`,w.value),v.notify({type:"positive",message:"Equipo actualizado exitosamente"}),V.value=!1,await X()}catch(t){console.error("Error updating team:",t),v.notify({type:"negative",message:((a=(o=t.response)==null?void 0:o.data)==null?void 0:a.detail)||"Error al actualizar equipo"})}finally{z.value=!1}},ie=async()=>{if(!x.value||x.value.length<2){k.value=[];return}try{const{data:o}=await b.get("/padelite/search/players",{params:{query:x.value}});k.value=o.data||[]}catch(o){console.error("Error searching players:",o)}},ue=o=>{i.value.player_id=o.id},de=o=>{const a=k.value.find(t=>t.id===o);return(a==null?void 0:a.full_name)||""},me=async()=>{var o,a;A.value=!0;try{const t={team_id:f,player_id:i.value.player_id,category:i.value.category,partner_id:i.value.partner_id};await b.post(`/padelite/teams/${f}/players`,t),v.notify({type:"positive",message:"Jugador agregado exitosamente"}),P.value=!1,i.value={category:null,player_id:null,partner_id:null},x.value="",k.value=[],await L()}catch(t){console.error("Error adding player:",t),v.notify({type:"negative",message:((a=(o=t.response)==null?void 0:o.data)==null?void 0:a.detail)||"Error al agregar jugador"})}finally{A.value=!1}},ce=o=>{var a;v.dialog({title:"Confirmar",message:`\xBFEst\xE1s seguro de eliminar a ${((a=o.profiles)==null?void 0:a.full_name)||"este jugador"} del equipo?`,cancel:!0,persistent:!0,dark:!0}).onOk(async()=>{var t,_;try{await b.delete(`/padelite/teams/${f}/players/${o.player_id}`),v.notify({type:"positive",message:"Jugador eliminado exitosamente"}),await L()}catch(h){console.error("Error removing player:",h),v.notify({type:"negative",message:((_=(t=h.response)==null?void 0:t.data)==null?void 0:_.detail)||"Error al eliminar jugador"})}})},W=async()=>{try{const{data:o}=await b.get(`/padelite/teams/${f}/chat`);J.value=(o.data||[]).reverse(),await we(),T.value&&(T.value.scrollTop=T.value.scrollHeight)}catch(o){console.error("Error fetching chat messages:",o)}},Y=async()=>{if(!!q.value.trim()){B.value=!0;try{await b.post(`/padelite/teams/${f}/chat`,{team_id:f,message:q.value}),q.value="",await W()}catch(o){console.error("Error sending message:",o),v.notify({type:"negative",message:"Error al enviar mensaje"})}finally{B.value=!1}}},pe=()=>{$.value=!0},Z=o=>({pending:"Pendiente",partial:"Parcial",completed:"Completado",paid:"Pagado"})[o]||o,ge=o=>o?new Date(o).toLocaleString("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",ve=()=>{oe.back()};return(o,a)=>(r(),c($e,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:l(()=>[e(qe,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[n("div",je,[a[11]||(a[11]=n("div",{class:"greeting"},[n("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),p(" Gestionar Equipo ")],-1)),n("div",Ie,[e(d,{flat:"",round:"",icon:"arrow_back",onClick:ve})])])]),_:1}),e(Te,null,{default:l(()=>[e(Pe,{class:"q-pa-md"},{default:l(()=>[I.value?(r(),g("div",Ue,[e(ae,{color:"primary",size:"50px"})])):y.value?(r(),g("div",ze,[e(Q,{flat:"",bordered:"",class:"q-mb-md bg-transparent text-white"},{default:l(()=>[e(m,{class:"row items-center"},{default:l(()=>[y.value.logo_url?(r(),c(D,{key:0,size:"80px"},{default:l(()=>[n("img",{src:y.value.logo_url},null,8,Ae)]),_:1})):(r(),c(D,{key:1,size:"80px",color:"primary","text-color":"white"},{default:l(()=>[p(u(y.value.name.charAt(0)),1)]),_:1})),n("div",Be,[n("div",Je,u(y.value.name),1),n("div",Le," Pago: "+u(Z(y.value.payment_status)),1)])]),_:1}),e(N,null,{default:l(()=>[e(d,{flat:"",color:"primary",label:"Editar Equipo",onClick:a[0]||(a[0]=t=>V.value=!0)}),e(d,{flat:"",color:"primary",label:"Ver Chat",onClick:pe})]),_:1})]),_:1}),e(Q,{flat:"",bordered:"",class:"q-mb-md bg-transparent text-white"},{default:l(()=>[e(m,null,{default:l(()=>[n("div",De,[a[12]||(a[12]=n("div",{class:"text-h6"},"Jugadores por Categor\xEDa",-1)),e(d,{flat:"",color:"primary",icon:"add",label:"Agregar Jugador",onClick:a[1]||(a[1]=t=>P.value=!0)})])]),_:1}),U.value?(r(),c(m,{key:0},{default:l(()=>[e(ae,{color:"primary",size:"30px"})]),_:1})):(r(),c(m,{key:1},{default:l(()=>[(r(!0),g(M,null,S(se.value,t=>(r(),g("div",{key:t.name,class:"q-mb-md"},[n("div",Ne," Categor\xEDa "+u(t.name),1),e(G,{separator:""},{default:l(()=>[(r(!0),g(M,null,S(t.players,_=>(r(),c(H,{key:_.id},{default:l(()=>[e(E,{avatar:""},{default:l(()=>[e(D,{color:"primary","text-color":"white"},{default:l(()=>{var h,ee;return[p(u(((ee=(h=_.profiles)==null?void 0:h.full_name)==null?void 0:ee.charAt(0))||"?"),1)]}),_:2},1024)]),_:2},1024),e(E,null,{default:l(()=>[e(C,null,{default:l(()=>{var h;return[p(u(((h=_.profiles)==null?void 0:h.full_name)||"Sin nombre"),1)]}),_:2},1024),e(C,{caption:""},{default:l(()=>[p(" Pago: "+u(Z(_.payment_status)),1)]),_:2},1024)]),_:2},1024),e(E,{side:""},{default:l(()=>[e(d,{flat:"",round:"",icon:"delete",color:"negative",onClick:h=>ce(_)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]))),128))]),_:1}))]),_:1}),e(R,{modelValue:V.value,"onUpdate:modelValue":a[4]||(a[4]=t=>V.value=t)},{default:l(()=>[e(Q,{style:{"min-width":"400px"},class:"bg-dark text-white"},{default:l(()=>[e(m,null,{default:l(()=>a[13]||(a[13]=[n("div",{class:"text-h6"},"Editar Equipo",-1)])),_:1}),e(m,null,{default:l(()=>[e(j,{modelValue:w.value.name,"onUpdate:modelValue":a[2]||(a[2]=t=>w.value.name=t),label:"Nombre del Equipo",outlined:"",dense:"",dark:"",class:"q-mb-md"},null,8,["modelValue"]),e(j,{modelValue:w.value.logo_url,"onUpdate:modelValue":a[3]||(a[3]=t=>w.value.logo_url=t),label:"URL del Logo",outlined:"",dense:"",dark:""},null,8,["modelValue"])]),_:1}),e(N,{align:"right"},{default:l(()=>[F(e(d,{flat:"",label:"Cancelar",color:"grey"},null,512),[[K]]),e(d,{flat:"",label:"Guardar",color:"primary",onClick:ne,loading:z.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(R,{modelValue:P.value,"onUpdate:modelValue":a[8]||(a[8]=t=>P.value=t)},{default:l(()=>[e(Q,{style:{"min-width":"500px"},class:"bg-dark text-white"},{default:l(()=>[e(m,null,{default:l(()=>a[14]||(a[14]=[n("div",{class:"text-h6"},"Agregar Jugador al Equipo",-1)])),_:1}),e(m,null,{default:l(()=>[e(Qe,{modelValue:i.value.category,"onUpdate:modelValue":a[5]||(a[5]=t=>i.value.category=t),options:re.value,label:"Categor\xEDa",outlined:"",dense:"",dark:"",class:"q-mb-md"},null,8,["modelValue","options"]),e(j,{modelValue:x.value,"onUpdate:modelValue":[a[6]||(a[6]=t=>x.value=t),ie],label:"Buscar Jugador",outlined:"",dense:"",dark:"",class:"q-mb-md",debounce:"300"},{append:l(()=>[e(ke,{name:"search"})]),_:1},8,["modelValue"]),k.value.length>0?(r(),c(G,{key:0,bordered:"",separator:"",class:"q-mb-md"},{default:l(()=>[(r(!0),g(M,null,S(k.value,t=>(r(),c(H,{key:t.id,clickable:"",onClick:_=>ue(t),class:Ce({"bg-primary":i.value.player_id===t.id})},{default:l(()=>[e(E,null,{default:l(()=>[e(C,null,{default:l(()=>[p(u(t.full_name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})):te("",!0),i.value.player_id?(r(),g("div",Re,[a[15]||(a[15]=n("div",{class:"text-caption"},"Jugador seleccionado:",-1)),e(Ee,{color:"primary","text-color":"white",removable:"",onRemove:a[7]||(a[7]=t=>i.value.player_id=null)},{default:l(()=>[p(u(de(i.value.player_id)),1)]),_:1})])):te("",!0)]),_:1}),e(N,{align:"right"},{default:l(()=>[F(e(d,{flat:"",label:"Cancelar",color:"grey"},null,512),[[K]]),e(d,{flat:"",label:"Agregar",color:"primary",onClick:me,loading:A.value,disable:!i.value.player_id||!i.value.category},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(R,{modelValue:$.value,"onUpdate:modelValue":a[10]||(a[10]=t=>$.value=t),maximized:""},{default:l(()=>[e(Q,{class:"bg-dark text-white"},{default:l(()=>[e(m,{class:"row items-center q-pb-none"},{default:l(()=>[a[16]||(a[16]=n("div",{class:"text-h6"},"Chat del Equipo",-1)),e(Ve),F(e(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[K]])]),_:1}),e(m,{style:{height:"70vh","overflow-y":"auto"},ref_key:"chatContainer",ref:T},{default:l(()=>[J.value.length>0?(r(),c(G,{key:0},{default:l(()=>[(r(!0),g(M,null,S(J.value,t=>(r(),c(H,{key:t.id,class:"q-mb-sm"},{default:l(()=>[e(E,null,{default:l(()=>[e(C,{class:"text-bold"},{default:l(()=>[p(u(t.sender_name),1)]),_:2},1024),e(C,{caption:""},{default:l(()=>[p(u(ge(t.timestamp)),1)]),_:2},1024),e(C,{class:"q-mt-sm"},{default:l(()=>[p(u(t.message),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),g("div",Fe," No hay mensajes todav\xEDa "))]),_:1},512),e(m,null,{default:l(()=>[n("div",He,[e(j,{modelValue:q.value,"onUpdate:modelValue":a[9]||(a[9]=t=>q.value=t),outlined:"",dense:"",dark:"",placeholder:"Escribe un mensaje...",class:"col",onKeyup:xe(Y,["enter"])},null,8,["modelValue"]),e(d,{color:"primary",icon:"send",onClick:Y,loading:B.value},null,8,["loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):(r(),g("div",Ge,a[17]||(a[17]=[n("div",{class:"text-h6"},"Equipo no encontrado",-1)])))]),_:1})]),_:1})]),_:1}))}};var va=Se(Ke,[["__scopeId","data-v-60741d02"]]);export{va as default};
