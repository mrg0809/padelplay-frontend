import{j as S,r as b,w as K,q as f,G as k,H as l,v as o,ac as E,I as t,ad as C,x as y,ag as z,aQ as ee,bP as ae,s as j,y as q,ah as L,J as p,ab as N,aj as O,F as oe,B as le,aa as X,af as te,ae as ne,ai as M}from"./index.0dae1473.js";import{Q as se}from"./QHeader.daa47c6c.js";import{Q as re}from"./QBadge.18302a36.js";import{Q as ie}from"./QPage.93249297.js";import{Q as R,a as A}from"./QItem.73fbae79.js";import{Q as de}from"./QList.228e108c.js";import{Q as ue}from"./QMenu.b120de54.js";import{Q as me,a as ce}from"./QLayout.c8e0bf98.js";import{C as I}from"./ClosePopup.6ca29b01.js";import{s as G}from"./supabase.25da9554.js";import{a as fe}from"./dateUtils.f5e3678f.js";import{n as ge}from"./navigationUtils.2c4b9dee.js";import{u as pe}from"./use-quasar.5ccf209f.js";import"./api.2af71db3.js";import{C as ve}from"./ClubNavigationMenu.e7dcf348.js";import{Q as Y}from"./QItemLabel.abb776d6.js";import{Q as Z}from"./QSelect.d037d2d9.js";import{Q as be}from"./QSlider.bf0bee74.js";import{_ as $}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.0d8bf4bb.js";import"./selection.94b8945c.js";import"./QTabs.dbece195.js";import"./rtl.276c3f1b.js";import"./QFooter.aca25710.js";import"./QChip.1bf307a2.js";import"./format.de7e9769.js";import"./TouchPan.67eb9149.js";import"./touch.9135741d.js";const Ce={name:"CombinedTournamentConfigDialog",props:{modelValue:{type:Boolean,default:!1},numTeams:{type:Number,required:!0}},emits:["update:modelValue","confirm","cancel"],setup(u,{emit:e}){const v=S({get:()=>u.modelValue,set:i=>e("update:modelValue",i)}),a=b(null),g=b(2),_=b("cuartos"),r=S(()=>{const i=[],m=u.numTeams;for(let c=2;c<=Math.min(8,Math.floor(m/3));c++){const B=m/c,D=Math.floor(B),w=m%c;let P="";if(w===0)P=`${c} grupos de ${D} parejas`;else{const U=w;P=`${c-w} grupos de ${D} parejas y ${U} de ${D+1} parejas`}i.push({value:{numGroups:c,baseSize:D,remainder:w},label:P,description:`Total: ${m} parejas`})}return i}),h=S(()=>2),d=S(()=>{if(!a.value)return 2;const i=a.value.baseSize;return Math.max(2,i-1)}),n=S(()=>{const i=[],m=u.numTeams;return i.push({label:"Final",value:"final"}),m>=4&&i.push({label:"Semifinales",value:"semifinal"}),m>=10&&i.push({label:"Cuartos de Final",value:"cuartos"}),m>=20&&i.push({label:"Octavos de Final",value:"octavos"}),i.reverse()}),x=S(()=>a.value!==null&&g.value>=h.value&&g.value<=d.value&&_.value!==null);return K(a,i=>{i&&g.value>d.value&&(g.value=d.value)}),K(()=>u.modelValue,i=>{if(i&&r.value.length>0&&!a.value){const m=r.value.find(c=>c.value.baseSize===4||c.value.baseSize===3);a.value=m?m.value:r.value[0].value}}),{showDialog:v,selectedGroupConfig:a,matchesPerTeam:g,playoffStartStage:_,groupOptions:r,minMatchesPerTeam:h,maxMatchesPerTeam:d,playoffStageOptions:n,isValid:x,confirm:()=>{if(!x.value)return;const i={groupConfig:a.value,matchesPerTeam:g.value,playoffStartStage:_.value};e("confirm",i),v.value=!1},cancel:()=>{e("cancel"),v.value=!1}}}},_e={class:"q-mb-md"},ye={class:"text-subtitle2 q-mb-sm"},Te={class:"q-mb-md"},ke={class:"text-subtitle1 q-mb-sm"},he={key:0,class:"q-mb-md"},xe={class:"text-subtitle1 q-mb-sm"},Ve={class:"text-caption q-mt-xs text-grey-4"},De={class:"q-mb-md"},we={class:"text-subtitle1 q-mb-sm"};function Qe(u,e,v,a,g,_){return f(),k(O,{modelValue:a.showDialog,"onUpdate:modelValue":e[3]||(e[3]=r=>a.showDialog=r),persistent:""},{default:l(()=>[o(N,{class:"config-dialog bg-black text-white",style:{"min-width":"400px"}},{default:l(()=>[o(E,{class:"row items-center bg-purple-8"},{default:l(()=>e[4]||(e[4]=[t("div",{class:"text-h6"},"Configuraci\xF3n del Torneo Combinado",-1)])),_:1}),o(E,null,{default:l(()=>[t("div",_e,[t("div",ye,[e[5]||(e[5]=t("strong",null,"Parejas inscritas:",-1)),C(" "+y(v.numTeams),1)])]),t("div",Te,[t("div",ke,[o(z,{name:"groups"}),e[6]||(e[6]=C(" Configuraci\xF3n de Grupos "))]),o(Z,{modelValue:a.selectedGroupConfig,"onUpdate:modelValue":e[0]||(e[0]=r=>a.selectedGroupConfig=r),options:a.groupOptions,label:"Selecciona la distribuci\xF3n de grupos",outlined:"",dark:"","emit-value":"","map-options":"","option-label":r=>r.label,"option-value":r=>r.value},{option:l(r=>[o(R,ee(ae(r.itemProps)),{default:l(()=>[o(A,null,{default:l(()=>[o(Y,null,{default:l(()=>[C(y(r.opt.label),1)]),_:2},1024),o(Y,{caption:""},{default:l(()=>[C(y(r.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","option-label","option-value"])]),a.selectedGroupConfig?(f(),j("div",he,[t("div",xe,[o(z,{name:"sports"}),e[7]||(e[7]=C(" Partidos por Pareja en Fase de Grupos "))]),o(be,{modelValue:a.matchesPerTeam,"onUpdate:modelValue":e[1]||(e[1]=r=>a.matchesPerTeam=r),min:a.minMatchesPerTeam,max:a.maxMatchesPerTeam,step:1,label:"","label-value":`${a.matchesPerTeam} partidos`,color:"purple",dark:""},null,8,["modelValue","min","max","label-value"]),t("div",Ve," M\xEDnimo: "+y(a.minMatchesPerTeam)+" | M\xE1ximo: "+y(a.maxMatchesPerTeam),1)])):q("",!0),t("div",De,[t("div",we,[o(z,{name:"emoji_events"}),e[8]||(e[8]=C(" Etapa Inicial de Eliminaci\xF3n "))]),o(Z,{modelValue:a.playoffStartStage,"onUpdate:modelValue":e[2]||(e[2]=r=>a.playoffStartStage=r),options:a.playoffStageOptions,label:"Desde qu\xE9 etapa comenzar los playoffs",outlined:"",dark:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]),_:1}),o(L,{align:"right",class:"q-pa-md"},{default:l(()=>[o(p,{flat:"",label:"Cancelar",color:"red",onClick:a.cancel},null,8,["onClick"]),o(p,{label:"Generar Cuadro",color:"purple",onClick:a.confirm,disable:!a.isValid},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Se=$(Ce,[["render",Qe],["__scopeId","data-v-1af1ed3a"]]);const Pe={name:"ListTournaments",components:{ClubNavigationMenu:ve,CombinedTournamentConfigDialog:Se},setup(){const u=oe(),e=pe(),v=b([]),a=b(null),g=b(!1),_=b(!1),r=b(!1),h=b(null),d=b(null),n=b(null),x=async()=>{try{if(!a.value){console.error("Club ID no encontrado.");return}const{data:s,error:T}=await G.from("tournaments").select("id, name, start_date, min_pairs, status").eq("club_id",a.value).order("start_date",{ascending:!1});if(T){console.error("Error fetching tournaments:",T.message);return}const Q=await Promise.all(s.map(async V=>{const{data:F,error:Be}=await G.from("tournament_teams").select("id",{count:"exact"}).eq("tournament_id",V.id).eq("status","confirmed");return{id:V.id,name:V.name,start_date:V.start_date,min_pairs:V.min_pairs,registered_teams:(F==null?void 0:F.length)||0,status:V.status||"open"}}));v.value=Q}catch(s){console.error("Unexpected error fetching tournaments:",s.message)}},H=s=>{u.push({name:"EditTournament",params:{tournamentId:s}})},J=s=>{h.value=s,g.value=!0},i=async()=>{try{const{error:s}=await G.from("tournaments").delete().eq("id",h.value);if(s)throw s;v.value=v.value.filter(T=>T.id!==h.value),g.value=!1,e.notify({type:"positive",message:"Torneo eliminado exitosamente."})}catch(s){console.error("Error al eliminar el torneo:",s.message),e.notify({type:"negative",message:"Error al eliminar torneo."})}},m=async s=>{d.value=s;try{const{data:T,error:Q}=await G.from("tournaments").select("system").eq("id",s.id).single();if(Q)throw Q;T.system==="combinado"?r.value=!0:_.value=!0}catch(T){console.error("Error fetching tournament system:",T),e.notify({type:"negative",message:"Error al cargar informaci\xF3n del torneo."})}},c=async()=>{try{if(console.log("Cerrando torneo:",d.value.id),d.value.registered_teams<d.value.min_pairs){e.notify({type:"negative",message:"El torneo no tiene suficientes parejas inscritas para cerrarlo."}),_.value=!1;return}const s={name:"PreviewTournament",params:{tournamentId:d.value.id}};n.value&&(s.query={config:JSON.stringify(n.value)}),u.push(s),_.value=!1}catch(s){console.error("Error navigating to preview:",s),e.notify({type:"negative",message:"Error al navegar a la vista previa del torneo."})}},B=s=>{console.log("Combined tournament config:",s),n.value=s,r.value=!1,c()},D=()=>{r.value=!1,d.value=null,n.value=null},w=s=>{u.push("/club/creartorneos")},P=s=>{u.push({name:"ManageTournament",params:{tournamentId:s}})},U=()=>{u.back()},W=()=>{ge(u,userStore)};return le(()=>{const s=localStorage.getItem("token");if(s){const Q=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),V=JSON.parse(atob(Q));a.value=V.club_id||null}x()}),{tournaments:v,goBack:U,editTournament:H,openDeleteDialog:J,openCloseDialog:m,deleteDialogVisible:g,closeDialogVisible:_,showCombinedConfigDialog:r,deleteTournament:i,closeTournament:c,handleCombinedConfig:B,cancelCombinedConfig:D,openCreateTournament:w,manageTournament:P,goToDashboard:W,selectedTournament:d,formatShortDate:fe}}},qe={class:"header-content"},Ee={class:"greeting"},Me={class:"header-icons"},Ie={key:0,class:"text-center q-mt-md"},Ge={key:1,class:"tournaments-list"},ze={class:"tournament-title"},je={class:"actions"};function Ne(u,e,v,a,g,_){const r=X("CombinedTournamentConfigDialog"),h=X("ClubNavigationMenu");return f(),k(me,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[o(se,{elevated:"",class:"text-white"},{default:l(()=>[t("div",qe,[t("div",Ee,[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...d)=>a.goToDashboard&&a.goToDashboard(...d))}),e[4]||(e[4]=C(" Mis Torneos "))]),t("div",Me,[o(p,{flat:"",round:"",icon:"arrow_back",onClick:a.goBack},null,8,["onClick"])])])]),_:1}),o(ce,null,{default:l(()=>{var d;return[o(ie,{class:"q-pa-md"},{default:l(()=>[a.tournaments.length===0?(f(),j("div",Ie,[o(z,{name:"event_busy",size:"64px"}),e[5]||(e[5]=t("p",null,"No has creado torneos todav\xEDa.",-1))])):(f(),j("div",Ge,[(f(!0),j(te,null,ne(a.tournaments,n=>(f(),k(N,{key:n.id,class:"transparent-card"},{default:l(()=>[o(E,null,{default:l(()=>[t("h4",ze,y(n.name),1),t("p",null,[e[6]||(e[6]=t("strong",null,"Fecha:",-1)),C(" "+y(a.formatShortDate(n.start_date).replace(/-/g,"/"))+" ",1),e[7]||(e[7]=t("br",null,null,-1)),e[8]||(e[8]=t("strong",null,"M\xEDnimo de Parejas:",-1)),C(" "+y(n.min_pairs)+" ",1),e[9]||(e[9]=t("br",null,null,-1)),e[10]||(e[10]=t("strong",null,"Parejas Inscritas:",-1)),C(" "+y(n.registered_teams)+" ",1),e[11]||(e[11]=t("br",null,null,-1)),e[12]||(e[12]=t("strong",null,"Estado:",-1)),o(re,{color:n.status==="closed"?"secondary":"primary","text-color":n.status==="closed"?"white":"black"},{default:l(()=>[C(y(n.status==="closed"?"Cerrado":"Abierto"),1)]),_:2},1032,["color","text-color"])]),t("div",je,[n.status!=="closed"?(f(),k(p,{key:0,icon:"edit",label:"Editar",color:"primary","text-color":"black",size:"sm",onClick:x=>a.editTournament(n.id)},null,8,["onClick"])):q("",!0),n.status!=="closed"?(f(),k(p,{key:1,icon:"delete",label:"Eliminar",color:"negative","text-color":"black",size:"sm",disable:n.registered_teams>0,onClick:x=>a.openDeleteDialog(n.id)},null,8,["disable","onClick"])):q("",!0),n.status!=="closed"?(f(),k(p,{key:2,icon:"preview",label:"Cerrar Torneo",color:"secondary","text-color":"black",size:"sm",onClick:x=>a.openCloseDialog(n)},null,8,["onClick"])):q("",!0),n.status==="closed"?(f(),k(p,{key:3,icon:"dashboard",label:"Administrar",color:"secondary",size:"sm",onClick:x=>a.manageTournament(n.id)},null,8,["onClick"])):q("",!0)])]),_:2},1024)]),_:2},1024))),128))]))]),_:1}),o(p,{glossy:"",round:"",size:"lg",color:"black",icon:"add",class:"fixed-bottom-right q-mb-xl"},{default:l(()=>[o(ue,{anchor:"top end",self:"bottom end"},{default:l(()=>[o(de,{style:{"min-width":"150px"}},{default:l(()=>[M((f(),k(R,{clickable:"",onClick:a.openCreateTournament},{default:l(()=>[o(A,null,{default:l(()=>e[13]||(e[13]=[t("strong",null,"Retas",-1)])),_:1})]),_:1},8,["onClick"])),[[I]]),M((f(),k(R,{clickable:"",onClick:a.openCreateTournament},{default:l(()=>[o(A,null,{default:l(()=>e[14]||(e[14]=[t("strong",null,"Torneo",-1)])),_:1})]),_:1},8,["onClick"])),[[I]])]),_:1})]),_:1})]),_:1}),o(O,{modelValue:a.deleteDialogVisible,"onUpdate:modelValue":e[1]||(e[1]=n=>a.deleteDialogVisible=n)},{default:l(()=>[o(N,{class:"bg-black text-white"},{default:l(()=>[o(E,null,{default:l(()=>e[15]||(e[15]=[t("div",{class:"text-h6"},"Confirmar eliminaci\xF3n",-1),t("div",null,"\xBFEst\xE1s seguro de que deseas eliminar este torneo?",-1)])),_:1}),o(L,{align:"right"},{default:l(()=>[M(o(p,{flat:"",label:"Cancelar",color:"primary"},null,512),[[I]]),o(p,{flat:"",label:"Eliminar",color:"negative",onClick:a.deleteTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(O,{modelValue:a.closeDialogVisible,"onUpdate:modelValue":e[2]||(e[2]=n=>a.closeDialogVisible=n)},{default:l(()=>[o(N,{class:"bg-black text-white"},{default:l(()=>[o(E,null,{default:l(()=>e[16]||(e[16]=[t("div",{class:"text-h6"},"Confirmar cierre",-1),t("div",null," \xBFEst\xE1s seguro de que deseas cerrar este torneo? Esto generar\xE1 el fixture autom\xE1ticamente. ",-1)])),_:1}),o(L,{align:"right"},{default:l(()=>[M(o(p,{flat:"",label:"Cancelar",color:"red"},null,512),[[I]]),o(p,{flat:"",label:"Cerrar Torneo",color:"green",onClick:a.closeTournament},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(r,{modelValue:a.showCombinedConfigDialog,"onUpdate:modelValue":e[3]||(e[3]=n=>a.showCombinedConfigDialog=n),"num-teams":((d=a.selectedTournament)==null?void 0:d.registered_teams)||0,onConfirm:a.handleCombinedConfig,onCancel:a.cancelCombinedConfig},null,8,["modelValue","num-teams","onConfirm","onCancel"])]}),_:1}),o(h)]),_:1})}var ga=$(Pe,[["render",Ne],["__scopeId","data-v-746d2b3f"]]);export{ga as default};
