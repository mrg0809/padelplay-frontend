import{a7 as ae,F as le,r as _,j as oe,B as se,a8 as ne,q as c,G as R,H as r,v as l,I as a,ab as y,J as h,s as p,a9 as w,aa as k,x as i,aM as re,ad as M,ac as U,ae as J,y as C,ah as L,K as V,af as A,ag as K}from"./index.f52eeb23.js";import{Q as ie}from"./QHeader.9b837285.js";import{Q as de}from"./QSpinnerPuff.576b1f55.js";import{Q as W}from"./QBadge.c46aeb79.js";import{Q as ue,a as I}from"./QTabs.82b2cce9.js";import{a as me,Q as B}from"./QTabPanel.eb6f0796.js";import{Q as ce}from"./QMarkupTable.fde88f76.js";import{Q as X}from"./QSelect.fcd8d5c3.js";import{Q as ge}from"./QPage.e3b227e5.js";import{Q as _e,a as ve}from"./QLayout.cb0005f9.js";import{C as Y}from"./ClosePopup.07fee054.js";import{u as pe}from"./use-quasar.181232a6.js";import{s as Z}from"./supabase.577864c8.js";import{n as fe}from"./navigationUtils.2c4b9dee.js";import{a as S}from"./api.2af71db3.js";import{C as be}from"./ClubNavigationMenu.11760d80.js";import{g as ye}from"./tournamentUtils.cfdf57cc.js";import{_ as he}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.264ef856.js";import"./use-render-cache.770e5fe8.js";import"./selection.8b3fabd2.js";import"./QChip.14b42392.js";import"./QItem.5db8a12f.js";import"./QItemLabel.c940b1f9.js";import"./QMenu.62944bb3.js";import"./position-engine.3d6fe0c3.js";import"./format.de7e9769.js";import"./QFooter.a31873a0.js";const ke={name:"ManageTournament",components:{ClubNavigationMenu:be},setup(){const q=ae(),e=le(),f=pe(),t=_(null),T=_([]),D=_([]),F=_(!1),o=_("matches"),m=_(!1),d=_(!1),v=_(null),E=_(!1),N=_(!1),g=_({set1_team1:null,set1_team2:null,set2_team1:null,set2_team2:null,set3_team1:null,set3_team2:null,winner:null}),Q=_({match_date:null,match_time:null,court_id:null}),O=_([]),$=oe(()=>v.value?[{label:v.value.team1,value:v.value.team1_players[0]},{label:v.value.team2,value:v.value.team2_players[0]}]:[]);se(async()=>{await ee(),await P(),await j(),await te()});const ee=async()=>{F.value=!0;try{const s=q.params.tournamentId,{data:n,error:u}=await Z.from("tournaments").select("*").eq("id",s).single();if(u)throw u;t.value=n}catch(s){console.error("Error loading tournament:",s),f.notify({type:"negative",message:"Error al cargar el torneo"})}finally{F.value=!1}},P=async()=>{try{const s=q.params.tournamentId,n=await S.get(`/tournaments/${s}/matches`);T.value=n.data.matches}catch(s){console.error("Error loading matches:",s),f.notify({type:"negative",message:"Error al cargar los partidos"})}},j=async()=>{try{const s=q.params.tournamentId,n=await S.get(`/tournaments/${s}/standings`);D.value=n.data.standings}catch(s){console.error("Error loading standings:",s),f.notify({type:"negative",message:"Error al cargar las posiciones"})}},te=async()=>{var s;try{if((s=t.value)!=null&&s.courts_used){const{data:n,error:u}=await Z.from("courts").select("id, name").in("id",t.value.courts_used);!u&&n&&(O.value=n.map(x=>({label:x.name,value:x.id})))}}catch(n){console.error("Error loading courts:",n)}};return{tournament:t,matches:T,standings:D,loading:F,activeTab:o,resultDialogVisible:m,rescheduleDialogVisible:d,selectedMatch:v,resultForm:g,rescheduleForm:Q,courtOptions:O,winnerOptions:$,savingResult:E,savingReschedule:N,getSystemName:s=>ye(s),formatScore:s=>{if(!s)return"Sin resultado";try{const n=typeof s=="string"?JSON.parse(s):s;let u=[];return n.set1&&u.push(`${n.set1.team1}-${n.set1.team2}`),n.set2&&u.push(`${n.set2.team1}-${n.set2.team2}`),n.set3&&u.push(`${n.set3.team1}-${n.set3.team2}`),u.join(", ")}catch{return"Error en formato"}},openResultDialog:s=>{var n,u,x,z,G,H;if(v.value=s,s.score)try{const b=typeof s.score=="string"?JSON.parse(s.score):s.score;g.value={set1_team1:((n=b.set1)==null?void 0:n.team1)||null,set1_team2:((u=b.set1)==null?void 0:u.team2)||null,set2_team1:((x=b.set2)==null?void 0:x.team1)||null,set2_team2:((z=b.set2)==null?void 0:z.team2)||null,set3_team1:((G=b.set3)==null?void 0:G.team1)||null,set3_team2:((H=b.set3)==null?void 0:H.team2)||null,winner:s.winner}}catch(b){console.error("Error parsing score:",b)}else g.value={set1_team1:null,set1_team2:null,set2_team1:null,set2_team2:null,set3_team1:null,set3_team2:null,winner:null};m.value=!0},openRescheduleDialog:s=>{v.value=s,Q.value={match_date:s.match_date,match_time:s.match_time,court_id:s.court_id},d.value=!0},saveResult:async()=>{var s,n;if(!!v.value){if(!g.value.winner){f.notify({type:"negative",message:"Debes seleccionar un ganador"});return}E.value=!0;try{const u={set1:{team1:g.value.set1_team1,team2:g.value.set1_team2},set2:{team1:g.value.set2_team1,team2:g.value.set2_team2}};g.value.set3_team1!==null&&g.value.set3_team2!==null&&(u.set3={team1:g.value.set3_team1,team2:g.value.set3_team2});const x=await S.put(`/tournaments/${t.value.id}/matches/${v.value.id}/result`,{score:u,winner:g.value.winner});f.notify({type:"positive",message:"Resultado guardado exitosamente"}),m.value=!1,await P(),await j()}catch(u){console.error("Error saving result:",u),f.notify({type:"negative",message:((n=(s=u.response)==null?void 0:s.data)==null?void 0:n.detail)||"Error al guardar el resultado"})}finally{E.value=!1}}},saveReschedule:async()=>{var s,n;if(!!v.value){N.value=!0;try{const u=await S.put(`/tournaments/${t.value.id}/matches/${v.value.id}/reschedule`,{match_date:Q.value.match_date,match_time:Q.value.match_time+":00",court_id:Q.value.court_id});f.notify({type:"positive",message:"Partido reagendado exitosamente"}),d.value=!1,await P()}catch(u){console.error("Error rescheduling match:",u),f.notify({type:"negative",message:((n=(s=u.response)==null?void 0:s.data)==null?void 0:n.detail)||"Error al reagendar el partido"})}finally{N.value=!1}}},goBack:()=>{e.back()},goToDashboard:()=>{fe(e,userStore)}}}},Ve={class:"header-content"},xe={class:"greeting"},we={class:"header-icons"},Ce={key:0,class:"text-center q-mt-md"},Fe={key:1},Qe={class:"q-mt-none"},qe={class:"row q-gutter-md"},Re={class:"col"},Se={class:"col"},Te={class:"matches-list"},De={class:"match-header row items-center justify-between"},Ee={class:"col"},Ne={class:"q-my-none"},Pe={class:"text-caption q-mb-none"},Me={class:"col-auto"},Ue={key:0,class:"q-mt-md"},Ie={class:"q-mt-md row q-gutter-sm"},Be={key:0,class:"text-center q-pa-xl"},Oe={class:"text-left"},je={class:"text-left"},ze={class:"text-center"},Ge={class:"text-center"},He={class:"text-center"},Je={class:"text-center"},Le={key:0,class:"text-center q-pa-xl"},Ae={class:"bracket-view q-mt-md"},Ke={class:"bracket-match-content"},We={class:"bracket-team"},Xe={class:"bracket-team"},Ye={class:"bracket-details text-caption"},Ze={class:"q-gutter-md"},$e={class:"q-gutter-md"};function et(q,e,f,t,T,D){const F=ne("ClubNavigationMenu");return c(),R(_e,{view:"hHh lpR fFf",class:"body text-white"},{default:r(()=>[l(ie,{elevated:"",class:"bg-primary text-white"},{default:r(()=>[a("div",Ve,[a("div",xe,[a("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:e[0]||(e[0]=(...o)=>t.goToDashboard&&t.goToDashboard(...o))}),e[15]||(e[15]=y(" Administrar Torneo "))]),a("div",we,[l(h,{flat:"",round:"",icon:"arrow_back",onClick:t.goBack},null,8,["onClick"])])])]),_:1}),l(ve,null,{default:r(()=>[l(ge,{class:"q-pa-md"},{default:r(()=>[t.loading?(c(),p("div",Ce,[l(de,{color:"primary",size:"3em"}),e[16]||(e[16]=a("p",null,"Cargando informaci\xF3n del torneo...",-1))])):t.tournament?(c(),p("div",Fe,[l(w,{class:"q-mb-md transparent-card"},{default:r(()=>[l(k,null,{default:r(()=>[a("h4",Qe,i(t.tournament.name),1),a("div",qe,[a("div",Re,[a("p",null,[e[17]||(e[17]=a("strong",null,"Sistema:",-1)),y(" "+i(t.getSystemName(t.tournament.system)),1)]),a("p",null,[e[18]||(e[18]=a("strong",null,"Categor\xEDa:",-1)),y(" "+i(t.tournament.category),1)]),a("p",null,[e[19]||(e[19]=a("strong",null,"G\xE9nero:",-1)),y(" "+i(t.tournament.gender),1)])]),a("div",Se,[a("p",null,[e[20]||(e[20]=a("strong",null,"Fecha Inicio:",-1)),y(" "+i(t.tournament.start_date),1)]),a("p",null,[e[21]||(e[21]=a("strong",null,"Fecha Fin:",-1)),y(" "+i(t.tournament.end_date),1)]),a("p",null,[e[23]||(e[23]=a("strong",null,"Estado:",-1)),l(W,{color:"green"},{default:r(()=>e[22]||(e[22]=[y("Cerrado")])),_:1})])])])]),_:1})]),_:1}),l(ue,{modelValue:t.activeTab,"onUpdate:modelValue":e[1]||(e[1]=o=>t.activeTab=o),dense:"",class:"text-white","active-color":"primary","indicator-color":"primary",align:"justify"},{default:r(()=>[l(I,{name:"matches",label:"Partidos",icon:"sports_tennis"}),l(I,{name:"standings",label:"Posiciones",icon:"emoji_events"}),l(I,{name:"bracket",label:"Cuadro",icon:"grid_on"})]),_:1},8,["modelValue"]),l(re),l(me,{modelValue:t.activeTab,"onUpdate:modelValue":e[2]||(e[2]=o=>t.activeTab=o),animated:"",class:"transparent-bg"},{default:r(()=>[l(B,{name:"matches"},{default:r(()=>[a("div",Te,[(c(!0),p(M,null,U(t.matches,o=>(c(),R(w,{key:o.id,class:"q-mb-md transparent-card"},{default:r(()=>[l(k,null,{default:r(()=>[a("div",De,[a("div",Ee,[a("h6",Ne,i(o.team1)+" vs "+i(o.team2),1),a("p",Pe,i(o.match_date)+" - "+i(o.match_time.substring(0,5))+" | Cancha: "+i(o.court_name),1)]),a("div",Me,[l(W,{color:o.has_result?"green":"orange",label:o.has_result?"Finalizado":"Pendiente"},null,8,["color","label"])])]),o.has_result?(c(),p("div",Ue,[a("p",null,[e[24]||(e[24]=a("strong",null,"Resultado:",-1)),y(" "+i(t.formatScore(o.score)),1)])])):C("",!0),a("div",Ie,[o.has_result?C("",!0):(c(),R(h,{key:0,label:"Registrar Resultado",color:"green",size:"sm",icon:"edit_note",onClick:m=>t.openResultDialog(o)},null,8,["onClick"])),o.has_result?(c(),R(h,{key:1,label:"Editar Resultado",color:"primary",size:"sm",icon:"edit",onClick:m=>t.openResultDialog(o)},null,8,["onClick"])):C("",!0),l(h,{label:"Reagendar",color:"orange",size:"sm",icon:"schedule",onClick:m=>t.openRescheduleDialog(o)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),t.matches.length===0?(c(),p("div",Be,[l(J,{name:"info",size:"3em",color:"grey"}),e[25]||(e[25]=a("p",null,"No hay partidos programados",-1))])):C("",!0)])]),_:1}),l(B,{name:"standings"},{default:r(()=>[l(w,{class:"transparent-card"},{default:r(()=>[l(k,null,{default:r(()=>[e[28]||(e[28]=a("h6",{class:"q-mt-none"},"Tabla de Posiciones",-1)),l(ce,{flat:"",bordered:"",class:"standings-table"},{default:r(()=>[e[26]||(e[26]=a("thead",null,[a("tr",null,[a("th",{class:"text-left"},"Pos"),a("th",{class:"text-left"},"Equipo"),a("th",{class:"text-center"},"PJ"),a("th",{class:"text-center"},"PG"),a("th",{class:"text-center"},"PP"),a("th",{class:"text-center"},"Pts")])],-1)),a("tbody",null,[(c(!0),p(M,null,U(t.standings,(o,m)=>(c(),p("tr",{key:o.team_id},[a("td",Oe,i(m+1),1),a("td",je,i(o.team_name),1),a("td",ze,i(o.matches_played),1),a("td",Ge,i(o.wins),1),a("td",He,i(o.losses),1),a("td",Je,[a("strong",null,i(o.points),1)])]))),128))])]),_:1}),t.standings.length===0?(c(),p("div",Le,[l(J,{name:"info",size:"3em",color:"grey"}),e[27]||(e[27]=a("p",null,"No hay resultados registrados a\xFAn",-1))])):C("",!0)]),_:1})]),_:1})]),_:1}),l(B,{name:"bracket"},{default:r(()=>[l(w,{class:"transparent-card"},{default:r(()=>[l(k,null,{default:r(()=>[e[30]||(e[30]=a("h6",{class:"q-mt-none"},"Cuadro del Torneo",-1)),e[31]||(e[31]=a("p",{class:"text-caption"},"Vista del cuadro completo del torneo",-1)),a("div",Ae,[(c(!0),p(M,null,U(t.matches,o=>(c(),p("div",{key:o.id,class:"bracket-match q-mb-sm"},[a("div",Ke,[a("div",We,i(o.team1),1),e[29]||(e[29]=a("div",{class:"bracket-vs"},"vs",-1)),a("div",Xe,i(o.team2),1)]),a("div",Ye,i(o.match_date)+" - "+i(o.match_time.substring(0,5)),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):C("",!0),l(L,{modelValue:t.resultDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=o=>t.resultDialogVisible=o)},{default:r(()=>[l(w,{class:"bg-dark text-white",style:{"min-width":"350px"}},{default:r(()=>[l(k,null,{default:r(()=>e[32]||(e[32]=[a("div",{class:"text-h6"},"Registrar Resultado",-1)])),_:1}),l(k,null,{default:r(()=>{var o,m;return[a("p",null,[a("strong",null,i((o=t.selectedMatch)==null?void 0:o.team1)+" vs "+i((m=t.selectedMatch)==null?void 0:m.team2),1)]),a("div",Ze,[l(V,{modelValue:t.resultForm.set1_team1,"onUpdate:modelValue":e[3]||(e[3]=d=>t.resultForm.set1_team1=d),type:"number",label:"Set 1 - Equipo 1",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(V,{modelValue:t.resultForm.set1_team2,"onUpdate:modelValue":e[4]||(e[4]=d=>t.resultForm.set1_team2=d),type:"number",label:"Set 1 - Equipo 2",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(V,{modelValue:t.resultForm.set2_team1,"onUpdate:modelValue":e[5]||(e[5]=d=>t.resultForm.set2_team1=d),type:"number",label:"Set 2 - Equipo 1",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(V,{modelValue:t.resultForm.set2_team2,"onUpdate:modelValue":e[6]||(e[6]=d=>t.resultForm.set2_team2=d),type:"number",label:"Set 2 - Equipo 2",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(V,{modelValue:t.resultForm.set3_team1,"onUpdate:modelValue":e[7]||(e[7]=d=>t.resultForm.set3_team1=d),type:"number",label:"Set 3 - Equipo 1 (Opcional)",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(V,{modelValue:t.resultForm.set3_team2,"onUpdate:modelValue":e[8]||(e[8]=d=>t.resultForm.set3_team2=d),type:"number",label:"Set 3 - Equipo 2 (Opcional)",outlined:"",dark:"",min:"0",max:"7"},null,8,["modelValue"]),l(X,{modelValue:t.resultForm.winner,"onUpdate:modelValue":e[9]||(e[9]=d=>t.resultForm.winner=d),options:t.winnerOptions,label:"Ganador",outlined:"",dark:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]}),_:1}),l(A,{align:"right"},{default:r(()=>[K(l(h,{flat:"",label:"Cancelar",color:"red"},null,512),[[Y]]),l(h,{flat:"",label:"Guardar",color:"green",onClick:t.saveResult,loading:t.savingResult},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(L,{modelValue:t.rescheduleDialogVisible,"onUpdate:modelValue":e[14]||(e[14]=o=>t.rescheduleDialogVisible=o)},{default:r(()=>[l(w,{class:"bg-dark text-white",style:{"min-width":"350px"}},{default:r(()=>[l(k,null,{default:r(()=>e[33]||(e[33]=[a("div",{class:"text-h6"},"Reagendar Partido",-1)])),_:1}),l(k,null,{default:r(()=>{var o,m;return[a("p",null,[a("strong",null,i((o=t.selectedMatch)==null?void 0:o.team1)+" vs "+i((m=t.selectedMatch)==null?void 0:m.team2),1)]),a("div",$e,[l(V,{modelValue:t.rescheduleForm.match_date,"onUpdate:modelValue":e[11]||(e[11]=d=>t.rescheduleForm.match_date=d),type:"date",label:"Nueva Fecha",outlined:"",dark:""},null,8,["modelValue"]),l(V,{modelValue:t.rescheduleForm.match_time,"onUpdate:modelValue":e[12]||(e[12]=d=>t.rescheduleForm.match_time=d),type:"time",label:"Nueva Hora",outlined:"",dark:""},null,8,["modelValue"]),l(X,{modelValue:t.rescheduleForm.court_id,"onUpdate:modelValue":e[13]||(e[13]=d=>t.rescheduleForm.court_id=d),options:t.courtOptions,label:"Nueva Cancha",outlined:"",dark:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]}),_:1}),l(A,{align:"right"},{default:r(()=>[K(l(h,{flat:"",label:"Cancelar",color:"red"},null,512),[[Y]]),l(h,{flat:"",label:"Guardar",color:"green",onClick:t.saveReschedule,loading:t.savingReschedule},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(F)]),_:1})}var It=he(ke,[["render",et],["__scopeId","data-v-158bb943"]]);export{It as default};
