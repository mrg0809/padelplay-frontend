import{r as Q,j as F,E as ce,b5 as _e,O as me,aD as be,p as A,k as ye,bH as he,a$ as we,aW as Ce,aY as Fe,b0 as xe,bI as ke,b1 as ne,bc as Ve,aX as Se,aB as De,F as Pe,B as Qe,a8 as Ie,q as y,G as j,H as n,v as a,I as C,ab as T,J as Y,s as U,ae as re,ac as G,ad as J,a9 as qe,aa as se,K as Ne,af as Ee,ag as ie,ah as ze,bC as ue,x as E,y as je}from"./index.e023fc86.js";import{Q as Te}from"./QHeader.56feab89.js";import{Q as Ue,a as te}from"./QTabs.5da5ba79.js";import{Q as ae,a as M}from"./QItem.67c7d6d6.js";import{Q as R}from"./QItemLabel.c5b968dc.js";import{Q as le}from"./QList.367328e6.js";import{a as Ae,Q as oe}from"./QTabPanel.b8b736db.js";import{Q as fe}from"./QChip.72fe66c5.js";import{Q as Be}from"./QPage.9f755cb5.js";import{Q as Oe,a as Le}from"./QLayout.5de9f2c5.js";import{h as Me}from"./format.de7e9769.js";import{C as de}from"./ClosePopup.1e64f2e8.js";import{s as z}from"./supabase.a7ca61c0.js";import{u as Re}from"./userStore.3700a688.js";import{a as Z}from"./api.2af71db3.js";import{C as We}from"./ClubNavigationMenu.1df79f28.js";import{_ as He}from"./plugin-vue_export-helper.21dcd24c.js";import"./rtl.276c3f1b.js";import"./use-panel.009d0490.js";import"./use-render-cache.770e5fe8.js";import"./selection.709b2df1.js";import"./pinia.eb62d3f8.js";import"./QFooter.1e0bb873.js";function W(t,o,I,r){const c=[];return t.forEach(v=>{r(v)===!0?c.push(v):o.push({failedPropValidation:I,file:v})}),c}function $(t){t&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),me(t)}const Ke={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Xe=["rejected"];function Ye({editable:t,dnd:o,getFileInput:I,addFilesToQueue:r}){const{props:c,emit:v,proxy:h}=ce(),l=Q(null),q=F(()=>c.accept!==void 0?c.accept.split(",").map(e=>(e=e.trim(),e==="*"?"*/":(e.endsWith("/*")&&(e=e.slice(0,e.length-1)),e.toUpperCase()))):null),N=F(()=>parseInt(c.maxFiles,10)),B=F(()=>parseInt(c.maxTotalSize,10));function O(e){if(t.value)if(e!==Object(e)&&(e={target:null}),e.target!==null&&e.target.matches('input[type="file"]')===!0)e.clientX===0&&e.clientY===0&&_e(e);else{const g=I();g&&g!==e.target&&g.click(e)}}function L(e){t.value&&e&&r(null,e)}function H(e,g,b,x){let s=Array.from(g||e.target.files);const _=[],k=()=>{_.length!==0&&v("rejected",_)};if(c.accept!==void 0&&q.value.indexOf("*/")===-1&&(s=W(s,_,"accept",d=>q.value.some(p=>d.type.toUpperCase().startsWith(p)||d.name.toUpperCase().endsWith(p))),s.length===0))return k();if(c.maxFileSize!==void 0){const d=parseInt(c.maxFileSize,10);if(s=W(s,_,"max-file-size",p=>p.size<=d),s.length===0)return k()}if(c.multiple!==!0&&s.length!==0&&(s=[s[0]]),s.forEach(d=>{d.__key=d.webkitRelativePath+d.lastModified+d.name+d.size}),x===!0){const d=b.map(p=>p.__key);s=W(s,_,"duplicate",p=>d.includes(p.__key)===!1)}if(s.length===0)return k();if(c.maxTotalSize!==void 0){let d=x===!0?b.reduce((p,u)=>p+u.size,0):0;if(s=W(s,_,"max-total-size",p=>(d+=p.size,d<=B.value)),s.length===0)return k()}if(typeof c.filter=="function"){const d=c.filter(s);s=W(s,_,"filter",p=>d.includes(p))}if(c.maxFiles!==void 0){let d=x===!0?b.length:0;if(s=W(s,_,"max-files",()=>(d++,d<=N.value)),s.length===0)return k()}if(k(),s.length!==0)return s}function K(e){$(e),o.value!==!0&&(o.value=!0)}function f(e){me(e),(e.relatedTarget!==null||be.is.safari!==!0?e.relatedTarget!==l.value:document.elementsFromPoint(e.clientX,e.clientY).includes(l.value)===!1)===!0&&(o.value=!1)}function X(e){$(e);const g=e.dataTransfer.files;g.length!==0&&r(null,g),o.value=!1}function m(e){if(o.value===!0)return A("div",{ref:l,class:`q-${e}__dnd absolute-full`,onDragenter:$,onDragover:$,onDragleave:f,onDrop:X})}return Object.assign(h,{pickFiles:O,addFiles:L}),{pickFiles:O,addFiles:L,onDragover:K,onDragleave:f,processFiles:H,getDndNode:m,maxFilesNumber:N,maxTotalSizeNumber:B}}var Ge=ye({name:"QFile",inheritAttrs:!1,props:{...he,...we,...Ke,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Ce,...Xe],setup(t,{slots:o,emit:I,attrs:r}){const{proxy:c}=ce(),v=Fe(),h=Q(null),l=Q(!1),q=xe(t),{pickFiles:N,onDragover:B,onDragleave:O,processFiles:L,getDndNode:H}=Ye({editable:v.editable,dnd:l,getFileInput:S,addFilesToQueue:D}),K=ke(t),f=F(()=>Object(t.modelValue)===t.modelValue?"length"in t.modelValue?Array.from(t.modelValue):[t.modelValue]:[]),X=F(()=>ne(f.value)),m=F(()=>f.value.map(i=>i.name).join(", ")),e=F(()=>Me(f.value.reduce((i,w)=>i+w.size,0))),g=F(()=>({totalSize:e.value,filesNumber:f.value.length,maxFiles:t.maxFiles})),b=F(()=>({tabindex:-1,type:"file",title:"",accept:t.accept,capture:t.capture,name:q.value,...r,id:v.targetUid.value,disabled:v.editable.value!==!0})),x=F(()=>"q-file q-field--auto-height"+(l.value===!0?" q-file--dnd":"")),s=F(()=>t.multiple===!0&&t.append===!0);function _(i){const w=f.value.slice();w.splice(i,1),d(w)}function k(i){const w=f.value.indexOf(i);w!==-1&&_(w)}function d(i){I("update:modelValue",t.multiple===!0?i:i[0])}function p(i){i.keyCode===13&&De(i)}function u(i){(i.keyCode===13||i.keyCode===32)&&N(i)}function S(){return h.value}function D(i,w){const P=L(i,w,f.value,s.value),ee=S();ee!=null&&(ee.value=""),P!==void 0&&((t.multiple===!0?t.modelValue&&P.every(ge=>f.value.includes(ge)):t.modelValue===P[0])||d(s.value===!0?f.value.concat(P):P))}function V(){return[A("input",{class:[t.inputClass,"q-file__filler"],style:t.inputStyle})]}function pe(){if(o.file!==void 0)return f.value.length===0?V():f.value.map((w,P)=>o.file({index:P,file:w,ref:this}));if(o.selected!==void 0)return f.value.length===0?V():o.selected({files:f.value,ref:this});if(t.useChips===!0)return f.value.length===0?V():f.value.map((w,P)=>A(fe,{key:"file-"+P,removable:v.editable.value,dense:!0,textColor:t.color,tabindex:t.tabindex,onRemove:()=>{_(P)}},()=>A("span",{class:"ellipsis",textContent:w.name})));const i=t.displayValue!==void 0?t.displayValue:m.value;return i.length!==0?[A("div",{class:t.inputClass,style:t.inputStyle,textContent:i})]:V()}function ve(){const i={ref:h,...b.value,...K.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:D};return t.multiple===!0&&(i.multiple=!0),A("input",i)}return Object.assign(v,{fieldClass:x,emitValue:d,hasValue:X,inputRef:h,innerValue:f,floatingLabel:F(()=>X.value===!0||ne(t.displayValue)),computedCounter:F(()=>{if(t.counterLabel!==void 0)return t.counterLabel(g.value);const i=t.maxFiles;return`${f.value.length}${i!==void 0?" / "+i:""} (${e.value})`}),getControlChild:()=>H("file"),getControl:()=>{const i={ref:v.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:t.tabindex};return v.editable.value===!0&&Object.assign(i,{onDragover:B,onDragleave:O,onKeydown:p,onKeyup:u}),A("div",i,[ve()].concat(pe()))}}),Object.assign(c,{removeAtIndex:_,removeFile:k,getNativeElement:()=>h.value}),Ve(c,"nativeEl",()=>h.value),Se(v)}});const Je={name:"ClubCommunity",components:{ClubNavigationMenu:We},setup(){const t=Pe(),o=Q("followed"),I=Q([]),r=Q([]),c=Q([]),v=Re(),h=Q(""),l=Q(null),q=Q(!1),N={like:"\u{1F44D}",love:"\u2764\uFE0F",laugh:"\u{1F602}",wow:"\u{1F62E}",sad:"\u{1F622}",angry:"\u{1F621}"},B=async()=>{try{const{data:m,error:e}=await z.from("follows").select("followed_id").eq("follower_id",v.userId);if(e)throw e;const g=m.map(u=>u.followed_id),{data:b,error:x}=await z.from("profiles").select("id, full_name, user_type, club_id").in("id",g);if(x)throw x;const{data:s,error:_}=await z.from("players").select("user_id, photo_url").in("user_id",g);if(_)throw _;const k=b.filter(u=>u.user_type==="club").map(u=>u.club_id),{data:d,error:p}=await z.from("clubs").select("id, logo_url").in("id",k);if(p)throw p;I.value=b.map(u=>{const S=s.find(V=>V.user_id===u.id),D=d.find(V=>V.id===u.club_id);return{id:u.id,name:u.full_name,photo_url:u.user_type==="player"?S==null?void 0:S.photo_url:(D==null?void 0:D.logo_url)||"default-avatar.png",type:u.user_type}})}catch(m){console.error("Error al obtener usuarios seguidos:",m)}},O=async()=>{try{const{data:m,error:e}=await z.from("follows").select("follower_id").eq("followed_id",v.userId);if(e)throw e;const g=m.map(u=>u.follower_id),{data:b,error:x}=await z.from("profiles").select("id, full_name, user_type, club_id").in("id",g);if(x)throw x;const{data:s,error:_}=await z.from("players").select("user_id, photo_url").in("user_id",g);if(_)throw _;const k=b.filter(u=>u.user_type==="club").map(u=>u.club_id),{data:d,error:p}=await z.from("clubs").select("id, logo_url").in("id",k);if(p)throw p;r.value=b.map(u=>{const S=s.find(V=>V.user_id===u.id),D=d.find(V=>V.id===u.club_id);return{id:u.id,name:u.full_name,photo_url:u.user_type==="player"?S==null?void 0:S.photo_url:(D==null?void 0:D.logo_url)||"default-avatar.png",type:u.user_type}})}catch(m){console.error("Error al obtener seguidores:",m)}},L=async()=>{try{const m=await Z.get(`community/posts/club/${v.clubId}`);console.log("Datos recibidos:",m.data),c.value=m.data.posts}catch(m){console.error("Error al obtener posts:",m)}},H=async()=>{try{let m=null;const e=await Z.post("/community/posts",{club_id:v.clubId,content:h.value});console.log(e.data.data[0].id);const g=e.data.data[0].id;if(l.value){const b=new FormData;b.append("file",l.value);const x=await Z.post(`/community/posts/upload-media?post_id=${g}`,b,{headers:{"Content-Type":"multipart/form-data"}})}c.value.unshift(e.data),h.value="",l.value=null}catch(m){console.error("Error al crear post:",m)}},K=async m=>{try{await Z.delete(`community/posts/${m}`,{data:{club_id:v.clubId}}),c.value=c.value.filter(e=>e.id!==m)}catch(e){console.error("Error al eliminar post:",e)}},f=m=>{if(!m)return"Fecha no disponible";const e=new Date(m);return isNaN(e.getTime())?"Fecha no disponible":e.toLocaleString()};return Qe(()=>{B(),O(),L()}),{tab:o,followedUsers:I,followers:r,posts:c,newPostContent:h,showCreatePostDialog:q,createPost:H,deletePost:K,formatDate:f,goBack:()=>{t.back()},reactionEmojis:N,newPostMedia:l}}},Ze={class:"header-content"},$e={class:"header-icons"},et={key:0,class:"text-center q-pa-md"},tt=["src"],at={key:0,class:"text-center q-pa-md"},lt=["src"],ot={class:"text-center q-pa-md"},nt={key:0,class:"q-mt-sm"},rt=["src"],st={class:"q-mt-sm"};function it(t,o,I,r,c,v){const h=Ie("ClubNavigationMenu");return y(),j(Oe,{view:"hHh lpR fFf",class:"body text-white"},{default:n(()=>[a(Te,{elevated:"",class:"bg-primary text-white"},{default:n(()=>[C("div",Ze,[o[6]||(o[6]=C("div",{class:"greeting"},[C("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),T(" Comunidad del Club ")],-1)),C("div",$e,[a(Y,{flat:"",round:"",icon:"arrow_back",onClick:r.goBack},null,8,["onClick"])])])]),_:1}),a(Le,null,{default:n(()=>[a(Be,{class:"q-pa-md"},{default:n(()=>[a(Ue,{modelValue:r.tab,"onUpdate:modelValue":o[0]||(o[0]=l=>r.tab=l),align:"justify",class:"text-white"},{default:n(()=>[a(te,{name:"followed",label:"Seguidos"}),a(te,{name:"followers",label:"Seguidores"}),a(te,{name:"wall",label:"Wall"})]),_:1},8,["modelValue"]),a(Ae,{modelValue:r.tab,"onUpdate:modelValue":o[2]||(o[2]=l=>r.tab=l),animated:"",class:"transparent-card q-mt-md"},{default:n(()=>[a(oe,{name:"followed"},{default:n(()=>[r.followedUsers.length===0?(y(),U("div",et,[a(re,{name:"people",size:"2em"}),o[7]||(o[7]=C("p",{class:"q-mt-sm"},"No sigues a ning\xFAn usuario todav\xEDa.",-1))])):(y(),j(le,{key:1,bordered:""},{default:n(()=>[(y(!0),U(J,null,G(r.followedUsers,l=>(y(),j(ae,{key:l.id,class:"q-mb-sm"},{default:n(()=>[a(M,{avatar:""},{default:n(()=>[a(ue,null,{default:n(()=>[C("img",{src:l.photo_url||"default-avatar.png"},null,8,tt)]),_:2},1024)]),_:2},1024),a(M,null,{default:n(()=>[a(R,null,{default:n(()=>[T(E(l.name),1)]),_:2},1024),a(R,{caption:""},{default:n(()=>[T(E(l.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),a(oe,{name:"followers"},{default:n(()=>[r.followers.length===0?(y(),U("div",at,[a(re,{name:"people",size:"2em"}),o[8]||(o[8]=C("p",{class:"q-mt-sm"},"No tienes seguidores todav\xEDa.",-1))])):(y(),j(le,{key:1,bordered:""},{default:n(()=>[(y(!0),U(J,null,G(r.followers,l=>(y(),j(ae,{key:l.id,class:"q-mb-sm"},{default:n(()=>[a(M,{avatar:""},{default:n(()=>[a(ue,null,{default:n(()=>[C("img",{src:l.photo_url||"default-avatar.png"},null,8,lt)]),_:2},1024)]),_:2},1024),a(M,null,{default:n(()=>[a(R,null,{default:n(()=>[T(E(l.name),1)]),_:2},1024),a(R,{caption:""},{default:n(()=>[T(E(l.type),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),a(oe,{name:"wall"},{default:n(()=>[C("div",ot,[a(Y,{icon:"add",color:"black",class:"q-mb-xl fixed-bottom-right",size:"lg",glossy:"",round:"",onClick:o[1]||(o[1]=l=>r.showCreatePostDialog=!0)})]),a(le,{bordered:"",class:"q-mt-md"},{default:n(()=>[(y(!0),U(J,null,G(r.posts,l=>(y(),j(ae,{key:l.id,class:"q-mb-sm"},{default:n(()=>[a(M,null,{default:n(()=>[a(R,null,{default:n(()=>[T(E(l.content),1)]),_:2},1024),a(R,{caption:""},{default:n(()=>[T(E(r.formatDate(l.created_at)),1)]),_:2},1024),l.media_url?(y(),U("div",nt,[C("img",{src:l.media_url,style:{"max-width":"100%","border-radius":"8px"},alt:"Imagen del post"},null,8,rt)])):je("",!0),C("div",st,[(y(!0),U(J,null,G(l.reactions,(q,N)=>(y(),j(fe,{color:"transparent",key:N},{default:n(()=>[C("span",null,E(r.reactionEmojis[N])+" "+E(q),1)]),_:2},1024))),128))])]),_:2},1024),a(M,{side:""},{default:n(()=>[a(Y,{flat:"",icon:"delete",color:"negative",onClick:q=>r.deletePost(l.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(ze,{modelValue:r.showCreatePostDialog,"onUpdate:modelValue":o[5]||(o[5]=l=>r.showCreatePostDialog=l)},{default:n(()=>[a(qe,{class:"q-pa-md bg-black",style:{"min-width":"300px"}},{default:n(()=>[a(se,null,{default:n(()=>o[9]||(o[9]=[C("div",{class:"text-h6"},"Nuevo Post",-1)])),_:1}),a(se,null,{default:n(()=>[a(Ne,{modelValue:r.newPostContent,"onUpdate:modelValue":o[3]||(o[3]=l=>r.newPostContent=l),type:"textarea",label:"Escribe tu post",autogrow:""},null,8,["modelValue"]),a(Ge,{modelValue:r.newPostMedia,"onUpdate:modelValue":o[4]||(o[4]=l=>r.newPostMedia=l),label:"Subir imagen o video",accept:"image/*, video/*",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),a(Ee,{align:"right"},{default:n(()=>[ie(a(Y,{flat:"",label:"Cancelar",color:"negative"},null,512),[[de]]),ie(a(Y,{flat:"",label:"Publicar",color:"green",onClick:r.createPost},null,8,["onClick"]),[[de]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(h)]),_:1})}var qt=He(Je,[["render",it],["__scopeId","data-v-37748572"]]);export{qt as default};
