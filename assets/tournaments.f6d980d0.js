import{s as c}from"./supabase.0d8934eb.js";const u=async e=>{if(!e)return console.error("getTournamentsByClub llamado sin clubId."),[];const a=new Date().toISOString().split("T")[0];console.log(`Buscando torneos futuros para club ${e} desde fecha: ${a}`);try{const{data:r,error:n}=await c.from("tournaments").select("id, name, start_date, category, gender").eq("club_id",e).gte("start_date",a).order("start_date",{ascending:!0});return n?(console.error(`Error fetching future tournaments for club ${e}:`,n),[]):(console.log(`Encontrados ${(r==null?void 0:r.length)||0} torneos futuros para club ${e}.`),r||[])}catch(r){return console.error(`Excepci\xF3n en getTournamentsByClub para club ${e}:`,r),[]}},g=async e=>{console.log("Buscando torneos con filtros:",e);try{const a=new Date().toISOString().split("T")[0];let r=c.from("tournaments").select(`
              id,
              name,
              start_date,
              category,
              gender,
              price_per_pair,
              prize,
              details,
              club_id,
              clubs ( city, name )
          `).gte("start_date",a);(e==null?void 0:e.city)&&e.city!==""&&(console.log(`Aplicando filtro ciudad: ${e.city}`),r=r.eq("clubs.city",e.city)),(e==null?void 0:e.category)&&e.category!==""&&(console.log(`Aplicando filtro categor\xEDa: ${e.category}`),r=r.eq("category",e.category)),(e==null?void 0:e.gender)&&e.gender!==""&&(console.log(`Aplicando filtro g\xE9nero: ${e.gender}`),r=r.eq("gender",e.gender)),r=r.order("start_date",{ascending:!0});const{data:n,error:s}=await r;return s?(console.error("Error de Supabase al buscar torneos:",s),(s.message.includes("relation")||s.message.includes("schema"))&&console.warn("Posible problema con el filtro de relaci\xF3n (ciudad)."),[]):(console.log(`Se encontraron ${(n==null?void 0:n.length)||0} torneos.`),n||[])}catch(t){return console.error("Excepci\xF3n en fetchTournaments:",t),[]}},y=async e=>{const{data:t,error:a}=await c.from("tournaments").select("id, name, start_date, end_date, start_time, end_time, category, gender, system, price_per_pair, prize, details, clubs(name, city)").eq("id",e);if(a)throw Error(a.message);return t||[]},m=async e=>{const{data:t,error:a}=await c.from("tournament_teams").select("player1_id, player2_id").eq("tournament_id",e);if(a)throw new Error(a.message);if(!t||t.length===0)return[];const r=Array.from(new Set(t.flatMap(o=>[o.player1_id,o.player2_id]).filter(o=>o!==null))),{data:n,error:s}=await c.from("players").select("id, user_id, photo_url").in("user_id",r);if(s)throw new Error(s.message);const d=new Map(n.map(o=>[o.user_id,o]));return t.map(o=>({player1:d.get(o.player1_id),player2:d.get(o.player2_id)}))};export{y as a,m as b,g as f,u as g};
