import{Q as G}from"./QHeader.78843607.js";import{Q as J}from"./QSpinnerDots.b6bdf7c1.js";import{a7 as L,F as H,r as h,j as O,B as M,q as o,G as x,H as p,v as r,I as t,s,a9 as K,aa as W,x as u,ae as m,ab as i,y as g,ad as q,ac as Q,J as N,af as X,bC as R}from"./index.0423b3df.js";import{Q as Y}from"./QPage.fc5cffac.js";import{Q as Z,a as ee}from"./QLayout.df606e8a.js";import{u as ae}from"./use-quasar.d11f21bd.js";import{u as le}from"./summaryStore.6c551ed8.js";import{u as oe}from"./userStore.a3d1466b.js";import{a as re,b as te}from"./tournaments.af4847ed.js";import{P as se}from"./PlayerNavigationMenu.aca0ab78.js";import{B as ne}from"./BannerPromoScrolling.96d7faec.js";import{N as ie}from"./NotificationBell.fb51b868.js";import{_ as ue}from"./PlayerSearch.d4ab9e22.js";import{D as de}from"./DesktopNavigation.426f1110.js";import{_ as ce}from"./plugin-vue_export-helper.21dcd24c.js";import"./pinia.2a6edf20.js";import"./supabase.5916d516.js";import"./QTabs.70acac82.js";import"./rtl.276c3f1b.js";import"./QFooter.951c273f.js";import"./admin.5ab62d8c.js";import"./api.f1a1189d.js";import"./QBadge.9d16bc57.js";import"./QItem.53fb7b0a.js";import"./QItemLabel.fd16a80c.js";import"./QList.e848a474.js";import"./ClosePopup.cac46259.js";import"./players.4dc097c2.js";import"./QTooltip.c3ff9eb0.js";import"./position-engine.637e08d5.js";import"./selection.6800623a.js";const me={class:"header-content"},pe={class:"header-icons"},ve={key:0,class:"text-center q-pa-xl"},ge={key:1},ye={class:"q-mt-none q-mb-md"},_e={key:0},fe={key:1},be={key:2,class:"q-mt-md q-pa-md bg-blue-grey-1 rounded-borders"},he={class:"q-mb-none text-body2"},xe={key:3,class:"q-mt-md"},Pe={key:0},ke={key:1},De={key:2,class:"q-gutter-xs row items-center"},qe=["src","alt"],Ne={key:1},Ie={key:3,class:"q-gutter-xs row items-center"},Ce=["src","alt"],we={key:1},Re=["src","alt"],Se={key:1},je={key:4,class:"q-mt-md"},Te={key:0},Qe={key:0,class:"q-mt-sm"},$e={key:1},Ee={class:"text-center q-mb-md text-body2"},ze={key:2,class:"q-pa-md text-center text-negative"},Be={__name:"TournamentDetails",setup(Fe){const $=L(),I=H(),_=ae(),S=le(),l=h(null),P=h(!1),C=oe(),k=$.params.tournamentId,D=h(!1),d=h(null),v=h([]),E=async()=>{if(!k){console.error("ID del torneo no encontrado en los par\xE1metros de la ruta."),_.notify({type:"negative",message:"No se pudo identificar el torneo."}),P.value=!1;return}P.value=!0,l.value=null,v.value=[];try{const e=await re(k);if(!e||typeof e!="object")throw console.warn(`No se encontraron datos para el torneo ID ${k} o el formato es incorrecto.`),new Error("Torneo no encontrado o datos inv\xE1lidos.");l.value=e[0],console.log("Detalles del torneo cargados:",l.value);const a=await te(k);v.value=a,console.log("Jugadores inscritos:",v.value)}catch(e){console.error("Error al cargar detalles del torneo (desde loadData):",e),l.value=null,_.notify({type:"negative",message:(e==null?void 0:e.message)||"Error al cargar la informaci\xF3n del torneo."})}finally{P.value=!1}},z=()=>{var f;if(console.log("handleEnrollment called"),console.log("selectedPartner.value:",d.value),console.log("selectedPartner.value.email:",(f=d.value)==null?void 0:f.email),!l.value||!l.value.price_per_pair||!d.value){console.error("Datos del torneo incompletos o precio/pareja no disponible o pareja no seleccionada",l.value,d.value),_.notify({type:"negative",message:"No se puede procesar la inscripci\xF3n, falta informaci\xF3n del torneo o la pareja."});return}if(!d.value.email){console.error("El jugador seleccionado no tiene un email v\xE1lido:",d.value),_.notify({type:"negative",message:"El jugador seleccionado no tiene un email v\xE1lido. Por favor, selecciona otro jugador."});return}const e=l.value,a=(e.price_per_pair||0)/2,c={summaryTitle:"Resumen de Inscripci\xF3n a Torneo",itemDetails:[{label:"Torneo",value:e.name||"No especificado"},{label:"Club",value:e.clubName||"No especificado"},{label:"Fecha Inicio",value:e.start_date||"No especificada"},{label:"Categor\xEDa",value:y(e.category)||"No especificada"},{label:"G\xE9nero",value:y(e.gender)||"No especificado"},{label:"Precio Inscripci\xF3n (Individual)",value:`$${a.toFixed(2)}`},{label:"Precio Total (Pareja)",value:`$${e.price_per_pair.toFixed(2)}`},{label:"Pareja",value:`${d.value.first_name} ${d.value.last_name}`}],baseData:{clubId:e.clubId,price:a,participants:2,type:"tournament",id:e.id,recipient_user_id:e.club_user_id||null,player2_email:d.value.email},allowPaymentSplit:!0,showPublicToggle:!1,commissionRate:4,extraData:{tournamentName:e.name,tournament_name:e.name,prize:e.prize,pricePerPair:e.price_per_pair,partnerId:d.value.user_id,player2_email:d.value.email}};console.log("summaryProps before storing:",c),console.log("baseData.player2_email:",c.baseData.player2_email),console.log("extraData.player2_email:",c.extraData.player2_email),S.setSummaryDetails(c),console.log("Datos del resumen de TORNEO guardados en Pinia:",c),I.push({name:"OrderSummary"})},B=()=>{I.back()},F=e=>{console.log("Partner selected:",e),console.log("Partner email:",e==null?void 0:e.email),d.value=e,D.value=!1},j=O(()=>!v.value||!C.userId?!1:v.value.some(e=>{var a,c;return((a=e.player1)==null?void 0:a.user_id)===C.userId||((c=e.player2)==null?void 0:c.user_id)===C.userId})),w=e=>{if(!e)return"??";const a=e.split("-");return a.length>0?a[0].substring(0,2).toUpperCase():e.substring(0,2).toUpperCase()},V=e=>({"round-robin":"Round Robin","eliminacion directa":"Eliminaci\xF3n Directa",combinado:"Combinado (Grupos + Playoffs)",liga:"Liga (Todos vs Todos)",retas:"Retas (Rotaci\xF3n de Parejas)"})[e]||e,y=e=>e&&e.charAt(0).toUpperCase()+e.slice(1),A=()=>!l.value||l.value.system!=="retas"?0:v.value.filter(e=>e.player1).length,U=async()=>{if(!l.value){_.notify({type:"negative",message:"No se pudo encontrar la informaci\xF3n del torneo."});return}const e=l.value,a=(e.price_per_pair||0)/2,c={summaryTitle:"Resumen de Inscripci\xF3n a Retas",itemDetails:[{label:"Evento",value:e.name||"No especificado"},{label:"Club",value:e.clubName||"No especificado"},{label:"Fecha Inicio",value:e.start_date||"No especificada"},{label:"Categor\xEDa",value:y(e.category)||"No especificada"},{label:"G\xE9nero",value:y(e.gender)||"No especificado"},{label:"Sistema",value:"Retas (Rotaci\xF3n de Parejas)"},{label:"Precio Individual",value:`$${a.toFixed(2)}`}],baseData:{clubId:e.clubId,price:a,participants:1,type:"tournament",id:e.id,recipient_user_id:e.club_user_id||null},extraData:{partnerId:null,isRetas:!0},successRedirect:"/dashboard/player",errorRedirect:`/tournament/${e.id}`};S.setSummaryProps(c),I.push("/tournament-checkout")};return M(()=>{E()}),(e,a)=>(o(),x(Z,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:p(()=>[r(G,{elevated:"",class:"text-white"},{default:p(()=>[t("div",me,[a[2]||(a[2]=t("div",{class:"greeting"},[t("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"})],-1)),t("div",pe,[r(ie)])]),r(ne)]),_:1}),r(de),r(ee,null,{default:p(()=>[r(Y,{class:"q-pa-md"},{default:p(()=>[P.value?(o(),s("div",ve,[r(J,{color:"primary",size:"xl"}),a[3]||(a[3]=t("p",{class:"q-mt-md"},"Cargando detalles del torneo...",-1))])):l.value?(o(),s("div",ge,[r(K,null,{default:p(()=>[r(W,null,{default:p(()=>{var c,f;return[t("h4",ye,u(l.value.name),1),t("p",null,[t("strong",null,[r(m,{name:"mdi-calendar-start",class:"q-mr-xs"}),a[4]||(a[4]=i("Inicio:"))]),i(" "+u(l.value.start_date)+" - "+u(l.value.start_time)+" hrs. ",1)]),t("p",null,[t("strong",null,[r(m,{name:"mdi-domain",class:"q-mr-xs"}),a[5]||(a[5]=i("Club:"))]),i(" "+u((c=l.value.clubs)==null?void 0:c.name),1)]),t("p",null,[t("strong",null,[r(m,{name:"mdi-trophy-variant-outline",class:"q-mr-xs"}),a[6]||(a[6]=i("Categor\xEDa:"))]),i(" "+u(y(l.value.category)),1)]),t("p",null,[t("strong",null,[r(m,{name:"mdi-gender-male-female",class:"q-mr-xs"}),a[7]||(a[7]=i("G\xE9nero:"))]),i(" "+u(y(l.value.gender)),1)]),t("p",null,[t("strong",null,[r(m,{name:"mdi-cogs",class:"q-mr-xs"}),a[8]||(a[8]=i("Sistema:"))]),i(" "+u(V(l.value.system)),1)]),l.value.system==="retas"?(o(),s("p",_e,[t("strong",null,[r(m,{name:"mdi-cash-multiple",class:"q-mr-xs"}),a[9]||(a[9]=i("Precio por Jugador:"))]),i(" $"+u((l.value.price_per_pair/2).toFixed(2)||"N/A"),1)])):(o(),s("p",fe,[t("strong",null,[r(m,{name:"mdi-cash-multiple",class:"q-mr-xs"}),a[10]||(a[10]=i("Precio por Pareja:"))]),i(" $"+u(((f=l.value.price_per_pair)==null?void 0:f.toFixed(2))||"N/A"),1)])),t("p",null,[t("strong",null,[r(m,{name:"mdi-gift-outline",class:"q-mr-xs"}),a[11]||(a[11]=i("Premios (Valor):"))]),i(" $"+u(l.value.prize||"N/A"),1)]),l.value.details?(o(),s("div",be,[t("p",null,[t("strong",null,[r(m,{name:"mdi-information-outline",class:"q-mr-xs"}),a[12]||(a[12]=i("Detalles del Torneo:"))])]),t("p",he,u(l.value.details),1)])):g("",!0),v.value.length>0?(o(),s("div",xe,[l.value.system==="retas"?(o(),s("p",Pe,[t("strong",null,[r(m,{name:"mdi-account-multiple",class:"q-mr-xs"}),i("Jugadores Inscritos ("+u(A())+"):",1)])])):(o(),s("p",ke,[t("strong",null,[r(m,{name:"account-group-outline",class:"q-mr-xs"}),a[13]||(a[13]=i("Jugadores Inscritos:"))])])),l.value.system==="retas"?(o(),s("div",De,[(o(!0),s(q,null,Q(v.value,n=>{var b;return o(),s(q,{key:(b=n.player1)==null?void 0:b.user_id},[n.player1?(o(),x(R,{key:0,size:"48px",color:"orange","text-color":"white"},{default:p(()=>[n.player1.photo_url?(o(),s("img",{key:0,src:n.player1.photo_url,alt:n.player1.user_id},null,8,qe)):(o(),s("span",Ne,u(w(n.player1.user_id)),1))]),_:2},1024)):g("",!0)],64)}),128))])):(o(),s("div",Ie,[(o(!0),s(q,null,Q(v.value,n=>{var b,T;return o(),s(q,{key:((b=n.player1)==null?void 0:b.user_id)+"-"+((T=n.player2)==null?void 0:T.user_id)},[n.player1?(o(),x(R,{key:0,size:"48px",color:"white","text-color":"black",class:"overlapping"},{default:p(()=>[n.player1.photo_url?(o(),s("img",{key:0,src:n.player1.photo_url,alt:n.player1.user_id},null,8,Ce)):(o(),s("span",we,u(w(n.player1.user_id)),1))]),_:2},1024)):g("",!0),n.player2?(o(),x(R,{key:1,size:"48px",color:"white","text-color":"black",class:"overlapping"},{default:p(()=>[n.player2.photo_url?(o(),s("img",{key:0,src:n.player2.photo_url,alt:n.player2.user_id},null,8,Re)):(o(),s("span",Se,u(w(n.player2.user_id)),1))]),_:2},1024)):g("",!0)],64)}),128))]))])):g("",!0),j.value?g("",!0):(o(),s("div",je,[l.value.system!=="retas"?(o(),s("div",Te,[r(N,{color:"primary",label:"Elige tu Pareja","icon-right":"mdi-account-search",onClick:a[0]||(a[0]=n=>D.value=!0),class:"full-width",size:"md",push:""}),d.value?(o(),s("p",Qe," Pareja Seleccionada: "+u(d.value.first_name)+" "+u(d.value.last_name),1)):g("",!0)])):(o(),s("div",$e,[t("p",Ee,[r(m,{name:"mdi-rotate-3d-variant",class:"q-mr-xs"}),a[14]||(a[14]=i(" En las retas juegas con diferentes parejas en cada ronda "))]),r(N,{label:"Inscribirme a las Retas",color:"orange","icon-right":"mdi-account-plus",class:"full-width",size:"lg",push:"",onClick:U,disable:!l.value,title:"Inscribirse individualmente a las retas"},null,8,["disable"])]))]))]}),_:1}),r(X,{align:"center",class:"q-pa-md"},{default:p(()=>[!j.value&&d.value&&l.value.system!=="retas"?(o(),x(N,{key:0,label:"Inscribir Pareja",color:"green","icon-right":"mdi-pencil-plus-outline",class:"full-width",size:"lg",push:"",onClick:z,disable:!l.value,title:"Inscribirse al torneo pagando la mitad del costo de pareja"},null,8,["disable"])):g("",!0)]),_:1})]),_:1})])):(o(),s("div",ze,[r(m,{name:"mdi-alert-circle-outline",size:"lg"}),a[15]||(a[15]=t("p",{class:"q-mt-md"},"No se pudieron cargar los detalles del torneo.",-1)),r(N,{flat:"",label:"Volver",onClick:B})]))]),_:1})]),_:1}),r(se),r(ue,{modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=c=>D.value=c),onPlayerSelected:F},null,8,["modelValue"])]),_:1}))}};var _a=ce(Be,[["__scopeId","data-v-8e3f3a0e"]]);export{_a as default};
