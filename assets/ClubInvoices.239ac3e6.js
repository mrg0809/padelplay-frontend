import{F as P,r as i,j as g,B as A,q as _,G as U,H as l,v as a,I as s,ab as u,J as C,K as I,s as f,x as r,a9 as y,aa as h,ae as O}from"./index.f175e85d.js";import{Q as $}from"./QHeader.b5531e4e.js";import{Q as R}from"./QSelect.ae69f148.js";import{Q as M}from"./QSpinnerPuff.f5541069.js";import{Q as c}from"./QTd.4e492c9c.js";import{Q as G}from"./QChip.0b7e576e.js";import{Q as H}from"./QTable.22a4e8e2.js";import{Q as j}from"./QPage.80e57fbc.js";import{Q as z,a as J}from"./QLayout.0fe9a5f1.js";import{u as Y}from"./use-quasar.8df62ead.js";import{u as K}from"./userStore.bb5275fc.js";import{C as W}from"./ClubNavigationMenu.dc203a0a.js";import{d as X,g as Z}from"./paymentsDebug.162ce73d.js";import{_ as ee}from"./plugin-vue_export-helper.21dcd24c.js";import"./QItem.34e65fde.js";import"./QItemLabel.da316464.js";import"./QMenu.2e28105c.js";import"./position-engine.eb8a1775.js";import"./selection.b09b6f35.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./QList.74d644b7.js";import"./use-fullscreen.91a2e034.js";import"./pinia.c6718bec.js";import"./QTabs.16df4bb6.js";import"./QFooter.a145b798.js";import"./supabase.869de744.js";const te={class:"header-content"},oe={class:"header-icons"},ae={class:"row q-gutter-md q-mb-md"},le={class:"col-12 col-md-3"},se={class:"col-12 col-md-3"},re={class:"col-12 col-md-3"},ne={class:"col-12 col-md-3 flex items-end"},ie={key:0,class:"text-center q-my-lg"},ue={key:1},de={class:"row q-gutter-md q-mt-lg"},ce={class:"col-12 col-md-3"},me={class:"text-h4"},pe={class:"col-12 col-md-3"},ve={class:"text-h4"},_e={class:"col-12 col-md-3"},be={class:"text-h4"},ge={key:2,class:"text-center q-my-lg"},fe={__name:"ClubInvoices",setup(ye){const w=P(),x=Y(),d=K(),n=i([]),m=i(!1),p=i(""),v=i(""),b=i(""),Q=i([{label:"Reservas",value:"reservation"},{label:"Lecciones",value:"lesson"},{label:"Torneos",value:"tournament"},{label:"Productos",value:"product"}]),S=i([{name:"order_date",label:"Fecha",field:"order_date",align:"left",sortable:!0},{name:"customer",label:"Cliente",field:o=>{var e;return((e=o.profiles)==null?void 0:e.full_name)||"N/A"},align:"left"},{name:"event_type",label:"Tipo",field:"event_type",align:"center"},{name:"payment_method",label:"M\xE9todo de Pago",field:"payment_method",align:"center"},{name:"total_amount",label:"Monto Total",field:"total_amount",align:"right",sortable:!0},{name:"club_commission",label:"Comisi\xF3n Club",field:"club_commission",align:"right"},{name:"player_commission",label:"Comisi\xF3n Jugador",field:"player_commission",align:"right"},{name:"net_amount",label:"Monto Neto",field:"net_amount",align:"right"}]),k=g(()=>n.value.reduce((o,e)=>o+Number(e.total_amount||0),0)),F=g(()=>n.value.reduce((o,e)=>o+Number(e.club_commission||0)+Number(e.player_commission||0),0)),T=g(()=>n.value.reduce((o,e)=>{const t=Number(e.total_amount||0),L=Number(e.club_commission||0)+Number(e.player_commission||0);return o+(t-L)},0)),D=()=>{w.back()},E=o=>new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),V=o=>{const e=Number(o.total_amount||0),t=Number(o.club_commission||0)+Number(o.player_commission||0);return(e-t).toFixed(2)},B=o=>({reservation:"Reserva",lesson:"Lecci\xF3n",tournament:"Torneo",product:"Producto"})[o]||o,q=o=>({reservation:"blue",lesson:"green",tournament:"orange",product:"purple"})[o]||"grey",N=async()=>{if(console.log("DEBUG ClubInvoices: userStore data:",{userId:d.userId,clubId:d.clubId,userType:d.userType}),!d.clubId){x.notify({type:"negative",message:"No se encontr\xF3 informaci\xF3n del club"});return}m.value=!0;try{n.value.length===0&&(console.log("=== RUNNING CLUB INVOICES DEBUG ANALYSIS ==="),await X(d.clubId),console.log("=== CLUB INVOICES DEBUG ANALYSIS COMPLETE ==="));const o=await Z(d.clubId,p.value||null,v.value||null,b.value||null);n.value=o}catch(o){console.error("Error fetching payment orders:",o),x.notify({type:"negative",message:"Error al cargar las facturas"})}finally{m.value=!1}};return A(()=>{const o=new Date,e=new Date(o);e.setDate(o.getDate()-30),p.value=e.toISOString().split("T")[0],v.value=o.toISOString().split("T")[0],N()}),(o,e)=>(_(),U(z,{view:"hHh lpR fFf",class:"body text-white"},{default:l(()=>[a($,{elevated:"",class:"bg-primary text-white"},{default:l(()=>[s("div",te,[e[3]||(e[3]=s("div",{class:"greeting"},[s("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon"}),u(" Facturas ")],-1)),s("div",oe,[a(C,{flat:"",round:"",icon:"arrow_back",onClick:D})])])]),_:1}),a(J,null,{default:l(()=>[a(j,{class:"q-pa-md"},{default:l(()=>[s("div",ae,[s("div",le,[a(I,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),type:"date",label:"Fecha Inicio",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),s("div",se,[a(I,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),type:"date",label:"Fecha Fin",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),s("div",re,[a(R,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),options:Q.value,label:"Tipo de Reserva",outlined:"",dense:"",dark:"",color:"white",clearable:""},null,8,["modelValue","options"])]),s("div",ne,[a(C,{onClick:N,color:"primary",label:"Filtrar",loading:m.value,dense:""},null,8,["loading"])])]),m.value?(_(),f("div",ie,[a(M,{color:"primary",size:"3em"}),e[4]||(e[4]=s("p",{class:"q-mt-md"},"Cargando facturas...",-1))])):n.value.length>0?(_(),f("div",ue,[a(H,{columns:S.value,rows:n.value,"row-key":"id",dense:"",class:"bg-black text-white","rows-per-page-options":[10,25,50],"rows-per-page-label":"Filas por p\xE1gina:","no-data-label":"No hay facturas disponibles"},{"body-cell-order_date":l(t=>[a(c,{props:t},{default:l(()=>[u(r(E(t.value)),1)]),_:2},1032,["props"])]),"body-cell-total_amount":l(t=>[a(c,{props:t},{default:l(()=>[u(" $"+r(Number(t.value).toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-club_commission":l(t=>[a(c,{props:t},{default:l(()=>[u(" $"+r(Number(t.value||0).toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-player_commission":l(t=>[a(c,{props:t},{default:l(()=>[u(" $"+r(Number(t.value||0).toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-net_amount":l(t=>[a(c,{props:t,class:"text-green"},{default:l(()=>[u(" $"+r(V(t.row)),1)]),_:2},1032,["props"])]),"body-cell-event_type":l(t=>[a(c,{props:t},{default:l(()=>[a(G,{color:q(t.value),"text-color":"white",dense:""},{default:l(()=>[u(r(B(t.value)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),_:1},8,["columns","rows"]),s("div",de,[s("div",ce,[a(y,{class:"bg-primary text-white"},{default:l(()=>[a(h,null,{default:l(()=>[e[5]||(e[5]=s("div",{class:"text-h6"},"Total Facturado",-1)),s("div",me,"$"+r(k.value.toFixed(2)),1)]),_:1})]),_:1})]),s("div",pe,[a(y,{class:"bg-orange text-white"},{default:l(()=>[a(h,null,{default:l(()=>[e[6]||(e[6]=s("div",{class:"text-h6"},"Comisi\xF3n Plataforma",-1)),s("div",ve,"$"+r(F.value.toFixed(2)),1)]),_:1})]),_:1})]),s("div",_e,[a(y,{class:"bg-green text-white"},{default:l(()=>[a(h,null,{default:l(()=>[e[7]||(e[7]=s("div",{class:"text-h6"},"Total Recibido",-1)),s("div",be,"$"+r(T.value.toFixed(2)),1)]),_:1})]),_:1})])])])):(_(),f("div",ge,[a(O,{name:"receipt",size:"4em",color:"black"}),e[8]||(e[8]=s("p",{class:"text-h6 q-mt-md"},"No hay facturas para mostrar",-1)),e[9]||(e[9]=s("p",{class:"text-black"},"Ajusta los filtros para ver m\xE1s resultados",-1))]))]),_:1})]),_:1}),a(W)]),_:1}))}};var ze=ee(fe,[["__scopeId","data-v-3a22e1e1"]]);export{ze as default};
