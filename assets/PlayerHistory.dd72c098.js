import{Q as le}from"./QHeader.3330d6d5.js";import{x as ne,y as ce,r as p,h as de,o as i,z as q,A as o,d as s,B as r,bK as B,D as v,a as l,a7 as E,a8 as V,a9 as _,E as j,e as $,ac as w,ab as L,aa as G,bG as R,t as c}from"./index.39adb644.js";import{Q as ue}from"./QSpinnerDots.cb16c82d.js";import{Q as me}from"./QTooltip.04e4bb6f.js";import{Q as A,a as y}from"./QItem.87198ca3.js";import{Q as f}from"./QItemLabel.24f30c08.js";import{Q as M}from"./QChip.4e1820bf.js";import{Q as U}from"./QList.aedeb71d.js";import{Q as pe}from"./QPage.28b7989a.js";import{Q as _e,a as ve}from"./QLayout.136fc703.js";import{s as S}from"./supabase.6e6ca5a2.js";import{d as ye}from"./dateUtils.11b71e5b.js";import{u as fe}from"./useDashboardNavigation.baccc7a3.js";import{P as ge}from"./PlayerNavigationMenu.beb9b04c.js";import{P as he}from"./PlayerTopMenu.21e0acc6.js";import{N as be}from"./NotificationBell.dfc226fc.js";import{B as xe}from"./BannerPromoScrolling.b0548ecb.js";import{_ as we}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.8dba34ce.js";import"./selection.365c2d2e.js";import"./QTabs.de2e2033.js";import"./rtl.276c3f1b.js";import"./QFooter.c2826d80.js";import"./QBtnDropdown.22dad14d.js";import"./QBtnGroup.37474f86.js";import"./QMenu.5f547e53.js";import"./haptics.92a2f832.js";import"./QBadge.a73c281f.js";import"./api.65c10df7.js";import"./admin.e253f26e.js";const ke={class:"header-content"},Ce={class:"greeting"},De={class:"header-icons"},Qe={class:"player-container"},Pe={class:"row items-center q-mb-md history-header"},qe={key:0,class:"text-center q-pa-xl"},$e={key:1,class:"history-content"},Se={class:"history-tabs q-mb-md"},Ne={class:"history-layout"},He={key:0,class:"history-section"},Te={class:"section-header"},Fe={key:0,class:"date-filter-section q-mb-md"},Ie={class:"row q-gutter-sm"},ze={class:"col"},Be={class:"col"},Ee={class:"row q-gutter-sm q-mt-sm"},Ve={key:1,class:"empty-state"},je={key:2,class:"payment-list"},Le={class:"text-right"},Ge={class:"text-weight-bold amount"},Re={key:1,class:"history-section"},Ae={key:0,class:"empty-state"},Me={key:1,class:"games-list"},Ue={class:"text-right"},Je={class:"q-mt-xs text-caption text-grey"},Oe={__name:"PlayerHistory",setup(Ke){const g=ne(),k=ce().userId,{goToDashboard:N}=fe(),h=p(!0),n=p("payments"),D=p([]),Q=p([]),b=p(""),x=p(""),C=p(!0),H=()=>{const e=new Date,t=new Date;t.setDate(e.getDate()-15),x.value=e.toISOString().split("T")[0],b.value=t.toISOString().split("T")[0]},T=async()=>{try{let e=S.from("payment_orders").select("*").eq("user_id",k);b.value&&(e=e.gte("order_date",b.value)),x.value&&(e=e.lte("order_date",x.value));const{data:t,error:a}=await e.order("order_date",{ascending:!1});if(a){console.error("Error loading payment history:",a);return}D.value=t||[]}catch(e){console.error("Error loading payment history:",e)}},F=async()=>{h.value=!0,await T(),h.value=!1},J=async()=>{H(),await F()},O=async()=>{try{const{data:e,error:t}=await S.from("reservations").select(`
        *,
        courts(id, name, club_id, clubs(name)),
        matches(id, gender, category, team1_players, team2_players)
      `).eq("player_id",k).order("reservation_date",{ascending:!1}).limit(50);if(t){console.error("Error loading games history:",t);return}const{data:a,error:d}=await S.from("matches").select(`
        id, gender, category, team1_players, team2_players,
        reservations(id, reservation_date, start_time, end_time, status, courts(id, name, clubs(name)))
      `).or(`team1_players.cs.{${k}},team2_players.cs.{${k}}`).order("created_at",{ascending:!1}).limit(50);d&&console.error("Error loading match reservations:",d);const u=[...e||[]];a&&a.forEach(m=>{m.reservations&&!u.some(P=>P.id===m.reservations.id)&&u.push({id:m.reservations.id,...m.reservations,matches:m})}),u.sort((m,P)=>new Date(P.reservation_date)-new Date(m.reservation_date)),Q.value=u}catch(e){console.error("Error loading games history:",e)}},I=e=>{switch(e){case"succeeded":case"approved":return"positive";case"pending":return"warning";case"failed":case"rejected":return"negative";default:return"grey"}},K=e=>{switch(e){case"succeeded":case"approved":return"Exitoso";case"pending":return"Pendiente";case"failed":case"rejected":return"Fallido";default:return e}},X=e=>{switch(e){case"court":case"reservation":return"sports_tennis";case"tournament":return"emoji_events";case"lesson":return"school";case"open_match_join":return"group_add";default:return"payment"}},W=e=>{switch(e.event_type){case"court":case"reservation":return"Reserva de cancha";case"tournament":return"Inscripci\xF3n a torneo";case"lesson":return"Clase de p\xE1del";case"open_match_join":return"Uni\xF3n a partido abierto";default:return e.event_type||"Pago"}},Y=e=>{switch(e){case"completed":return"positive";case"active":case"confirmed":return"primary";case"cancelled":return"negative";default:return"grey"}},Z=e=>{switch(e){case"completed":return"Completado";case"active":case"confirmed":return"Confirmado";case"cancelled":return"Cancelado";default:return e||"Programado"}},ee=e=>{if(e.matches){const t=e.matches;let a="Partido";return t.gender&&(a+=` ${t.gender}`),t.category&&(a+=` - ${t.category}`),a}return"Reserva de cancha"},te=e=>{var t,a;if(e.courts){const d=e.courts.name||"Cancha sin nombre",u=((t=e.courts.clubs)==null?void 0:t.name)||((a=e.courts.club)==null?void 0:a.name);return u?`${d} - ${u}`:d}return"Cancha sin nombre"},z=e=>e?ye(e):"",se=e=>e?e.substring(0,5):"",ae=e=>e?Number(e).toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",oe=()=>{g.go(-1)},re=e=>{var t;(t=e.matches)!=null&&t.id?g.push(`/player/match/${e.matches.id}`):e.id&&console.log("Reservation details:",e)},ie=e=>{switch(e.event_type){case"court":case"reservation":case"open_match_join":e.event_id&&g.push(`/player/match/${e.event_id}`);break;case"tournament":e.event_id&&g.push(`/player/tournaments/${e.event_id}`);break;case"lesson":case"private-lesson":case"public-lesson":e.event_id&&g.push(`/player/classes/${e.event_id}`);break;default:console.log("Payment details:",e)}};return de(async()=>{h.value=!0,H(),await Promise.all([T(),O()]),h.value=!1}),(e,t)=>(i(),q(_e,{view:"hHh lpR fFf",class:"text-white"},{default:o(()=>[s(le,{elevated:"",class:"text-white"},{default:o(()=>[r("div",ke,[r("div",Ce,[r("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...a)=>B(N)&&B(N)(...a))})]),r("div",De,[s(be),s(he)])]),s(xe)]),_:1}),s(ve,null,{default:o(()=>[s(pe,{class:"q-pa-md"},{default:o(()=>[r("div",Qe,[r("div",Pe,[s(v,{flat:"",round:"",dense:"",icon:"arrow_back",class:"text-white",onClick:oe}),t[6]||(t[6]=r("h5",{class:"text-white q-ma-none q-ml-md"},"Historial",-1))]),h.value?(i(),l("div",qe,[s(ue,{size:"50px",color:"white"}),t[7]||(t[7]=r("div",{class:"q-mt-md text-white"},"Cargando historial...",-1))])):(i(),l("div",$e,[r("div",Se,[s(v,{color:n.value==="payments"?"primary":"grey",outline:n.value!=="payments",label:"Pagos",onClick:t[1]||(t[1]=a=>n.value="payments"),class:"tab-btn"},null,8,["color","outline"]),s(v,{color:n.value==="games"?"primary":"grey",outline:n.value!=="games",label:"Juegos",onClick:t[2]||(t[2]=a=>n.value="games"),class:"tab-btn"},null,8,["color","outline"])]),r("div",Ne,[n.value==="payments"?(i(),l("div",He,[s(E,{flat:"",bordered:"",class:"text-white history-card"},{default:o(()=>[s(V,null,{default:o(()=>[r("div",Te,[t[9]||(t[9]=r("div",{class:"text-h6"},"\u{1F4CB} Historial de Pagos",-1)),s(v,{flat:"",round:"",dense:"",icon:C.value?"expand_less":"tune",onClick:t[3]||(t[3]=a=>C.value=!C.value),color:"primary",class:"q-ml-sm"},{default:o(()=>[s(me,null,{default:o(()=>[...t[8]||(t[8]=[_("Filtrar por fechas",-1)])]),_:1})]),_:1},8,["icon"])]),C.value?(i(),l("div",Fe,[r("div",Ie,[r("div",ze,[s(j,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=a=>b.value=a),type:"date",label:"Desde",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])]),r("div",Be,[s(j,{modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=a=>x.value=a),type:"date",label:"Hasta",outlined:"",dense:"",dark:"",color:"white"},null,8,["modelValue"])])]),r("div",Ee,[s(v,{label:"Aplicar",color:"primary",onClick:F,size:"sm"}),s(v,{label:"\xDAltimos 15 d\xEDas",color:"secondary",outline:"",onClick:J,size:"sm"})])])):$("",!0),D.value.length===0?(i(),l("div",Ve,[s(w,{name:"payment",size:"50px",color:"grey"}),t[10]||(t[10]=r("div",{class:"q-mt-md text-grey"},"No tienes pagos registrados",-1))])):(i(),l("div",je,[s(U,{separator:"",class:"text-white"},{default:o(()=>[(i(!0),l(L,null,G(D.value,a=>(i(),q(A,{key:a.id,class:"payment-item",clickable:"",onClick:d=>ie(a)},{default:o(()=>[s(y,{avatar:""},{default:o(()=>[s(R,{color:I(a.payment_status),"text-color":"white",size:"40px"},{default:o(()=>[s(w,{name:X(a.event_type)},null,8,["name"])]),_:2},1032,["color"])]),_:2},1024),s(y,{class:"payment-details"},{default:o(()=>[s(f,{class:"text-weight-bold payment-title"},{default:o(()=>[_(c(W(a)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey payment-date"},{default:o(()=>[_(c(z(a.order_date)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey payment-method"},{default:o(()=>[_(c(a.payment_method),1)]),_:2},1024)]),_:2},1024),s(y,{side:"",class:"payment-amount"},{default:o(()=>[r("div",Le,[r("div",Ge," $"+c(ae(a.total_amount)),1),s(M,{color:I(a.payment_status),"text-color":"white",size:"sm",label:K(a.payment_status)},null,8,["color","label"])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]))]),_:1})]),_:1})])):$("",!0),n.value==="games"?(i(),l("div",Re,[s(E,{flat:"",bordered:"",class:"text-white history-card"},{default:o(()=>[s(V,null,{default:o(()=>[t[12]||(t[12]=r("div",{class:"section-header"},[r("div",{class:"text-h6"},"\u{1F3D3} Historial de Juegos")],-1)),Q.value.length===0?(i(),l("div",Ae,[s(w,{name:"sports_tennis",size:"50px",color:"grey"}),t[11]||(t[11]=r("div",{class:"q-mt-md text-grey"},"No tienes juegos registrados",-1))])):(i(),l("div",Me,[s(U,{separator:"",class:"text-white"},{default:o(()=>[(i(!0),l(L,null,G(Q.value,a=>(i(),q(A,{key:a.id,class:"game-item",clickable:"",onClick:d=>re(a)},{default:o(()=>[s(y,{avatar:""},{default:o(()=>[s(R,{color:"primary","text-color":"white",size:"40px"},{default:o(()=>[s(w,{name:"sports_tennis"})]),_:1})]),_:1}),s(y,{class:"game-details"},{default:o(()=>[s(f,{class:"text-weight-bold game-title"},{default:o(()=>[_(c(te(a)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey game-date"},{default:o(()=>[_(c(z(a.reservation_date))+" - "+c(se(a.start_time)),1)]),_:2},1024),s(f,{caption:"",class:"text-grey game-type"},{default:o(()=>[_(c(ee(a)),1)]),_:2},1024)]),_:2},1024),s(y,{side:"",class:"game-status"},{default:o(()=>[r("div",Ue,[s(M,{color:Y(a.status),"text-color":"white",size:"sm",label:Z(a.status)},null,8,["color","label"]),r("div",Je,[s(w,{name:"chevron_right"})])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]))]),_:1})]),_:1})])):$("",!0)])]))])]),_:1})]),_:1}),s(ge)]),_:1}))}};var Pt=we(Oe,[["__scopeId","data-v-84ce4836"]]);export{Pt as default};
