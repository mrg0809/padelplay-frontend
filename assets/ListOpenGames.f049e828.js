import{Q as se}from"./QHeader.3518b267.js";import{F as le,r as p,w as re,B as ne,q as r,G as u,H as s,v as l,I as a,bG as U,ae as w,ab as k,s as d,ac as ie,ad as ce,a9 as de,aa as z,x as n,bC as C,y as ue,J as q,aU as M}from"./index.a05546fd.js";import{Q as I,a as P}from"./QItem.e38a8786.js";import{Q as $}from"./QSelect.eb5f7fc7.js";import{Q as pe}from"./QList.f969f6a2.js";import{Q as me}from"./QSpinnerDots.33aa6a01.js";import{Q as _e}from"./QPage.f01afbe1.js";import{Q as ye,a as ve}from"./QLayout.46a61ef3.js";import{s as A}from"./supabase.9337c7d0.js";import{f as fe}from"./commun.0c2088c1.js";import{u as be}from"./useDashboardNavigation.a1f678a3.js";import{u as he}from"./summaryStore.45b2cdc4.js";import{u as ke}from"./use-quasar.c5364419.js";import{P as ge}from"./PlayerNavigationMenu.25e2275d.js";import{N as De}from"./NotificationBell.7faf38c2.js";import{B as xe}from"./BannerPromoScrolling.769d50f5.js";import{D as Se}from"./DesktopNavigation.cb844375.js";import"./QChip.5ead8bc8.js";import"./QItemLabel.3b94dbaa.js";import"./QMenu.d39fc5b7.js";import"./position-engine.246fbfef.js";import"./selection.a09e7172.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./userStore.2b3b6ba3.js";import"./pinia.eaa32ff8.js";import"./QTabs.b249ec85.js";import"./QFooter.216d5ed8.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QBadge.50532ba9.js";import"./api.2af71db3.js";import"./admin.c99b9bfe.js";import"./QTooltip.b593864b.js";const we={class:"header-content"},Ce={class:"greeting"},Ne={class:"header-icons"},Qe={class:"row q-col-gutter-md q-mb-lg"},Te={class:"col-12 col-sm-4"},Oe={class:"col-12 col-sm-4"},qe={class:"col-12 col-sm-4"},Me={class:"games-list"},Ie={class:"court-container"},Pe={class:"court"},$e={class:"player team1-player1"},je={key:0},Fe=["src"],Ve={key:1},Le={class:"text-caption"},Ee={class:"player team1-player2"},He={key:0},Be=["src"],Ge={key:1},Je={class:"text-caption"},Ue={class:"player team2-player1"},ze={key:0},Ae=["src"],Xe={key:1},Re={class:"text-caption"},We={class:"player team2-player2"},Ke={key:0},Ye=["src"],Ze={key:1},et={class:"text-caption"},tt={class:"club-info"},ot=["src"],at={class:"club-name"},st={class:"price-duration"},lt={class:"total-price"},rt={class:"duration"},nt={key:1,class:"text-center"},it={key:2,class:"text-center text-black"},Gt={__name:"ListOpenGames",setup(ct){const X=le(),{goToDashboard:j}=be(),R=he(),F=ke(),D=p([]),x=p([]),W=p(["Hoy","Ma\xF1ana","Esta Semana","Pr\xF3ximos 7 d\xEDas"]),K=p(["femenil","varonil","mixto"]),v=p(null),g=p(null),f=p(null),b=p([]),N=p(!1),V=o=>new Date(o).toLocaleDateString("es-MX",{day:"numeric",month:"long",year:"numeric"}),Y=(o,t)=>{const[e,i]=o.split(":").map(Number),[_,m]=t.split(":").map(Number);let y=_*60+m-(e*60+i);return y<0&&(y+=24*60),y},Z=async()=>{try{const o=await fe();D.value=o.map(t=>typeof t=="string"?t:t.value||t.label||t),x.value=D.value}catch{}},ee=(o,t)=>{if(o===""){t(()=>{x.value=D.value});return}t(()=>{const e=o.toLowerCase();x.value=D.value.filter(i=>i.toLowerCase().indexOf(e)>-1)})},L=async()=>{N.value=!0,b.value=[];try{let o=A.from("matches").select(`
                id, match_date, match_time, category, gender, is_open, team1_players, team2_players,
                club:clubs!inner ( id, name, city, logo_url ),
                reservation:reservations ( total_price, start_time, end_time )
            `).eq("is_open",!0);const t=g.value,e=new Date;e.setHours(0,0,0,0);const i=new Date(e);i.setDate(e.getDate()+1);const _=new Date(e);_.setDate(e.getDate()+2);const m=new Date(e);m.setDate(e.getDate()+(7-e.getDay())),m.setHours(23,59,59,999);const y=new Date(e);y.setDate(e.getDate()+7),y.setHours(23,59,59,999);const S=e.toISOString().split("T")[0],E=i.toISOString().split("T")[0],te=_.toISOString().split("T")[0],oe=m.toISOString().split("T")[0],ae=y.toISOString().split("T")[0];t==="Hoy"?o=o.gte("match_date",S).lt("match_date",E):t==="Ma\xF1ana"?o=o.gte("match_date",E).lt("match_date",te):t==="Esta Semana"?o=o.gte("match_date",S).lte("match_date",oe):t==="Pr\xF3ximos 7 d\xEDas"?o=o.gte("match_date",S).lte("match_date",ae):o=o.gte("match_date",S),v.value&&(o=o.eq("club.city",v.value)),f.value&&(o=o.eq("gender",f.value));const{data:T,error:H}=await o.order("match_date").order("match_time");if(H)throw H;if(!T){b.value=[];return}const B=T.flatMap(c=>[...c.team1_players||[],...c.team2_players||[]]).filter(c=>c!=null);let O={};if(B.length>0){const{data:c,error:h}=await A.from("players").select("user_id, first_name, photo_url, category").in("user_id",[...new Set(B)]);if(h)throw h;O=(c||[]).reduce((G,J)=>(G[J.user_id]=J,G),{})}b.value=T.map(c=>({...c,club:c.club||{name:"N/A",city:"N/A",id:null},reservation:c.reservation||{total_price:0,start_time:"00:00",end_time:"00:00"},team1_players:(c.team1_players||[null,null]).map(h=>O[h]||null),team2_players:(c.team2_players||[null,null]).map(h=>O[h]||null)}))}catch(o){console.error("Error fetching matches:",o),b.value=[],F.notify({type:"negative",message:"Error al buscar juegos."})}finally{N.value=!1}},Q=(o,t,e)=>{var m;if(console.log(`Intentando unirse a juego ${o.id}, equipo ${t}, slot ${e}`),!o||!o.reservation||o.reservation.total_price===void 0||o.reservation.total_price===null||!((m=o.club)!=null&&m.id)){console.error("Datos incompletos del juego para proceder al pago:",o),F.notify({type:"negative",message:"Informaci\xF3n del juego incompleta para unirse."});return}const i=(o.reservation.total_price||0)/4;i<=0&&console.warn("El precio por jugador es cero o inv\xE1lido.");const _={summaryTitle:"Confirmar Uni\xF3n a Juego",itemDetails:[{label:"Club",value:o.club.name||"No especificado"},{label:"Fecha",value:V(o.match_date)},{label:"Hora",value:`${new Date(o.match_date+"T"+o.match_time).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})} hrs.`},{label:"Categor\xEDa",value:o.category||"N/A"},{label:"Precio (Tu parte)",value:`$${i.toFixed(2)}`}],baseData:{clubId:o.club.id,price:i,participants:1,type:"open_match_join",id:o.id},allowPaymentSplit:!1,showPublicToggle:!1,commissionRate:4,extraData:{matchId:o.id,teamToJoin:t,slotIndex:e,matchCategory:o.category,matchGender:o.gender,matchDate:o.match_date,matchTime:o.match_time,clubName:o.club.name}};R.setSummaryDetails(_),console.log("Datos para unirse a juego guardados en Pinia:",_),X.push({name:"OrderSummary"})};return re([v,g,f],L,{deep:!0}),ne(()=>{Z(),L()}),(o,t)=>(r(),u(ye,{view:"hHh lpR fFf",class:"bg-dark text-white"},{default:s(()=>[l(se,{elevated:"",class:"text-white"},{default:s(()=>[a("div",we,[a("div",Ce,[a("img",{src:"/padelplay.png",alt:"Logo",class:"logo-icon clickable-logo",onClick:t[0]||(t[0]=(...e)=>U(j)&&U(j)(...e))})]),a("div",Ne,[l(De)])]),l(xe)]),_:1}),l(ve,{class:"home"},{default:s(()=>[l(_e,{class:"q-pa-md"},{default:s(()=>[a("div",Qe,[a("div",Te,[l($,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e),options:x.value,label:"Ciudad",outlined:"",dense:"","options-dense":"",clearable:"","hide-selected":"","input-debounce":"300",onFilter:ee,onClear:t[2]||(t[2]=e=>v.value=null),dark:"",color:"black","label-color":"black","popup-content-class":"bg-black text-black"},{prepend:s(()=>[l(w,{name:"location_on",color:"black"})]),"no-option":s(()=>[l(I,null,{default:s(()=>[l(P,{class:"text-black"},{default:s(()=>t[7]||(t[7]=[k("No hay ciudades")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),a("div",Oe,[l($,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=e=>g.value=e),options:W.value,label:"Fecha",outlined:"",dense:"","options-dense":"",clearable:"",dark:"",color:"black","label-color":"black","popup-content-class":"bg-black text-black",onClear:t[4]||(t[4]=e=>g.value=null)},{prepend:s(()=>[l(w,{name:"calendar_month",color:"black"})]),"no-option":s(()=>[l(I,null,{default:s(()=>[l(P,{class:"text-black"},{default:s(()=>t[8]||(t[8]=[k("No hay opciones")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),a("div",qe,[l($,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=e=>f.value=e),options:K.value,label:"G\xE9nero",outlined:"",dense:"","options-dense":"",clearable:"",dark:"",color:"black","label-color":"black","popup-content-class":"bg-black text-black",onClear:t[6]||(t[6]=e=>f.value=null)},{prepend:s(()=>[l(w,{name:"wc",color:"black"})]),"no-option":s(()=>[l(I,null,{default:s(()=>[l(P,{class:"text-grey-8"},{default:s(()=>t[9]||(t[9]=[k("No hay opciones")])),_:1})]),_:1})]),_:1},8,["modelValue","options"])])]),a("div",Me,[b.value.length>0?(r(),u(pe,{key:0,class:"q-mt-md"},{default:s(()=>[(r(!0),d(ce,null,ie(b.value,e=>(r(),u(de,{key:e.id,clickable:"",class:"match-card"},{default:s(()=>[l(z,{class:"q-mt-md"},{default:s(()=>[a("strong",null,n(V(e.match_date))+" | "+n(new Date(e.match_date+"T"+e.match_time).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})),1),t[14]||(t[14]=a("br",null,null,-1)),t[15]||(t[15]=k(" Categor\xEDa")),l(w,{name:"o_sports_tennis"}),k(" "+n(e.category)+" ",1),a("div",Ie,[a("div",Pe,[a("div",$e,[e.team1_players[0]?(r(),d("div",je,[e.team1_players[0].photo_url?(r(),u(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team1_players[0].photo_url,alt:"Foto del jugador"},null,8,Fe)]),_:2},1024)):(r(),d("span",Ve,n(e.team1_players[0].first_name||"Jugador 1 Equipo 1"),1)),a("div",Le,n(e.team1_players[0].category),1)])):ue("",!0)]),a("div",Ee,[e.team1_players[1]?(r(),d("div",He,[e.team1_players[1].photo_url?(r(),u(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team1_players[1].photo_url,alt:"Foto del jugador"},null,8,Be)]),_:2},1024)):(r(),d("span",Ge,n(e.team1_players[1].first_name||"Jugador 1 Equipo 1"),1)),a("div",Je,n(e.team1_players[1].category),1)])):(r(),u(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>Q(e,1,1),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),a("div",Ue,[e.team2_players[0]?(r(),d("div",ze,[e.team2_players[0].photo_url?(r(),u(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team2_players[0].photo_url,alt:"Foto del jugador"},null,8,Ae)]),_:2},1024)):(r(),d("span",Xe,n(e.team2_players[0].first_name||"Jugador 1 Equipo 2"),1)),a("div",Re,n(e.team2_players[0].category),1)])):(r(),u(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>Q(e,2,0),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),a("div",We,[e.team2_players[1]?(r(),d("div",Ke,[e.team2_players[1].photo_url?(r(),u(C,{key:0,size:"40px"},{default:s(()=>[a("img",{src:e.team2_players[1].photo_url,alt:"Foto del jugador"},null,8,Ye)]),_:2},1024)):(r(),d("span",Ze,n(e.team2_players[1].first_name||"Jugador 2 Equipo 2"),1)),a("div",et,n(e.team2_players[1].category),1)])):(r(),u(q,{key:1,flat:"",round:"",icon:"o_person_add",onClick:M(i=>Q(e,2,1),["stop"]),title:"Unirse a este espacio"},null,8,["onClick"]))]),t[10]||(t[10]=a("div",{class:"line1"},null,-1)),t[11]||(t[11]=a("div",{class:"net"},null,-1)),t[12]||(t[12]=a("div",{class:"line2"},null,-1)),t[13]||(t[13]=a("div",{class:"horizontal-line"},null,-1))])])]),_:2},1024),l(z,{class:"club-info-section"},{default:s(()=>[a("div",tt,[a("img",{src:e.club.logo_url||"/logo.jpeg",alt:"Club Logo",class:"club-logo"},null,8,ot),a("span",at,n(e.club.name),1)]),t[17]||(t[17]=a("div",{class:"vertical-divider"},null,-1)),a("div",st,[a("span",lt,"$"+n(e.reservation.total_price/4)+" MXN",1),t[16]||(t[16]=a("br",null,null,-1)),a("span",rt,n(Y(e.reservation.start_time,e.reservation.end_time))+" minutos",1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})):N.value?(r(),d("div",nt,[t[18]||(t[18]=k("Buscando...")),t[19]||(t[19]=a("br",null,null,-1)),l(me,{color:"black",size:"xl"})])):(r(),d("div",it,t[20]||(t[20]=[a("p",null,"No se encontraron juegos.",-1)])))])]),_:1})]),_:1}),l(ge),l(Se)]),_:1}))}};export{Gt as default};
